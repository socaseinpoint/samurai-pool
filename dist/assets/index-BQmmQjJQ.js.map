{"version":3,"file":"index-BQmmQjJQ.js","sources":["../../src/core/GameLoop.ts","../../src/core/Input.ts","../../src/utils/math.ts","../../src/player/Player.ts","../../src/weapon/Weapon.ts","../../src/weapon/WeaponRenderer.ts","../../src/enemies/Target.ts","../../src/items/Pickup.ts","../../src/audio/AudioManager.ts","../../src/render/Shaders.ts","../../src/render/WebGLRenderer.ts","../../src/render/HUD.ts","../../src/world/Collision.ts","../../src/core/Game.ts","../../src/main.ts"],"sourcesContent":["/**\n * Игровой цикл с фиксированным временным шагом\n */\nexport class GameLoop {\n  /** Функция обновления логики */\n  private updateFn: (dt: number) => void;\n\n  /** Функция рендеринга */\n  private renderFn: (interpolation: number) => void;\n\n  /** Время последнего кадра */\n  private lastTime = 0;\n\n  /** Накопленное время */\n  private accumulator = 0;\n\n  /** Фиксированный временной шаг (60 FPS) */\n  public readonly fixedDeltaTime = 1 / 60;\n\n  /** ID запроса анимации */\n  private animationFrameId: number | null = null;\n\n  /** Цикл запущен */\n  public isRunning = false;\n\n  /** Текущий FPS */\n  public fps = 0;\n\n  /** Счётчик кадров для FPS */\n  private frameCount = 0;\n\n  /** Время последнего замера FPS */\n  private fpsTime = 0;\n\n  constructor(\n    updateFn: (dt: number) => void,\n    renderFn: (interpolation: number) => void\n  ) {\n    this.updateFn = updateFn;\n    this.renderFn = renderFn;\n  }\n\n  /** Запустить цикл */\n  public start(): void {\n    if (this.isRunning) return;\n\n    this.isRunning = true;\n    this.lastTime = performance.now();\n    this.fpsTime = this.lastTime;\n    this.frameCount = 0;\n    this.animationFrameId = requestAnimationFrame(this.tick.bind(this));\n  }\n\n  /** Остановить цикл */\n  public stop(): void {\n    if (!this.isRunning) return;\n\n    this.isRunning = false;\n    if (this.animationFrameId !== null) {\n      cancelAnimationFrame(this.animationFrameId);\n      this.animationFrameId = null;\n    }\n  }\n\n  /** Один тик игрового цикла */\n  private tick(currentTime: number): void {\n    if (!this.isRunning) return;\n\n    // Вычисляем дельту времени\n    const deltaTime = Math.min((currentTime - this.lastTime) / 1000, 0.1);\n    this.lastTime = currentTime;\n\n    // Обновляем FPS\n    this.frameCount++;\n    if (currentTime - this.fpsTime >= 1000) {\n      this.fps = this.frameCount;\n      this.frameCount = 0;\n      this.fpsTime = currentTime;\n    }\n\n    // Накапливаем время для фиксированного шага\n    this.accumulator += deltaTime;\n\n    // Выполняем обновления с фиксированным шагом\n    while (this.accumulator >= this.fixedDeltaTime) {\n      this.updateFn(this.fixedDeltaTime);\n      this.accumulator -= this.fixedDeltaTime;\n    }\n\n    // Рендерим с интерполяцией\n    const interpolation = this.accumulator / this.fixedDeltaTime;\n    this.renderFn(interpolation);\n\n    // Следующий кадр\n    this.animationFrameId = requestAnimationFrame(this.tick.bind(this));\n  }\n}\n\n","import type { InputState } from '@/types';\n\n/**\n * Менеджер ввода\n * Обрабатывает клавиатуру и мышь\n */\nexport class Input {\n  /** Текущее состояние ввода */\n  public state: InputState = {\n    forward: false,\n    backward: false,\n    left: false,\n    right: false,\n    run: false,\n    jump: false,\n    fire: false,\n    altFire: false, // ПКМ для сплеш-атаки\n    reload: false,\n  };\n\n  /** Движение мыши за кадр */\n  public mouseDelta = { x: 0, y: 0 };\n\n  /** Pointer Lock активен */\n  public isPointerLocked = false;\n\n  /** Чувствительность мыши (выше = быстрее) */\n  public sensitivity = 0.005;\n\n  /** Установить чувствительность */\n  public setSensitivity(value: number): void {\n    this.sensitivity = Math.max(0.001, Math.min(0.015, value));\n  }\n\n  /** Инвертировать ось X */\n  public invertX = true;\n\n  /** Инвертировать ось Y */\n  public invertY = true;\n\n  private canvas: HTMLCanvasElement;\n  private onPointerLockChange?: () => void;\n\n  constructor(canvas: HTMLCanvasElement) {\n    this.canvas = canvas;\n    this.setupListeners();\n  }\n\n  /** Настройка обработчиков событий */\n  private setupListeners(): void {\n    // Клавиатура\n    document.addEventListener('keydown', this.handleKeyDown.bind(this));\n    document.addEventListener('keyup', this.handleKeyUp.bind(this));\n\n    // Мышь\n    document.addEventListener('mousemove', this.handleMouseMove.bind(this));\n    document.addEventListener('mousedown', this.handleMouseDown.bind(this));\n    document.addEventListener('mouseup', this.handleMouseUp.bind(this));\n\n    // Отключаем контекстное меню для ПКМ\n    this.canvas.addEventListener('contextmenu', (e) => e.preventDefault());\n\n    // Pointer Lock\n    document.addEventListener('pointerlockchange', this.handlePointerLockChange.bind(this));\n  }\n\n  /** Запросить Pointer Lock */\n  public requestPointerLock(onLockChange?: () => void): void {\n    this.onPointerLockChange = onLockChange;\n    this.canvas.requestPointerLock();\n  }\n\n  /** Выйти из Pointer Lock */\n  public exitPointerLock(): void {\n    document.exitPointerLock();\n  }\n\n  /** Сбросить дельту мыши (вызывать в конце кадра) */\n  public resetMouseDelta(): void {\n    this.mouseDelta.x = 0;\n    this.mouseDelta.y = 0;\n  }\n\n  /** Обработка нажатия клавиши */\n  private handleKeyDown(e: KeyboardEvent): void {\n    this.updateKeyState(e.code, true);\n  }\n\n  /** Обработка отпускания клавиши */\n  private handleKeyUp(e: KeyboardEvent): void {\n    this.updateKeyState(e.code, false);\n  }\n\n  /** Обновление состояния клавиши */\n  private updateKeyState(code: string, pressed: boolean): void {\n    switch (code) {\n      case 'KeyW':\n        this.state.forward = pressed;\n        break;\n      case 'KeyS':\n        this.state.backward = pressed;\n        break;\n      case 'KeyA':\n        this.state.left = pressed;\n        break;\n      case 'KeyD':\n        this.state.right = pressed;\n        break;\n      case 'ShiftLeft':\n      case 'ShiftRight':\n        this.state.run = pressed;\n        break;\n      case 'Space':\n        this.state.jump = pressed;\n        break;\n      case 'KeyR':\n        this.state.reload = pressed;\n        break;\n    }\n  }\n\n  /** Обработка движения мыши */\n  private handleMouseMove(e: MouseEvent): void {\n    if (!this.isPointerLocked) return;\n\n    // Инверсия осей как в оригинале\n    const dx = this.invertX ? -e.movementX : e.movementX;\n    const dy = this.invertY ? -e.movementY : e.movementY;\n\n    this.mouseDelta.x += dx * this.sensitivity;\n    this.mouseDelta.y += dy * this.sensitivity;\n  }\n\n  /** Обработка нажатия кнопки мыши */\n  private handleMouseDown(e: MouseEvent): void {\n    if (e.button === 0) {\n      this.state.fire = true;\n    } else if (e.button === 2) {\n      e.preventDefault();\n      this.state.altFire = true;\n    }\n  }\n\n  /** Обработка отпускания кнопки мыши */\n  private handleMouseUp(e: MouseEvent): void {\n    if (e.button === 0) {\n      this.state.fire = false;\n    } else if (e.button === 2) {\n      this.state.altFire = false;\n    }\n  }\n\n  /** Обработка изменения Pointer Lock */\n  private handlePointerLockChange(): void {\n    this.isPointerLocked = document.pointerLockElement === this.canvas;\n    this.onPointerLockChange?.();\n  }\n\n  /** Удалить обработчики */\n  public destroy(): void {\n    document.removeEventListener('keydown', this.handleKeyDown.bind(this));\n    document.removeEventListener('keyup', this.handleKeyUp.bind(this));\n    document.removeEventListener('mousemove', this.handleMouseMove.bind(this));\n    document.removeEventListener('mousedown', this.handleMouseDown.bind(this));\n    document.removeEventListener('mouseup', this.handleMouseUp.bind(this));\n    document.removeEventListener('pointerlockchange', this.handlePointerLockChange.bind(this));\n  }\n}\n\n","import type { Vec3, Vec2 } from '@/types';\n\n// ========== СОЗДАНИЕ ВЕКТОРОВ ==========\n\n/** Создать Vec3 */\nexport function vec3(x: number = 0, y: number = 0, z: number = 0): Vec3 {\n  return { x, y, z };\n}\n\n/** Создать Vec2 */\nexport function vec2(x: number = 0, y: number = 0): Vec2 {\n  return { x, y };\n}\n\n// ========== ОПЕРАЦИИ С VEC3 ==========\n\n/** Сложение векторов */\nexport function addVec3(a: Vec3, b: Vec3): Vec3 {\n  return { x: a.x + b.x, y: a.y + b.y, z: a.z + b.z };\n}\n\n/** Вычитание векторов */\nexport function subVec3(a: Vec3, b: Vec3): Vec3 {\n  return { x: a.x - b.x, y: a.y - b.y, z: a.z - b.z };\n}\n\n/** Умножение на скаляр */\nexport function mulVec3(v: Vec3, s: number): Vec3 {\n  return { x: v.x * s, y: v.y * s, z: v.z * s };\n}\n\n/** Длина вектора */\nexport function lengthVec3(v: Vec3): number {\n  return Math.sqrt(v.x * v.x + v.y * v.y + v.z * v.z);\n}\n\n/** Длина XZ компоненты */\nexport function lengthXZ(v: Vec3): number {\n  return Math.sqrt(v.x * v.x + v.z * v.z);\n}\n\n/** Нормализация вектора */\nexport function normalizeVec3(v: Vec3): Vec3 {\n  const len = lengthVec3(v);\n  if (len === 0) return { x: 0, y: 0, z: 0 };\n  return { x: v.x / len, y: v.y / len, z: v.z / len };\n}\n\n/** Скалярное произведение */\nexport function dotVec3(a: Vec3, b: Vec3): number {\n  return a.x * b.x + a.y * b.y + a.z * b.z;\n}\n\n/** Векторное произведение */\nexport function crossVec3(a: Vec3, b: Vec3): Vec3 {\n  return {\n    x: a.y * b.z - a.z * b.y,\n    y: a.z * b.x - a.x * b.z,\n    z: a.x * b.y - a.y * b.x,\n  };\n}\n\n/** Линейная интерполяция */\nexport function lerpVec3(a: Vec3, b: Vec3, t: number): Vec3 {\n  return {\n    x: a.x + (b.x - a.x) * t,\n    y: a.y + (b.y - a.y) * t,\n    z: a.z + (b.z - a.z) * t,\n  };\n}\n\n/** Расстояние между точками */\nexport function distanceVec3(a: Vec3, b: Vec3): number {\n  return lengthVec3(subVec3(a, b));\n}\n\n// ========== УТИЛИТЫ ==========\n\n/** Ограничить значение */\nexport function clamp(value: number, min: number, max: number): number {\n  return Math.max(min, Math.min(max, value));\n}\n\n/** Линейная интерполяция чисел */\nexport function lerp(a: number, b: number, t: number): number {\n  return a + (b - a) * t;\n}\n\n/** Плавный переход (smoothstep) */\nexport function smoothstep(edge0: number, edge1: number, x: number): number {\n  const t = clamp((x - edge0) / (edge1 - edge0), 0, 1);\n  return t * t * (3 - 2 * t);\n}\n\n/** Градусы в радианы */\nexport function degToRad(deg: number): number {\n  return deg * (Math.PI / 180);\n}\n\n/** Радианы в градусы */\nexport function radToDeg(rad: number): number {\n  return rad * (180 / Math.PI);\n}\n\n/** Случайное число в диапазоне */\nexport function randomRange(min: number, max: number): number {\n  return min + Math.random() * (max - min);\n}\n\n/** Случайный Vec3 в сфере */\nexport function randomInSphere(radius: number): Vec3 {\n  const theta = Math.random() * Math.PI * 2;\n  const phi = Math.acos(2 * Math.random() - 1);\n  const r = radius * Math.cbrt(Math.random());\n  return {\n    x: r * Math.sin(phi) * Math.cos(theta),\n    y: r * Math.sin(phi) * Math.sin(theta),\n    z: r * Math.cos(phi),\n  };\n}\n\n","import type { PlayerState, MovementConfig, InputState, Vec3, ICollisionSystem } from '@/types';\nimport { vec3, clamp } from '@/utils/math';\n\n/** Конфигурация по умолчанию */\nconst DEFAULT_CONFIG: MovementConfig = {\n  walkSpeed: 8.0,\n  runSpeed: 20.0,\n  jumpForce: 8.0,\n  gravity: 25.0,\n  groundFriction: 12.0,\n  airControl: 0.3,\n  mouseSensitivity: 0.002, // Высокая чувствительность\n};\n\n/**\n * Игрок\n * Управление позицией, движением и камерой\n * Поддержка лестниц через getFloorHeight\n */\nexport class Player {\n  /** Состояние игрока */\n  public state: PlayerState;\n\n  /** Конфигурация движения */\n  public config: MovementConfig;\n\n  /** Система коллизий */\n  private collision: ICollisionSystem;\n\n  /** Скорость подъёма/спуска по лестницам */\n  private stepSpeed = 12.0;\n\n  /** Максимальная высота автоматического подъёма */\n  private maxStepHeight = 0.5;\n\n  /** Целевые значения камеры */\n  private targetYaw = 0;\n  private targetPitch = -0.05;\n\n  /** Кулдаун двойного прыжка (секунды) */\n  private doubleJumpCooldown = 0;\n  \n  /** Время кулдауна двойного прыжка */\n  private readonly DOUBLE_JUMP_COOLDOWN = 2.5;\n\n  /** Можно ли делать двойной прыжок (отпустили ли Space после первого) */\n  private canDoubleJump = false;\n\n  /** Режим буйства */\n  public rageMode = false;\n  public rageModeTimer = 0;\n\n  /** Модификатор скорости (стимпак) */\n  public speedBoost = 1.0;\n  public speedBoostTimer = 0;\n\n  constructor(\n    startPosition: Vec3 = vec3(0, 1.7, 5),\n    config: Partial<MovementConfig> = {},\n    collision: ICollisionSystem\n  ) {\n    this.config = { ...DEFAULT_CONFIG, ...config };\n    this.collision = collision;\n\n    this.state = {\n      position: { ...startPosition },\n      velocity: vec3(),\n      yaw: 0, // Смотрим вперёд\n      pitch: -0.05, // Слегка вниз\n      grounded: true,\n      eyeHeight: 1.7, // Высота глаз над полом\n      health: 100,\n      maxHealth: 100,\n    };\n  }\n\n  /** Обновление игрока */\n  public update(dt: number, input: InputState, mouseDelta: { x: number; y: number }): void {\n    // Обновляем таймеры буйства и скорости\n    if (this.rageModeTimer > 0) {\n      this.rageModeTimer -= dt;\n      if (this.rageModeTimer <= 0) {\n        this.rageMode = false;\n      }\n    }\n    if (this.speedBoostTimer > 0) {\n      this.speedBoostTimer -= dt;\n      if (this.speedBoostTimer <= 0) {\n        this.speedBoost = 1.0;\n      }\n    }\n    \n    // Обновляем кулдаун двойного прыжка\n    if (this.doubleJumpCooldown > 0) {\n      this.doubleJumpCooldown -= dt;\n    }\n\n    // Обновляем камеру\n    this.updateCamera(mouseDelta);\n\n    // Обновляем движение\n    this.updateMovement(dt, input);\n  }\n\n  /** Активировать стимпак */\n  public activateStimpack(): void {\n    this.rageMode = true;\n    this.rageModeTimer = 8.0; // 8 секунд буйства\n    this.speedBoost = 1.8; // +80% скорости\n    this.speedBoostTimer = 8.0;\n  }\n\n  /** Попытка двойного прыжка - возвращает true если выполнен */\n  public tryDoubleJump(): boolean {\n    // Нужно отпустить Space после первого прыжка\n    if (!this.canDoubleJump) return false;\n    \n    // В режиме буйства - без кулдауна!\n    if (this.rageMode) {\n      this.state.velocity.y = this.config.jumpForce * 0.85;\n      this.canDoubleJump = false; // Требуем отпустить Space\n      return true;\n    }\n    \n    // Обычный двойной прыжок с кулдауном\n    if (this.doubleJumpCooldown <= 0) {\n      this.doubleJumpCooldown = this.DOUBLE_JUMP_COOLDOWN;\n      this.state.velocity.y = this.config.jumpForce * 0.95;\n      this.canDoubleJump = false; // Требуем отпустить Space\n      return true;\n    }\n    \n    return false;\n  }\n\n  /** Сообщить что Space отпущен - можно делать двойной прыжок */\n  public onJumpReleased(): void {\n    if (!this.state.grounded) {\n      this.canDoubleJump = true;\n    }\n  }\n\n  /** Получить оставшийся кулдаун двойного прыжка */\n  public getDoubleJumpCooldown(): number {\n    return Math.max(0, this.doubleJumpCooldown);\n  }\n\n  /** Готов ли двойной прыжок */\n  public isDoubleJumpReady(): boolean {\n    return this.doubleJumpCooldown <= 0 || this.rageMode;\n  }\n\n  /** Обновление камеры - быстрое и лёгкое */\n  private updateCamera(mouseDelta: { x: number; y: number }): void {\n    // Прямое применение движения мыши к целевым углам\n    this.targetYaw -= mouseDelta.x;\n    this.targetPitch += mouseDelta.y;\n\n    // Ограничиваем pitch\n    this.targetPitch = clamp(this.targetPitch, -Math.PI / 2 + 0.01, Math.PI / 2 - 0.01);\n\n    // Быстрая интерполяция (0.7 = почти мгновенно, но чуть сглажено)\n    this.state.yaw += (this.targetYaw - this.state.yaw) * 0.7;\n    this.state.pitch += (this.targetPitch - this.state.pitch) * 0.7;\n  }\n\n  /** Обновление движения с поддержкой лестниц */\n  private updateMovement(dt: number, input: InputState): void {\n    const { state, config } = this;\n\n    // Направление движения от ввода\n    let moveX = 0;\n    let moveZ = 0;\n\n    if (input.forward) moveZ -= 1;\n    if (input.backward) moveZ += 1;\n    if (input.left) moveX -= 1;\n    if (input.right) moveX += 1;\n\n    // Нормализуем если движемся по диагонали\n    const moveLen = Math.sqrt(moveX * moveX + moveZ * moveZ);\n    if (moveLen > 0) {\n      moveX /= moveLen;\n      moveZ /= moveLen;\n    }\n\n    // Поворачиваем направление по yaw\n    const sin = Math.sin(state.yaw);\n    const cos = Math.cos(state.yaw);\n    const worldMoveX = moveX * cos - moveZ * sin;\n    const worldMoveZ = moveX * sin + moveZ * cos;\n\n    // Скорость (бег или ходьба) с учётом буста\n    const baseSpeed = input.run ? config.runSpeed : config.walkSpeed;\n    const speed = baseSpeed * this.speedBoost;\n\n    // Целевая скорость\n    const targetVx = worldMoveX * speed;\n    const targetVz = worldMoveZ * speed;\n\n    // Получаем высоту пола в текущей позиции\n    const currentFloorHeight = this.collision.getFloorHeight(state.position);\n    const targetY = currentFloorHeight + state.eyeHeight;\n\n    if (state.grounded) {\n      // На земле — полный контроль и трение\n      const friction = config.groundFriction * dt;\n      state.velocity.x += (targetVx - state.velocity.x) * Math.min(friction, 1);\n      state.velocity.z += (targetVz - state.velocity.z) * Math.min(friction, 1);\n\n      // Прыжок\n      if (input.jump) {\n        state.velocity.y = config.jumpForce;\n        state.grounded = false;\n      } else {\n        // Плавное следование за полом (лестницы)\n        const heightDiff = targetY - state.position.y;\n        \n        if (Math.abs(heightDiff) < 0.01) {\n          // Почти на уровне - просто выравниваем\n          state.position.y = targetY;\n          state.velocity.y = 0;\n        } else if (heightDiff > 0 && heightDiff < this.maxStepHeight) {\n          // Подъём по лестнице - плавно поднимаемся\n          state.velocity.y = this.stepSpeed;\n        } else if (heightDiff < 0 && heightDiff > -this.maxStepHeight) {\n          // Спуск по лестнице - плавно опускаемся\n          state.velocity.y = -this.stepSpeed * 0.8;\n        } else if (heightDiff < -this.maxStepHeight) {\n          // Большой спуск - начинаем падать\n          state.grounded = false;\n          state.velocity.y = 0;\n        }\n      }\n    } else {\n      // В воздухе — ограниченный контроль\n      state.velocity.x += (targetVx - state.velocity.x) * config.airControl * dt;\n      state.velocity.z += (targetVz - state.velocity.z) * config.airControl * dt;\n\n      // Гравитация\n      state.velocity.y -= config.gravity * dt;\n    }\n\n    // Применяем скорость к позиции\n    const newPosX = state.position.x + state.velocity.x * dt;\n    const newPosY = state.position.y + state.velocity.y * dt;\n    const newPosZ = state.position.z + state.velocity.z * dt;\n\n    // Проверяем коллизии по осям отдельно\n    // X\n    const testPosX = { x: newPosX, y: state.position.y, z: state.position.z };\n    if (!this.collision.checkCollision(testPosX)) {\n      state.position.x = newPosX;\n    } else {\n      state.velocity.x = 0;\n    }\n\n    // Z\n    const testPosZ = { x: state.position.x, y: state.position.y, z: newPosZ };\n    if (!this.collision.checkCollision(testPosZ)) {\n      state.position.z = newPosZ;\n    } else {\n      state.velocity.z = 0;\n    }\n\n    // Y (вертикаль) - с учётом пола\n    const newFloorHeight = this.collision.getFloorHeight(state.position);\n    const minY = newFloorHeight + state.eyeHeight;\n\n    if (!state.grounded) {\n      // В воздухе - проверяем приземление\n      if (newPosY <= minY) {\n        // Приземлились\n        state.position.y = minY;\n        state.velocity.y = 0;\n        state.grounded = true;\n        this.canDoubleJump = false; // Сброс разрешения на двойной прыжок\n      } else {\n        // Ещё летим\n        const testPosY = { x: state.position.x, y: newPosY, z: state.position.z };\n        const ceilingHeight = this.collision.getCeilingHeight(state.position);\n        \n        if (newPosY < ceilingHeight - 0.3 && !this.collision.checkCollision(testPosY)) {\n          state.position.y = newPosY;\n        } else {\n          // Упёрлись в потолок\n          state.velocity.y = Math.min(state.velocity.y, 0);\n        }\n      }\n    } else {\n      // На земле - плавно следуем за полом\n      state.position.y += state.velocity.y * dt;\n      \n      // Не проваливаемся ниже пола\n      if (state.position.y < minY) {\n        state.position.y = minY;\n        state.velocity.y = 0;\n      }\n    }\n  }\n\n  /** Получить позицию глаз */\n  public getEyePosition(): Vec3 {\n    return {\n      x: this.state.position.x,\n      y: this.state.position.y,\n      z: this.state.position.z,\n    };\n  }\n\n  /** Получить направление взгляда */\n  public getLookDirection(): Vec3 {\n    const { yaw, pitch } = this.state;\n    return {\n      x: Math.sin(yaw) * Math.cos(pitch),\n      y: Math.sin(pitch),\n      z: -Math.cos(yaw) * Math.cos(pitch),\n    };\n  }\n\n  /** Нанести урон */\n  public takeDamage(amount: number): void {\n    this.state.health = Math.max(0, this.state.health - amount);\n  }\n\n  /** Вылечить */\n  public heal(amount: number): void {\n    this.state.health = Math.min(this.state.maxHealth, this.state.health + amount);\n  }\n\n  /** Игрок мёртв? */\n  public isDead(): boolean {\n    return this.state.health <= 0;\n  }\n\n  /** Сброс позиции */\n  public reset(position: Vec3): void {\n    this.state.position = { ...position };\n    this.state.velocity = vec3();\n    this.state.health = this.state.maxHealth;\n    this.state.grounded = true;\n  }\n}\n","import type { WeaponState, Vec3 } from '@/types';\n\n/** Тип оружия */\nexport type WeaponType = 'katana' | 'charged';\n\n/**\n * Катана - оружие ближнего боя\n * ЛКМ = обычный взмах\n * ПКМ = сплеш-волна (если заряжена)\n */\nexport class Weapon {\n  /** Состояние оружия */\n  public state: WeaponState;\n\n  /** Текущий тип оружия */\n  public currentWeapon: WeaponType = 'katana';\n\n  /** Заряды сплеш-атаки */\n  public splashCharges = 0;\n\n  /** Время до следующего удара */\n  private attackCooldown = 0;\n\n  /** Время атаки */\n  private attackDuration = 0.3;\n\n  /** Перезарядка между ударами */\n  private attackCooldownTime = 0.4;\n\n  /** Дальность удара */\n  public attackRange = 4.0;\n\n  /** Угол атаки (радианы) */\n  public attackAngle = Math.PI * 0.6; // 108 градусов\n\n  /** Урон */\n  public damage = 100;\n\n  /** Сейчас атакуем? */\n  public isAttacking = false;\n\n  /** Прогресс атаки (0-1) */\n  public attackProgress = 0;\n\n  /** Callback при ударе */\n  public onSlice?: () => void;\n\n  /** Callback при сплеш-атаке */\n  public onSplash?: () => void;\n\n  /** Это сплеш-атака? */\n  public isSplashAttack = false;\n\n  /** Радиус сплеш-волны */\n  public splashRadius = 10.0;\n\n  constructor() {\n    this.state = {\n      ammo: 999,\n      reserveAmmo: 999,\n      magazineSize: 999,\n      isReloading: false,\n      reloadTimeLeft: 0,\n      recoilX: 0,\n      recoilY: 0,\n      recoilBack: 0,\n      muzzleFlash: 0,\n      bobPhase: 0,\n    };\n  }\n\n  /** Обновление оружия */\n  public update(dt: number, isMoving: boolean, isRunning: boolean): void {\n    // Кулдаун атаки\n    if (this.attackCooldown > 0) {\n      this.attackCooldown -= dt;\n    }\n\n    // Прогресс анимации атаки\n    if (this.isAttacking) {\n      this.attackProgress += dt / this.attackDuration;\n      if (this.attackProgress >= 1) {\n        this.isAttacking = false;\n        this.attackProgress = 0;\n      }\n    }\n\n    // Покачивание при ходьбе\n    if (isMoving) {\n      const bobSpeed = isRunning ? 14 : 10;\n      this.state.bobPhase += dt * bobSpeed;\n    } else {\n      this.state.bobPhase *= 0.95;\n    }\n\n    // Затухание эффектов\n    this.state.recoilX *= 0.85;\n    this.state.recoilY *= 0.85;\n    this.state.muzzleFlash *= 0.8;\n  }\n\n  /** Попытка обычного удара (ЛКМ) */\n  public tryAttack(): boolean {\n    if (this.attackCooldown > 0) return false;\n    if (this.isAttacking) return false;\n\n    this.attack(false);\n    return true;\n  }\n\n  /** Попытка сплеш-атаки (ПКМ) */\n  public trySplashAttack(): boolean {\n    if (this.attackCooldown > 0) return false;\n    if (this.isAttacking) return false;\n    if (this.splashCharges <= 0) return false;\n\n    this.attack(true);\n    return true;\n  }\n\n  /** Удар катаной */\n  private attack(isSplash: boolean): void {\n    this.isAttacking = true;\n    this.attackProgress = 0;\n    this.attackCooldown = isSplash ? 0.6 : this.attackCooldownTime;\n    this.isSplashAttack = isSplash;\n    \n    if (isSplash) {\n      // Сплеш-волна\n      this.splashCharges--;\n      this.state.recoilX = 0.6;\n      this.state.muzzleFlash = 2.0;\n      \n      // Если закончились заряды - возвращаемся к обычной катане\n      if (this.splashCharges <= 0) {\n        this.currentWeapon = 'katana';\n      }\n      \n      this.onSplash?.();\n    } else {\n      // Обычный удар\n      this.state.recoilX = 0.3;\n      this.state.muzzleFlash = 1.0;\n      this.onSlice?.();\n    }\n  }\n\n  /** Зарядить катану (подбор на балконе) */\n  public chargeKatana(): void {\n    this.currentWeapon = 'charged';\n    this.splashCharges = 3; // 3 сплеш-удара\n  }\n\n  /** Проверить заряжена ли */\n  public isCharged(): boolean {\n    return this.splashCharges > 0;\n  }\n\n  /** Проверка попадания по врагу */\n  public checkHit(playerPos: Vec3, playerYaw: number, targetPos: Vec3): boolean {\n    if (!this.isAttacking) return false;\n    // Попадаем только в середине анимации\n    if (this.attackProgress < 0.2 || this.attackProgress > 0.6) return false;\n\n    // Вектор к цели\n    const dx = targetPos.x - playerPos.x;\n    const dz = targetPos.z - playerPos.z;\n    const dist = Math.sqrt(dx * dx + dz * dz);\n\n    // Сплеш-атака топором - бьёт всех в радиусе!\n    if (this.isSplashAttack) {\n      return dist <= this.splashRadius;\n    }\n\n    // Обычная атака катаной - проверка дистанции\n    if (dist > this.attackRange) return false;\n\n    // Проверка угла\n    const angleToTarget = Math.atan2(dx, -dz);\n    let angleDiff = angleToTarget - playerYaw;\n    \n    // Нормализуем угол\n    while (angleDiff > Math.PI) angleDiff -= Math.PI * 2;\n    while (angleDiff < -Math.PI) angleDiff += Math.PI * 2;\n\n    return Math.abs(angleDiff) < this.attackAngle / 2;\n  }\n\n  /** Получить смещение от покачивания */\n  public getWeaponOffset(): { x: number; y: number; z: number } {\n    const bobX = Math.sin(this.state.bobPhase) * 0.02;\n    const bobY = Math.abs(Math.sin(this.state.bobPhase * 2)) * 0.015;\n\n    // Анимация атаки\n    let attackOffsetX = 0;\n    let attackOffsetY = 0;\n\n    if (this.isAttacking) {\n      // Взмах справа налево\n      const t = this.attackProgress;\n      attackOffsetX = Math.sin(t * Math.PI) * 0.3;\n      attackOffsetY = -Math.sin(t * Math.PI * 2) * 0.1;\n    }\n\n    return {\n      x: bobX + this.state.recoilX + attackOffsetX,\n      y: bobY - this.state.recoilY + attackOffsetY,\n      z: 0,\n    };\n  }\n\n  // Заглушки для совместимости\n  public tryShoot(_playerPos: Vec3, _playerDir: Vec3): boolean {\n    return this.tryAttack();\n  }\n  \n  public startReload(): boolean {\n    return false;\n  }\n  \n  public projectiles: never[] = [];\n}\n","import type { WeaponState } from '@/types';\nimport type { WeaponType } from './Weapon';\n\n/** 2D частица для эффектов */\ninterface Particle {\n  x: number;\n  y: number;\n  vx: number;\n  vy: number;\n  size: number;\n  color: string;\n  life: number;\n  maxLife: number;\n  type: 'fragment' | 'spark' | 'trail';\n}\n\n/**\n * Рендерер катаны в стиле Retrowave\n * Неоновые эффекты при взмахе + частицы осколков\n */\nexport class WeaponRenderer {\n  private ctx: CanvasRenderingContext2D;\n  private width: number;\n  private height: number;\n\n  /** Прогресс атаки (0-1) */\n  public attackProgress = 0;\n\n  /** Сейчас атакуем? */\n  public isAttacking = false;\n\n  /** Это сплеш-атака? */\n  public isSplashAttack = false;\n\n  /** Заряды сплеша */\n  public splashCharges = 0;\n\n  /** Вспышка попадания */\n  private hitFlash = 0;\n\n  /** Частицы */\n  private particles: Particle[] = [];\n\n  /** Активна сплеш-волна */\n  private splashWaveActive = false;\n  \n  /** Прогресс волны (0-1) */\n  private splashWaveProgress = 0;\n  \n  /** Направление волны (yaw) */\n  private splashWaveYaw = 0;\n\n  constructor(canvas: HTMLCanvasElement) {\n    this.ctx = canvas.getContext('2d')!;\n    this.width = canvas.width;\n    this.height = canvas.height;\n  }\n\n  public resize(width: number, height: number): void {\n    this.width = width;\n    this.height = height;\n  }\n\n  /** Показать эффект попадания - взрыв осколков! */\n  public showHitEffect(): void {\n    this.hitFlash = 1.0;\n    this.spawnFragments();\n  }\n\n  /** Показать эффект сплеш-атаки топором! */\n  public showSplashEffect(): void {\n    this.hitFlash = 1.2;\n    this.spawnAxeSplash();\n  }\n\n  /** Показать горизонтальную сплеш-волну! */\n  public showSplashWave(yaw: number): void {\n    this.splashWaveActive = true;\n    this.splashWaveProgress = 0;\n    this.splashWaveYaw = yaw;\n    this.hitFlash = 1.5;\n    this.spawnWaveParticles();\n  }\n\n  /** Создать частицы волны */\n  private spawnWaveParticles(): void {\n    const centerX = this.width / 2;\n    const centerY = this.height / 2;\n    // Голубые/бирюзовые цвета для волны\n    const colors = ['#00ffff', '#00e5ff', '#00bfff', '#40e0d0', '#48d1cc', '#7fffd4'];\n\n    // Частицы расходятся горизонтально веером\n    for (let i = 0; i < 30; i++) {\n      const angle = (i / 30) * Math.PI - Math.PI / 2; // От -90 до +90 градусов (вперёд)\n      const speed = 800 + Math.random() * 400;\n      this.particles.push({\n        x: centerX,\n        y: centerY,\n        vx: Math.cos(angle) * speed,\n        vy: Math.sin(angle) * speed * 0.3, // Больше горизонтальное движение\n        size: 6 + Math.random() * 8,\n        color: colors[Math.floor(Math.random() * colors.length)],\n        life: 0.6 + Math.random() * 0.4,\n        maxLife: 0.6 + Math.random() * 0.4,\n        type: 'spark',\n      });\n    }\n\n    // Большие капли энергии\n    for (let i = 0; i < 15; i++) {\n      const angle = (Math.random() - 0.5) * Math.PI * 0.8;\n      const speed = 600 + Math.random() * 300;\n      this.particles.push({\n        x: centerX + (Math.random() - 0.5) * 100,\n        y: centerY + (Math.random() - 0.5) * 50,\n        vx: Math.cos(angle) * speed,\n        vy: Math.sin(angle) * speed * 0.2,\n        size: 12 + Math.random() * 18,\n        color: colors[Math.floor(Math.random() * colors.length)],\n        life: 0.8 + Math.random() * 0.4,\n        maxLife: 0.8 + Math.random() * 0.4,\n        type: 'fragment',\n      });\n    }\n  }\n\n  /** Создать осколки врага (кислотная жижа!) */\n  private spawnFragments(): void {\n    const centerX = this.width / 2;\n    const centerY = this.height / 2;\n    // Зелёные кислотные цвета\n    const colors = ['#00ff00', '#33ff00', '#66ff33', '#00ff66', '#99ff00', '#00ff99'];\n\n    // Крупные осколки\n    for (let i = 0; i < 12; i++) {\n      const angle = (i / 12) * Math.PI * 2 + Math.random() * 0.5;\n      const speed = 400 + Math.random() * 600;\n      this.particles.push({\n        x: centerX + (Math.random() - 0.5) * 50,\n        y: centerY + (Math.random() - 0.5) * 50,\n        vx: Math.cos(angle) * speed,\n        vy: Math.sin(angle) * speed - 200,\n        size: 8 + Math.random() * 12,\n        color: colors[Math.floor(Math.random() * colors.length)],\n        life: 0.8 + Math.random() * 0.5,\n        maxLife: 0.8 + Math.random() * 0.5,\n        type: 'fragment',\n      });\n    }\n\n    // Искры\n    for (let i = 0; i < 25; i++) {\n      const angle = Math.random() * Math.PI * 2;\n      const speed = 200 + Math.random() * 500;\n      this.particles.push({\n        x: centerX + (Math.random() - 0.5) * 30,\n        y: centerY + (Math.random() - 0.5) * 30,\n        vx: Math.cos(angle) * speed,\n        vy: Math.sin(angle) * speed - 100,\n        size: 2 + Math.random() * 4,\n        color: colors[Math.floor(Math.random() * colors.length)],\n        life: 0.4 + Math.random() * 0.4,\n        maxLife: 0.4 + Math.random() * 0.4,\n        type: 'spark',\n      });\n    }\n  }\n\n  /** Обновить частицы */\n  private updateParticles(dt: number): void {\n    const gravity = 800;\n\n    for (let i = this.particles.length - 1; i >= 0; i--) {\n      const p = this.particles[i];\n\n      // Физика\n      p.x += p.vx * dt;\n      p.y += p.vy * dt;\n      p.vy += gravity * dt;\n\n      // Затухание\n      p.vx *= 0.98;\n\n      // Время жизни\n      p.life -= dt;\n\n      // Удаляем мёртвые\n      if (p.life <= 0 || p.y > this.height + 50) {\n        this.particles.splice(i, 1);\n      }\n    }\n  }\n\n  /** Рендер частиц */\n  private renderParticles(ctx: CanvasRenderingContext2D): void {\n    for (const p of this.particles) {\n      const alpha = Math.min(1, p.life / p.maxLife * 2);\n\n      ctx.save();\n      ctx.globalAlpha = alpha;\n\n      if (p.type === 'fragment') {\n        // Крупный осколок с градиентом\n        const gradient = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, p.size);\n        gradient.addColorStop(0, '#ffffff');\n        gradient.addColorStop(0.3, p.color);\n        gradient.addColorStop(1, 'transparent');\n\n        ctx.fillStyle = gradient;\n        ctx.shadowColor = p.color;\n        ctx.shadowBlur = 20;\n\n        ctx.beginPath();\n        // Неправильная форма осколка\n        const points = 5 + Math.floor(Math.random() * 3);\n        for (let j = 0; j < points; j++) {\n          const angle = (j / points) * Math.PI * 2;\n          const r = p.size * (0.5 + Math.random() * 0.5);\n          const px = p.x + Math.cos(angle) * r;\n          const py = p.y + Math.sin(angle) * r;\n          if (j === 0) ctx.moveTo(px, py);\n          else ctx.lineTo(px, py);\n        }\n        ctx.closePath();\n        ctx.fill();\n\n        // Обводка\n        ctx.strokeStyle = p.color;\n        ctx.lineWidth = 2;\n        ctx.stroke();\n\n      } else {\n        // Искра\n        ctx.fillStyle = p.color;\n        ctx.shadowColor = p.color;\n        ctx.shadowBlur = 10;\n\n        ctx.beginPath();\n        ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);\n        ctx.fill();\n\n        // Хвост\n        ctx.strokeStyle = p.color;\n        ctx.lineWidth = p.size * 0.5;\n        ctx.lineCap = 'round';\n        ctx.beginPath();\n        ctx.moveTo(p.x, p.y);\n        ctx.lineTo(p.x - p.vx * 0.02, p.y - p.vy * 0.02);\n        ctx.stroke();\n      }\n\n      ctx.restore();\n    }\n  }\n\n  public render(state: WeaponState, time: number): void {\n    const ctx = this.ctx;\n    ctx.clearRect(0, 0, this.width, this.height);\n\n    // Обновляем частицы\n    this.updateParticles(1 / 60);\n\n    // Обновляем сплеш-волну\n    if (this.splashWaveActive) {\n      this.splashWaveProgress += 0.03;\n      if (this.splashWaveProgress >= 1) {\n        this.splashWaveActive = false;\n      }\n    }\n\n    const scale = Math.min(this.width, this.height) / 600;\n\n    // Покачивание\n    const bobX = Math.sin(state.bobPhase) * 8 * scale;\n    const bobY = Math.abs(Math.sin(state.bobPhase * 2)) * 6 * scale;\n\n    // Затухание вспышки попадания\n    if (this.hitFlash > 0) {\n      this.hitFlash -= 0.04;\n    }\n\n    // Рисуем сплеш-волну на фоне\n    if (this.splashWaveActive) {\n      this.drawSplashWaveEffect(ctx, time);\n    }\n\n    ctx.save();\n\n    // Позиция оружия\n    let baseX = this.width * 0.65;\n    let baseY = this.height * 0.8;\n    let rotation = -0.4;\n\n    // Анимация атаки - мощный взмах\n    if (this.isAttacking) {\n      const t = this.attackProgress;\n      // Быстрый взмах с замедлением в конце\n      const easeOut = 1 - Math.pow(1 - t, 3);\n      // Сплеш-атака - более мощный горизонтальный взмах\n      const swingAngle = Math.sin(easeOut * Math.PI) * (this.isSplashAttack ? 3.2 : 2.5);\n      rotation = -0.4 - swingAngle;\n\n      // Движение к центру и вверх (сплеш движется сильнее)\n      const moveMultiplier = this.isSplashAttack ? 1.5 : 1.0;\n      baseX -= Math.sin(t * Math.PI) * this.width * 0.3 * moveMultiplier;\n      baseY -= Math.sin(t * Math.PI) * this.height * 0.15 * moveMultiplier;\n    }\n\n    ctx.translate(baseX + bobX, baseY + bobY);\n    ctx.rotate(rotation);\n    ctx.scale(scale, scale);\n\n    // Эффект следа\n    if (this.isAttacking && this.attackProgress > 0.05 && this.attackProgress < 0.8) {\n      if (this.isSplashAttack) {\n        this.drawSplashSlash(ctx, this.attackProgress, time);\n      } else {\n        this.drawRetrowaveSlash(ctx, this.attackProgress, time);\n      }\n    }\n\n    // Катана (всегда катана теперь)\n    this.drawKatana(ctx, state, time);\n\n    // Индикатор заряда сверху катаны если есть заряды\n    if (this.splashCharges > 0) {\n      this.drawChargeIndicator(ctx, time);\n    }\n\n    // Эффект попадания\n    if (this.hitFlash > 0) {\n      this.drawHitGlow(ctx, this.hitFlash, this.isSplashAttack ? 'charged' : 'katana');\n    }\n\n    ctx.restore();\n\n    // Рендерим частицы поверх всего\n    this.renderParticles(ctx);\n\n    // Полноэкранная вспышка при попадании\n    if (this.hitFlash > 0.5) {\n      this.drawScreenFlash(ctx, this.isSplashAttack ? 'charged' : 'katana');\n    }\n  }\n\n  /** Рисуем индикатор заряда */\n  private drawChargeIndicator(ctx: CanvasRenderingContext2D, time: number): void {\n    // 3 точки энергии вдоль лезвия\n    ctx.save();\n    ctx.shadowColor = '#00ffff';\n    ctx.shadowBlur = 15;\n    \n    for (let i = 0; i < 3; i++) {\n      const y = -50 - i * 60;\n      const pulse = 0.7 + 0.3 * Math.sin(time * 5 + i);\n      \n      if (this.splashCharges > i) {\n        ctx.fillStyle = `rgba(0, 255, 255, ${pulse})`;\n        ctx.beginPath();\n        ctx.arc(0, y, 8, 0, Math.PI * 2);\n        ctx.fill();\n        \n        // Внешнее кольцо\n        ctx.strokeStyle = `rgba(0, 255, 255, ${pulse * 0.5})`;\n        ctx.lineWidth = 2;\n        ctx.beginPath();\n        ctx.arc(0, y, 12 + Math.sin(time * 8 + i) * 3, 0, Math.PI * 2);\n        ctx.stroke();\n      } else {\n        ctx.fillStyle = 'rgba(100, 100, 100, 0.3)';\n        ctx.beginPath();\n        ctx.arc(0, y, 6, 0, Math.PI * 2);\n        ctx.fill();\n      }\n    }\n    \n    ctx.restore();\n  }\n\n  /** Эффект сплеш-волны на экране */\n  private drawSplashWaveEffect(ctx: CanvasRenderingContext2D, time: number): void {\n    const centerX = this.width / 2;\n    const centerY = this.height / 2;\n    const maxRadius = Math.max(this.width, this.height) * 0.8;\n    const currentRadius = this.splashWaveProgress * maxRadius;\n    \n    ctx.save();\n    \n    // Несколько концентрических волн\n    for (let i = 0; i < 3; i++) {\n      const r = currentRadius - i * 30;\n      if (r > 0) {\n        const alpha = (1 - this.splashWaveProgress) * (0.5 - i * 0.1);\n        \n        // Основная волна\n        ctx.strokeStyle = `rgba(0, 255, 255, ${alpha})`;\n        ctx.lineWidth = 8 - i * 2;\n        ctx.shadowColor = '#00ffff';\n        ctx.shadowBlur = 20;\n        \n        ctx.beginPath();\n        // Рисуем полукруг вперёд (горизонтальная волна)\n        ctx.ellipse(centerX, centerY + 100, r, r * 0.3, 0, Math.PI, 0);\n        ctx.stroke();\n        \n        // Искрящаяся линия\n        if (i === 0) {\n          ctx.strokeStyle = `rgba(255, 255, 255, ${alpha * 0.8})`;\n          ctx.lineWidth = 2;\n          ctx.beginPath();\n          ctx.ellipse(centerX, centerY + 100, r - 5, (r - 5) * 0.3, 0, Math.PI, 0);\n          ctx.stroke();\n        }\n      }\n    }\n    \n    // Добавляем искры на волне\n    const sparkCount = Math.floor((1 - this.splashWaveProgress) * 20);\n    ctx.fillStyle = '#ffffff';\n    for (let i = 0; i < sparkCount; i++) {\n      const angle = Math.PI + Math.random() * Math.PI;\n      const sparkR = currentRadius + (Math.random() - 0.5) * 20;\n      const x = centerX + Math.cos(angle) * sparkR;\n      const y = centerY + 100 + Math.sin(angle) * sparkR * 0.3;\n      const size = 2 + Math.random() * 4;\n      \n      ctx.beginPath();\n      ctx.arc(x, y, size, 0, Math.PI * 2);\n      ctx.fill();\n    }\n    \n    ctx.restore();\n  }\n\n  /** След сплеш-атаки (более широкий и яркий) */\n  private drawSplashSlash(ctx: CanvasRenderingContext2D, progress: number, time: number): void {\n    ctx.save();\n    ctx.globalCompositeOperation = 'lighter';\n\n    // Основной широкий след - бирюзовый\n    const cyanGrad = ctx.createLinearGradient(-200, -350, 50, 0);\n    cyanGrad.addColorStop(0, 'rgba(0, 255, 255, 0)');\n    cyanGrad.addColorStop(0.3, 'rgba(0, 255, 255, 0.8)');\n    cyanGrad.addColorStop(0.6, 'rgba(0, 255, 255, 1)');\n    cyanGrad.addColorStop(1, 'rgba(0, 255, 255, 0)');\n\n    ctx.strokeStyle = cyanGrad;\n    ctx.lineWidth = 30 + Math.sin(progress * Math.PI) * 20; // Шире!\n    ctx.lineCap = 'round';\n    ctx.shadowColor = '#00ffff';\n    ctx.shadowBlur = 40;\n\n    ctx.beginPath();\n    ctx.moveTo(-200, -350);\n    ctx.quadraticCurveTo(\n      -100 + Math.sin(time * 30) * 20,\n      -200,\n      50, 0\n    );\n    ctx.stroke();\n\n    // Внутреннее ядро - белое\n    ctx.strokeStyle = 'rgba(255, 255, 255, 0.9)';\n    ctx.lineWidth = 6;\n    ctx.shadowBlur = 20;\n    ctx.stroke();\n\n    // Дополнительные волны\n    for (let i = 0; i < 3; i++) {\n      const offset = i * 15;\n      ctx.strokeStyle = `rgba(0, 200, 255, ${0.4 - i * 0.1})`;\n      ctx.lineWidth = 4 - i;\n      ctx.beginPath();\n      ctx.moveTo(-200 - offset, -350 + offset);\n      ctx.quadraticCurveTo(\n        -100 - offset + Math.sin(time * 30 + i) * 15,\n        -200 + offset,\n        50 - offset, 0 + offset\n      );\n      ctx.stroke();\n    }\n\n    ctx.restore();\n  }\n\n  private drawKatana(ctx: CanvasRenderingContext2D, _state: WeaponState, time: number): void {\n    // === РУКА ===\n    ctx.fillStyle = '#8a7a6a';\n    ctx.beginPath();\n    ctx.ellipse(0, 80, 40, 50, 0.2, 0, Math.PI * 2);\n    ctx.fill();\n\n    // === ЦУКА (рукоять) ===\n    const tsukaGrad = ctx.createLinearGradient(0, 40, 0, 160);\n    tsukaGrad.addColorStop(0, '#2a1a1a');\n    tsukaGrad.addColorStop(0.5, '#1a0a0a');\n    tsukaGrad.addColorStop(1, '#2a1a1a');\n\n    ctx.fillStyle = tsukaGrad;\n    ctx.beginPath();\n    ctx.moveTo(-14, 40);\n    ctx.lineTo(14, 40);\n    ctx.lineTo(12, 160);\n    ctx.lineTo(-12, 160);\n    ctx.closePath();\n    ctx.fill();\n\n    // Обмотка с неоном\n    ctx.strokeStyle = '#ff00ff';\n    ctx.shadowColor = '#ff00ff';\n    ctx.shadowBlur = 10;\n    ctx.lineWidth = 2;\n    for (let i = 0; i < 10; i++) {\n      const y = 50 + i * 11;\n      const glow = 0.5 + 0.5 * Math.sin(time * 3 + i * 0.5);\n      ctx.strokeStyle = `rgba(255, 0, 255, ${glow})`;\n      ctx.beginPath();\n      ctx.moveTo(-12, y);\n      ctx.lineTo(0, y + 5);\n      ctx.lineTo(12, y);\n      ctx.stroke();\n    }\n    ctx.shadowBlur = 0;\n\n    // === ЦУБА (гарда) - неоновая ===\n    ctx.fillStyle = '#1a1a2a';\n    ctx.beginPath();\n    ctx.ellipse(0, 35, 35, 12, 0, 0, Math.PI * 2);\n    ctx.fill();\n\n    // Неоновый контур гарды\n    ctx.strokeStyle = '#00ffff';\n    ctx.shadowColor = '#00ffff';\n    ctx.shadowBlur = 15;\n    ctx.lineWidth = 2;\n    ctx.beginPath();\n    ctx.ellipse(0, 35, 32, 10, 0, 0, Math.PI * 2);\n    ctx.stroke();\n    ctx.shadowBlur = 0;\n\n    // === КЛИНОК ===\n    // Основа\n    const bladeGrad = ctx.createLinearGradient(-10, 0, 10, 0);\n    bladeGrad.addColorStop(0, '#8080a0');\n    bladeGrad.addColorStop(0.3, '#c0c0e0');\n    bladeGrad.addColorStop(0.5, '#ffffff');\n    bladeGrad.addColorStop(0.7, '#c0c0e0');\n    bladeGrad.addColorStop(1, '#6060a0');\n\n    ctx.fillStyle = bladeGrad;\n    ctx.beginPath();\n    ctx.moveTo(-10, 30);\n    ctx.lineTo(10, 30);\n    ctx.lineTo(7, -280);\n    ctx.lineTo(0, -320);\n    ctx.lineTo(-5, -280);\n    ctx.closePath();\n    ctx.fill();\n\n    // Неоновая кромка\n    ctx.strokeStyle = '#00ffff';\n    ctx.shadowColor = '#00ffff';\n    ctx.shadowBlur = 8;\n    ctx.lineWidth = 2;\n    ctx.beginPath();\n    ctx.moveTo(9, 30);\n    ctx.lineTo(6, -280);\n    ctx.lineTo(0, -320);\n    ctx.stroke();\n\n    // Пульсирующий хамон\n    ctx.strokeStyle = `rgba(255, 0, 255, ${0.5 + 0.3 * Math.sin(time * 4)})`;\n    ctx.shadowColor = '#ff00ff';\n    ctx.shadowBlur = 5;\n    ctx.lineWidth = 1.5;\n    ctx.beginPath();\n    ctx.moveTo(-4, 30);\n    for (let i = 0; i < 25; i++) {\n      const y = 30 - i * 13;\n      const wave = Math.sin(i * 0.7 + time * 2) * 4;\n      ctx.lineTo(-4 + wave, y);\n    }\n    ctx.stroke();\n    ctx.shadowBlur = 0;\n\n    // Блик\n    ctx.fillStyle = 'rgba(255, 255, 255, 0.4)';\n    ctx.beginPath();\n    ctx.moveTo(3, 25);\n    ctx.lineTo(5, 25);\n    ctx.lineTo(3, -270);\n    ctx.lineTo(1, -270);\n    ctx.closePath();\n    ctx.fill();\n  }\n\n  private drawRetrowaveSlash(ctx: CanvasRenderingContext2D, progress: number, time: number): void {\n    ctx.save();\n    ctx.translate(0, -150);\n\n    const alpha = Math.sin(progress * Math.PI);\n\n    // Множественные неоновые дуги\n    const colors = [\n      { color: '#ff00ff', offset: 0 },\n      { color: '#00ffff', offset: 15 },\n      { color: '#ff0080', offset: 30 },\n      { color: '#8000ff', offset: 45 },\n    ];\n\n    for (const { color, offset } of colors) {\n      ctx.strokeStyle = color;\n      ctx.shadowColor = color;\n      ctx.shadowBlur = 25;\n      ctx.lineWidth = 10 - offset * 0.15;\n      ctx.lineCap = 'round';\n\n      ctx.beginPath();\n      ctx.arc(0, 100, 200 + offset, -Math.PI * 0.7, Math.PI * 0.15);\n      ctx.globalAlpha = alpha * (1 - offset * 0.015);\n      ctx.stroke();\n    }\n\n    // Искры\n    ctx.globalAlpha = alpha;\n    for (let i = 0; i < 15; i++) {\n      const angle = -Math.PI * 0.7 + (Math.PI * 0.85) * (i / 15) + Math.sin(time * 10 + i) * 0.1;\n      const dist = 200 + Math.random() * 50;\n      const x = Math.cos(angle) * dist;\n      const y = 100 + Math.sin(angle) * dist;\n\n      const sparkColor = i % 2 === 0 ? '#ff00ff' : '#00ffff';\n      ctx.fillStyle = sparkColor;\n      ctx.shadowColor = sparkColor;\n      ctx.shadowBlur = 15;\n      ctx.beginPath();\n      ctx.arc(x, y, 4 + Math.random() * 4, 0, Math.PI * 2);\n      ctx.fill();\n    }\n\n    ctx.globalAlpha = 1;\n    ctx.shadowBlur = 0;\n    ctx.restore();\n  }\n\n  /** Рисуем ТОПОР ХАОСА - как катана, но с широким лезвием! */\n  private drawAxe(ctx: CanvasRenderingContext2D, _state: WeaponState, time: number, charges: number): void {\n    // === РУКА ===\n    ctx.fillStyle = '#8a7a6a';\n    ctx.beginPath();\n    ctx.ellipse(0, 80, 40, 50, 0.2, 0, Math.PI * 2);\n    ctx.fill();\n\n    // === РУКОЯТЬ (как у катаны) ===\n    const tsukaGrad = ctx.createLinearGradient(0, 40, 0, 160);\n    tsukaGrad.addColorStop(0, '#3a2010');\n    tsukaGrad.addColorStop(0.5, '#2a1005');\n    tsukaGrad.addColorStop(1, '#3a2010');\n\n    ctx.fillStyle = tsukaGrad;\n    ctx.beginPath();\n    ctx.moveTo(-14, 40);\n    ctx.lineTo(14, 40);\n    ctx.lineTo(12, 160);\n    ctx.lineTo(-12, 160);\n    ctx.closePath();\n    ctx.fill();\n\n    // Обмотка - огненная (как у катаны но оранжевая)\n    ctx.strokeStyle = '#ff6600';\n    ctx.shadowColor = '#ff6600';\n    ctx.shadowBlur = 10;\n    ctx.lineWidth = 2;\n    for (let i = 0; i < 10; i++) {\n      const y = 50 + i * 11;\n      const glow = 0.5 + 0.5 * Math.sin(time * 4 + i * 0.5);\n      ctx.strokeStyle = `rgba(255, 100, 0, ${glow})`;\n      ctx.beginPath();\n      ctx.moveTo(-12, y);\n      ctx.lineTo(0, y + 5);\n      ctx.lineTo(12, y);\n      ctx.stroke();\n    }\n    ctx.shadowBlur = 0;\n\n    // === ГАРДА (как цуба но квадратная) ===\n    ctx.fillStyle = '#2a2020';\n    ctx.beginPath();\n    ctx.rect(-30, 25, 60, 20);\n    ctx.fill();\n\n    // Огненный контур гарды\n    ctx.strokeStyle = '#ff6600';\n    ctx.shadowColor = '#ff6600';\n    ctx.shadowBlur = 15;\n    ctx.lineWidth = 2;\n    ctx.strokeRect(-28, 27, 56, 16);\n    ctx.shadowBlur = 0;\n\n    // === ЛЕЗВИЕ ТОПОРА (широкое, как секира) ===\n    // Основа - широкий клинок\n    const bladeGrad = ctx.createLinearGradient(-40, 0, 40, 0);\n    bladeGrad.addColorStop(0, '#6060a0');\n    bladeGrad.addColorStop(0.2, '#8080b0');\n    bladeGrad.addColorStop(0.4, '#b0b0d0');\n    bladeGrad.addColorStop(0.5, '#e0e0f0');\n    bladeGrad.addColorStop(0.6, '#b0b0d0');\n    bladeGrad.addColorStop(0.8, '#8080b0');\n    bladeGrad.addColorStop(1, '#6060a0');\n\n    ctx.fillStyle = bladeGrad;\n    ctx.beginPath();\n    // Широкое лезвие секиры\n    ctx.moveTo(-12, 20);\n    ctx.lineTo(12, 20);\n    ctx.lineTo(15, -50);\n    // Расширение к голове\n    ctx.lineTo(50, -180);\n    ctx.lineTo(55, -220);\n    // Острие\n    ctx.lineTo(0, -300);\n    // Обратная сторона\n    ctx.lineTo(-55, -220);\n    ctx.lineTo(-50, -180);\n    ctx.lineTo(-15, -50);\n    ctx.closePath();\n    ctx.fill();\n\n    // Огненная кромка (как неоновая у катаны но оранжевая)\n    ctx.strokeStyle = '#ff6600';\n    ctx.shadowColor = '#ff6600';\n    ctx.shadowBlur = 12;\n    ctx.lineWidth = 3;\n    ctx.beginPath();\n    ctx.moveTo(14, 20);\n    ctx.lineTo(52, -180);\n    ctx.lineTo(57, -220);\n    ctx.lineTo(0, -305);\n    ctx.stroke();\n\n    // Вторая кромка\n    ctx.beginPath();\n    ctx.moveTo(-14, 20);\n    ctx.lineTo(-52, -180);\n    ctx.lineTo(-57, -220);\n    ctx.lineTo(0, -305);\n    ctx.stroke();\n\n    // Пульсирующая линия по центру (как хамон)\n    ctx.strokeStyle = `rgba(255, 150, 0, ${0.5 + 0.3 * Math.sin(time * 5)})`;\n    ctx.shadowColor = '#ff9900';\n    ctx.shadowBlur = 8;\n    ctx.lineWidth = 2;\n    ctx.beginPath();\n    ctx.moveTo(0, 15);\n    for (let i = 0; i < 20; i++) {\n      const y = 15 - i * 15;\n      const wave = Math.sin(i * 0.8 + time * 3) * (3 + i * 0.3);\n      ctx.lineTo(wave, y);\n    }\n    ctx.stroke();\n    ctx.shadowBlur = 0;\n\n    // Индикатор зарядов - огненные точки вдоль лезвия\n    for (let i = 0; i < 5; i++) {\n      const y = -50 - i * 45;\n      \n      if (i < charges) {\n        ctx.fillStyle = '#ff8800';\n        ctx.shadowColor = '#ff8800';\n        ctx.shadowBlur = 15;\n      } else {\n        ctx.fillStyle = '#333333';\n        ctx.shadowColor = 'transparent';\n        ctx.shadowBlur = 0;\n      }\n      \n      ctx.beginPath();\n      ctx.arc(0, y, 4, 0, Math.PI * 2);\n      ctx.fill();\n    }\n    ctx.shadowBlur = 0;\n\n    // Блик\n    ctx.fillStyle = 'rgba(255, 255, 255, 0.4)';\n    ctx.beginPath();\n    ctx.moveTo(5, 15);\n    ctx.lineTo(8, 15);\n    ctx.lineTo(40, -170);\n    ctx.lineTo(37, -170);\n    ctx.closePath();\n    ctx.fill();\n  }\n\n  /** След от топора - как у катаны но с разлётом! */\n  private drawAxeSlash(ctx: CanvasRenderingContext2D, progress: number, time: number): void {\n    ctx.save();\n    ctx.translate(0, -150);\n\n    const alpha = Math.sin(progress * Math.PI);\n\n    // Огненные дуги (как у катаны)\n    const colors = [\n      { color: '#ff6600', offset: 0 },\n      { color: '#ff9900', offset: 15 },\n      { color: '#ff3300', offset: 30 },\n      { color: '#ffcc00', offset: 45 },\n    ];\n\n    for (const { color, offset } of colors) {\n      ctx.strokeStyle = color;\n      ctx.shadowColor = color;\n      ctx.shadowBlur = 25;\n      ctx.lineWidth = 12 - offset * 0.15;\n      ctx.lineCap = 'round';\n\n      ctx.beginPath();\n      ctx.arc(0, 100, 200 + offset, -Math.PI * 0.7, Math.PI * 0.15);\n      ctx.globalAlpha = alpha * (1 - offset * 0.015);\n      ctx.stroke();\n    }\n\n    // Искры разлетаются!\n    ctx.globalAlpha = alpha;\n    for (let i = 0; i < 15; i++) {\n      const angle = -Math.PI * 0.7 + (Math.PI * 0.85) * (i / 15) + Math.sin(time * 10 + i) * 0.1;\n      const dist = 200 + Math.random() * 50;\n      const x = Math.cos(angle) * dist;\n      const y = 100 + Math.sin(angle) * dist;\n\n      const sparkColor = i % 2 === 0 ? '#ff6600' : '#ffaa00';\n      ctx.fillStyle = sparkColor;\n      ctx.shadowColor = sparkColor;\n      ctx.shadowBlur = 15;\n      ctx.beginPath();\n      ctx.arc(x, y, 4 + Math.random() * 4, 0, Math.PI * 2);\n      ctx.fill();\n    }\n\n    ctx.globalAlpha = 1;\n    ctx.shadowBlur = 0;\n    ctx.restore();\n  }\n\n  /** Создать огненные осколки при сплеше топора! */\n  public spawnAxeSplash(): void {\n    const centerX = this.width / 2;\n    const centerY = this.height / 2;\n    // Огненные цвета\n    const colors = ['#ff6600', '#ff9900', '#ff3300', '#ffcc00', '#ff0000', '#ffaa00'];\n\n    // Крупные огненные осколки - разлетаются во все стороны!\n    for (let i = 0; i < 20; i++) {\n      const angle = (i / 20) * Math.PI * 2 + Math.random() * 0.3;\n      const speed = 500 + Math.random() * 700;\n      this.particles.push({\n        x: centerX + (Math.random() - 0.5) * 100,\n        y: centerY + (Math.random() - 0.5) * 100,\n        vx: Math.cos(angle) * speed,\n        vy: Math.sin(angle) * speed - 150,\n        size: 10 + Math.random() * 15,\n        color: colors[Math.floor(Math.random() * colors.length)],\n        life: 0.7 + Math.random() * 0.5,\n        maxLife: 0.7 + Math.random() * 0.5,\n        type: 'fragment',\n      });\n    }\n\n    // Искры\n    for (let i = 0; i < 35; i++) {\n      const angle = Math.random() * Math.PI * 2;\n      const speed = 300 + Math.random() * 600;\n      this.particles.push({\n        x: centerX + (Math.random() - 0.5) * 50,\n        y: centerY + (Math.random() - 0.5) * 50,\n        vx: Math.cos(angle) * speed,\n        vy: Math.sin(angle) * speed - 100,\n        size: 3 + Math.random() * 5,\n        color: colors[Math.floor(Math.random() * colors.length)],\n        life: 0.5 + Math.random() * 0.4,\n        maxLife: 0.5 + Math.random() * 0.4,\n        type: 'spark',\n      });\n    }\n  }\n\n  private drawHitGlow(ctx: CanvasRenderingContext2D, intensity: number, weaponType: WeaponType = 'katana'): void {\n    ctx.save();\n    ctx.globalAlpha = intensity;\n\n    if (weaponType === 'charged') {\n      // Электрическое свечение для заряженной катаны\n      ctx.strokeStyle = '#ffffff';\n      ctx.shadowColor = '#00ffff';\n      ctx.shadowBlur = 50 * intensity;\n      ctx.lineWidth = 10;\n\n      // Обводка всего лезвия\n      ctx.beginPath();\n      ctx.moveTo(9, 30);\n      ctx.lineTo(6, -280);\n      ctx.lineTo(0, -320);\n      ctx.stroke();\n\n      // Дополнительные волны энергии\n      ctx.strokeStyle = '#00ffff';\n      ctx.shadowColor = '#0088ff';\n      ctx.shadowBlur = 30 * intensity;\n      ctx.lineWidth = 4;\n      for (let i = 0; i < 3; i++) {\n        ctx.beginPath();\n        ctx.arc(0, -150, 50 + i * 30, 0, Math.PI * 2);\n        ctx.stroke();\n      }\n    } else {\n      // Неоновое свечение для катаны\n      ctx.strokeStyle = '#ffffff';\n      ctx.shadowColor = '#00ffff';\n      ctx.shadowBlur = 30 * intensity;\n      ctx.lineWidth = 6;\n\n      ctx.beginPath();\n      ctx.moveTo(9, 30);\n      ctx.lineTo(6, -280);\n      ctx.lineTo(0, -320);\n      ctx.stroke();\n\n      ctx.strokeStyle = '#ff00ff';\n      ctx.shadowColor = '#ff00ff';\n      ctx.shadowBlur = 20 * intensity;\n      ctx.lineWidth = 3;\n      ctx.stroke();\n    }\n\n    ctx.restore();\n  }\n\n  private drawScreenFlash(ctx: CanvasRenderingContext2D, weaponType: WeaponType = 'katana'): void {\n    ctx.save();\n    ctx.resetTransform();\n\n    const gradient = ctx.createRadialGradient(\n      this.width / 2, this.height / 2, 0,\n      this.width / 2, this.height / 2, this.width\n    );\n    \n    if (weaponType === 'charged') {\n      // Электрическая вспышка для заряженной катаны\n      gradient.addColorStop(0, `rgba(255, 255, 255, ${this.hitFlash * 0.6})`);\n      gradient.addColorStop(0.2, `rgba(0, 255, 255, ${this.hitFlash * 0.4})`);\n      gradient.addColorStop(0.5, `rgba(0, 150, 255, ${this.hitFlash * 0.2})`);\n      gradient.addColorStop(0.8, `rgba(0, 80, 255, ${this.hitFlash * 0.1})`);\n      gradient.addColorStop(1, 'rgba(0, 0, 0, 0)');\n    } else {\n      // Неоновая вспышка для катаны\n      gradient.addColorStop(0, `rgba(255, 255, 255, ${this.hitFlash * 0.4})`);\n      gradient.addColorStop(0.3, `rgba(255, 0, 255, ${this.hitFlash * 0.2})`);\n      gradient.addColorStop(0.6, `rgba(0, 255, 255, ${this.hitFlash * 0.1})`);\n      gradient.addColorStop(1, 'rgba(0, 0, 0, 0)');\n    }\n\n    ctx.fillStyle = gradient;\n    ctx.fillRect(0, 0, this.width, this.height);\n\n    ctx.restore();\n  }\n}\n","import type { Vec3 } from '@/types';\nimport { vec3, distanceVec3, normalizeVec3 } from '@/utils/math';\n\n/** Тип врага */\nexport type EnemyType = 'baneling' | 'phantom' | 'runner' | 'hopper' | 'boss_green' | 'boss_black' | 'boss_blue';\n\n/** Осколок после разрубания */\nexport interface Fragment {\n  position: Vec3;\n  velocity: Vec3;\n  size: number;\n  lifetime: number;\n  rotation: number;\n  rotationSpeed: number;\n}\n\n/** Токсичная лужа (от Зелёного Босса) */\nexport interface ToxicPool {\n  position: Vec3;\n  radius: number;\n  lifetime: number;\n  damage: number;\n}\n\n/**\n * Враг-шар который летит к игроку\n * - baneling: зелёная жижа, взрывается при столкновении\n * - phantom: чёрный шар, пронзает насквозь с инерцией\n */\nexport class Target {\n  /** Позиция */\n  public position: Vec3;\n\n  /** Скорость полёта */\n  public velocity: Vec3 = vec3();\n\n  /** Радиус */\n  public radius = 0.8;\n\n  /** Активен? */\n  public active = true;\n\n  /** Базовая скорость движения */\n  public speed = 4.0;\n\n  /** Интенсивность огня (для шейдера) */\n  public fireIntensity = 1.0;\n\n  /** Осколки после разрубания */\n  public fragments: Fragment[] = [];\n\n  /** Время до удаления */\n  private removeTimer = 0;\n\n  /** Уникальный ID для разного поведения */\n  private id: number;\n\n  /** Фаза синусоиды */\n  private phase: number;\n\n  /** Тип движения (0-3) */\n  private moveType: number;\n\n  /** Тип врага */\n  public enemyType: EnemyType = 'baneling';\n\n  /** Урон при столкновении */\n  public damage: number = 25;\n\n  /** Фантом: текущая скорость (для разгона) */\n  private currentSpeed = 0;\n\n  /** Фантом: набирает разгон? */\n  private isCharging = true;\n\n  /** Фантом: направление атаки (фиксируется при разгоне) */\n  private chargeDirection: Vec3 = vec3();\n\n  /** Фантом: время после пролёта через игрока */\n  private passedThroughTimer = 0;\n\n  /** Hopper: вертикальная скорость */\n  private verticalVelocity = 0;\n\n  /** Hopper: на земле? */\n  private onGround = true;\n\n  /** Hopper: время до следующего прыжка */\n  private hopTimer = 0;\n\n  /** Runner: угол уклонения */\n  private dodgeAngle = 0;\n\n  /** Runner: время до смены направления */\n  private dodgeTimer = 0;\n\n  /** Runner: прицепился к игроку? */\n  public isAttached = false;\n\n  /** Runner: время на прицепе (сколько осталось чтобы скинуть) */\n  public attachTimer = 0;\n\n  /** Runner: угол вращения вокруг игрока */\n  private orbitAngle = 0;\n\n  /** Босс: HP (обычные враги имеют 1) */\n  public hp = 1;\n  public maxHp = 1;\n\n  /** Босс: это босс? */\n  public isBoss = false;\n\n  /** Синий босс: таймер телепортации */\n  private teleportTimer = 0;\n\n  /** Чёрный босс: интенсивность искривления */\n  public distortionPower = 0;\n\n  /** Зелёный босс: таймер создания лужи */\n  private poolTimer = 0;\n\n  /** Зелёный босс: фаза (1 или 2) */\n  public bossPhase = 1;\n\n  /** Callback при смене фазы босса */\n  public onPhaseChange?: (phase: number) => void;\n\n  constructor(position: Vec3, speed: number = 4.0, id: number = 0, type: EnemyType = 'baneling') {\n    this.position = { ...position };\n    this.speed = speed;\n    this.id = id;\n    this.phase = Math.random() * Math.PI * 2;\n    this.moveType = id % 4;\n    this.enemyType = type;\n\n    // Настройки по типу врага\n    if (type === 'phantom') {\n      this.speed = speed * 2; // В 2 раза быстрее\n      this.damage = 10; // Меньше урона\n      this.radius = 0.6;\n      this.currentSpeed = 0;\n      this.isCharging = true;\n    } else if (type === 'runner') {\n      this.speed = speed * 2.5; // Очень быстрый!\n      this.damage = 15;\n      this.radius = 0.4; // Маленький и низкий\n      this.position.y = 0.5; // Бежит по земле\n    } else if (type === 'hopper') {\n      this.speed = speed * 1.2;\n      this.damage = 20;\n      this.radius = 0.5;\n      this.verticalVelocity = 8;\n      this.onGround = false;\n    } else if (type === 'boss_green') {\n      // ЗЕЛЁНЫЙ БОСС - огромный и живучий\n      this.isBoss = true;\n      this.speed = speed * 0.6; // Медленный\n      this.damage = 40;\n      this.radius = 2.5; // ОГРОМНЫЙ!\n      this.hp = 10;\n      this.maxHp = 10;\n    } else if (type === 'boss_black') {\n      // ЧЁРНЫЙ БОСС - искривляет пространство\n      this.isBoss = true;\n      this.speed = speed * 0.8;\n      this.damage = 30;\n      this.radius = 2.0;\n      this.hp = 15;\n      this.maxHp = 15;\n      this.distortionPower = 1.0;\n    } else if (type === 'boss_blue') {\n      // СИНИЙ БОСС - телепортируется\n      this.isBoss = true;\n      this.speed = speed * 1.5; // Быстрый между телепортами\n      this.damage = 25;\n      this.radius = 1.8;\n      this.hp = 12;\n      this.maxHp = 12;\n      this.teleportTimer = 3.0;\n    } else {\n      this.damage = 25;\n      this.currentSpeed = speed;\n    }\n  }\n\n  /** Обновление - движение к игроку с паттерном */\n  public update(dt: number, playerPos: Vec3, time: number): void {\n    // Пульсирующий эффект\n    this.fireIntensity = 0.6 + Math.sin(time * 8 + this.id) * 0.4;\n\n    if (this.active) {\n      switch (this.enemyType) {\n        case 'phantom':\n          this.updatePhantom(dt, playerPos, time);\n          break;\n        case 'runner':\n          this.updateRunner(dt, playerPos, time);\n          break;\n        case 'hopper':\n          this.updateHopper(dt, playerPos, time);\n          break;\n        case 'boss_green':\n          this.updateBossGreen(dt, playerPos, time);\n          break;\n        case 'boss_black':\n          this.updateBossBlack(dt, playerPos, time);\n          break;\n        case 'boss_blue':\n          this.updateBossBlue(dt, playerPos, time);\n          break;\n        default:\n          this.updateBaneling(dt, playerPos, time);\n      }\n    }\n\n    // Обновление осколков\n    this.updateFragments(dt);\n\n    // Таймер удаления\n    if (!this.active && this.removeTimer > 0) {\n      this.removeTimer -= dt;\n    }\n  }\n\n  /** Обновление бейнлинга - медленное преследование с паттернами */\n  private updateBaneling(dt: number, playerPos: Vec3, time: number): void {\n    const dx = playerPos.x - this.position.x;\n    const dy = (playerPos.y - 0.3) - this.position.y;\n    const dz = playerPos.z - this.position.z;\n    const dist = Math.sqrt(dx * dx + dy * dy + dz * dz);\n\n    if (dist > 0.1) {\n      const dirX = dx / dist;\n      const dirY = dy / dist;\n      const dirZ = dz / dist;\n\n      // Скорость увеличивается при приближении (агрессия!)\n      const aggression = 1.0 + Math.max(0, (15 - dist) / 15) * 0.8;\n      const currentSpeed = this.speed * aggression;\n\n      // Разные паттерны движения\n      let offsetX = 0, offsetY = 0, offsetZ = 0;\n      const wave = time * 4 + this.phase;\n\n      switch (this.moveType) {\n        case 0: // Спираль\n          offsetX = Math.cos(wave) * 3;\n          offsetZ = Math.sin(wave) * 3;\n          offsetY = Math.sin(wave * 0.5) * 1.5;\n          break;\n        case 1: // Зигзаг горизонтальный\n          offsetX = Math.sin(wave * 2) * 4;\n          offsetY = Math.cos(wave) * 0.5;\n          break;\n        case 2: // Волна вверх-вниз\n          offsetY = Math.sin(wave * 1.5) * 2.5;\n          offsetX = Math.cos(wave * 0.7) * 1;\n          break;\n        case 3: // Рывками\n          const pulse = Math.sin(wave) > 0 ? 1.5 : 0.5;\n          offsetX = Math.cos(wave * 3) * 2 * pulse;\n          offsetZ = Math.sin(wave * 3) * 2 * pulse;\n          break;\n      }\n\n      // Добавляем смещение перпендикулярно направлению\n      const perpX = -dirZ;\n      const perpZ = dirX;\n\n      this.velocity.x = dirX * currentSpeed + perpX * offsetX * 0.3 + offsetX * 0.1;\n      this.velocity.y = dirY * currentSpeed + offsetY * 0.3;\n      this.velocity.z = dirZ * currentSpeed + perpZ * offsetZ * 0.3 + offsetZ * 0.1;\n\n      this.position.x += this.velocity.x * dt;\n      this.position.y += this.velocity.y * dt;\n      this.position.z += this.velocity.z * dt;\n\n      this.position.y = Math.max(0.5, Math.min(4.0, this.position.y));\n    }\n  }\n\n  /** Обновление фантома - разгон и пронзание */\n  private updatePhantom(dt: number, playerPos: Vec3, time: number): void {\n    const dx = playerPos.x - this.position.x;\n    const dy = (playerPos.y - 0.3) - this.position.y;\n    const dz = playerPos.z - this.position.z;\n    const dist = Math.sqrt(dx * dx + dy * dy + dz * dz);\n\n    if (this.isCharging) {\n      // Фаза разгона - набираем скорость, направляемся к игроку\n      this.currentSpeed = Math.min(this.currentSpeed + dt * 15, this.speed);\n\n      // Обновляем направление пока разгоняемся\n      if (dist > 0.1) {\n        this.chargeDirection.x = dx / dist;\n        this.chargeDirection.y = dy / dist;\n        this.chargeDirection.z = dz / dist;\n      }\n\n      // Слегка покачиваемся пока набираем разгон\n      const wobble = Math.sin(time * 10) * 0.3;\n      \n      this.velocity.x = this.chargeDirection.x * this.currentSpeed + wobble;\n      this.velocity.y = this.chargeDirection.y * this.currentSpeed;\n      this.velocity.z = this.chargeDirection.z * this.currentSpeed;\n\n      // Когда набрали полную скорость - фиксируем направление\n      if (this.currentSpeed >= this.speed * 0.9) {\n        this.isCharging = false;\n      }\n    } else {\n      // Фаза атаки - летим по инерции в зафиксированном направлении\n      this.passedThroughTimer += dt;\n\n      // Продолжаем лететь в том же направлении\n      this.velocity.x = this.chargeDirection.x * this.speed;\n      this.velocity.y = this.chargeDirection.y * this.speed;\n      this.velocity.z = this.chargeDirection.z * this.speed;\n\n      // После пролёта через игрока (3 сек) - разворачиваемся\n      if (this.passedThroughTimer > 2.5) {\n        this.isCharging = true;\n        this.currentSpeed = this.speed * 0.3; // Частичный разгон\n        this.passedThroughTimer = 0;\n      }\n    }\n\n    // Движение\n    this.position.x += this.velocity.x * dt;\n    this.position.y += this.velocity.y * dt;\n    this.position.z += this.velocity.z * dt;\n\n    // Ограничения высоты\n    this.position.y = Math.max(0.5, Math.min(4.0, this.position.y));\n\n    // Если улетел слишком далеко - начинаем разгон заново\n    if (dist > 35) {\n      this.isCharging = true;\n      this.currentSpeed = 0;\n      this.passedThroughTimer = 0;\n    }\n  }\n\n  /** Обновление раннера - быстрый бегун, прицепляется к игроку */\n  private updateRunner(dt: number, playerPos: Vec3, time: number): void {\n    if (this.isAttached) {\n      // === РЕЖИМ ПРИЦЕПА - летает вокруг игрока ===\n      this.attachTimer -= dt;\n      this.orbitAngle += dt * 12; // Быстрое вращение!\n\n      // Летает вокруг игрока\n      const orbitRadius = 1.2;\n      const orbitHeight = Math.sin(time * 8) * 0.3;\n      \n      this.position.x = playerPos.x + Math.cos(this.orbitAngle) * orbitRadius;\n      this.position.y = playerPos.y + orbitHeight;\n      this.position.z = playerPos.z + Math.sin(this.orbitAngle) * orbitRadius;\n\n      // Время вышло - наносим урон и отцепляемся!\n      if (this.attachTimer <= 0) {\n        this.isAttached = false;\n        this.active = false; // Самоуничтожение после укуса\n        this.removeTimer = 0.5;\n      }\n      return;\n    }\n\n    // === РЕЖИМ ПОГОНИ ===\n    const dx = playerPos.x - this.position.x;\n    const dz = playerPos.z - this.position.z;\n    const dist = Math.sqrt(dx * dx + dz * dz);\n\n    // Если достаточно близко - ПРИЦЕПЛЯЕМСЯ!\n    if (dist < 1.5) {\n      this.isAttached = true;\n      this.attachTimer = 3.0; // 3 секунды чтобы скинуть!\n      this.orbitAngle = Math.atan2(dz, dx);\n      return;\n    }\n\n    if (dist > 0.1) {\n      const dirX = dx / dist;\n      const dirZ = dz / dist;\n\n      // Таймер уклонения\n      this.dodgeTimer -= dt;\n      if (this.dodgeTimer <= 0) {\n        this.dodgeAngle = (Math.random() - 0.5) * Math.PI * 0.8;\n        this.dodgeTimer = 0.3 + Math.random() * 0.4;\n      }\n\n      // Применяем уклонение к направлению\n      const cos = Math.cos(this.dodgeAngle);\n      const sin = Math.sin(this.dodgeAngle);\n      const dodgedDirX = dirX * cos - dirZ * sin;\n      const dodgedDirZ = dirX * sin + dirZ * cos;\n\n      // Скорость увеличивается при приближении\n      const aggression = 1.0 + Math.max(0, (10 - dist) / 10) * 0.5;\n      const currentSpeed = this.speed * aggression;\n\n      // Зигзаг движение\n      const zigzag = Math.sin(time * 15 + this.phase) * 2;\n\n      this.velocity.x = dodgedDirX * currentSpeed + zigzag * 0.3;\n      this.velocity.y = 0;\n      this.velocity.z = dodgedDirZ * currentSpeed;\n\n      this.position.x += this.velocity.x * dt;\n      this.position.z += this.velocity.z * dt;\n      \n      // Бежит по земле\n      this.position.y = 0.5 + Math.abs(Math.sin(time * 20)) * 0.1;\n    }\n  }\n\n  /** Откидывание от удара (для боссов) */\n  public applyKnockback(dirX: number, dirZ: number, force: number): void {\n    // Нормализуем направление\n    const len = Math.sqrt(dirX * dirX + dirZ * dirZ);\n    if (len > 0) {\n      this.velocity.x = (dirX / len) * force;\n      this.velocity.z = (dirZ / len) * force;\n      // Немного подбрасываем\n      this.velocity.y = force * 0.3;\n    }\n    // Таймер стана - босс замирает на мгновение\n    this.knockbackTimer = 0.3;\n  }\n\n  /** Таймер отката от удара */\n  private knockbackTimer = 0;\n\n  /** Скинуть раннера (двойной прыжок) */\n  public detachRunner(): boolean {\n    if (this.isAttached && this.enemyType === 'runner') {\n      this.isAttached = false;\n      const angle = this.orbitAngle + Math.PI;\n      this.velocity.x = Math.cos(angle) * 15;\n      this.velocity.y = 8;\n      this.velocity.z = Math.sin(angle) * 15;\n      this.attachTimer = 0;\n      return true;\n    }\n    return false;\n  }\n\n  /** Callback для создания лужи */\n  public onCreatePool?: (pos: Vec3) => void;\n\n  /** Зелёный босс - медленно надвигается, оставляет лужи */\n  private updateBossGreen(dt: number, playerPos: Vec3, time: number): void {\n    // Обработка отката от удара\n    if (this.knockbackTimer > 0) {\n      this.knockbackTimer -= dt;\n      // Применяем инерцию отката\n      this.position.x += this.velocity.x * dt;\n      this.position.y += this.velocity.y * dt;\n      this.position.z += this.velocity.z * dt;\n      // Затухание скорости\n      this.velocity.x *= 0.9;\n      this.velocity.y *= 0.9;\n      this.velocity.z *= 0.9;\n      // Гравитация\n      this.velocity.y -= 15 * dt;\n      this.position.y = Math.max(this.radius, this.position.y);\n      return;\n    }\n\n    const dx = playerPos.x - this.position.x;\n    const dy = playerPos.y - this.position.y;\n    const dz = playerPos.z - this.position.z;\n    const dist = Math.sqrt(dx * dx + dy * dy + dz * dz);\n\n    if (dist > 0.1) {\n      const dirX = dx / dist;\n      const dirY = dy / dist;\n      const dirZ = dz / dist;\n\n      // Медленно но неуклонно\n      const wobble = Math.sin(time * 2) * 0.5;\n      \n      this.velocity.x = dirX * this.speed + wobble;\n      this.velocity.y = dirY * this.speed * 0.3;\n      this.velocity.z = dirZ * this.speed;\n\n      this.position.x += this.velocity.x * dt;\n      this.position.y += this.velocity.y * dt;\n      this.position.z += this.velocity.z * dt;\n\n      // Не опускается ниже пола\n      this.position.y = Math.max(this.radius, this.position.y);\n    }\n\n    // Пульсирующий размер (больше во второй фазе)\n    const baseRadius = this.bossPhase === 2 ? 2.8 : 2.5;\n    this.radius = baseRadius + Math.sin(time * 3) * 0.3;\n\n    // Создание токсичных луж\n    this.poolTimer -= dt;\n    // Во второй фазе лужи создаются в 2 раза чаще!\n    const poolCooldown = this.bossPhase === 2 ? 1.0 : 2.0;\n    if (this.poolTimer <= 0) {\n      this.poolTimer = poolCooldown;\n      // Лужа под боссом\n      const poolPos = vec3(this.position.x, 0.05, this.position.z);\n      this.onCreatePool?.(poolPos);\n      \n      // Во второй фазе создаёт дополнительные лужи вокруг\n      if (this.bossPhase === 2) {\n        const angle = Math.random() * Math.PI * 2;\n        const extraPool = vec3(\n          this.position.x + Math.cos(angle) * 3,\n          0.05,\n          this.position.z + Math.sin(angle) * 3\n        );\n        this.onCreatePool?.(extraPool);\n      }\n    }\n  }\n\n  /** Чёрный босс - искривляет пространство вокруг себя */\n  private updateBossBlack(dt: number, playerPos: Vec3, time: number): void {\n    // Обработка отката от удара\n    if (this.knockbackTimer > 0) {\n      this.knockbackTimer -= dt;\n      this.position.x += this.velocity.x * dt;\n      this.position.y += this.velocity.y * dt;\n      this.position.z += this.velocity.z * dt;\n      this.velocity.x *= 0.92;\n      this.velocity.y *= 0.92;\n      this.velocity.z *= 0.92;\n      this.velocity.y -= 10 * dt;\n      this.position.y = Math.max(1.0, this.position.y);\n      return;\n    }\n\n    const dx = playerPos.x - this.position.x;\n    const dy = playerPos.y - this.position.y;\n    const dz = playerPos.z - this.position.z;\n    const dist = Math.sqrt(dx * dx + dy * dy + dz * dz);\n\n    // Орбитальное движение вокруг центра + приближение к игроку\n    const orbitSpeed = 0.5;\n    const orbitRadius = 8 + Math.sin(time * 0.3) * 3;\n    \n    const targetX = Math.cos(time * orbitSpeed) * orbitRadius;\n    const targetZ = Math.sin(time * orbitSpeed) * orbitRadius;\n    \n    // Притяжение к орбите + направление к игроку\n    const toOrbitX = targetX - this.position.x;\n    const toOrbitZ = targetZ - this.position.z;\n    \n    this.velocity.x = toOrbitX * 0.5 + (dx / dist) * this.speed * 0.3;\n    this.velocity.y = (1.5 - this.position.y) * 2; // Держится на высоте\n    this.velocity.z = toOrbitZ * 0.5 + (dz / dist) * this.speed * 0.3;\n\n    this.position.x += this.velocity.x * dt;\n    this.position.y += this.velocity.y * dt;\n    this.position.z += this.velocity.z * dt;\n\n    // Интенсивность искривления зависит от расстояния до игрока\n    this.distortionPower = Math.max(0, 1.0 - dist / 20);\n  }\n\n  /** Синий босс - телепортируется */\n  private updateBossBlue(dt: number, playerPos: Vec3, time: number): void {\n    // Обработка отката от удара - синий откидывается сильно!\n    if (this.knockbackTimer > 0) {\n      this.knockbackTimer -= dt;\n      this.position.x += this.velocity.x * dt;\n      this.position.y += this.velocity.y * dt;\n      this.position.z += this.velocity.z * dt;\n      this.velocity.x *= 0.85; // Быстрее затухает\n      this.velocity.y *= 0.85;\n      this.velocity.z *= 0.85;\n      this.velocity.y -= 20 * dt;\n      this.position.y = Math.max(0.5, this.position.y);\n      return;\n    }\n\n    this.teleportTimer -= dt;\n\n    if (this.teleportTimer <= 0) {\n      // ТЕЛЕПОРТ!\n      const angle = Math.random() * Math.PI * 2;\n      const dist = 5 + Math.random() * 10;\n      \n      this.position.x = playerPos.x + Math.cos(angle) * dist;\n      this.position.y = 1.5 + Math.random() * 2;\n      this.position.z = playerPos.z + Math.sin(angle) * dist;\n      \n      this.teleportTimer = 2.0 + Math.random() * 2.0; // 2-4 сек между телепортами\n      return;\n    }\n\n    // Между телепортами - агрессивное преследование\n    const dx = playerPos.x - this.position.x;\n    const dy = playerPos.y - this.position.y;\n    const dz = playerPos.z - this.position.z;\n    const dist = Math.sqrt(dx * dx + dy * dy + dz * dz);\n\n    if (dist > 0.1) {\n      // Зигзаг движение\n      const zigzag = Math.sin(time * 10) * 3;\n      \n      this.velocity.x = (dx / dist) * this.speed + zigzag * 0.5;\n      this.velocity.y = (dy / dist) * this.speed * 0.5;\n      this.velocity.z = (dz / dist) * this.speed;\n\n      this.position.x += this.velocity.x * dt;\n      this.position.y += this.velocity.y * dt;\n      this.position.z += this.velocity.z * dt;\n\n      this.position.y = Math.max(0.5, Math.min(4.0, this.position.y));\n    }\n  }\n\n  /** Получить урон (для боссов) */\n  public takeDamage(amount: number = 1): boolean {\n    this.hp -= amount;\n    \n    // Проверка смены фазы для Зелёного Босса\n    if (this.enemyType === 'boss_green' && this.bossPhase === 1) {\n      if (this.hp <= this.maxHp / 2) {\n        this.bossPhase = 2;\n        this.speed *= 1.3; // Быстрее во второй фазе\n        this.onPhaseChange?.(2);\n      }\n    }\n    \n    if (this.hp <= 0) {\n      this.hp = 0;\n      return true; // Убит\n    }\n    return false;\n  }\n\n  /** Обновление хоппера - прыгающий враг */\n  private updateHopper(dt: number, playerPos: Vec3, time: number): void {\n    const dx = playerPos.x - this.position.x;\n    const dy = playerPos.y - this.position.y;\n    const dz = playerPos.z - this.position.z;\n    const distXZ = Math.sqrt(dx * dx + dz * dz);\n\n    // Гравитация\n    const gravity = 18.0;\n\n    if (this.onGround) {\n      // На земле - готовимся к прыжку\n      this.hopTimer -= dt;\n      \n      if (this.hopTimer <= 0) {\n        // ПРЫЖОК!\n        this.onGround = false;\n        this.verticalVelocity = 10 + Math.random() * 4; // Высокий прыжок\n        this.hopTimer = 0.5 + Math.random() * 0.5;\n\n        // Направляемся к игроку с упреждением\n        if (distXZ > 0.1) {\n          const jumpSpeed = this.speed * 1.5;\n          this.velocity.x = (dx / distXZ) * jumpSpeed;\n          this.velocity.z = (dz / distXZ) * jumpSpeed;\n        }\n      } else {\n        // Ждём на земле, немного двигаемся\n        this.velocity.x *= 0.9;\n        this.velocity.z *= 0.9;\n      }\n    } else {\n      // В воздухе\n      this.verticalVelocity -= gravity * dt;\n      \n      // Немного корректируем направление в воздухе\n      if (distXZ > 0.1) {\n        this.velocity.x += (dx / distXZ) * dt * 3;\n        this.velocity.z += (dz / distXZ) * dt * 3;\n      }\n    }\n\n    // Применяем движение\n    this.position.x += this.velocity.x * dt;\n    this.position.y += this.verticalVelocity * dt;\n    this.position.z += this.velocity.z * dt;\n\n    // Проверка земли\n    if (this.position.y <= 0.5) {\n      this.position.y = 0.5;\n      this.onGround = true;\n      this.verticalVelocity = 0;\n    }\n\n    // Максимальная высота\n    this.position.y = Math.min(6.0, this.position.y);\n  }\n\n  /** Обновление осколков */\n  private updateFragments(dt: number): void {\n    const gravity = 15.0;\n\n    for (let i = this.fragments.length - 1; i >= 0; i--) {\n      const f = this.fragments[i];\n\n      // Физика\n      f.position.x += f.velocity.x * dt;\n      f.position.y += f.velocity.y * dt;\n      f.position.z += f.velocity.z * dt;\n\n      // Гравитация\n      f.velocity.y -= gravity * dt;\n\n      // Вращение\n      f.rotation += f.rotationSpeed * dt;\n\n      // Время жизни\n      f.lifetime -= dt;\n\n      // Удаляем мёртвые\n      if (f.lifetime <= 0 || f.position.y < -5) {\n        this.fragments.splice(i, 1);\n      }\n    }\n  }\n\n  /** Проверка столкновения с игроком */\n  public checkPlayerCollision(playerPos: Vec3): boolean {\n    if (!this.active) return false;\n\n    const dist = distanceVec3(this.position, playerPos);\n    return dist < this.radius + 0.5; // Радиус игрока ~0.5\n  }\n\n  /** Разрубить на куски! */\n  public slice(sliceDirection: Vec3): void {\n    if (!this.active) return;\n\n    this.active = false;\n    this.removeTimer = 3.0;\n\n    // Создаём осколки\n    const numFragments = 4 + Math.floor(Math.random() * 4); // 4-7 кусков\n\n    for (let i = 0; i < numFragments; i++) {\n      // Случайное направление разлёта\n      const angle = Math.random() * Math.PI * 2;\n      const upAngle = Math.random() * Math.PI * 0.5;\n      \n      const speed = 8 + Math.random() * 12;\n      \n      // Основное направление - от удара + случайное\n      const vx = sliceDirection.x * speed * 0.5 + Math.cos(angle) * Math.cos(upAngle) * speed;\n      const vy = Math.sin(upAngle) * speed + 3;\n      const vz = sliceDirection.z * speed * 0.5 + Math.sin(angle) * Math.cos(upAngle) * speed;\n\n      this.fragments.push({\n        position: { \n          x: this.position.x + (Math.random() - 0.5) * this.radius,\n          y: this.position.y + (Math.random() - 0.5) * this.radius,\n          z: this.position.z + (Math.random() - 0.5) * this.radius,\n        },\n        velocity: { x: vx, y: vy, z: vz },\n        size: 0.15 + Math.random() * 0.25,\n        lifetime: 1.5 + Math.random() * 1.0,\n        rotation: Math.random() * Math.PI * 2,\n        rotationSpeed: (Math.random() - 0.5) * 15,\n      });\n    }\n  }\n\n  /** Можно удалить? */\n  public canRemove(): boolean {\n    return !this.active && this.removeTimer <= 0 && this.fragments.length === 0;\n  }\n\n  /** Данные для шейдера [x, y, z, type+intensity] */\n  public getShaderData(): [number, number, number, number] {\n    // w компонент: 0 = неактивен\n    // 1.0-1.9 = бейнлинг (зелёный)\n    // 3.0-3.9 = фантом (чёрный)\n    // 5.0-5.9 = runner (оранжевый)\n    // 7.0-7.9 = hopper (синий)\n    // 11.0-11.9 = boss_green (огромный зелёный)\n    // 13.0-13.9 = boss_black (чёрный, искривление)\n    // 15.0-15.9 = boss_blue (синий, телепорт)\n    let w = 0;\n    if (this.active) {\n      const intensity = this.fireIntensity * 0.5;\n      switch (this.enemyType) {\n        case 'phantom':\n          w = 3 + intensity;\n          break;\n        case 'runner':\n          w = 5 + intensity;\n          break;\n        case 'hopper':\n          w = 7 + intensity;\n          break;\n        case 'boss_green':\n          w = 11 + intensity;\n          break;\n        case 'boss_black':\n          w = 13 + intensity;\n          break;\n        case 'boss_blue':\n          w = 15 + intensity;\n          break;\n        default: // baneling\n          w = 1 + intensity;\n      }\n    }\n    return [this.position.x, this.position.y, this.position.z, w];\n  }\n\n  /** Данные осколков для шейдера */\n  public getFragmentsData(): number[] {\n    const data: number[] = [];\n    for (const f of this.fragments) {\n      data.push(f.position.x, f.position.y, f.position.z, f.size);\n    }\n    return data;\n  }\n}\n\n/**\n * Менеджер врагов с системой волн\n */\nexport class TargetManager {\n  /** Все враги */\n  public targets: Target[] = [];\n\n  /** Текущая волна */\n  public wave = 0;\n\n  /** Волна активна? */\n  public waveActive = false;\n\n  /** Задержка между волнами (секунды) */\n  private waveDelay = 4.0;\n  private waveTimer = 0;\n\n  /** Счёт */\n  public score = 0;\n\n  /** Callback при уничтожении */\n  public onTargetDestroyed?: (target: Target) => void;\n\n  /** Callback при столкновении с игроком */\n  public onPlayerHit?: (target: Target) => void;\n\n  /** Callback при завершении волны */\n  public onWaveComplete?: (wave: number) => void;\n\n  /** Callback при старте волны */\n  public onWaveStart?: (wave: number) => void;\n\n  /** Callback при уроне от лужи */\n  public onPoolDamage?: (damage: number) => void;\n\n  /** Callback при смене фазы босса */\n  public onBossPhaseChange?: (bossType: EnemyType, phase: number) => void;\n\n  /** Токсичные лужи */\n  public toxicPools: ToxicPool[] = [];\n\n  /** Таймер урона от луж */\n  private poolDamageTimer = 0;\n\n  constructor() {}\n\n  /** Начать игру с указанной волны */\n  public startGame(startWave: number = 1): void {\n    this.wave = startWave - 1; // -1 потому что startNextWave сделает +1\n    this.score = 0;\n    this.targets = [];\n    this.toxicPools = [];\n    this.startNextWave();\n  }\n\n  /** Начать следующую волну */\n  public startNextWave(): void {\n    this.wave++;\n    this.waveActive = true;\n    \n    // Спавним N врагов (N = номер волны)\n    this.spawnEnemies(this.wave);\n    \n    this.onWaveStart?.(this.wave);\n  }\n\n  /** Счётчик для ID */\n  private enemyIdCounter = 0;\n\n  /**\n   * Спавн врагов по волнам:\n   * - Волна 5: ЗЕЛЁНЫЙ БОСС + враги\n   * - Волна 10: ЧЁРНЫЙ БОСС + враги\n   * - Волна 15: СИНИЙ БОСС + враги\n   */\n  private spawnEnemies(wave: number): void {\n    const spawnRadius = 18;\n    const baseSpeed = 3.5 + wave * 0.3;\n\n    // === БОССЫ ===\n    if (wave === 5) {\n      // ЗЕЛЁНЫЙ БОСС!\n      const pos = vec3(0, 3.0, -spawnRadius);\n      const boss = new Target(pos, baseSpeed, this.enemyIdCounter++, 'boss_green');\n      // Callback для создания луж\n      boss.onCreatePool = (poolPos) => {\n        this.toxicPools.push({\n          position: { ...poolPos },\n          radius: 2.5,\n          lifetime: 8.0, // 8 секунд живёт\n          damage: 5 // 5 урона в секунду\n        });\n      };\n      // Callback для смены фазы\n      boss.onPhaseChange = (phase) => {\n        this.onBossPhaseChange?.(boss.enemyType, phase);\n      };\n      this.targets.push(boss);\n    } else if (wave === 10) {\n      // ЧЁРНЫЙ БОСС!\n      const pos = vec3(0, 2.5, -spawnRadius);\n      this.targets.push(new Target(pos, baseSpeed, this.enemyIdCounter++, 'boss_black'));\n    } else if (wave === 15) {\n      // СИНИЙ БОСС!\n      const pos = vec3(0, 2.0, -spawnRadius);\n      this.targets.push(new Target(pos, baseSpeed, this.enemyIdCounter++, 'boss_blue'));\n    }\n\n    // На волнах боссов - ТОЛЬКО БОСС!\n    const isBossWave = wave === 5 || wave === 10 || wave === 15;\n    if (isBossWave) return; // Не спавним обычных врагов на волнах боссов\n    \n    // === СБАЛАНСИРОВАННОЕ КОЛИЧЕСТВО ВРАГОВ ===\n    // Эпоха 1 (1-5): умеренно\n    // Эпоха 2 (6-10): сложнее, но без раннеров\n    // Эпоха 3 (11-15): максимальная сложность с раннерами\n    \n    let banelingCount: number;\n    let phantomCount: number;\n    let runnerCount: number;\n    let hopperCount: number;\n    \n    if (wave <= 5) {\n      // Эпоха 1: кислотная - простая\n      banelingCount = Math.floor(wave * 1.2);\n      phantomCount = wave >= 3 ? Math.floor((wave - 2) * 0.8) : 0;\n      runnerCount = 0; // Нет раннеров\n      hopperCount = wave >= 4 ? Math.floor((wave - 3) * 0.5) : 0;\n    } else if (wave <= 10) {\n      // Эпоха 2: чёрная дыра - средняя сложность\n      banelingCount = Math.floor(wave * 0.8); // Меньше бейнлингов\n      phantomCount = Math.floor((wave - 3) * 0.6); // Меньше фантомов\n      runnerCount = 0; // Нет раннеров до 11 волны!\n      hopperCount = Math.floor((wave - 4) * 0.6); // Меньше хопперов\n    } else {\n      // Эпоха 3: космическая - с раннерами\n      banelingCount = Math.floor(wave * 0.7);\n      phantomCount = Math.floor((wave - 5) * 0.5);\n      runnerCount = Math.floor((wave - 10) * 1.5); // Раннеры с 11 волны!\n      hopperCount = Math.floor((wave - 6) * 0.5);\n    }\n\n    const totalCount = Math.max(1, banelingCount + phantomCount + runnerCount + hopperCount);\n    let idx = 0;\n\n    // Спавним бейнлингов (зелёные)\n    for (let i = 0; i < banelingCount; i++) {\n      const angle = (idx / totalCount) * Math.PI * 2 + Math.random() * 0.3;\n      const height = 1.0 + Math.random() * 2.5;\n\n      const pos = vec3(\n        Math.cos(angle) * spawnRadius,\n        height,\n        Math.sin(angle) * spawnRadius\n      );\n\n      const speed = baseSpeed + Math.random() * 1.5;\n      this.targets.push(new Target(pos, speed, this.enemyIdCounter++, 'baneling'));\n      idx++;\n    }\n\n    // Спавним раннеров (оранжевые, бегут по земле)\n    for (let i = 0; i < runnerCount; i++) {\n      const angle = (idx / totalCount) * Math.PI * 2 + Math.random() * 0.3;\n\n      const pos = vec3(\n        Math.cos(angle) * spawnRadius,\n        0.5,\n        Math.sin(angle) * spawnRadius\n      );\n\n      const speed = baseSpeed + Math.random() * 1.0;\n      this.targets.push(new Target(pos, speed, this.enemyIdCounter++, 'runner'));\n      idx++;\n    }\n\n    // Спавним хопперов (синие, прыгают)\n    for (let i = 0; i < hopperCount; i++) {\n      const angle = (idx / totalCount) * Math.PI * 2 + Math.random() * 0.3;\n\n      const pos = vec3(\n        Math.cos(angle) * spawnRadius,\n        0.5,\n        Math.sin(angle) * spawnRadius\n      );\n\n      const speed = baseSpeed + Math.random() * 1.0;\n      this.targets.push(new Target(pos, speed, this.enemyIdCounter++, 'hopper'));\n      idx++;\n    }\n\n    // Спавним фантомов (чёрные)\n    for (let i = 0; i < phantomCount; i++) {\n      const angle = ((banelingCount + i) / totalCount) * Math.PI * 2 + Math.random() * 0.3;\n      const height = 1.5 + Math.random() * 2.0;\n\n      const pos = vec3(\n        Math.cos(angle) * spawnRadius,\n        height,\n        Math.sin(angle) * spawnRadius\n      );\n\n      const speed = baseSpeed + Math.random() * 1.0;\n      this.targets.push(new Target(pos, speed, this.enemyIdCounter++, 'phantom'));\n    }\n  }\n\n  /** Кулдаун на урон от фантомов (чтобы не спамил урон) */\n  private phantomDamageCooldown: Map<number, number> = new Map();\n\n  /** Обновление */\n  public update(dt: number, playerPos: Vec3, time: number): void {\n    // Таймер между волнами\n    if (!this.waveActive && this.waveTimer > 0) {\n      this.waveTimer -= dt;\n      if (this.waveTimer <= 0) {\n        this.startNextWave();\n      }\n      return;\n    }\n\n    // Уменьшаем кулдауны фантомов\n    for (const [id, cd] of this.phantomDamageCooldown) {\n      if (cd > 0) {\n        this.phantomDamageCooldown.set(id, cd - dt);\n      }\n    }\n\n    // Обновляем врагов\n    for (const target of this.targets) {\n      target.update(dt, playerPos, time);\n\n      // Проверка столкновения с игроком\n      if (target.checkPlayerCollision(playerPos)) {\n        if (target.enemyType === 'phantom') {\n          // Фантом пролетает сквозь, но наносит урон с кулдауном\n          const cd = this.phantomDamageCooldown.get(target['id'] as number) || 0;\n          if (cd <= 0) {\n            this.onPlayerHit?.(target);\n            this.phantomDamageCooldown.set(target['id'] as number, 1.0); // 1 сек кулдаун\n          }\n          // НЕ деактивируем - фантом летит дальше!\n        } else if (target.isBoss) {\n          // Боссы наносят урон но НЕ умирают при столкновении!\n          const cd = this.phantomDamageCooldown.get(target['id'] as number) || 0;\n          if (cd <= 0) {\n            this.onPlayerHit?.(target);\n            this.phantomDamageCooldown.set(target['id'] as number, 1.5); // 1.5 сек кулдаун для боссов\n          }\n        } else {\n          // Обычные враги взрываются\n          this.onPlayerHit?.(target);\n          target.active = false;\n        }\n      }\n    }\n\n    // Удаляем мёртвых\n    this.targets = this.targets.filter(t => !t.canRemove());\n\n    // === ТОКСИЧНЫЕ ЛУЖИ ===\n    // Обновляем время жизни луж\n    for (const pool of this.toxicPools) {\n      pool.lifetime -= dt;\n    }\n    // Удаляем истёкшие\n    this.toxicPools = this.toxicPools.filter(p => p.lifetime > 0);\n\n    // Урон от луж (каждые 0.5 сек)\n    this.poolDamageTimer -= dt;\n    if (this.poolDamageTimer <= 0) {\n      this.poolDamageTimer = 0.5;\n      \n      for (const pool of this.toxicPools) {\n        const dx = playerPos.x - pool.position.x;\n        const dz = playerPos.z - pool.position.z;\n        const dist = Math.sqrt(dx * dx + dz * dz);\n        \n        if (dist < pool.radius) {\n          // Игрок в луже - урон!\n          this.onPoolDamage?.(pool.damage);\n          break; // Только одна лужа может наносить урон за раз\n        }\n      }\n    }\n\n    // Проверяем завершение волны\n    if (this.waveActive && this.getActiveCount() === 0) {\n      this.waveActive = false;\n      this.waveTimer = this.waveDelay;\n      this.onWaveComplete?.(this.wave);\n      // Очищаем лужи при завершении волны\n      this.toxicPools = [];\n    }\n  }\n\n  /** Попытка разрубить катаной */\n  public trySlice(playerPos: Vec3, playerYaw: number, range: number, angle: number): Target | null {\n    for (const target of this.targets) {\n      if (!target.active) continue;\n\n      // Расстояние (для боссов увеличиваем хитбокс)\n      const dx = target.position.x - playerPos.x;\n      const dz = target.position.z - playerPos.z;\n      const dist = Math.sqrt(dx * dx + dz * dz);\n      \n      // Учитываем размер врага\n      const effectiveRange = range + (target.isBoss ? target.radius : 0);\n      if (dist > effectiveRange) continue;\n\n      // Угол\n      const angleToTarget = Math.atan2(dx, -dz);\n      let angleDiff = angleToTarget - playerYaw;\n      \n      while (angleDiff > Math.PI) angleDiff -= Math.PI * 2;\n      while (angleDiff < -Math.PI) angleDiff += Math.PI * 2;\n\n      if (Math.abs(angleDiff) > angle / 2) continue;\n\n      // Попали!\n      if (target.isBoss) {\n        // Босс - уменьшаем HP\n        const killed = target.takeDamage(1);\n        \n        // Зелёный босс выпускает бейнлинга при каждом ударе!\n        if (target.enemyType === 'boss_green' && !killed) {\n          this.spawnBanelingFromBoss(target.position);\n        }\n        \n        if (killed) {\n          // Босс убит! Эпичный взрыв\n          const sliceDir = normalizeVec3({ x: dx, y: 0, z: dz });\n          target.slice(sliceDir);\n          this.score += 1000 * this.wave; // Много очков за босса!\n          this.onTargetDestroyed?.(target);\n          \n          // Зелёный босс при смерти выпускает кучу бейнлингов!\n          if (target.enemyType === 'boss_green') {\n            for (let i = 0; i < 5; i++) {\n              this.spawnBanelingFromBoss(target.position);\n            }\n          }\n        } else {\n          // Не убит - откидываем босса назад!\n          const knockbackForce = target.enemyType === 'boss_green' ? 8 : \n                                 target.enemyType === 'boss_black' ? 5 : 12; // Синий откидывается сильнее\n          target.applyKnockback(dx, dz, knockbackForce);\n        }\n        // Возвращаем даже если не убит - чтобы был хитмаркер\n        return target;\n      } else {\n        // Обычный враг - убиваем сразу\n        const sliceDir = normalizeVec3({ x: dx, y: 0, z: dz });\n        target.slice(sliceDir);\n        \n        this.score += 100 * this.wave;\n        this.onTargetDestroyed?.(target);\n        \n        return target;\n      }\n    }\n\n    return null;\n  }\n\n  /** Сплеш-волна - бьёт всех врагов в радиусе горизонтально */\n  public trySplashWave(playerPos: Vec3, playerYaw: number, radius: number): number {\n    let killCount = 0;\n    \n    for (const target of this.targets) {\n      if (!target.active) continue;\n\n      // Расстояние от игрока\n      const dx = target.position.x - playerPos.x;\n      const dz = target.position.z - playerPos.z;\n      const dist = Math.sqrt(dx * dx + dz * dz);\n      \n      // Учитываем размер врага для радиуса\n      const effectiveRadius = radius + (target.isBoss ? target.radius : target.radius);\n      if (dist > effectiveRadius) continue;\n\n      // Попали!\n      if (target.isBoss) {\n        // Босс - уменьшаем HP (сплеш наносит 2 урона)\n        const killed = target.takeDamage(2);\n        \n        // Зелёный босс выпускает бейнлинга при каждом ударе!\n        if (target.enemyType === 'boss_green' && !killed) {\n          this.spawnBanelingFromBoss(target.position);\n        }\n        \n        if (killed) {\n          // Босс убит!\n          const sliceDir = normalizeVec3({ x: dx, y: 0, z: dz });\n          target.slice(sliceDir);\n          this.score += 1000 * this.wave;\n          this.onTargetDestroyed?.(target);\n          killCount++;\n          \n          // Зелёный босс при смерти выпускает бейнлингов\n          if (target.enemyType === 'boss_green') {\n            for (let i = 0; i < 5; i++) {\n              this.spawnBanelingFromBoss(target.position);\n            }\n          }\n        } else {\n          // Откидываем босса назад (сплеш сильнее)\n          const knockbackForce = (target.enemyType === 'boss_green' ? 12 : \n                                  target.enemyType === 'boss_black' ? 8 : 18);\n          target.applyKnockback(dx, dz, knockbackForce);\n        }\n      } else {\n        // Обычный враг - убиваем сразу\n        const sliceDir = normalizeVec3({ x: dx, y: 0, z: dz });\n        target.slice(sliceDir);\n        \n        this.score += 100 * this.wave;\n        this.onTargetDestroyed?.(target);\n        killCount++;\n      }\n    }\n\n    return killCount;\n  }\n\n  /** Данные для шейдера (4 компонента: x, y, z, type) */\n  public getShaderData(): Float32Array {\n    const data = new Float32Array(this.targets.length * 4);\n    for (let i = 0; i < this.targets.length; i++) {\n      const [x, y, z, typeIntensity] = this.targets[i].getShaderData();\n      data[i * 4 + 0] = x;\n      data[i * 4 + 1] = y;\n      data[i * 4 + 2] = z;\n      data[i * 4 + 3] = typeIntensity;\n    }\n    return data;\n  }\n\n  /** Данные всех осколков */\n  public getAllFragmentsData(): Float32Array {\n    const allFragments: number[] = [];\n    for (const target of this.targets) {\n      allFragments.push(...target.getFragmentsData());\n    }\n    return new Float32Array(allFragments);\n  }\n\n  /** Данные луж для шейдера [x, z, radius, lifetime] */\n  public getPoolsShaderData(): Float32Array {\n    const data = new Float32Array(this.toxicPools.length * 4);\n    for (let i = 0; i < this.toxicPools.length; i++) {\n      const pool = this.toxicPools[i];\n      data[i * 4 + 0] = pool.position.x;\n      data[i * 4 + 1] = pool.position.z;\n      data[i * 4 + 2] = pool.radius;\n      data[i * 4 + 3] = pool.lifetime / 8.0; // Нормализованное время жизни\n    }\n    return data;\n  }\n\n  /** Спавн бейнлинга из Зелёного Босса */\n  private spawnBanelingFromBoss(bossPos: Vec3): void {\n    // Случайное направление вылета\n    const angle = Math.random() * Math.PI * 2;\n    const speed = 5 + Math.random() * 3;\n    \n    const pos = vec3(\n      bossPos.x + Math.cos(angle) * 2,\n      bossPos.y + Math.random() * 1.5,\n      bossPos.z + Math.sin(angle) * 2\n    );\n    \n    const baneling = new Target(pos, speed, this.enemyIdCounter++, 'baneling');\n    \n    // Начальная скорость - вылетает из босса\n    baneling.velocity = vec3(\n      Math.cos(angle) * 8,\n      3 + Math.random() * 3,\n      Math.sin(angle) * 8\n    );\n    \n    this.targets.push(baneling);\n  }\n\n  /** Количество активных врагов */\n  public getActiveCount(): number {\n    return this.targets.filter(t => t.active).length;\n  }\n\n  /** Получить активного босса (если есть) */\n  public getActiveBoss(): Target | null {\n    return this.targets.find(t => t.active && t.isBoss) || null;\n  }\n\n  /** Расстояние до ближайшего врага */\n  public getClosestEnemyDistance(playerPos: Vec3): number {\n    let minDist = Infinity;\n    for (const target of this.targets) {\n      if (!target.active) continue;\n      const dx = target.position.x - playerPos.x;\n      const dy = target.position.y - playerPos.y;\n      const dz = target.position.z - playerPos.z;\n      const dist = Math.sqrt(dx * dx + dy * dy + dz * dz);\n      if (dist < minDist) minDist = dist;\n    }\n    return minDist;\n  }\n\n  /** Создать мишени для арены (заглушка для совместимости) */\n  public createArenaTargets(_count: number = 8): void {\n    this.startGame();\n  }\n\n  /** Проверить попадание снаряда (заглушка) */\n  public checkProjectileHit(_position: Vec3, _damage: number): Target | null {\n    return null;\n  }\n}\n","import type { Vec3 } from '@/types';\nimport { vec3, distanceVec3 } from '@/utils/math';\n\n/** Тип предмета */\nexport type PickupType = 'health' | 'stimpack' | 'charge';\n\n/**\n * Предмет для подбора\n */\nexport class Pickup {\n  /** Позиция */\n  public position: Vec3;\n\n  /** Тип предмета */\n  public type: PickupType;\n\n  /** Радиус подбора */\n  public radius = 1.0;\n\n  /** Активен? */\n  public active = true;\n\n  /** Время жизни */\n  public lifetime: number;\n\n  /** Фаза анимации */\n  private phase: number;\n\n  /** Базовая высота */\n  private baseY: number;\n\n  constructor(position: Vec3, type: PickupType) {\n    this.position = { ...position };\n    this.type = type;\n    this.phase = Math.random() * Math.PI * 2;\n    this.baseY = position.y;\n    this.lifetime = 30; // 30 секунд жизни\n  }\n\n  /** Обновление */\n  public update(dt: number, time: number): void {\n    if (!this.active) return;\n\n    // Парящий эффект\n    this.position.y = this.baseY + Math.sin(time * 3 + this.phase) * 0.2;\n\n    // Уменьшение времени жизни\n    this.lifetime -= dt;\n    if (this.lifetime <= 0) {\n      this.active = false;\n    }\n  }\n\n  /** Проверка подбора */\n  public checkPickup(playerPos: Vec3): boolean {\n    if (!this.active) return false;\n\n    const dist = distanceVec3(this.position, playerPos);\n    if (dist < this.radius + 0.5) {\n      this.active = false;\n      return true;\n    }\n    return false;\n  }\n\n  /** Данные для шейдера [x, y, z, type] */\n  public getShaderData(): [number, number, number, number] {\n    // type: 0 = неактивен, 9 = health, 10 = stimpack, 11 = charge\n    let w = 0;\n    if (this.active) {\n      if (this.type === 'health') w = 9;\n      else if (this.type === 'stimpack') w = 10;\n      else if (this.type === 'charge') w = 11;\n    }\n    return [this.position.x, this.position.y, this.position.z, w];\n  }\n}\n\n/**\n * Менеджер предметов\n */\nexport class PickupManager {\n  /** Все предметы */\n  public pickups: Pickup[] = [];\n\n  /** Время между спавнами */\n  private spawnTimer = 10;\n\n  /** Таймер спавна на возвышенности */\n  private platformSpawnTimer = 30;\n\n  /** Позиции возвышенностей */\n  private platformPositions = [\n    { x: -20, y: 2.5, z: 0 },  // Левая платформа\n    { x: 20, y: 2.5, z: 0 },   // Правая платформа\n  ];\n\n  /** Текущая платформа для спавна */\n  private currentPlatform = 0;\n\n  /** Максимум предметов на карте */\n  private maxPickups = 5;\n\n  /** Заряд катаны на балконе */\n  private chargeOnBalcony: Pickup | null = null;\n  \n  /** Таймер респавна заряда */\n  private chargeRespawnTimer = 0;\n\n  constructor() {\n    // Спавним заряд на балконе сразу\n    this.spawnChargeOnBalcony();\n  }\n\n  /** Обновление */\n  public update(dt: number, time: number, playerPos: Vec3): PickupType | null {\n    // Обновляем существующие\n    for (const pickup of this.pickups) {\n      pickup.update(dt, time);\n    }\n\n    // Удаляем неактивные\n    this.pickups = this.pickups.filter(p => p.active);\n\n    // Спавним новые случайные\n    this.spawnTimer -= dt;\n    if (this.spawnTimer <= 0 && this.pickups.length < this.maxPickups) {\n      this.spawnRandom();\n      this.spawnTimer = 8 + Math.random() * 7; // 8-15 сек между спавнами\n    }\n\n    // Спавн аптечки на возвышенности каждые 30 секунд\n    this.platformSpawnTimer -= dt;\n    if (this.platformSpawnTimer <= 0) {\n      this.spawnOnPlatform();\n      this.platformSpawnTimer = 30;\n    }\n\n    // Обновляем респавн заряда\n    this.updateChargeRespawn(dt);\n\n    // Проверяем подбор заряда (только на балконе)\n    if (this.checkChargePickup(playerPos)) {\n      return 'charge';\n    }\n\n    // Проверяем подбор обычных предметов\n    for (const pickup of this.pickups) {\n      // Пропускаем заряд, он уже проверен выше\n      if (pickup.type === 'charge') continue;\n      \n      if (pickup.checkPickup(playerPos)) {\n        return pickup.type;\n      }\n    }\n\n    return null;\n  }\n\n  /** Спавн случайного предмета */\n  private spawnRandom(): void {\n    const spawnRadius = 15;\n    const angle = Math.random() * Math.PI * 2;\n    const dist = 5 + Math.random() * spawnRadius;\n    \n    const pos = vec3(\n      Math.cos(angle) * dist,\n      1.0,\n      Math.sin(angle) * dist\n    );\n\n    // Только аптечки (стимпаки за быстрые убийства)\n    this.pickups.push(new Pickup(pos, 'health'));\n  }\n\n  /** Спавн аптечки на возвышенности */\n  private spawnOnPlatform(): void {\n    // Чередуем платформы\n    const platform = this.platformPositions[this.currentPlatform];\n    this.currentPlatform = (this.currentPlatform + 1) % this.platformPositions.length;\n\n    const pos = vec3(\n      platform.x + (Math.random() - 0.5) * 4, // Небольшой разброс по X\n      platform.y,\n      platform.z + (Math.random() - 0.5) * 8  // Разброс по Z\n    );\n\n    // На платформе всегда аптечка\n    this.pickups.push(new Pickup(pos, 'health'));\n  }\n\n  /** Принудительный спавн после убийства */\n  public spawnAfterKill(position: Vec3): void {\n    // 25% шанс выпадения аптечки (стимпаки за быстрые убийства)\n    if (Math.random() < 0.25) {\n      const pos = vec3(\n        position.x + (Math.random() - 0.5) * 2,\n        1.0,\n        position.z + (Math.random() - 0.5) * 2\n      );\n      this.pickups.push(new Pickup(pos, 'health'));\n    }\n  }\n\n  /** Спавн заряда катаны на балконе */\n  private spawnChargeOnBalcony(): void {\n    // Позиция на верхнем балконе (высота 12)\n    const pos = vec3(0, 12.5, -23);\n    this.chargeOnBalcony = new Pickup(pos, 'charge');\n    this.chargeOnBalcony.lifetime = 999999; // Не исчезает\n    this.pickups.push(this.chargeOnBalcony);\n  }\n\n  /** Проверка подбора заряда (только на балконе!) */\n  public checkChargePickup(playerPos: Vec3): boolean {\n    if (!this.chargeOnBalcony || !this.chargeOnBalcony.active) return false;\n    \n    // Заряд можно подобрать только если игрок на верхнем балконе (высота > 11)\n    if (playerPos.y < 11.0) return false;\n    \n    if (this.chargeOnBalcony.checkPickup(playerPos)) {\n      this.chargeOnBalcony = null;\n      this.chargeRespawnTimer = 60; // Респавн через 60 секунд\n      return true;\n    }\n    return false;\n  }\n\n  /** Обновление респавна заряда */\n  public updateChargeRespawn(dt: number): void {\n    if (this.chargeOnBalcony === null && this.chargeRespawnTimer > 0) {\n      this.chargeRespawnTimer -= dt;\n      if (this.chargeRespawnTimer <= 0) {\n        this.spawnChargeOnBalcony();\n      }\n    }\n  }\n\n  /** Данные для шейдера */\n  public getShaderData(): Float32Array {\n    const data = new Float32Array(this.pickups.length * 4);\n    for (let i = 0; i < this.pickups.length; i++) {\n      const [x, y, z, w] = this.pickups[i].getShaderData();\n      data[i * 4 + 0] = x;\n      data[i * 4 + 1] = y;\n      data[i * 4 + 2] = z;\n      data[i * 4 + 3] = w;\n    }\n    return data;\n  }\n}\n\n","import type { SFXType } from '@/types';\n\n/**\n * Менеджер аудио - SYNTHWAVE/RETROWAVE стиль\n * Дисторшн, глитчи, реверб, энергия!\n */\nexport class AudioManager {\n  private ctx: AudioContext | null = null;\n  private masterGain: GainNode | null = null;\n  private musicGain: GainNode | null = null;\n  private sfxGain: GainNode | null = null;\n\n  // Эффекты\n  private reverb: ConvolverNode | null = null;\n  private distortion: WaveShaperNode | null = null;\n  private compressor: DynamicsCompressorNode | null = null;\n\n  /** Аудио запущено */\n  public isStarted = false;\n\n  /** Звук включён */\n  public isMuted = false;\n\n  /** Запустить аудио */\n  public start(): void {\n    if (this.isStarted) return;\n\n    this.ctx = new (window.AudioContext || (window as any).webkitAudioContext)();\n\n    // Компрессор для панча\n    this.compressor = this.ctx.createDynamicsCompressor();\n    this.compressor.threshold.value = -24;\n    this.compressor.knee.value = 30;\n    this.compressor.ratio.value = 12;\n    this.compressor.attack.value = 0.003;\n    this.compressor.release.value = 0.25;\n    this.compressor.connect(this.ctx.destination);\n\n    // Мастер громкость (уменьшена в 2 раза)\n    this.masterGain = this.ctx.createGain();\n    this.masterGain.gain.value = 0.4;\n    this.masterGain.connect(this.compressor);\n\n    // Дисторшн\n    this.distortion = this.createDistortion(20);\n    this.distortion.connect(this.masterGain);\n\n    // Реверб\n    this.reverb = this.createReverb(2.5);\n    this.reverb.connect(this.masterGain);\n\n    // Музыка\n    this.musicGain = this.ctx.createGain();\n    this.musicGain.gain.value = 0.12;\n    this.musicGain.connect(this.masterGain);\n\n    // Звуковые эффекты\n    this.sfxGain = this.ctx.createGain();\n    this.sfxGain.gain.value = 0.3;\n    this.sfxGain.connect(this.distortion);\n\n    this.isStarted = true;\n\n    // Запускаем музыку\n    this.startSynthwaveMusic();\n  }\n\n  /** Создать дисторшн */\n  private createDistortion(amount: number): WaveShaperNode {\n    const distortion = this.ctx!.createWaveShaper();\n    const samples = 44100;\n    const curve = new Float32Array(samples);\n    const deg = Math.PI / 180;\n\n    for (let i = 0; i < samples; i++) {\n      const x = (i * 2) / samples - 1;\n      curve[i] = ((3 + amount) * x * 20 * deg) / (Math.PI + amount * Math.abs(x));\n    }\n\n    distortion.curve = curve;\n    distortion.oversample = '4x';\n    return distortion;\n  }\n\n  /** Создать реверб */\n  private createReverb(duration: number): ConvolverNode {\n    const convolver = this.ctx!.createConvolver();\n    const rate = this.ctx!.sampleRate;\n    const length = rate * duration;\n    const impulse = this.ctx!.createBuffer(2, length, rate);\n\n    for (let channel = 0; channel < 2; channel++) {\n      const data = impulse.getChannelData(channel);\n      for (let i = 0; i < length; i++) {\n        // Экспоненциальное затухание с модуляцией\n        const decay = Math.exp(-3 * i / length);\n        const mod = Math.sin(i * 0.001) * 0.3 + 0.7;\n        data[i] = (Math.random() * 2 - 1) * decay * mod;\n      }\n    }\n\n    convolver.buffer = impulse;\n    return convolver;\n  }\n\n  /** Переключить звук */\n  public toggleMute(): void {\n    this.isMuted = !this.isMuted;\n    if (this.masterGain) {\n      this.masterGain.gain.value = this.isMuted ? 0 : this.volume;\n    }\n  }\n\n  /** Громкость (0-1) */\n  private volume = 0.5;\n\n  /** Установить громкость */\n  public setVolume(value: number): void {\n    this.volume = Math.max(0, Math.min(1, value));\n    if (this.masterGain && !this.isMuted) {\n      this.masterGain.gain.value = this.volume;\n    }\n  }\n\n  // Звук приближения врага\n  private proximityOsc: OscillatorNode | null = null;\n  private proximityGain: GainNode | null = null;\n  private proximityFilter: BiquadFilterNode | null = null;\n\n  /** Воспроизвести звуковой эффект */\n  public playSFX(type: SFXType): void {\n    if (!this.ctx || !this.sfxGain || this.isMuted) return;\n\n    switch (type) {\n      case 'gunshot':\n        this.playKatanaSwing();\n        break;\n      case 'reload':\n        this.playGlitch();\n        break;\n      case 'footstep':\n        this.playFootstep();\n        break;\n      case 'jump':\n        this.playJump();\n        break;\n      case 'land':\n        this.playLand();\n        break;\n      case 'hit':\n        this.playBanelingExplosion(); // Взрыв бейнлинга!\n        break;\n      case 'phantom_pass':\n        this.playPhantomPass();\n        break;\n      case 'runner_hit':\n        this.playRunnerHit();\n        break;\n      case 'hopper_hit':\n        this.playHopperHit();\n        break;\n      case 'kill':\n        this.playKill();\n        break;\n      case 'katana_swing':\n        this.playKatanaSwing();\n        break;\n      case 'splash_wave':\n        this.playSplashWave();\n        break;\n      case 'charge_pickup':\n        this.playChargePickup();\n        break;\n    }\n  }\n\n  /** Обновить звук приближения врага (0-1, где 1 = очень близко) */\n  public updateProximitySound(proximity: number): void {\n    if (!this.ctx || !this.sfxGain || this.isMuted) return;\n\n    // Создаём осциллятор если нет\n    if (!this.proximityOsc) {\n      this.proximityOsc = this.ctx.createOscillator();\n      this.proximityGain = this.ctx.createGain();\n      this.proximityFilter = this.ctx.createBiquadFilter();\n\n      this.proximityOsc.type = 'sawtooth';\n      this.proximityFilter!.type = 'lowpass';\n      this.proximityFilter!.Q.value = 5;\n\n      this.proximityOsc.connect(this.proximityFilter!);\n      this.proximityFilter!.connect(this.proximityGain!);\n      this.proximityGain!.connect(this.sfxGain);\n\n      this.proximityOsc.start();\n    }\n\n    // Частота и громкость зависят от близости\n    const freq = 80 + proximity * 200; // 80-280 Hz\n    const volume = proximity * 0.25; // 0-0.25\n    const filterFreq = 200 + proximity * 1500; // 200-1700 Hz\n\n    this.proximityOsc.frequency.setTargetAtTime(freq, this.ctx.currentTime, 0.1);\n    this.proximityGain!.gain.setTargetAtTime(volume, this.ctx.currentTime, 0.1);\n    this.proximityFilter!.frequency.setTargetAtTime(filterFreq, this.ctx.currentTime, 0.1);\n\n    // Добавляем вибрато при высокой близости\n    if (proximity > 0.6) {\n      const vibrato = Math.sin(this.ctx.currentTime * 20) * 20 * proximity;\n      this.proximityOsc.frequency.setTargetAtTime(freq + vibrato, this.ctx.currentTime, 0.02);\n    }\n  }\n\n  /** Взрыв бейнлинга! */\n  private playBanelingExplosion(): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    const now = this.ctx.currentTime;\n\n    // Мощный низкочастотный взрыв\n    const boom = this.ctx.createOscillator();\n    const boomGain = this.ctx.createGain();\n\n    boom.type = 'sine';\n    boom.frequency.setValueAtTime(100, now);\n    boom.frequency.exponentialRampToValueAtTime(20, now + 0.3);\n\n    boomGain.gain.setValueAtTime(0.7, now);\n    boomGain.gain.exponentialRampToValueAtTime(0.01, now + 0.4);\n\n    boom.connect(boomGain);\n    boomGain.connect(this.sfxGain);\n    boomGain.connect(this.reverb!);\n\n    boom.start(now);\n    boom.stop(now + 0.5);\n\n    // Звук разбрызгивания кислоты\n    const acidNoise = this.createNoise(0.4);\n    const acidGain = this.ctx.createGain();\n    const acidFilter = this.ctx.createBiquadFilter();\n    const acidFilter2 = this.ctx.createBiquadFilter();\n\n    acidFilter.type = 'bandpass';\n    acidFilter.frequency.setValueAtTime(3000, now);\n    acidFilter.frequency.exponentialRampToValueAtTime(500, now + 0.3);\n    acidFilter.Q.value = 3;\n\n    acidFilter2.type = 'highpass';\n    acidFilter2.frequency.value = 1000;\n\n    acidGain.gain.setValueAtTime(0.5, now);\n    acidGain.gain.exponentialRampToValueAtTime(0.01, now + 0.35);\n\n    acidNoise.connect(acidFilter);\n    acidFilter.connect(acidFilter2);\n    acidFilter2.connect(acidGain);\n    acidGain.connect(this.sfxGain);\n\n    // Булькающий звук\n    for (let i = 0; i < 5; i++) {\n      const delay = i * 0.04;\n      const bubble = this.ctx.createOscillator();\n      const bubbleGain = this.ctx.createGain();\n\n      bubble.type = 'sine';\n      bubble.frequency.setValueAtTime(400 + Math.random() * 600, now + delay);\n      bubble.frequency.exponentialRampToValueAtTime(100 + Math.random() * 100, now + delay + 0.08);\n\n      bubbleGain.gain.setValueAtTime(0.15, now + delay);\n      bubbleGain.gain.exponentialRampToValueAtTime(0.01, now + delay + 0.1);\n\n      bubble.connect(bubbleGain);\n      bubbleGain.connect(this.sfxGain);\n\n      bubble.start(now + delay);\n      bubble.stop(now + delay + 0.15);\n    }\n\n    // Шипение кислоты (затухающее)\n    const hiss = this.createNoise(0.8);\n    const hissGain = this.ctx.createGain();\n    const hissFilter = this.ctx.createBiquadFilter();\n\n    hissFilter.type = 'highpass';\n    hissFilter.frequency.value = 4000;\n\n    hissGain.gain.setValueAtTime(0.2, now + 0.1);\n    hissGain.gain.exponentialRampToValueAtTime(0.01, now + 0.7);\n\n    hiss.connect(hissFilter);\n    hissFilter.connect(hissGain);\n    hissGain.connect(this.sfxGain);\n  }\n\n  /** Фантом пролетает сквозь игрока */\n  private playPhantomPass(): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    const now = this.ctx.currentTime;\n\n    // Жуткий низкий свист (доплер эффект)\n    const swoosh = this.ctx.createOscillator();\n    const swooshGain = this.ctx.createGain();\n    const swooshFilter = this.ctx.createBiquadFilter();\n\n    swoosh.type = 'sawtooth';\n    // Частота падает как будто пролетает мимо\n    swoosh.frequency.setValueAtTime(400, now);\n    swoosh.frequency.exponentialRampToValueAtTime(100, now + 0.3);\n\n    swooshFilter.type = 'lowpass';\n    swooshFilter.frequency.setValueAtTime(2000, now);\n    swooshFilter.frequency.exponentialRampToValueAtTime(300, now + 0.3);\n    swooshFilter.Q.value = 2;\n\n    swooshGain.gain.setValueAtTime(0.3, now);\n    swooshGain.gain.exponentialRampToValueAtTime(0.01, now + 0.4);\n\n    swoosh.connect(swooshFilter);\n    swooshFilter.connect(swooshGain);\n    swooshGain.connect(this.sfxGain);\n    swooshGain.connect(this.reverb!);\n\n    swoosh.start(now);\n    swoosh.stop(now + 0.5);\n\n    // Тёмный резонанс\n    const dark = this.ctx.createOscillator();\n    const darkGain = this.ctx.createGain();\n\n    dark.type = 'sine';\n    dark.frequency.setValueAtTime(60, now);\n    dark.frequency.exponentialRampToValueAtTime(30, now + 0.5);\n\n    darkGain.gain.setValueAtTime(0.4, now);\n    darkGain.gain.exponentialRampToValueAtTime(0.01, now + 0.6);\n\n    dark.connect(darkGain);\n    darkGain.connect(this.sfxGain);\n\n    dark.start(now);\n    dark.stop(now + 0.7);\n\n    // Шёпот/шорох (высокочастотный шум)\n    const whisper = this.createNoise(0.3);\n    const whisperGain = this.ctx.createGain();\n    const whisperFilter = this.ctx.createBiquadFilter();\n\n    whisperFilter.type = 'bandpass';\n    whisperFilter.frequency.value = 3000;\n    whisperFilter.Q.value = 5;\n\n    whisperGain.gain.setValueAtTime(0.15, now);\n    whisperGain.gain.exponentialRampToValueAtTime(0.01, now + 0.25);\n\n    whisper.connect(whisperFilter);\n    whisperFilter.connect(whisperGain);\n    whisperGain.connect(this.sfxGain);\n  }\n\n  /** Runner врезался - быстрый огненный удар */\n  private playRunnerHit(): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    const now = this.ctx.currentTime;\n\n    // Быстрый свист\n    const swoosh = this.ctx.createOscillator();\n    const swooshGain = this.ctx.createGain();\n\n    swoosh.type = 'sawtooth';\n    swoosh.frequency.setValueAtTime(800, now);\n    swoosh.frequency.exponentialRampToValueAtTime(200, now + 0.15);\n\n    swooshGain.gain.setValueAtTime(0.3, now);\n    swooshGain.gain.exponentialRampToValueAtTime(0.01, now + 0.2);\n\n    swoosh.connect(swooshGain);\n    swooshGain.connect(this.sfxGain);\n\n    swoosh.start(now);\n    swoosh.stop(now + 0.25);\n\n    // Огненный треск\n    for (let i = 0; i < 4; i++) {\n      const crackle = this.ctx.createOscillator();\n      const crackleGain = this.ctx.createGain();\n\n      crackle.type = 'square';\n      crackle.frequency.value = 1000 + Math.random() * 2000;\n\n      const t = now + i * 0.03;\n      crackleGain.gain.setValueAtTime(0.15, t);\n      crackleGain.gain.setValueAtTime(0, t + 0.02);\n\n      crackle.connect(crackleGain);\n      crackleGain.connect(this.sfxGain);\n\n      crackle.start(t);\n      crackle.stop(t + 0.03);\n    }\n\n    // Низкий удар\n    const impact = this.ctx.createOscillator();\n    const impactGain = this.ctx.createGain();\n\n    impact.type = 'sine';\n    impact.frequency.setValueAtTime(120, now);\n    impact.frequency.exponentialRampToValueAtTime(40, now + 0.15);\n\n    impactGain.gain.setValueAtTime(0.4, now);\n    impactGain.gain.exponentialRampToValueAtTime(0.01, now + 0.2);\n\n    impact.connect(impactGain);\n    impactGain.connect(this.sfxGain);\n\n    impact.start(now);\n    impact.stop(now + 0.25);\n  }\n\n  /** Hopper приземлился на игрока - электрический удар сверху */\n  private playHopperHit(): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    const now = this.ctx.currentTime;\n\n    // Электрический разряд (высокий → низкий)\n    const zap = this.ctx.createOscillator();\n    const zapGain = this.ctx.createGain();\n    const zapFilter = this.ctx.createBiquadFilter();\n\n    zap.type = 'sawtooth';\n    zap.frequency.setValueAtTime(2000, now);\n    zap.frequency.exponentialRampToValueAtTime(100, now + 0.2);\n\n    zapFilter.type = 'bandpass';\n    zapFilter.frequency.value = 1500;\n    zapFilter.Q.value = 3;\n\n    zapGain.gain.setValueAtTime(0.35, now);\n    zapGain.gain.exponentialRampToValueAtTime(0.01, now + 0.25);\n\n    zap.connect(zapFilter);\n    zapFilter.connect(zapGain);\n    zapGain.connect(this.sfxGain);\n    zapGain.connect(this.reverb!);\n\n    zap.start(now);\n    zap.stop(now + 0.3);\n\n    // Тяжёлый удар сверху\n    const thud = this.ctx.createOscillator();\n    const thudGain = this.ctx.createGain();\n\n    thud.type = 'sine';\n    thud.frequency.setValueAtTime(80, now + 0.05);\n    thud.frequency.exponentialRampToValueAtTime(25, now + 0.3);\n\n    thudGain.gain.setValueAtTime(0.5, now + 0.05);\n    thudGain.gain.exponentialRampToValueAtTime(0.01, now + 0.35);\n\n    thud.connect(thudGain);\n    thudGain.connect(this.sfxGain);\n\n    thud.start(now + 0.05);\n    thud.stop(now + 0.4);\n\n    // Искры (шум)\n    const sparks = this.createNoise(0.25);\n    const sparksGain = this.ctx.createGain();\n    const sparksFilter = this.ctx.createBiquadFilter();\n\n    sparksFilter.type = 'highpass';\n    sparksFilter.frequency.value = 3000;\n\n    sparksGain.gain.setValueAtTime(0.2, now);\n    sparksGain.gain.exponentialRampToValueAtTime(0.01, now + 0.15);\n\n    sparks.connect(sparksFilter);\n    sparksFilter.connect(sparksGain);\n    sparksGain.connect(this.sfxGain);\n  }\n\n  /** Глитч эффект */\n  private playGlitch(): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    const now = this.ctx.currentTime;\n\n    // Случайные частоты и длительности\n    for (let i = 0; i < 5; i++) {\n      const delay = i * 0.03 + Math.random() * 0.02;\n      const osc = this.ctx.createOscillator();\n      const gain = this.ctx.createGain();\n      const filter = this.ctx.createBiquadFilter();\n\n      osc.type = Math.random() > 0.5 ? 'square' : 'sawtooth';\n      osc.frequency.value = 100 + Math.random() * 2000;\n\n      filter.type = 'bandpass';\n      filter.frequency.value = 500 + Math.random() * 3000;\n      filter.Q.value = 5 + Math.random() * 10;\n\n      gain.gain.setValueAtTime(0.15, now + delay);\n      gain.gain.setValueAtTime(0, now + delay + 0.02 + Math.random() * 0.03);\n\n      osc.connect(filter);\n      filter.connect(gain);\n      gain.connect(this.sfxGain);\n      gain.connect(this.reverb!);\n\n      osc.start(now + delay);\n      osc.stop(now + delay + 0.1);\n    }\n  }\n\n  /** Шаг с басовым ударом */\n  private playFootstep(): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    const now = this.ctx.currentTime;\n\n    // Низкий удар\n    const kick = this.ctx.createOscillator();\n    const kickGain = this.ctx.createGain();\n\n    kick.type = 'sine';\n    kick.frequency.setValueAtTime(80, now);\n    kick.frequency.exponentialRampToValueAtTime(30, now + 0.08);\n\n    kickGain.gain.setValueAtTime(0.2, now);\n    kickGain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);\n\n    kick.connect(kickGain);\n    kickGain.connect(this.sfxGain);\n\n    kick.start(now);\n    kick.stop(now + 0.12);\n\n    // Шум поверхности\n    const noise = this.createNoise(0.06);\n    const noiseGain = this.ctx.createGain();\n    const noiseFilter = this.ctx.createBiquadFilter();\n\n    noiseFilter.type = 'lowpass';\n    noiseFilter.frequency.value = 300 + Math.random() * 200;\n\n    noiseGain.gain.setValueAtTime(0.1, now);\n    noiseGain.gain.exponentialRampToValueAtTime(0.01, now + 0.05);\n\n    noise.connect(noiseFilter);\n    noiseFilter.connect(noiseGain);\n    noiseGain.connect(this.sfxGain);\n  }\n\n  /** Прыжок - восходящий синт */\n  private playJump(): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    const now = this.ctx.currentTime;\n\n    const osc = this.ctx.createOscillator();\n    const osc2 = this.ctx.createOscillator();\n    const gain = this.ctx.createGain();\n\n    osc.type = 'square';\n    osc.frequency.setValueAtTime(150, now);\n    osc.frequency.exponentialRampToValueAtTime(600, now + 0.1);\n\n    osc2.type = 'sawtooth';\n    osc2.frequency.setValueAtTime(155, now);\n    osc2.frequency.exponentialRampToValueAtTime(605, now + 0.1);\n\n    gain.gain.setValueAtTime(0.15, now);\n    gain.gain.exponentialRampToValueAtTime(0.01, now + 0.15);\n\n    osc.connect(gain);\n    osc2.connect(gain);\n    gain.connect(this.sfxGain);\n    gain.connect(this.reverb!);\n\n    osc.start(now);\n    osc.stop(now + 0.15);\n    osc2.start(now);\n    osc2.stop(now + 0.15);\n  }\n\n  /** Приземление - удар + реверб */\n  private playLand(): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    const now = this.ctx.currentTime;\n\n    // Тяжёлый удар\n    const kick = this.ctx.createOscillator();\n    const kickGain = this.ctx.createGain();\n\n    kick.type = 'sine';\n    kick.frequency.setValueAtTime(100, now);\n    kick.frequency.exponentialRampToValueAtTime(20, now + 0.15);\n\n    kickGain.gain.setValueAtTime(0.5, now);\n    kickGain.gain.exponentialRampToValueAtTime(0.01, now + 0.2);\n\n    kick.connect(kickGain);\n    kickGain.connect(this.sfxGain);\n    kickGain.connect(this.reverb!);\n\n    kick.start(now);\n    kick.stop(now + 0.25);\n\n    // Шум удара\n    const noise = this.createNoise(0.15);\n    const noiseGain = this.ctx.createGain();\n    const noiseFilter = this.ctx.createBiquadFilter();\n\n    noiseFilter.type = 'lowpass';\n    noiseFilter.frequency.value = 400;\n\n    noiseGain.gain.setValueAtTime(0.3, now);\n    noiseGain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);\n\n    noise.connect(noiseFilter);\n    noiseFilter.connect(noiseGain);\n    noiseGain.connect(this.sfxGain);\n  }\n\n  /** Убийство врага - ЭПИЧНЫЙ взрыв! */\n  private playKill(): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    const now = this.ctx.currentTime;\n\n    // Мощный басовый взрыв\n    const boom = this.ctx.createOscillator();\n    const boomGain = this.ctx.createGain();\n\n    boom.type = 'sine';\n    boom.frequency.setValueAtTime(150, now);\n    boom.frequency.exponentialRampToValueAtTime(20, now + 0.4);\n\n    boomGain.gain.setValueAtTime(0.6, now);\n    boomGain.gain.exponentialRampToValueAtTime(0.01, now + 0.5);\n\n    boom.connect(boomGain);\n    boomGain.connect(this.sfxGain);\n    boomGain.connect(this.reverb!);\n\n    boom.start(now);\n    boom.stop(now + 0.6);\n\n    // Восходящий синт (сатисфакция)\n    const synth = this.ctx.createOscillator();\n    const synth2 = this.ctx.createOscillator();\n    const synthGain = this.ctx.createGain();\n    const synthFilter = this.ctx.createBiquadFilter();\n\n    synth.type = 'sawtooth';\n    synth.frequency.setValueAtTime(200, now);\n    synth.frequency.exponentialRampToValueAtTime(800, now + 0.2);\n\n    synth2.type = 'square';\n    synth2.frequency.setValueAtTime(203, now);\n    synth2.frequency.exponentialRampToValueAtTime(806, now + 0.2);\n\n    synthFilter.type = 'lowpass';\n    synthFilter.frequency.setValueAtTime(500, now);\n    synthFilter.frequency.exponentialRampToValueAtTime(4000, now + 0.15);\n    synthFilter.Q.value = 3;\n\n    synthGain.gain.setValueAtTime(0.25, now);\n    synthGain.gain.exponentialRampToValueAtTime(0.01, now + 0.3);\n\n    synth.connect(synthFilter);\n    synth2.connect(synthFilter);\n    synthFilter.connect(synthGain);\n    synthGain.connect(this.sfxGain);\n    synthGain.connect(this.reverb!);\n\n    synth.start(now);\n    synth.stop(now + 0.35);\n    synth2.start(now);\n    synth2.stop(now + 0.35);\n\n    // Глитч-хвост\n    for (let i = 0; i < 4; i++) {\n      const delay = 0.1 + i * 0.05;\n      const glitch = this.ctx.createOscillator();\n      const glitchGain = this.ctx.createGain();\n\n      glitch.type = 'square';\n      glitch.frequency.value = 400 + Math.random() * 1000;\n\n      glitchGain.gain.setValueAtTime(0.1, now + delay);\n      glitchGain.gain.exponentialRampToValueAtTime(0.01, now + delay + 0.03);\n\n      glitch.connect(glitchGain);\n      glitchGain.connect(this.distortion!);\n\n      glitch.start(now + delay);\n      glitch.stop(now + delay + 0.05);\n    }\n\n    // Шум взрыва\n    const noise = this.createNoise(0.3);\n    const noiseGain = this.ctx.createGain();\n    const noiseFilter = this.ctx.createBiquadFilter();\n\n    noiseFilter.type = 'bandpass';\n    noiseFilter.frequency.setValueAtTime(2000, now);\n    noiseFilter.frequency.exponentialRampToValueAtTime(200, now + 0.3);\n    noiseFilter.Q.value = 1;\n\n    noiseGain.gain.setValueAtTime(0.3, now);\n    noiseGain.gain.exponentialRampToValueAtTime(0.01, now + 0.25);\n\n    noise.connect(noiseFilter);\n    noiseFilter.connect(noiseGain);\n    noiseGain.connect(this.sfxGain);\n  }\n\n  /** Создать источник шума */\n  private createNoise(duration: number): AudioBufferSourceNode {\n    if (!this.ctx) throw new Error('AudioContext not initialized');\n\n    const bufferSize = this.ctx.sampleRate * duration;\n    const buffer = this.ctx.createBuffer(1, bufferSize, this.ctx.sampleRate);\n    const data = buffer.getChannelData(0);\n\n    for (let i = 0; i < bufferSize; i++) {\n      data[i] = Math.random() * 2 - 1;\n    }\n\n    const source = this.ctx.createBufferSource();\n    source.buffer = buffer;\n    source.start();\n\n    return source;\n  }\n\n  /** Взмах катаной */\n  private playKatanaSwing(): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    const now = this.ctx.currentTime;\n\n    // Свист лезвия\n    const whoosh = this.ctx.createOscillator();\n    const whooshGain = this.ctx.createGain();\n    const whooshFilter = this.ctx.createBiquadFilter();\n\n    whoosh.type = 'sawtooth';\n    whoosh.frequency.setValueAtTime(600, now);\n    whoosh.frequency.exponentialRampToValueAtTime(100, now + 0.12);\n\n    whooshFilter.type = 'bandpass';\n    whooshFilter.frequency.setValueAtTime(800, now);\n    whooshFilter.frequency.exponentialRampToValueAtTime(300, now + 0.12);\n    whooshFilter.Q.value = 4;\n\n    whooshGain.gain.setValueAtTime(0.25, now);\n    whooshGain.gain.exponentialRampToValueAtTime(0.01, now + 0.15);\n\n    whoosh.connect(whooshFilter);\n    whooshFilter.connect(whooshGain);\n    whooshGain.connect(this.sfxGain);\n\n    whoosh.start(now);\n    whoosh.stop(now + 0.2);\n\n    // Лёгкий металлический звон\n    const metal = this.ctx.createOscillator();\n    const metalGain = this.ctx.createGain();\n\n    metal.type = 'sine';\n    metal.frequency.value = 1800;\n\n    metalGain.gain.setValueAtTime(0.08, now + 0.03);\n    metalGain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);\n\n    metal.connect(metalGain);\n    metalGain.connect(this.sfxGain);\n\n    metal.start(now + 0.03);\n    metal.stop(now + 0.15);\n  }\n\n  /** Сплеш-волна энергии - МОЩНАЯ! */\n  private playSplashWave(): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    const now = this.ctx.currentTime;\n\n    // Волна энергии - нарастает и расходится\n    const wave = this.ctx.createOscillator();\n    const waveGain = this.ctx.createGain();\n    const waveFilter = this.ctx.createBiquadFilter();\n\n    wave.type = 'sawtooth';\n    wave.frequency.setValueAtTime(200, now);\n    wave.frequency.exponentialRampToValueAtTime(80, now + 0.4);\n\n    waveFilter.type = 'lowpass';\n    waveFilter.frequency.setValueAtTime(2000, now);\n    waveFilter.frequency.exponentialRampToValueAtTime(400, now + 0.4);\n    waveFilter.Q.value = 10;\n\n    waveGain.gain.setValueAtTime(0.5, now);\n    waveGain.gain.exponentialRampToValueAtTime(0.01, now + 0.5);\n\n    wave.connect(waveFilter);\n    waveFilter.connect(waveGain);\n    waveGain.connect(this.sfxGain);\n    waveGain.connect(this.reverb!);\n\n    wave.start(now);\n    wave.stop(now + 0.5);\n\n    // Электрический треск\n    const noiseSource = this.createNoise(0.3);\n    const noiseGain = this.ctx.createGain();\n    const noiseFilter = this.ctx.createBiquadFilter();\n\n    noiseFilter.type = 'bandpass';\n    noiseFilter.frequency.value = 3000;\n    noiseFilter.Q.value = 5;\n\n    noiseGain.gain.setValueAtTime(0.2, now);\n    noiseGain.gain.exponentialRampToValueAtTime(0.01, now + 0.25);\n\n    noiseSource.connect(noiseFilter);\n    noiseFilter.connect(noiseGain);\n    noiseGain.connect(this.sfxGain);\n\n    // Высокий тон резонанса\n    const resonance = this.ctx.createOscillator();\n    const resonanceGain = this.ctx.createGain();\n\n    resonance.type = 'sine';\n    resonance.frequency.setValueAtTime(800, now);\n    resonance.frequency.exponentialRampToValueAtTime(400, now + 0.3);\n\n    resonanceGain.gain.setValueAtTime(0.15, now);\n    resonanceGain.gain.exponentialRampToValueAtTime(0.01, now + 0.35);\n\n    resonance.connect(resonanceGain);\n    resonanceGain.connect(this.sfxGain);\n\n    resonance.start(now);\n    resonance.stop(now + 0.4);\n\n    // Суб-бас удар\n    const subBass = this.ctx.createOscillator();\n    const subGain = this.ctx.createGain();\n\n    subBass.type = 'sine';\n    subBass.frequency.setValueAtTime(60, now);\n    subBass.frequency.exponentialRampToValueAtTime(30, now + 0.3);\n\n    subGain.gain.setValueAtTime(0.6, now);\n    subGain.gain.exponentialRampToValueAtTime(0.01, now + 0.4);\n\n    subBass.connect(subGain);\n    subGain.connect(this.sfxGain);\n\n    subBass.start(now);\n    subBass.stop(now + 0.45);\n  }\n\n  /** Подбор заряда катаны - электрический эффект */\n  private playChargePickup(): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    const now = this.ctx.currentTime;\n\n    // Нарастающий электрический звук\n    const charge = this.ctx.createOscillator();\n    const charge2 = this.ctx.createOscillator();\n    const chargeGain = this.ctx.createGain();\n    const chargeFilter = this.ctx.createBiquadFilter();\n\n    charge.type = 'sawtooth';\n    charge.frequency.setValueAtTime(150, now);\n    charge.frequency.exponentialRampToValueAtTime(800, now + 0.3);\n\n    charge2.type = 'square';\n    charge2.frequency.setValueAtTime(152, now);\n    charge2.frequency.exponentialRampToValueAtTime(810, now + 0.3);\n\n    chargeFilter.type = 'bandpass';\n    chargeFilter.frequency.setValueAtTime(500, now);\n    chargeFilter.frequency.exponentialRampToValueAtTime(2000, now + 0.3);\n    chargeFilter.Q.value = 8;\n\n    chargeGain.gain.setValueAtTime(0.15, now);\n    chargeGain.gain.linearRampToValueAtTime(0.35, now + 0.2);\n    chargeGain.gain.exponentialRampToValueAtTime(0.01, now + 0.5);\n\n    charge.connect(chargeFilter);\n    charge2.connect(chargeFilter);\n    chargeFilter.connect(chargeGain);\n    chargeGain.connect(this.sfxGain);\n    chargeGain.connect(this.reverb!);\n\n    charge.start(now);\n    charge.stop(now + 0.5);\n    charge2.start(now);\n    charge2.stop(now + 0.5);\n\n    // Высокий блеск энергии\n    const shimmer = this.ctx.createOscillator();\n    const shimmerGain = this.ctx.createGain();\n\n    shimmer.type = 'sine';\n    shimmer.frequency.value = 2500;\n\n    shimmerGain.gain.setValueAtTime(0.12, now + 0.15);\n    shimmerGain.gain.exponentialRampToValueAtTime(0.01, now + 0.5);\n\n    shimmer.connect(shimmerGain);\n    shimmerGain.connect(this.reverb!);\n\n    shimmer.start(now + 0.15);\n    shimmer.stop(now + 0.55);\n\n    // Электрический треск\n    const noiseSource2 = this.createNoise(0.2);\n    const noiseGain2 = this.ctx.createGain();\n    const noiseFilter2 = this.ctx.createBiquadFilter();\n\n    noiseFilter2.type = 'highpass';\n    noiseFilter2.frequency.value = 4000;\n\n    noiseGain2.gain.setValueAtTime(0.1, now + 0.1);\n    noiseGain2.gain.exponentialRampToValueAtTime(0.01, now + 0.3);\n\n    noiseSource2.connect(noiseFilter2);\n    noiseFilter2.connect(noiseGain2);\n    noiseGain2.connect(this.sfxGain);\n  }\n\n  // ==================== SYNTHWAVE МУЗЫКА ====================\n\n  private arpInterval: number | null = null;\n\n  /** Текущий режим музыки */\n  private currentMusicMode: 'normal' | 'low_hp' | 'boss_green' | 'boss_black' | 'boss_blue' = 'normal';\n  \n  /** Интервалы музыки для остановки */\n  private musicIntervals: number[] = [];\n\n  /** Флаг тревожного режима */\n  private isLowHpMode = false;\n\n  /** Текущая эпоха (1-3) */\n  private currentEra = 1;\n\n  /** Установить эпоху музыки */\n  public setEra(wave: number): void {\n    let newEra = 1;\n    if (wave > 10) newEra = 3;\n    else if (wave > 5) newEra = 2;\n\n    if (newEra !== this.currentEra && this.currentMusicMode === 'normal') {\n      this.currentEra = newEra;\n      // Перезапускаем музыку для новой эпохи\n      for (const interval of this.musicIntervals) {\n        clearInterval(interval);\n        clearTimeout(interval);\n      }\n      this.musicIntervals = [];\n      this.startSynthwaveMusic();\n    } else {\n      this.currentEra = newEra;\n    }\n  }\n\n  /** Запустить synthwave музыку */\n  private startSynthwaveMusic(): void {\n    if (!this.ctx || !this.musicGain) return;\n\n    switch (this.currentEra) {\n      case 1:\n        this.playEra1Music(); // Кислотная\n        break;\n      case 2:\n        this.playEra2Music(); // Чёрная дыра\n        break;\n      case 3:\n        this.playEra3Music(); // Космическая\n        break;\n    }\n  }\n\n  /** ЭПОХА 1: Кислотная (волны 1-5) */\n  private playEra1Music(): void {\n    if (!this.ctx || !this.musicGain) return;\n\n    // Агрессивный acid бас\n    const bassNotes = [55, 55, 73.4, 55, 82.4, 55, 73.4, 65.4];\n    let noteIndex = 0;\n\n    const playBass = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'normal' || this.currentEra !== 1) return;\n\n      const now = this.ctx.currentTime;\n      const osc = this.ctx.createOscillator();\n      const filter = this.ctx.createBiquadFilter();\n      const gain = this.ctx.createGain();\n\n      osc.type = 'sawtooth';\n      osc.frequency.value = bassNotes[noteIndex];\n\n      filter.type = 'lowpass';\n      filter.frequency.setValueAtTime(300, now);\n      filter.frequency.exponentialRampToValueAtTime(800, now + 0.05);\n      filter.frequency.exponentialRampToValueAtTime(200, now + 0.2);\n      filter.Q.value = 10;\n\n      gain.gain.setValueAtTime(0.15, now);\n      gain.gain.exponentialRampToValueAtTime(0.01, now + 0.25);\n\n      osc.connect(filter);\n      filter.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 0.3);\n\n      noteIndex = (noteIndex + 1) % bassNotes.length;\n    };\n\n    this.musicIntervals.push(setInterval(playBass, 250) as unknown as number);\n\n    // Кислотное арпеджио\n    const arpNotes = [220, 277, 330, 440, 330, 277];\n    let arpIndex = 0;\n\n    const playArp = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'normal' || this.currentEra !== 1) return;\n\n      const now = this.ctx.currentTime;\n      const osc = this.ctx.createOscillator();\n      const gain = this.ctx.createGain();\n\n      osc.type = 'square';\n      osc.frequency.value = arpNotes[arpIndex];\n\n      gain.gain.setValueAtTime(0.06, now);\n      gain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);\n\n      osc.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 0.12);\n\n      arpIndex = (arpIndex + 1) % arpNotes.length;\n    };\n\n    this.musicIntervals.push(setInterval(playArp, 125) as unknown as number);\n\n    // Кик\n    const playKick = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'normal' || this.currentEra !== 1) return;\n\n      const now = this.ctx.currentTime;\n      const osc = this.ctx.createOscillator();\n      const gain = this.ctx.createGain();\n\n      osc.type = 'sine';\n      osc.frequency.setValueAtTime(150, now);\n      osc.frequency.exponentialRampToValueAtTime(40, now + 0.1);\n\n      gain.gain.setValueAtTime(0.25, now);\n      gain.gain.exponentialRampToValueAtTime(0.01, now + 0.15);\n\n      osc.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 0.15);\n    };\n\n    this.musicIntervals.push(setInterval(playKick, 500) as unknown as number);\n  }\n\n  /** ЭПОХА 2: Чёрная дыра (волны 6-10) */\n  private playEra2Music(): void {\n    if (!this.ctx || !this.musicGain) return;\n\n    // Глубокий мрачный дрон\n    const playDrone = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'normal' || this.currentEra !== 2) return;\n\n      const now = this.ctx.currentTime;\n      const osc = this.ctx.createOscillator();\n      const osc2 = this.ctx.createOscillator();\n      const lfo = this.ctx.createOscillator();\n      const lfoGain = this.ctx.createGain();\n      const gain = this.ctx.createGain();\n      const filter = this.ctx.createBiquadFilter();\n\n      osc.type = 'sawtooth';\n      osc.frequency.value = 41; // E1 - очень низкий\n\n      osc2.type = 'triangle';\n      osc2.frequency.value = 41.2; // Биения\n\n      lfo.type = 'sine';\n      lfo.frequency.value = 0.1;\n      lfoGain.gain.value = 20;\n\n      lfo.connect(lfoGain);\n      lfoGain.connect(osc.frequency);\n\n      filter.type = 'lowpass';\n      filter.frequency.value = 150;\n\n      gain.gain.setValueAtTime(0.12, now);\n      gain.gain.linearRampToValueAtTime(0.08, now + 3);\n      gain.gain.exponentialRampToValueAtTime(0.01, now + 4);\n\n      osc.connect(filter);\n      osc2.connect(filter);\n      filter.connect(gain);\n      gain.connect(this.musicGain!);\n\n      lfo.start(now);\n      osc.start(now);\n      osc2.start(now);\n      lfo.stop(now + 4);\n      osc.stop(now + 4);\n      osc2.stop(now + 4);\n    };\n\n    playDrone();\n    this.musicIntervals.push(setInterval(playDrone, 4000) as unknown as number);\n\n    // Медленный тяжёлый бит\n    let beat = 0;\n    const playBeat = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'normal' || this.currentEra !== 2) return;\n\n      const now = this.ctx.currentTime;\n\n      if (beat % 2 === 0) {\n        // Глухой удар\n        const osc = this.ctx.createOscillator();\n        const gain = this.ctx.createGain();\n\n        osc.type = 'sine';\n        osc.frequency.setValueAtTime(80, now);\n        osc.frequency.exponentialRampToValueAtTime(20, now + 0.3);\n\n        gain.gain.setValueAtTime(0.3, now);\n        gain.gain.exponentialRampToValueAtTime(0.01, now + 0.4);\n\n        osc.connect(gain);\n        gain.connect(this.musicGain!);\n\n        osc.start(now);\n        osc.stop(now + 0.4);\n      }\n\n      beat++;\n    };\n\n    this.musicIntervals.push(setInterval(playBeat, 600) as unknown as number);\n\n    // Жуткие высокие тона\n    const playEerie = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'normal' || this.currentEra !== 2) return;\n\n      const now = this.ctx.currentTime;\n      const freq = 600 + Math.random() * 400;\n\n      const osc = this.ctx.createOscillator();\n      const gain = this.ctx.createGain();\n\n      osc.type = 'sine';\n      osc.frequency.setValueAtTime(freq, now);\n      osc.frequency.linearRampToValueAtTime(freq * 0.7, now + 2);\n\n      gain.gain.setValueAtTime(0, now);\n      gain.gain.linearRampToValueAtTime(0.04, now + 0.5);\n      gain.gain.linearRampToValueAtTime(0, now + 2);\n\n      osc.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 2);\n    };\n\n    this.musicIntervals.push(setInterval(playEerie, 3000 + Math.random() * 2000) as unknown as number);\n\n    // Гравитационный шум\n    const playGravity = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'normal' || this.currentEra !== 2) return;\n\n      const now = this.ctx.currentTime;\n\n      const bufferSize = this.ctx.sampleRate * 0.5;\n      const buffer = this.ctx.createBuffer(1, bufferSize, this.ctx.sampleRate);\n      const data = buffer.getChannelData(0);\n      \n      for (let i = 0; i < bufferSize; i++) {\n        data[i] = (Math.random() * 2 - 1) * Math.exp(-i / (bufferSize * 0.5));\n      }\n\n      const noise = this.ctx.createBufferSource();\n      noise.buffer = buffer;\n\n      const filter = this.ctx.createBiquadFilter();\n      filter.type = 'lowpass';\n      filter.frequency.value = 200;\n\n      const gain = this.ctx.createGain();\n      gain.gain.setValueAtTime(0.08, now);\n      gain.gain.exponentialRampToValueAtTime(0.01, now + 0.5);\n\n      noise.connect(filter);\n      filter.connect(gain);\n      gain.connect(this.musicGain!);\n\n      noise.start(now);\n      noise.stop(now + 0.5);\n    };\n\n    this.musicIntervals.push(setInterval(playGravity, 1500) as unknown as number);\n  }\n\n  /** ЭПОХА 3: Космическая технологическая (волны 11-15) */\n  private playEra3Music(): void {\n    if (!this.ctx || !this.musicGain) return;\n\n    // Быстрый синтвейв бас\n    const bassNotes = [110, 110, 146.8, 110, 130.8, 110, 164.8, 146.8];\n    let noteIndex = 0;\n\n    const playBass = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'normal' || this.currentEra !== 3) return;\n\n      const now = this.ctx.currentTime;\n      const osc = this.ctx.createOscillator();\n      const filter = this.ctx.createBiquadFilter();\n      const gain = this.ctx.createGain();\n\n      osc.type = 'sawtooth';\n      osc.frequency.value = bassNotes[noteIndex];\n\n      filter.type = 'lowpass';\n      filter.frequency.setValueAtTime(400, now);\n      filter.frequency.exponentialRampToValueAtTime(150, now + 0.15);\n\n      gain.gain.setValueAtTime(0.12, now);\n      gain.gain.exponentialRampToValueAtTime(0.01, now + 0.2);\n\n      osc.connect(filter);\n      filter.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 0.22);\n\n      noteIndex = (noteIndex + 1) % bassNotes.length;\n    };\n\n    this.musicIntervals.push(setInterval(playBass, 200) as unknown as number);\n\n    // Космическое арпеджио (высокое)\n    const arpNotes = [880, 1046, 1318, 1760, 1318, 1046, 880, 659];\n    let arpIndex = 0;\n\n    const playArp = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'normal' || this.currentEra !== 3) return;\n\n      const now = this.ctx.currentTime;\n      const osc = this.ctx.createOscillator();\n      const gain = this.ctx.createGain();\n      const delay = this.ctx.createDelay();\n      const delayGain = this.ctx.createGain();\n\n      osc.type = 'triangle';\n      osc.frequency.value = arpNotes[arpIndex];\n\n      delay.delayTime.value = 0.15;\n      delayGain.gain.value = 0.3;\n\n      gain.gain.setValueAtTime(0.05, now);\n      gain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);\n\n      osc.connect(gain);\n      osc.connect(delay);\n      delay.connect(delayGain);\n      delayGain.connect(this.musicGain!);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 0.12);\n\n      arpIndex = (arpIndex + 1) % arpNotes.length;\n    };\n\n    this.musicIntervals.push(setInterval(playArp, 100) as unknown as number);\n\n    // Техно кик\n    const playKick = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'normal' || this.currentEra !== 3) return;\n\n      const now = this.ctx.currentTime;\n      const osc = this.ctx.createOscillator();\n      const gain = this.ctx.createGain();\n\n      osc.type = 'sine';\n      osc.frequency.setValueAtTime(200, now);\n      osc.frequency.exponentialRampToValueAtTime(50, now + 0.08);\n\n      gain.gain.setValueAtTime(0.2, now);\n      gain.gain.exponentialRampToValueAtTime(0.01, now + 0.12);\n\n      osc.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 0.12);\n    };\n\n    this.musicIntervals.push(setInterval(playKick, 400) as unknown as number);\n\n    // Космический пэд\n    const playPad = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'normal' || this.currentEra !== 3) return;\n\n      const now = this.ctx.currentTime;\n      const chord = [220, 277, 330, 440]; // Am7\n\n      for (const freq of chord) {\n        const osc = this.ctx.createOscillator();\n        const gain = this.ctx.createGain();\n\n        osc.type = 'sine';\n        osc.frequency.value = freq;\n\n        gain.gain.setValueAtTime(0, now);\n        gain.gain.linearRampToValueAtTime(0.03, now + 0.5);\n        gain.gain.linearRampToValueAtTime(0.02, now + 2);\n        gain.gain.linearRampToValueAtTime(0, now + 3);\n\n        osc.connect(gain);\n        gain.connect(this.musicGain!);\n\n        osc.start(now);\n        osc.stop(now + 3.5);\n      }\n    };\n\n    playPad();\n    this.musicIntervals.push(setInterval(playPad, 4000) as unknown as number);\n\n    // Электрические разряды\n    const playZap = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'normal' || this.currentEra !== 3) return;\n\n      const now = this.ctx.currentTime;\n\n      const osc = this.ctx.createOscillator();\n      const gain = this.ctx.createGain();\n\n      osc.type = 'sawtooth';\n      osc.frequency.setValueAtTime(1500 + Math.random() * 1000, now);\n      osc.frequency.exponentialRampToValueAtTime(100, now + 0.1);\n\n      gain.gain.setValueAtTime(0.06, now);\n      gain.gain.exponentialRampToValueAtTime(0.001, now + 0.1);\n\n      osc.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 0.1);\n    };\n\n    this.musicIntervals.push(setInterval(playZap, 800 + Math.random() * 600) as unknown as number);\n  }\n\n  /** Включить/выключить режим низкого HP */\n  public setLowHpMode(enabled: boolean): void {\n    if (!this.ctx || !this.musicGain) return;\n    \n    // Не переключаем если сейчас босс\n    if (this.currentMusicMode !== 'normal' && this.currentMusicMode !== 'low_hp') return;\n    \n    if (enabled && !this.isLowHpMode) {\n      // Включаем тревожный режим\n      this.isLowHpMode = true;\n      this.currentMusicMode = 'low_hp';\n      \n      // Останавливаем обычную музыку\n      for (const interval of this.musicIntervals) {\n        clearInterval(interval);\n        clearTimeout(interval);\n      }\n      this.musicIntervals = [];\n      \n      this.playLowHpMusic();\n      \n    } else if (!enabled && this.isLowHpMode) {\n      // Выключаем тревожный режим\n      this.isLowHpMode = false;\n      this.currentMusicMode = 'normal';\n      \n      // Останавливаем тревожную музыку\n      for (const interval of this.musicIntervals) {\n        clearInterval(interval);\n        clearTimeout(interval);\n      }\n      this.musicIntervals = [];\n      \n      this.startSynthwaveMusic();\n    }\n  }\n\n  /** Тревожная музыка при низком HP */\n  private playLowHpMusic(): void {\n    if (!this.ctx || !this.musicGain) return;\n\n    // === ТРЕВОЖНЫЙ ПУЛЬС ===\n    const playHeartbeat = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'low_hp') return;\n\n      const now = this.ctx.currentTime;\n\n      // Двойной удар сердца\n      for (let i = 0; i < 2; i++) {\n        const osc = this.ctx.createOscillator();\n        const gain = this.ctx.createGain();\n\n        osc.type = 'sine';\n        osc.frequency.value = 40;\n\n        const offset = i * 0.15;\n        gain.gain.setValueAtTime(0, now + offset);\n        gain.gain.linearRampToValueAtTime(0.3, now + offset + 0.05);\n        gain.gain.exponentialRampToValueAtTime(0.01, now + offset + 0.2);\n\n        osc.connect(gain);\n        gain.connect(this.musicGain!);\n\n        osc.start(now + offset);\n        osc.stop(now + offset + 0.25);\n      }\n    };\n\n    this.musicIntervals.push(setInterval(playHeartbeat, 800) as unknown as number);\n\n    // === ТРЕВОЖНЫЙ ДРОН ===\n    const playDrone = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'low_hp') return;\n\n      const now = this.ctx.currentTime;\n\n      const osc = this.ctx.createOscillator();\n      const osc2 = this.ctx.createOscillator();\n      const gain = this.ctx.createGain();\n      const filter = this.ctx.createBiquadFilter();\n\n      // Низкий тревожный тон\n      osc.type = 'sawtooth';\n      osc.frequency.value = 55;\n\n      osc2.type = 'sawtooth';\n      osc2.frequency.value = 55.5; // Биения для тревожности\n\n      filter.type = 'lowpass';\n      filter.frequency.value = 200;\n      filter.Q.value = 5;\n\n      gain.gain.setValueAtTime(0.1, now);\n      gain.gain.linearRampToValueAtTime(0.15, now + 1);\n      gain.gain.linearRampToValueAtTime(0.05, now + 2);\n\n      osc.connect(filter);\n      osc2.connect(filter);\n      filter.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 2.5);\n      osc2.start(now);\n      osc2.stop(now + 2.5);\n    };\n\n    playDrone();\n    this.musicIntervals.push(setInterval(playDrone, 2500) as unknown as number);\n\n    // === ИСКРЫ ===\n    const playSpark = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'low_hp') return;\n\n      const now = this.ctx.currentTime;\n\n      // Случайные искры\n      const sparkCount = 1 + Math.floor(Math.random() * 3);\n      for (let i = 0; i < sparkCount; i++) {\n        const bufferSize = Math.floor(this.ctx.sampleRate * (0.02 + Math.random() * 0.03));\n        const buffer = this.ctx.createBuffer(1, bufferSize, this.ctx.sampleRate);\n        const data = buffer.getChannelData(0);\n        \n        for (let j = 0; j < bufferSize; j++) {\n          data[j] = (Math.random() * 2 - 1) * Math.exp(-j / (bufferSize * 0.3));\n        }\n\n        const noise = this.ctx.createBufferSource();\n        noise.buffer = buffer;\n\n        const filter = this.ctx.createBiquadFilter();\n        filter.type = 'highpass';\n        filter.frequency.value = 3000 + Math.random() * 5000;\n\n        const gain = this.ctx.createGain();\n        gain.gain.setValueAtTime(0.05 + Math.random() * 0.05, now + i * 0.05);\n        gain.gain.exponentialRampToValueAtTime(0.001, now + i * 0.05 + 0.05);\n\n        noise.connect(filter);\n        filter.connect(gain);\n        gain.connect(this.musicGain!);\n\n        noise.start(now + i * 0.05);\n        noise.stop(now + i * 0.05 + 0.05);\n      }\n    };\n\n    this.musicIntervals.push(setInterval(playSpark, 500 + Math.random() * 500) as unknown as number);\n\n    // === ТРЕВОЖНЫЕ НОТЫ ===\n    const playWarning = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'low_hp') return;\n\n      const now = this.ctx.currentTime;\n\n      const osc = this.ctx.createOscillator();\n      const gain = this.ctx.createGain();\n\n      osc.type = 'square';\n      // Тревожная секунда (минорный интервал)\n      const notes = [220, 233.1]; // A3, Bb3\n      const note = notes[Math.floor(Math.random() * notes.length)];\n      osc.frequency.value = note;\n\n      gain.gain.setValueAtTime(0, now);\n      gain.gain.linearRampToValueAtTime(0.08, now + 0.1);\n      gain.gain.linearRampToValueAtTime(0.06, now + 0.3);\n      gain.gain.exponentialRampToValueAtTime(0.01, now + 0.5);\n\n      osc.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 0.5);\n    };\n\n    this.musicIntervals.push(setInterval(playWarning, 1500 + Math.random() * 1000) as unknown as number);\n\n    // === СТАТИЧЕСКИЕ ПОМЕХИ ===\n    const playStatic = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'low_hp') return;\n\n      const now = this.ctx.currentTime;\n\n      const bufferSize = this.ctx.sampleRate * 0.1;\n      const buffer = this.ctx.createBuffer(1, bufferSize, this.ctx.sampleRate);\n      const data = buffer.getChannelData(0);\n      \n      for (let i = 0; i < bufferSize; i++) {\n        // Прерывистый шум\n        data[i] = Math.random() > 0.7 ? (Math.random() * 2 - 1) * 0.5 : 0;\n      }\n\n      const noise = this.ctx.createBufferSource();\n      noise.buffer = buffer;\n\n      const filter = this.ctx.createBiquadFilter();\n      filter.type = 'bandpass';\n      filter.frequency.value = 2000;\n      filter.Q.value = 3;\n\n      const gain = this.ctx.createGain();\n      gain.gain.setValueAtTime(0.03, now);\n      gain.gain.exponentialRampToValueAtTime(0.001, now + 0.1);\n\n      noise.connect(filter);\n      filter.connect(gain);\n      gain.connect(this.musicGain!);\n\n      noise.start(now);\n      noise.stop(now + 0.1);\n    };\n\n    this.musicIntervals.push(setInterval(playStatic, 300 + Math.random() * 400) as unknown as number);\n  }\n\n  /** Фаза Зелёного Босса */\n  private bossGreenPhase = 1;\n\n  /** Переключить музыку для босса */\n  public setBossMusic(bossType: 'boss_green' | 'boss_black' | 'boss_blue' | null): void {\n    if (!this.ctx || !this.musicGain) return;\n\n    // Останавливаем все текущие интервалы\n    for (const interval of this.musicIntervals) {\n      clearInterval(interval);\n      clearTimeout(interval);\n    }\n    this.musicIntervals = [];\n    this.bossGreenPhase = 1; // Сброс фазы\n\n    if (bossType === null) {\n      // Обычная музыка\n      this.currentMusicMode = 'normal';\n      this.startSynthwaveMusic();\n    } else {\n      this.currentMusicMode = bossType;\n      \n      switch (bossType) {\n        case 'boss_green':\n          this.playBossGreenMusic();\n          break;\n        case 'boss_black':\n          this.playBossBlackMusic();\n          break;\n        case 'boss_blue':\n          this.playBossBlueMusic();\n          break;\n      }\n    }\n  }\n\n  /** Переход в фазу 2 для Зелёного Босса - добавляем БОЧКУ! */\n  public setBossGreenPhase2(): void {\n    if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'boss_green') return;\n    if (this.bossGreenPhase === 2) return; // Уже во второй фазе\n\n    this.bossGreenPhase = 2;\n\n    // === ТЯЖЁЛАЯ БОЧКА (808 стиль) ===\n    const playHeavyKick = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'boss_green') return;\n\n      const now = this.ctx.currentTime;\n\n      // Основной кик\n      const osc = this.ctx.createOscillator();\n      const osc2 = this.ctx.createOscillator();\n      const gain = this.ctx.createGain();\n      const distortion = this.ctx.createWaveShaper();\n\n      osc.type = 'sine';\n      osc.frequency.setValueAtTime(200, now);\n      osc.frequency.exponentialRampToValueAtTime(30, now + 0.15);\n\n      osc2.type = 'sine';\n      osc2.frequency.setValueAtTime(100, now);\n      osc2.frequency.exponentialRampToValueAtTime(20, now + 0.2);\n\n      // Дисторшн для грязи\n      const curve = new Float32Array(256);\n      for (let i = 0; i < 256; i++) {\n        const x = (i / 128) - 1;\n        curve[i] = Math.tanh(x * 5);\n      }\n      distortion.curve = curve;\n\n      gain.gain.setValueAtTime(0.5, now);\n      gain.gain.exponentialRampToValueAtTime(0.01, now + 0.25);\n\n      osc.connect(distortion);\n      osc2.connect(distortion);\n      distortion.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 0.25);\n      osc2.start(now);\n      osc2.stop(now + 0.25);\n    };\n\n    // Тяжёлая бочка на каждую восьмую - агрессивнее!\n    this.musicIntervals.push(setInterval(playHeavyKick, 207) as unknown as number);\n\n    // === СИРЕНА ТРЕВОГИ ===\n    const playAlarm = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'boss_green') return;\n\n      const now = this.ctx.currentTime;\n\n      const osc = this.ctx.createOscillator();\n      const gain = this.ctx.createGain();\n\n      osc.type = 'square';\n      osc.frequency.setValueAtTime(600, now);\n      osc.frequency.linearRampToValueAtTime(800, now + 0.2);\n      osc.frequency.linearRampToValueAtTime(600, now + 0.4);\n\n      gain.gain.setValueAtTime(0.08, now);\n      gain.gain.linearRampToValueAtTime(0.12, now + 0.2);\n      gain.gain.linearRampToValueAtTime(0.0, now + 0.4);\n\n      osc.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 0.4);\n    };\n\n    // Сирена каждые 2 секунды\n    this.musicIntervals.push(setInterval(playAlarm, 2000) as unknown as number);\n  }\n\n  /** Музыка Зелёного Босса - КИСЛОТНОЕ ТЕХНО (Acid Techno) */\n  private playBossGreenMusic(): void {\n    if (!this.ctx || !this.musicGain) return;\n\n    // === TB-303 ACID BASSLINE ===\n    // Классические кислотные ноты\n    const acidNotes = [55, 55, 82.4, 55, 73.4, 55, 98, 73.4]; // A1, A1, E2, A1, D2, A1, G2, D2\n    let noteIndex = 0;\n    let filterMod = 0;\n\n    const playAcidBass = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'boss_green') return;\n\n      const now = this.ctx.currentTime;\n\n      const osc = this.ctx.createOscillator();\n      const filter = this.ctx.createBiquadFilter();\n      const gain = this.ctx.createGain();\n      const distortion = this.ctx.createWaveShaper();\n\n      // Классический 303 sawtooth\n      osc.type = 'sawtooth';\n      osc.frequency.value = acidNotes[noteIndex];\n\n      // КИСЛОТНЫЙ ФИЛЬТР - высокий резонанс!\n      filter.type = 'lowpass';\n      filter.Q.value = 15; // Высокий резонанс для \"квакающего\" звука\n      \n      // Модуляция фильтра - главная фишка acid\n      const filterBase = 200 + Math.sin(filterMod) * 150;\n      filter.frequency.setValueAtTime(filterBase, now);\n      filter.frequency.exponentialRampToValueAtTime(800 + Math.random() * 600, now + 0.05);\n      filter.frequency.exponentialRampToValueAtTime(filterBase * 0.5, now + 0.15);\n\n      // Дисторшн для грязи\n      const curve = new Float32Array(256);\n      for (let i = 0; i < 256; i++) {\n        const x = (i / 128) - 1;\n        curve[i] = Math.tanh(x * 4);\n      }\n      distortion.curve = curve;\n\n      gain.gain.setValueAtTime(0.2, now);\n      gain.gain.linearRampToValueAtTime(0.15, now + 0.05);\n      gain.gain.exponentialRampToValueAtTime(0.01, now + 0.15);\n\n      osc.connect(filter);\n      filter.connect(distortion);\n      distortion.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 0.2);\n\n      noteIndex = (noteIndex + 1) % acidNotes.length;\n      filterMod += 0.3;\n    };\n\n    // 145 BPM - быстрый acid темп\n    this.musicIntervals.push(setInterval(playAcidBass, 103) as unknown as number);\n\n    // === ТЕХНО КИК ===\n    const playKick = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'boss_green') return;\n\n      const now = this.ctx.currentTime;\n\n      const osc = this.ctx.createOscillator();\n      const gain = this.ctx.createGain();\n\n      osc.type = 'sine';\n      osc.frequency.setValueAtTime(150, now);\n      osc.frequency.exponentialRampToValueAtTime(40, now + 0.1);\n\n      gain.gain.setValueAtTime(0.4, now);\n      gain.gain.exponentialRampToValueAtTime(0.01, now + 0.2);\n\n      osc.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 0.2);\n    };\n\n    // Кик на каждую четверть\n    this.musicIntervals.push(setInterval(playKick, 414) as unknown as number);\n\n    // === ХАЙХЭТ ===\n    const playHihat = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'boss_green') return;\n\n      const now = this.ctx.currentTime;\n\n      const bufferSize = this.ctx.sampleRate * 0.05;\n      const buffer = this.ctx.createBuffer(1, bufferSize, this.ctx.sampleRate);\n      const data = buffer.getChannelData(0);\n      for (let i = 0; i < bufferSize; i++) {\n        data[i] = Math.random() * 2 - 1;\n      }\n\n      const noise = this.ctx.createBufferSource();\n      noise.buffer = buffer;\n\n      const filter = this.ctx.createBiquadFilter();\n      filter.type = 'highpass';\n      filter.frequency.value = 8000;\n\n      const gain = this.ctx.createGain();\n      gain.gain.setValueAtTime(0.08, now);\n      gain.gain.exponentialRampToValueAtTime(0.001, now + 0.05);\n\n      noise.connect(filter);\n      filter.connect(gain);\n      gain.connect(this.musicGain!);\n\n      noise.start(now);\n      noise.stop(now + 0.05);\n    };\n\n    // Хайхэт на каждую восьмую\n    this.musicIntervals.push(setInterval(playHihat, 207) as unknown as number);\n\n    // === КИСЛОТНЫЙ СКРИМ (acid scream) ===\n    const playAcidScream = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'boss_green') return;\n\n      const now = this.ctx.currentTime;\n\n      const osc = this.ctx.createOscillator();\n      const filter = this.ctx.createBiquadFilter();\n      const gain = this.ctx.createGain();\n\n      osc.type = 'sawtooth';\n      osc.frequency.setValueAtTime(200 + Math.random() * 100, now);\n      osc.frequency.exponentialRampToValueAtTime(800 + Math.random() * 400, now + 0.3);\n\n      filter.type = 'bandpass';\n      filter.frequency.setValueAtTime(500, now);\n      filter.frequency.exponentialRampToValueAtTime(3000, now + 0.3);\n      filter.Q.value = 10;\n\n      gain.gain.setValueAtTime(0.1, now);\n      gain.gain.linearRampToValueAtTime(0.15, now + 0.15);\n      gain.gain.exponentialRampToValueAtTime(0.01, now + 0.4);\n\n      osc.connect(filter);\n      filter.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 0.4);\n    };\n\n    // Скрим каждые 2 такта\n    this.musicIntervals.push(setInterval(playAcidScream, 1656) as unknown as number);\n  }\n\n  /** Музыка Чёрного Босса - Deep Techno */\n  private playBossBlackMusic(): void {\n    if (!this.ctx || !this.musicGain) return;\n\n    // === DEEP KICK (126 BPM) ===\n    const playKick = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'boss_black') return;\n\n      const now = this.ctx.currentTime;\n\n      // Основной глубокий кик\n      const osc = this.ctx.createOscillator();\n      const osc2 = this.ctx.createOscillator();\n      const gain = this.ctx.createGain();\n\n      osc.type = 'sine';\n      osc.frequency.setValueAtTime(150, now);\n      osc.frequency.exponentialRampToValueAtTime(35, now + 0.12);\n\n      // Sub-bass слой\n      osc2.type = 'sine';\n      osc2.frequency.setValueAtTime(60, now);\n      osc2.frequency.exponentialRampToValueAtTime(25, now + 0.2);\n\n      gain.gain.setValueAtTime(0.35, now);\n      gain.gain.exponentialRampToValueAtTime(0.01, now + 0.25);\n\n      osc.connect(gain);\n      osc2.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 0.25);\n      osc2.start(now);\n      osc2.stop(now + 0.3);\n    };\n\n    // Кик на каждую четверть (126 BPM = ~476ms)\n    this.musicIntervals.push(setInterval(playKick, 476) as unknown as number);\n\n    // === ГЛУБОКИЙ БАС ===\n    const bassNotes = [36.7, 36.7, 41.2, 36.7, 32.7, 36.7, 41.2, 43.6]; // D1 прогрессия\n    let bassIndex = 0;\n\n    const playBass = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'boss_black') return;\n\n      const now = this.ctx.currentTime;\n\n      const osc = this.ctx.createOscillator();\n      const filter = this.ctx.createBiquadFilter();\n      const gain = this.ctx.createGain();\n\n      osc.type = 'sawtooth';\n      osc.frequency.value = bassNotes[bassIndex];\n\n      filter.type = 'lowpass';\n      filter.frequency.setValueAtTime(200, now);\n      filter.frequency.exponentialRampToValueAtTime(80, now + 0.4);\n      filter.Q.value = 5;\n\n      gain.gain.setValueAtTime(0.12, now);\n      gain.gain.exponentialRampToValueAtTime(0.01, now + 0.45);\n\n      osc.connect(filter);\n      filter.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 0.5);\n\n      bassIndex = (bassIndex + 1) % bassNotes.length;\n    };\n\n    this.musicIntervals.push(setInterval(playBass, 476) as unknown as number);\n\n    // === ХАЙХЭТЫ (закрытые) ===\n    let hihatCounter = 0;\n    const playHihat = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'boss_black') return;\n\n      const now = this.ctx.currentTime;\n\n      // Шум для хайхэта\n      const bufferSize = this.ctx.sampleRate * 0.05;\n      const buffer = this.ctx.createBuffer(1, bufferSize, this.ctx.sampleRate);\n      const data = buffer.getChannelData(0);\n      for (let i = 0; i < bufferSize; i++) {\n        data[i] = Math.random() * 2 - 1;\n      }\n\n      const noise = this.ctx.createBufferSource();\n      noise.buffer = buffer;\n\n      const filter = this.ctx.createBiquadFilter();\n      filter.type = 'highpass';\n      filter.frequency.value = 8000;\n\n      const gain = this.ctx.createGain();\n      // Акцент на offbeat\n      const vol = hihatCounter % 2 === 1 ? 0.08 : 0.04;\n      gain.gain.setValueAtTime(vol, now);\n      gain.gain.exponentialRampToValueAtTime(0.001, now + 0.05);\n\n      noise.connect(filter);\n      filter.connect(gain);\n      gain.connect(this.musicGain!);\n\n      noise.start(now);\n      noise.stop(now + 0.05);\n\n      hihatCounter++;\n    };\n\n    this.musicIntervals.push(setInterval(playHihat, 119) as unknown as number);\n\n    // === ГИПНОТИЧЕСКИЙ ПЭД ===\n    const playPad = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'boss_black') return;\n\n      const now = this.ctx.currentTime;\n      const chord = [73.4, 87.3, 110, 146.8]; // Dm минорный аккорд\n\n      for (const freq of chord) {\n        const osc = this.ctx.createOscillator();\n        const filter = this.ctx.createBiquadFilter();\n        const gain = this.ctx.createGain();\n\n        osc.type = 'triangle';\n        osc.frequency.value = freq;\n\n        filter.type = 'lowpass';\n        filter.frequency.value = 400;\n\n        gain.gain.setValueAtTime(0, now);\n        gain.gain.linearRampToValueAtTime(0.025, now + 1);\n        gain.gain.linearRampToValueAtTime(0.02, now + 3);\n        gain.gain.linearRampToValueAtTime(0, now + 4);\n\n        osc.connect(filter);\n        filter.connect(gain);\n        gain.connect(this.musicGain!);\n\n        osc.start(now);\n        osc.stop(now + 4.5);\n      }\n    };\n\n    playPad();\n    this.musicIntervals.push(setInterval(playPad, 7616) as unknown as number); // 16 тактов\n\n    // === РЕЙВ СТАБ (редкий) ===\n    const playStab = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'boss_black') return;\n      if (Math.random() > 0.3) return; // Только 30% шанс\n\n      const now = this.ctx.currentTime;\n      const notes = [146.8, 174.6, 220]; // D3, F3, A3\n\n      for (const freq of notes) {\n        const osc = this.ctx.createOscillator();\n        const gain = this.ctx.createGain();\n\n        osc.type = 'sawtooth';\n        osc.frequency.value = freq;\n\n        gain.gain.setValueAtTime(0.06, now);\n        gain.gain.exponentialRampToValueAtTime(0.001, now + 0.1);\n\n        osc.connect(gain);\n        gain.connect(this.musicGain!);\n\n        osc.start(now);\n        osc.stop(now + 0.12);\n      }\n    };\n\n    this.musicIntervals.push(setInterval(playStab, 1904) as unknown as number); // Каждые 4 такта\n\n    // === ТЁМНАЯ АТМОСФЕРА ===\n    const playAtmosphere = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'boss_black') return;\n\n      const now = this.ctx.currentTime;\n\n      // Низкий rumble\n      const osc = this.ctx.createOscillator();\n      const lfo = this.ctx.createOscillator();\n      const lfoGain = this.ctx.createGain();\n      const filter = this.ctx.createBiquadFilter();\n      const gain = this.ctx.createGain();\n\n      osc.type = 'sine';\n      osc.frequency.value = 30;\n\n      lfo.type = 'sine';\n      lfo.frequency.value = 0.5;\n      lfoGain.gain.value = 10;\n\n      lfo.connect(lfoGain);\n      lfoGain.connect(osc.frequency);\n\n      filter.type = 'lowpass';\n      filter.frequency.value = 80;\n\n      gain.gain.setValueAtTime(0.1, now);\n      gain.gain.linearRampToValueAtTime(0.05, now + 3);\n      gain.gain.linearRampToValueAtTime(0, now + 4);\n\n      osc.connect(filter);\n      filter.connect(gain);\n      gain.connect(this.musicGain!);\n\n      lfo.start(now);\n      osc.start(now);\n      lfo.stop(now + 4);\n      osc.stop(now + 4);\n    };\n\n    playAtmosphere();\n    this.musicIntervals.push(setInterval(playAtmosphere, 4000) as unknown as number);\n\n    // === КОСМИЧЕСКИЙ ЭФФЕКТ ===\n    const playVoid = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'boss_black') return;\n\n      const now = this.ctx.currentTime;\n\n      const osc = this.ctx.createOscillator();\n      const gain = this.ctx.createGain();\n\n      osc.type = 'sine';\n      osc.frequency.setValueAtTime(300 + Math.random() * 200, now);\n      osc.frequency.exponentialRampToValueAtTime(50, now + 2);\n\n      gain.gain.setValueAtTime(0.03, now);\n      gain.gain.exponentialRampToValueAtTime(0.001, now + 2);\n\n      osc.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 2);\n    };\n\n    this.musicIntervals.push(setInterval(playVoid, 2000 + Math.random() * 1000) as unknown as number);\n  }\n\n  /** Музыка Синего Босса - быстрый электронный бит */\n  private playBossBlueMusic(): void {\n    if (!this.ctx || !this.musicGain) return;\n\n    // Быстрый синтезаторный бас\n    const bassNotes = [110, 110, 146.8, 164.8, 110, 130.8, 146.8, 110]; // Быстрая прогрессия\n    let noteIndex = 0;\n\n    const playBass = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'boss_blue') return;\n\n      const now = this.ctx.currentTime;\n\n      const osc = this.ctx.createOscillator();\n      const gain = this.ctx.createGain();\n      const filter = this.ctx.createBiquadFilter();\n\n      osc.type = 'square';\n      osc.frequency.value = bassNotes[noteIndex];\n\n      filter.type = 'lowpass';\n      filter.frequency.setValueAtTime(800, now);\n      filter.frequency.exponentialRampToValueAtTime(200, now + 0.2);\n\n      gain.gain.setValueAtTime(0.15, now);\n      gain.gain.linearRampToValueAtTime(0, now + 0.2);\n\n      osc.connect(filter);\n      filter.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 0.25);\n\n      noteIndex = (noteIndex + 1) % bassNotes.length;\n    };\n\n    this.musicIntervals.push(setInterval(playBass, 250) as unknown as number);\n\n    // Быстрое арпеджио\n    const arpNotes = [880, 1046, 1318, 1567, 1318, 1046];\n    let arpIndex = 0;\n\n    const playArp = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'boss_blue') return;\n\n      const now = this.ctx.currentTime;\n\n      const osc = this.ctx.createOscillator();\n      const gain = this.ctx.createGain();\n\n      osc.type = 'triangle';\n      osc.frequency.value = arpNotes[arpIndex];\n\n      gain.gain.setValueAtTime(0.08, now);\n      gain.gain.exponentialRampToValueAtTime(0.001, now + 0.1);\n\n      osc.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 0.12);\n\n      arpIndex = (arpIndex + 1) % arpNotes.length;\n    };\n\n    this.musicIntervals.push(setInterval(playArp, 125) as unknown as number);\n\n    // Электрические разряды\n    const playZap = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'boss_blue') return;\n\n      const now = this.ctx.currentTime;\n\n      const osc = this.ctx.createOscillator();\n      const gain = this.ctx.createGain();\n\n      osc.type = 'sawtooth';\n      osc.frequency.setValueAtTime(2000, now);\n      osc.frequency.exponentialRampToValueAtTime(100, now + 0.15);\n\n      gain.gain.setValueAtTime(0.1, now);\n      gain.gain.exponentialRampToValueAtTime(0.001, now + 0.15);\n\n      osc.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 0.15);\n    };\n\n    this.musicIntervals.push(setInterval(playZap, 500 + Math.random() * 300) as unknown as number);\n\n    // Быстрые удары\n    const playKick = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'boss_blue') return;\n\n      const now = this.ctx.currentTime;\n\n      const osc = this.ctx.createOscillator();\n      const gain = this.ctx.createGain();\n\n      osc.type = 'sine';\n      osc.frequency.setValueAtTime(150, now);\n      osc.frequency.exponentialRampToValueAtTime(50, now + 0.1);\n\n      gain.gain.setValueAtTime(0.2, now);\n      gain.gain.exponentialRampToValueAtTime(0.001, now + 0.15);\n\n      osc.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 0.15);\n    };\n\n    this.musicIntervals.push(setInterval(playKick, 500) as unknown as number);\n  }\n\n  /** Бас-линия */\n  private playBassline(): void {\n    if (!this.ctx || !this.musicGain) return;\n\n    const bassNotes = [55, 55, 73.4, 82.4]; // A1, A1, D2, E2\n    let noteIndex = 0;\n\n    const playBassNote = () => {\n      // Останавливаем если переключились на босса\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'normal') return;\n\n      const now = this.ctx.currentTime;\n\n      const osc = this.ctx.createOscillator();\n      const osc2 = this.ctx.createOscillator();\n      const gain = this.ctx.createGain();\n      const filter = this.ctx.createBiquadFilter();\n\n      osc.type = 'sawtooth';\n      osc.frequency.value = bassNotes[noteIndex];\n\n      osc2.type = 'square';\n      osc2.frequency.value = bassNotes[noteIndex] * 1.005; // Детюн\n\n      filter.type = 'lowpass';\n      filter.frequency.setValueAtTime(300, now);\n      filter.frequency.linearRampToValueAtTime(150, now + 0.8);\n\n      gain.gain.setValueAtTime(0.2, now);\n      gain.gain.linearRampToValueAtTime(0.15, now + 0.1);\n      gain.gain.linearRampToValueAtTime(0, now + 0.9);\n\n      osc.connect(filter);\n      osc2.connect(filter);\n      filter.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 1);\n      osc2.start(now);\n      osc2.stop(now + 1);\n\n      noteIndex = (noteIndex + 1) % bassNotes.length;\n\n      setTimeout(playBassNote, 1000);\n    };\n\n    playBassNote();\n  }\n\n  /** Арпеджио */\n  private playArpeggio(): void {\n    if (!this.ctx || !this.musicGain) return;\n\n    // A minor pentatonic: A, C, D, E, G\n    const arpNotes = [440, 523, 587, 659, 784, 659, 587, 523];\n    let noteIndex = 0;\n\n    const playArpNote = () => {\n      // Останавливаем если переключились на босса\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'normal') return;\n\n      const now = this.ctx.currentTime;\n\n      const osc = this.ctx.createOscillator();\n      const gain = this.ctx.createGain();\n      const filter = this.ctx.createBiquadFilter();\n      const delay = this.ctx.createDelay();\n      const delayGain = this.ctx.createGain();\n\n      osc.type = 'square';\n      osc.frequency.value = arpNotes[noteIndex];\n\n      filter.type = 'lowpass';\n      filter.frequency.setValueAtTime(2000, now);\n      filter.frequency.exponentialRampToValueAtTime(500, now + 0.15);\n      filter.Q.value = 5;\n\n      gain.gain.setValueAtTime(0.08, now);\n      gain.gain.exponentialRampToValueAtTime(0.01, now + 0.12);\n\n      // Дилей для глубины\n      delay.delayTime.value = 0.25;\n      delayGain.gain.value = 0.3;\n\n      osc.connect(filter);\n      filter.connect(gain);\n      gain.connect(this.musicGain!);\n      gain.connect(delay);\n      delay.connect(delayGain);\n      delayGain.connect(this.musicGain!);\n      delayGain.connect(this.reverb!);\n\n      osc.start(now);\n      osc.stop(now + 0.15);\n\n      noteIndex = (noteIndex + 1) % arpNotes.length;\n\n      setTimeout(playArpNote, 125); // 16th notes at 120 BPM\n    };\n\n    setTimeout(playArpNote, 2000);\n  }\n\n  /** Атмосферный пэд */\n  private playPad(): void {\n    if (!this.ctx || !this.musicGain) return;\n\n    const padChords = [\n      [220, 261.6, 329.6], // Am\n      [196, 246.9, 293.7], // G\n      [174.6, 220, 261.6], // F\n      [164.8, 196, 246.9], // Em\n    ];\n    let chordIndex = 0;\n\n    const playPadChord = () => {\n      // Останавливаем если переключились на босса\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'normal') return;\n\n      const now = this.ctx.currentTime;\n      const chord = padChords[chordIndex];\n\n      chord.forEach((freq, i) => {\n        const osc = this.ctx!.createOscillator();\n        const osc2 = this.ctx!.createOscillator();\n        const gain = this.ctx!.createGain();\n        const filter = this.ctx!.createBiquadFilter();\n\n        osc.type = 'sawtooth';\n        osc.frequency.value = freq;\n\n        osc2.type = 'triangle';\n        osc2.frequency.value = freq * 1.002;\n\n        filter.type = 'lowpass';\n        filter.frequency.value = 800;\n        filter.Q.value = 1;\n\n        // Медленное нарастание\n        gain.gain.setValueAtTime(0, now);\n        gain.gain.linearRampToValueAtTime(0.03, now + 1);\n        gain.gain.linearRampToValueAtTime(0.03, now + 3);\n        gain.gain.linearRampToValueAtTime(0, now + 4);\n\n        osc.connect(filter);\n        osc2.connect(filter);\n        filter.connect(gain);\n        gain.connect(this.musicGain!);\n        gain.connect(this.reverb!);\n\n        osc.start(now + i * 0.1);\n        osc.stop(now + 4.5);\n        osc2.start(now + i * 0.1);\n        osc2.stop(now + 4.5);\n      });\n\n      chordIndex = (chordIndex + 1) % padChords.length;\n\n      setTimeout(playPadChord, 4000);\n    };\n\n    setTimeout(playPadChord, 500);\n  }\n\n  /** Драм-машина */\n  private playDrums(): void {\n    if (!this.ctx || !this.musicGain) return;\n\n    let beat = 0;\n\n    const playBeat = () => {\n      // Останавливаем если переключились на босса\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'normal') return;\n\n      const now = this.ctx.currentTime;\n\n      // Кик на 1 и 3\n      if (beat % 4 === 0 || beat % 4 === 2) {\n        const kick = this.ctx.createOscillator();\n        const kickGain = this.ctx.createGain();\n\n        kick.type = 'sine';\n        kick.frequency.setValueAtTime(150, now);\n        kick.frequency.exponentialRampToValueAtTime(40, now + 0.1);\n\n        kickGain.gain.setValueAtTime(0.3, now);\n        kickGain.gain.exponentialRampToValueAtTime(0.01, now + 0.15);\n\n        kick.connect(kickGain);\n        kickGain.connect(this.musicGain!);\n\n        kick.start(now);\n        kick.stop(now + 0.2);\n      }\n\n      // Снэйр на 2 и 4\n      if (beat % 4 === 1 || beat % 4 === 3) {\n        const snare = this.createNoise(0.15);\n        const snareGain = this.ctx.createGain();\n        const snareFilter = this.ctx.createBiquadFilter();\n\n        snareFilter.type = 'highpass';\n        snareFilter.frequency.value = 1000;\n\n        snareGain.gain.setValueAtTime(0.15, now);\n        snareGain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);\n\n        snare.connect(snareFilter);\n        snareFilter.connect(snareGain);\n        snareGain.connect(this.musicGain!);\n\n        // Тональная часть снэйра\n        const snareTone = this.ctx.createOscillator();\n        const snareToneGain = this.ctx.createGain();\n\n        snareTone.type = 'triangle';\n        snareTone.frequency.value = 180;\n\n        snareToneGain.gain.setValueAtTime(0.1, now);\n        snareToneGain.gain.exponentialRampToValueAtTime(0.01, now + 0.08);\n\n        snareTone.connect(snareToneGain);\n        snareToneGain.connect(this.musicGain!);\n\n        snareTone.start(now);\n        snareTone.stop(now + 0.1);\n      }\n\n      // Хай-хэт на каждый бит\n      const hihat = this.createNoise(0.03);\n      const hihatGain = this.ctx.createGain();\n      const hihatFilter = this.ctx.createBiquadFilter();\n\n      hihatFilter.type = 'highpass';\n      hihatFilter.frequency.value = 8000;\n\n      hihatGain.gain.setValueAtTime(beat % 2 === 0 ? 0.08 : 0.04, now);\n      hihatGain.gain.exponentialRampToValueAtTime(0.01, now + 0.03);\n\n      hihat.connect(hihatFilter);\n      hihatFilter.connect(hihatGain);\n      hihatGain.connect(this.musicGain!);\n\n      beat = (beat + 1) % 16;\n\n      setTimeout(playBeat, 250); // 120 BPM\n    };\n\n    setTimeout(playBeat, 1000);\n  }\n\n  /** Остановить аудио */\n  public stop(): void {\n    if (this.arpInterval) {\n      clearInterval(this.arpInterval);\n    }\n    if (this.ctx) {\n      this.ctx.close();\n      this.ctx = null;\n    }\n    this.isStarted = false;\n  }\n}\n","/** Вершинный шейдер */\nexport const VERTEX_SHADER = `#version 300 es\nprecision highp float;\n\nin vec2 a_position;\nout vec2 v_uv;\n\nvoid main() {\n  v_uv = a_position * 0.5 + 0.5;\n  gl_Position = vec4(a_position, 0.0, 1.0);\n}\n`;\n\n/** Фрагментный шейдер - Circular Arena with Pools */\nexport const FRAGMENT_SHADER = `#version 300 es\nprecision highp float;\n\nuniform vec2 u_resolution;\nuniform float u_time;\nuniform vec3 u_cameraPos;\nuniform float u_cameraYaw;\nuniform float u_cameraPitch;\nuniform vec4 u_targets[16];\nuniform int u_targetCount;\nuniform float u_muzzleFlash;\nuniform vec4 u_pools[8]; // Токсичные лужи [x, z, radius, lifetime]\nuniform int u_poolCount;\nuniform int u_era; // Эпоха: 1=кислотная, 2=чёрная дыра, 3=космическая\nuniform vec4 u_pickups[8]; // Пикапы [x, y, z, type] type: 9=health, 10=stimpack, 11=charge\nuniform int u_pickupCount;\n\nin vec2 v_uv;\nout vec4 fragColor;\n\n// === ОПТИМИЗИРОВАННЫЕ ПАРАМЕТРЫ ===\n#define MAX_STEPS 20\n#define MAX_DIST 40.0\n#define SURF_DIST 0.03\n#define PI 3.14159265\n\n// === РАЗМЕРЫ АРЕНЫ ===\n#define ARENA_RADIUS 28.0\n#define DOME_HEIGHT 18.0\n#define POOL_RADIUS 8.0\n#define POOL_DEPTH 2.0\n// Малые бассейны удалены для упрощения\n#define PLATFORM_HEIGHT 2.0\n#define PLATFORM_X 20.0\n#define BRIDGE_WIDTH 3.0\n\n// === NOISE ===\nfloat hash(vec2 p) {\n  return fract(sin(dot(p, vec2(127.1, 311.7))) * 43758.5453);\n}\n\nfloat noise(vec2 p) {\n  vec2 i = floor(p);\n  vec2 f = fract(p);\n  f = f * f * (3.0 - 2.0 * f);\n  return mix(\n    mix(hash(i), hash(i + vec2(1, 0)), f.x),\n    mix(hash(i + vec2(0, 1)), hash(i + vec2(1, 1)), f.x),\n    f.y\n  );\n}\n\nfloat waterWaves(vec2 p, float t) {\n  float wave = 0.0;\n  wave += sin(p.x * 0.5 + t * 0.8) * 0.08;\n  wave += sin(p.y * 0.4 + t * 0.6) * 0.06;\n  wave += sin((p.x + p.y) * 0.7 + t) * 0.04;\n  return wave;\n}\n\n// === SDF ПРИМИТИВЫ ===\nfloat sdSphere(vec3 p, float r) {\n  return length(p) - r;\n}\n\nfloat sdBox(vec3 p, vec3 b) {\n  vec3 q = abs(p) - b;\n  return length(max(q, 0.0)) + min(max(q.x, max(q.y, q.z)), 0.0);\n}\n\nfloat sdCylinder(vec3 p, float r, float h) {\n  vec2 d = abs(vec2(length(p.xz), p.y)) - vec2(r, h);\n  return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));\n}\n\nfloat sdTorus(vec3 p, vec2 t) {\n  vec2 q = vec2(length(p.xz) - t.x, p.y);\n  return length(q) - t.y;\n}\n\nfloat sdCappedCone(vec3 p, float h, float r1, float r2) {\n  vec2 q = vec2(length(p.xz), p.y);\n  vec2 k1 = vec2(r2, h);\n  vec2 k2 = vec2(r2 - r1, 2.0 * h);\n  vec2 ca = vec2(q.x - min(q.x, (q.y < 0.0) ? r1 : r2), abs(q.y) - h);\n  vec2 cb = q - k1 + k2 * clamp(dot(k1 - q, k2) / dot(k2, k2), 0.0, 1.0);\n  float s = (cb.x < 0.0 && ca.y < 0.0) ? -1.0 : 1.0;\n  return s * sqrt(min(dot(ca, ca), dot(cb, cb)));\n}\n\n// Плавное объединение\nfloat smin(float a, float b, float k) {\n  float h = clamp(0.5 + 0.5 * (b - a) / k, 0.0, 1.0);\n  return mix(b, a, h) - k * h * (1.0 - h);\n}\n\n// === МАТЕРИАЛ ===\n// 0 = стены/пол, 1 = вода, 2 = растения, 3 = металл, 4 = свечение\nint materialId = 0;\n\n// === ПАЛЬМА ===\nfloat sdPalm(vec3 p, vec3 pos) {\n  vec3 lp = p - pos;\n  float d = MAX_DIST;\n  \n  // Горшок\n  float pot = sdCappedCone(lp - vec3(0.0, 0.3, 0.0), 0.3, 0.5, 0.4);\n  d = min(d, pot);\n  \n  // Ствол\n  float trunk = sdCylinder(lp - vec3(0.0, 1.5, 0.0), 0.12, 1.2);\n  d = min(d, trunk);\n  \n  // Крона (несколько сфер)\n  float crown = sdSphere(lp - vec3(0.0, 3.0, 0.0), 1.0);\n  crown = min(crown, sdSphere(lp - vec3(0.5, 2.8, 0.3), 0.7));\n  crown = min(crown, sdSphere(lp - vec3(-0.5, 2.8, -0.3), 0.7));\n  crown = min(crown, sdSphere(lp - vec3(0.3, 2.9, -0.5), 0.6));\n  crown = min(crown, sdSphere(lp - vec3(-0.3, 2.9, 0.5), 0.6));\n  d = min(d, crown);\n  \n  return d;\n}\n\n// === КУСТ ===\nfloat sdBush(vec3 p, vec3 pos, float size) {\n  vec3 lp = p - pos;\n  float d = sdSphere(lp, size);\n  // Добавляем неровности\n  d += sin(lp.x * 8.0) * sin(lp.y * 8.0) * sin(lp.z * 8.0) * 0.05 * size;\n  return d;\n}\n\n// === ФАКЕЛ ===\nfloat sdTorch(vec3 p, vec3 pos) {\n  vec3 lp = p - pos;\n  float holder = sdCylinder(lp, 0.08, 0.3);\n  float bowl = sdCappedCone(lp - vec3(0.0, 0.35, 0.0), 0.15, 0.05, 0.15);\n  return min(holder, bowl);\n}\n\n// === ЛЕСТНИЦА ===\nfloat sdStairs(vec3 p, vec3 pos, float width, float height, float depth, int steps) {\n  vec3 lp = p - pos;\n  float d = MAX_DIST;\n  \n  float stepH = height / float(steps);\n  float stepD = depth / float(steps);\n  \n  for (int i = 0; i < steps; i++) {\n    if (i >= 10) break; // Ограничение для производительности\n    float y = float(i) * stepH;\n    float z = float(i) * stepD;\n    float step = sdBox(lp - vec3(0.0, y + stepH * 0.5, z + stepD * 0.5), \n                       vec3(width * 0.5, stepH * 0.5, stepD * 0.5));\n    d = min(d, step);\n  }\n  \n  return d;\n}\n\n// === СЦЕНА ===\nfloat map(vec3 p) {\n  float d = MAX_DIST;\n  materialId = 0;\n  \n  float distFromCenter = length(p.xz);\n  \n  // === ПОЛ ===\n  float floor_d = p.y;\n  d = min(d, floor_d);\n  \n  // === ТОКСИЧНЫЕ ЛУЖИ ===\n  for (int i = 0; i < u_poolCount; i++) {\n    if (i >= 8) break;\n    vec4 pool = u_pools[i];\n    if (pool.w > 0.0) { // lifetime > 0\n      float distToPool = length(p.xz - pool.xy);\n      if (distToPool < pool.z && p.y < 0.15 && p.y > -0.1) {\n        // Внутри лужи\n        float poolSurface = p.y - 0.08;\n        if (poolSurface < d) {\n          d = poolSurface;\n          materialId = 13; // Токсичная лужа\n        }\n      }\n    }\n  }\n  \n  // === ПИКАПЫ ===\n  for (int i = 0; i < u_pickupCount; i++) {\n    if (i >= 8) break;\n    vec4 pickup = u_pickups[i];\n    float pType = pickup.w;\n    \n    if (pType > 0.0) {\n      vec3 pickupPos = pickup.xyz;\n      float pickupDist = length(p - pickupPos);\n      \n      // Парящая сфера/куб\n      if (pType == 9.0) {\n        // Аптечка - красный крест (сфера + кубы)\n        float sphere = length(p - pickupPos) - 0.4;\n        // Простая сфера для производительности\n        if (sphere < d) {\n          d = sphere;\n          materialId = 14; // Аптечка\n        }\n      } else if (pType == 10.0) {\n        // Стимпак - жёлтая звезда (сфера)\n        float sphere = length(p - pickupPos) - 0.35;\n        if (sphere < d) {\n          d = sphere;\n          materialId = 15; // Стимпак\n        }\n      } else if (pType == 11.0) {\n        // Заряд катаны - энергетическая сфера\n        float chargeSphere = length(p - pickupPos) - 0.5;\n        if (chargeSphere < d) {\n          d = chargeSphere;\n          materialId = 17; // Заряд\n        }\n      }\n    }\n  }\n  \n  // === КРУГЛЫЕ СТЕНЫ (цилиндр вовнутрь) ===\n  float walls = -(length(p.xz) - ARENA_RADIUS);\n  d = min(d, walls);\n  \n  // === КУПОЛ ===\n  // Сферический купол над ареной\n  float domeRadius = ARENA_RADIUS * 1.3;\n  float dome = -(length(vec3(p.x, p.y - 3.0, p.z)) - domeRadius);\n  dome = max(dome, p.y - DOME_HEIGHT);\n  d = min(d, dome);\n  \n  // === ЦЕНТРАЛЬНАЯ КОЛОННА (фонтан) ===\n  float centerCol = sdCylinder(p - vec3(0.0, 1.5, 0.0), 1.2, 1.5);\n  d = min(d, centerCol);\n  \n  // Чаша фонтана\n  float fountain = sdTorus(p - vec3(0.0, 0.3, 0.0), vec2(1.8, 0.25));\n  d = min(d, fountain);\n  \n  // === ЦЕНТРАЛЬНЫЙ БАССЕЙН ===\n  float poolDist = distFromCenter;\n  if (poolDist < POOL_RADIUS + 1.0 && poolDist > 2.5 && p.y < 0.5) {\n    // Дно бассейна\n    float poolBottom = p.y + POOL_DEPTH;\n    \n    // Бортик бассейна\n    float rim = sdTorus(p - vec3(0.0, 0.15, 0.0), vec2(POOL_RADIUS, 0.3));\n    d = min(d, rim);\n    \n    // Не пробиваем дно если внутри бассейна\n    if (poolDist < POOL_RADIUS - 0.3) {\n      d = min(d, poolBottom);\n    }\n  }\n  \n  // === МОСТЫ ЧЕРЕЗ БАССЕЙН ===\n  // Мост по X\n  float bridgeX = sdBox(p - vec3(0.0, 0.2, 0.0), vec3(POOL_RADIUS + 1.0, 0.2, BRIDGE_WIDTH * 0.5));\n  // Вырезаем центр для колонны\n  bridgeX = max(bridgeX, -sdCylinder(p, 2.0, 1.0));\n  d = min(d, bridgeX);\n  \n  // Мост по Z\n  float bridgeZ = sdBox(p - vec3(0.0, 0.2, 0.0), vec3(BRIDGE_WIDTH * 0.5, 0.2, POOL_RADIUS + 1.0));\n  bridgeZ = max(bridgeZ, -sdCylinder(p, 2.0, 1.0));\n  d = min(d, bridgeZ);\n  \n  // === ПЛАТФОРМЫ С ЛЕСТНИЦАМИ ===\n  // Левая платформа (X от -17 до -23)\n  float leftPlat = sdBox(p - vec3(-20.0, PLATFORM_HEIGHT * 0.5, 0.0), \n                         vec3(3.0, PLATFORM_HEIGHT * 0.5, 5.0));\n  d = min(d, leftPlat);\n  \n  // Лестница к левой платформе (X от -16 до -17, Z в центре)\n  float stairsL = sdBox(p - vec3(-16.5, PLATFORM_HEIGHT * 0.25, 0.0), \n                        vec3(0.5, PLATFORM_HEIGHT * 0.25 + 0.1, 2.5));\n  // Рампа вместо ступенек для простоты\n  d = min(d, stairsL);\n  \n  // Правая платформа (X от 17 до 23)\n  float rightPlat = sdBox(p - vec3(20.0, PLATFORM_HEIGHT * 0.5, 0.0), \n                          vec3(3.0, PLATFORM_HEIGHT * 0.5, 5.0));\n  d = min(d, rightPlat);\n  \n  // Лестница к правой платформе (X от 16 до 17)\n  float stairsR = sdBox(p - vec3(16.5, PLATFORM_HEIGHT * 0.25, 0.0), \n                        vec3(0.5, PLATFORM_HEIGHT * 0.25 + 0.1, 2.5));\n  d = min(d, stairsR);\n  \n  // Перила платформ\n  float railL = sdBox(p - vec3(-17.2, PLATFORM_HEIGHT + 0.5, 0.0), vec3(0.1, 0.5, 5.0));\n  float railR = sdBox(p - vec3(17.2, PLATFORM_HEIGHT + 0.5, 0.0), vec3(0.1, 0.5, 5.0));\n  d = min(d, min(railL, railR));\n  \n  // === КОЛОННЫ (только 2 у платформ) ===\n  float colD = sdCylinder(p - vec3(22.0, 4.0, 0.0), 0.5, 4.0);\n  colD = min(colD, sdCylinder(p - vec3(-22.0, 4.0, 0.0), 0.5, 4.0));\n  d = min(d, colD);\n  \n  // === ВЕРХНИЙ БАЛКОН С ЗАРЯДОМ (требует двойной прыжок) ===\n  // Балкон наверху (высота 12)\n  float balconyHeight = 12.0;\n  float balcony = sdBox(p - vec3(0.0, balconyHeight, -23.0), vec3(4.0, 0.3, 3.0));\n  if (balcony < d) {\n    d = balcony;\n    materialId = 16; // Балкон (особый материал)\n  }\n  \n  // Перила балкона\n  float balcRail1 = sdBox(p - vec3(-4.0, balconyHeight + 0.8, -23.0), vec3(0.15, 0.8, 3.0));\n  float balcRail2 = sdBox(p - vec3(4.0, balconyHeight + 0.8, -23.0), vec3(0.15, 0.8, 3.0));\n  float balcRail3 = sdBox(p - vec3(0.0, balconyHeight + 0.8, -20.0), vec3(4.0, 0.8, 0.15));\n  d = min(d, min(balcRail1, min(balcRail2, balcRail3)));\n  \n  // Платформы для прыжков (требуют двойной прыжок)\n  // Платформа 1 (высота 3) - обычный прыжок\n  float plat1 = sdBox(p - vec3(-6.5, 3.0, -24.0), vec3(1.5, 0.3, 2.0));\n  if (plat1 < d) {\n    d = plat1;\n    materialId = 16;\n  }\n  \n  // Платформа 2 (высота 6) - двойной прыжок\n  float plat2 = sdBox(p - vec3(-2.5, 6.0, -24.0), vec3(1.5, 0.3, 2.0));\n  if (plat2 < d) {\n    d = plat2;\n    materialId = 16;\n  }\n  \n  // Платформа 3 (высота 9) - двойной прыжок\n  float plat3 = sdBox(p - vec3(1.5, 9.0, -24.0), vec3(1.5, 0.3, 2.0));\n  if (plat3 < d) {\n    d = plat3;\n    materialId = 16;\n  }\n  \n  // === ВОДА ===\n  // Центральный бассейн (только визуально, не пройти - коллизия блокирует)\n  if (distFromCenter > 2.5 && distFromCenter < POOL_RADIUS - 0.3) {\n    // Проверяем что не на мосту\n    bool onBridge = (abs(p.z) < BRIDGE_WIDTH * 0.5) || (abs(p.x) < BRIDGE_WIDTH * 0.5);\n    if (!onBridge) {\n      float waterY = 0.0 + waterWaves(p.xz, u_time) * 0.05;\n      float waterPlane = p.y - waterY;\n      if (waterPlane < d && waterPlane > -0.3) {\n        d = max(waterPlane, 0.001);\n        materialId = 1;\n      }\n    }\n  }\n  \n  // Фонтан в центре (декоративная вода)\n  float fountainWater = length(p.xz);\n  if (fountainWater < 1.8 && fountainWater > 1.3) {\n    float waterY = 0.4 + waterWaves(p.xz * 3.0, u_time * 2.0) * 0.02;\n    float waterPlane = p.y - waterY;\n    if (waterPlane < d && waterPlane > -0.1) {\n      d = max(waterPlane, 0.001);\n      materialId = 1;\n    }\n  }\n  \n  // === ВРАГИ ===\n  // w: 0=неактивен, 1-2=бейнлинг, 3-4=фантом, 5-6=runner, 7-8=hopper\n  // 11-12=boss_green, 13-14=boss_black, 15-16=boss_blue\n  for (int i = 0; i < u_targetCount; i++) {\n    if (i >= 16) break;\n    vec4 target = u_targets[i];\n    if (target.w > 0.5) {\n      vec3 tp = p - target.xyz;\n      int enemyType = int(target.w / 2.0); // 0=baneling, 1=phantom, 2=runner, 3=hopper, 5=boss_green, 6=boss_black, 7=boss_blue\n      \n      float targetD;\n      int matId;\n      \n      if (enemyType == 5) {\n        // === ЗЕЛЁНЫЙ БОСС (огромная зелёная жижа) ===\n        float wobble = sin(u_time * 2.0 + tp.x * 1.5) * 0.3\n                     + sin(u_time * 1.5 + tp.y * 2.0) * 0.25\n                     + sin(u_time * 2.5 + tp.z * 1.0) * 0.2;\n        float radius = 2.5 + wobble;\n        targetD = sdSphere(tp, radius);\n        \n        // Пузырящаяся поверхность\n        float bubbles = sin(tp.x * 4.0 + u_time * 3.0) \n                      * sin(tp.y * 4.0 + u_time * 2.5) \n                      * sin(tp.z * 4.0 + u_time * 3.5) * 0.2;\n        targetD += bubbles;\n        \n        // Щупальца\n        for (int t = 0; t < 4; t++) {\n          float angle = float(t) * 1.57 + u_time * 0.5;\n          vec3 tentacle = tp - vec3(cos(angle) * 1.5, -1.0, sin(angle) * 1.5);\n          targetD = smin(targetD, sdCylinder(tentacle, 0.3, 1.5), 0.3);\n        }\n        matId = 10; // Зелёный босс\n        \n      } else if (enemyType == 6) {\n        // === ЧЁРНЫЙ БОСС (искривляет пространство) ===\n        // Искажённое пространство вокруг\n        vec3 distorted = tp;\n        float distortAmount = sin(u_time * 3.0) * 0.3;\n        distorted.x += sin(tp.y * 3.0 + u_time * 2.0) * distortAmount;\n        distorted.z += cos(tp.y * 3.0 + u_time * 2.0) * distortAmount;\n        \n        float radius = 2.0;\n        targetD = sdSphere(distorted, radius);\n        \n        // Кольца тёмной энергии\n        float ring1 = abs(sdTorus(tp, vec2(3.0, 0.1))) - 0.05;\n        float ring2 = abs(sdTorus(tp * vec3(1.0, 0.7, 1.0), vec2(3.5, 0.08))) - 0.03;\n        targetD = min(targetD, ring1);\n        targetD = min(targetD, ring2);\n        matId = 11; // Чёрный босс\n        \n      } else if (enemyType == 7) {\n        // === СИНИЙ БОСС (телепортирующийся) ===\n        // Мерцающая форма\n        float flicker = abs(sin(u_time * 20.0)) * 0.3 + 0.7;\n        float radius = 1.8 * flicker;\n        targetD = sdSphere(tp, radius);\n        \n        // Электрические разряды\n        float sparks = sin(tp.x * 15.0 + u_time * 30.0) \n                     * sin(tp.y * 15.0 + u_time * 25.0) * 0.1;\n        targetD += sparks;\n        \n        // Призрачные копии\n        vec3 ghost1 = tp - vec3(sin(u_time * 5.0) * 2.0, 0.0, cos(u_time * 5.0) * 2.0);\n        vec3 ghost2 = tp + vec3(cos(u_time * 4.0) * 2.0, 0.0, sin(u_time * 4.0) * 2.0);\n        targetD = min(targetD, sdSphere(ghost1, 0.5) - 0.1);\n        targetD = min(targetD, sdSphere(ghost2, 0.5) - 0.1);\n        matId = 12; // Синий босс\n        \n      } else if (enemyType == 1) {\n        // === ФАНТОМ (чёрный шар) ===\n        float distort = sin(u_time * 8.0 + tp.x * 5.0) * 0.08\n                      + sin(u_time * 7.0 + tp.z * 6.0) * 0.06;\n        float radius = 0.55 + distort;\n        targetD = sdSphere(tp, radius);\n        \n        vec3 trail = tp + vec3(0.0, 0.0, 0.3);\n        float trailD = sdSphere(trail, 0.3) - 0.1;\n        targetD = min(targetD, trailD);\n        matId = 5;\n        \n      } else if (enemyType == 2) {\n        // === RUNNER (оранжевый, вытянутый) ===\n        vec3 stretched = tp;\n        stretched.x *= 0.6;\n        float radius = 0.35;\n        targetD = sdSphere(stretched, radius);\n        \n        float speedTrail = sdSphere(tp + vec3(0.3, 0.0, 0.0), 0.2);\n        speedTrail = min(speedTrail, sdSphere(tp + vec3(0.5, 0.0, 0.0), 0.12));\n        targetD = min(targetD, speedTrail);\n        matId = 6;\n        \n      } else if (enemyType == 3) {\n        // === HOPPER (синий, пружинистый) ===\n        float squeeze = 1.0 + sin(u_time * 12.0) * 0.15;\n        vec3 squashed = tp;\n        squashed.y *= squeeze;\n        float radius = 0.45;\n        targetD = sdSphere(squashed, radius);\n        \n        vec3 ear1 = tp - vec3(0.2, 0.4, 0.0);\n        vec3 ear2 = tp - vec3(-0.2, 0.4, 0.0);\n        float ears = min(sdSphere(ear1, 0.12), sdSphere(ear2, 0.12));\n        targetD = min(targetD, ears);\n        matId = 7;\n        \n      } else {\n        // === БЕЙНЛИНГ (зелёная жижа) ===\n        float wobble = sin(u_time * 4.0 + tp.x * 3.0) * 0.1\n                     + sin(u_time * 3.0 + tp.y * 4.0) * 0.1\n                     + sin(u_time * 5.0 + tp.z * 2.0) * 0.08;\n        float radius = 0.7 + wobble;\n        targetD = sdSphere(tp, radius);\n        \n        float bubbles = sin(tp.x * 8.0 + u_time * 2.0) \n                      * sin(tp.y * 8.0 + u_time * 1.5) \n                      * sin(tp.z * 8.0 + u_time * 2.5) * 0.05;\n        targetD += bubbles;\n        matId = 4;\n      }\n      \n      if (targetD < d) {\n        d = targetD;\n        materialId = matId;\n      }\n    }\n  }\n  \n  return d;\n}\n\n// === RAY MARCHING ===\nfloat rayMarch(vec3 ro, vec3 rd) {\n  float d = 0.0;\n  for (int i = 0; i < MAX_STEPS; i++) {\n    vec3 p = ro + rd * d;\n    float dist = map(p);\n    d += dist * 0.9; // Небольшой overrelaxation для скорости\n    if (dist < SURF_DIST || d > MAX_DIST) break;\n  }\n  return d;\n}\n\nvec3 getNormal(vec3 p) {\n  vec2 e = vec2(0.02, 0.0); // Грубее но быстрее\n  return normalize(vec3(\n    map(p + e.xyy) - map(p - e.xyy),\n    map(p + e.yxy) - map(p - e.yxy),\n    map(p + e.yyx) - map(p - e.yyx)\n  ));\n}\n\n// === КАУСТИКИ ===\nfloat caustics(vec2 p, float t) {\n  float c = 0.0;\n  for (float i = 1.0; i <= 3.0; i++) {\n    vec2 uv = p * (1.0 + i * 0.3);\n    uv += vec2(sin(t * 0.3 + i), cos(t * 0.4 + i * 1.1)) * 0.5;\n    c += pow(0.5 + 0.5 * sin(noise(uv) * 6.0), 4.0);\n  }\n  return c / 3.0;\n}\n\n// === ЗВЁЗДНОЕ НЕБО (через купол) ===\nvec3 renderSky(vec3 rd) {\n  vec3 color = vec3(0.02, 0.03, 0.08);\n  \n  // Звёзды\n  vec2 skyUV = rd.xz / (rd.y + 0.5);\n  for (float i = 0.0; i < 50.0; i++) {\n    vec2 starPos = vec2(hash(vec2(i, 0.0)), hash(vec2(i, 1.0))) * 4.0 - 2.0;\n    float star = 0.002 / (length(skyUV - starPos) + 0.002);\n    star *= step(0.7, hash(vec2(i, 2.0)));\n    color += vec3(1.0, 0.95, 0.9) * star * 0.3;\n  }\n  \n  // Луна\n  vec3 moonDir = normalize(vec3(0.5, 0.8, -0.3));\n  float moon = smoothstep(0.98, 0.99, dot(rd, moonDir));\n  color += vec3(1.0, 0.98, 0.95) * moon * 2.0;\n  \n  // Свечение вокруг луны\n  float moonGlow = pow(max(0.0, dot(rd, moonDir)), 32.0);\n  color += vec3(0.3, 0.35, 0.5) * moonGlow * 0.5;\n  \n  return color;\n}\n\n// === ГЛАВНАЯ ===\nvoid main() {\n  vec2 uv = (v_uv - 0.5) * 2.0;\n  uv.x *= u_resolution.x / u_resolution.y;\n  \n  vec3 ro = u_cameraPos;\n  \n  float cy = cos(u_cameraYaw);\n  float sy = sin(u_cameraYaw);\n  float cp = cos(u_cameraPitch);\n  float sp = sin(u_cameraPitch);\n  \n  vec3 forward = vec3(sy * cp, sp, -cy * cp);\n  vec3 right = vec3(cy, 0.0, sy);\n  vec3 up = cross(right, forward);\n  \n  vec3 rd = normalize(forward + uv.x * right + uv.y * up);\n  \n  float d = rayMarch(ro, rd);\n  \n  // Фоновый цвет (небо через купол)\n  vec3 color = renderSky(rd) * 0.3;\n  \n  if (d < MAX_DIST) {\n    vec3 p = ro + rd * d;\n    vec3 n = getNormal(p);\n    \n    map(p);\n    int mat = materialId;\n    \n    // === ОСВЕЩЕНИЕ ПО ЭПОХАМ ===\n    vec3 ambient;\n    vec3 mainLight;\n    vec3 accentColor;\n    vec3 fogColor;\n    \n    if (u_era == 1) {\n      // ЭПОХА 1: Кислотная (зелёная токсичная)\n      ambient = vec3(0.08, 0.15, 0.08);\n      mainLight = vec3(0.3, 0.8, 0.3); // Зелёный свет\n      accentColor = vec3(0.5, 1.0, 0.3); // Кислотный\n      fogColor = vec3(0.02, 0.08, 0.02);\n    } else if (u_era == 2) {\n      // ЭПОХА 2: Чёрная дыра (тёмно-фиолетовая)\n      ambient = vec3(0.06, 0.04, 0.12);\n      mainLight = vec3(0.5, 0.3, 0.8); // Фиолетовый\n      accentColor = vec3(0.8, 0.2, 1.0); // Пурпурный\n      fogColor = vec3(0.03, 0.01, 0.06);\n    } else {\n      // ЭПОХА 3: Космическая (синяя технологичная)\n      ambient = vec3(0.08, 0.12, 0.18);\n      mainLight = vec3(0.4, 0.7, 1.0); // Синий\n      accentColor = vec3(0.2, 0.8, 1.0); // Циан\n      fogColor = vec3(0.01, 0.03, 0.08);\n    }\n    \n    // Основной свет сверху\n    float mainDot = max(dot(n, vec3(0.3, 0.9, -0.2)), 0.0);\n    \n    // Один тёплый источник (факел) - цвет меняется по эпохе\n    vec3 torchPos = vec3(0.0, 8.0, 0.0);\n    vec3 toTorch = torchPos - p;\n    float torchDist = length(toTorch);\n    float atten = 25.0 / (1.0 + torchDist * 0.05 + torchDist * torchDist * 0.008);\n    vec3 torchLight = accentColor * max(dot(n, normalize(toTorch)), 0.0) * atten;\n    \n    // Подсветка бассейна - цвет по эпохе\n    float distFromCenter = length(p.xz);\n    float poolInfluence = 1.0 - smoothstep(0.0, 15.0, distFromCenter);\n    vec3 poolLight = accentColor * poolInfluence * 2.0;\n    \n    // === МАТЕРИАЛЫ (упрощённые) ===\n    if (mat == 1) {\n      // === ВОДА (простая) ===\n      vec3 waterColor = vec3(0.2, 0.55, 0.7);\n      waterColor += poolLight;\n      float fresnel = pow(1.0 - max(0.0, dot(-rd, n)), 2.0);\n      color = mix(waterColor, vec3(0.5, 0.8, 0.9), fresnel * 0.3);\n      \n    } else if (mat == 4) {\n      // === БЕЙНЛИНГИ (зелёная кислотная жижа) ===\n      vec3 acidGreen = vec3(0.2, 0.9, 0.1);\n      vec3 darkGreen = vec3(0.0, 0.4, 0.0);\n      \n      float pulse = 0.7 + 0.3 * sin(u_time * 4.0 + p.x * 2.0);\n      float pulse2 = 0.8 + 0.2 * sin(u_time * 6.0 + p.z * 3.0);\n      float glow = 0.5 + 0.5 * sin(u_time * 3.0);\n      \n      color = mix(darkGreen, acidGreen, pulse * pulse2);\n      color += vec3(0.3, 1.0, 0.2) * glow * 0.5;\n      color *= 1.5;\n      \n      float fresnel = pow(1.0 - max(0.0, dot(-rd, n)), 3.0);\n      color = mix(color, vec3(0.5, 1.0, 0.3), fresnel * 0.4);\n      \n    } else if (mat == 5) {\n      // === ФАНТОМ (чёрный шар с тёмной энергией) ===\n      vec3 voidBlack = vec3(0.02, 0.02, 0.05);\n      vec3 darkPurple = vec3(0.1, 0.0, 0.15);\n      \n      float flicker = 0.6 + 0.4 * sin(u_time * 12.0 + p.x * 5.0);\n      float flicker2 = 0.7 + 0.3 * sin(u_time * 15.0 + p.z * 4.0);\n      \n      color = mix(voidBlack, darkPurple, flicker * flicker2 * 0.3);\n      \n      float fresnel = pow(1.0 - max(0.0, dot(-rd, n)), 2.0);\n      vec3 edgeGlow = vec3(0.3, 0.0, 0.5) * fresnel * 0.8;\n      color += edgeGlow;\n      \n      float spark = sin(u_time * 20.0 + p.y * 10.0) * sin(u_time * 18.0 + p.x * 8.0);\n      if (spark > 0.9) {\n        color += vec3(0.5, 0.2, 0.8) * 0.5;\n      }\n      color *= 0.6;\n      \n    } else if (mat == 6) {\n      // === RUNNER (оранжевый, огненный) ===\n      vec3 orange = vec3(1.0, 0.5, 0.0);\n      vec3 yellow = vec3(1.0, 0.9, 0.2);\n      vec3 red = vec3(1.0, 0.2, 0.0);\n      \n      // Быстрое мерцание как пламя\n      float flame = 0.5 + 0.5 * sin(u_time * 20.0 + p.x * 8.0);\n      float flame2 = 0.6 + 0.4 * sin(u_time * 25.0 + p.z * 10.0);\n      \n      color = mix(red, orange, flame);\n      color = mix(color, yellow, flame2 * 0.4);\n      color *= 1.8; // Яркий!\n      \n      // Свечение по краям\n      float fresnel = pow(1.0 - max(0.0, dot(-rd, n)), 2.0);\n      color += vec3(1.0, 0.8, 0.3) * fresnel * 0.6;\n      \n    } else if (mat == 7) {\n      // === HOPPER (синий, электрический) ===\n      vec3 cyan = vec3(0.0, 0.8, 1.0);\n      vec3 blue = vec3(0.1, 0.3, 1.0);\n      vec3 white = vec3(0.9, 0.95, 1.0);\n      \n      // Электрические разряды\n      float spark1 = sin(u_time * 30.0 + p.y * 15.0);\n      float spark2 = sin(u_time * 35.0 + p.x * 12.0);\n      float electric = spark1 * spark2;\n      \n      color = mix(blue, cyan, 0.5 + 0.5 * sin(u_time * 8.0));\n      \n      // Яркие вспышки\n      if (electric > 0.8) {\n        color = mix(color, white, 0.7);\n      }\n      color *= 1.5;\n      \n      // Свечение\n      float fresnel = pow(1.0 - max(0.0, dot(-rd, n)), 2.5);\n      color += vec3(0.3, 0.6, 1.0) * fresnel * 0.8;\n      \n    } else if (mat == 10) {\n      // === ЗЕЛЁНЫЙ БОСС (огромная токсичная жижа) ===\n      vec3 toxicGreen = vec3(0.1, 0.9, 0.2);\n      vec3 darkGreen = vec3(0.0, 0.4, 0.1);\n      vec3 yellow = vec3(0.8, 1.0, 0.0);\n      \n      // Пульсирующее ядовитое свечение\n      float pulse = 0.6 + 0.4 * sin(u_time * 3.0);\n      color = mix(darkGreen, toxicGreen, pulse);\n      \n      // Пузыри на поверхности\n      float bubbles = sin(p.x * 6.0 + u_time * 4.0) * sin(p.z * 6.0 + u_time * 3.0);\n      if (bubbles > 0.7) {\n        color = mix(color, yellow, 0.5);\n      }\n      \n      // Яркое свечение\n      float fresnel = pow(1.0 - max(0.0, dot(-rd, n)), 2.0);\n      color += toxicGreen * fresnel * 1.5;\n      color *= 2.0; // Очень яркий!\n      \n    } else if (mat == 11) {\n      // === ЧЁРНЫЙ БОСС (искривляет пространство) ===\n      vec3 voidBlack = vec3(0.02, 0.0, 0.05);\n      vec3 purple = vec3(0.4, 0.0, 0.6);\n      vec3 darkPurple = vec3(0.15, 0.0, 0.25);\n      \n      // Почти чёрный с пурпурным мерцанием\n      float darkPulse = sin(u_time * 2.0 + p.y * 3.0) * 0.5 + 0.5;\n      color = mix(voidBlack, darkPurple, darkPulse * 0.3);\n      \n      // Искривление видно как переливы\n      float distortion = sin(u_time * 5.0 + p.x * 8.0) * sin(u_time * 4.0 + p.z * 8.0);\n      if (distortion > 0.6) {\n        color += purple * 0.3;\n      }\n      \n      // Жуткое свечение по краям\n      float fresnel = pow(1.0 - max(0.0, dot(-rd, n)), 4.0);\n      color += purple * fresnel * 2.0;\n      \n      // Звёзды внутри (как чёрная дыра)\n      float stars = sin(p.x * 30.0) * sin(p.y * 30.0) * sin(p.z * 30.0);\n      if (stars > 0.95) {\n        color += vec3(1.0, 1.0, 1.0) * 0.5;\n      }\n      \n    } else if (mat == 12) {\n      // === СИНИЙ БОСС (телепортирующийся) ===\n      vec3 electricBlue = vec3(0.0, 0.5, 1.0);\n      vec3 cyan = vec3(0.0, 1.0, 1.0);\n      vec3 white = vec3(1.0, 1.0, 1.0);\n      \n      // Мерцание (телепорт эффект)\n      float flicker = abs(sin(u_time * 25.0));\n      color = mix(electricBlue, cyan, flicker);\n      \n      // Разряды\n      float spark = sin(u_time * 50.0 + p.x * 20.0) * sin(u_time * 45.0 + p.y * 20.0);\n      if (spark > 0.85) {\n        color = white;\n      }\n      \n      // Призрачность\n      float ghost = sin(u_time * 8.0) * 0.3 + 0.7;\n      color *= ghost;\n      \n      // Яркое свечение\n      float fresnel = pow(1.0 - max(0.0, dot(-rd, n)), 2.0);\n      color += cyan * fresnel * 1.5;\n      color *= 1.8;\n      \n    } else if (mat == 13) {\n      // === ТОКСИЧНАЯ ЛУЖА ===\n      vec3 toxicGreen = vec3(0.2, 1.0, 0.3);\n      vec3 darkGreen = vec3(0.0, 0.3, 0.1);\n      \n      // Пульсирующий эффект\n      float pulse = 0.5 + 0.5 * sin(u_time * 4.0 + p.x * 2.0 + p.z * 2.0);\n      color = mix(darkGreen, toxicGreen, pulse);\n      \n      // Пузыри\n      float bubbles = sin(p.x * 10.0 + u_time * 5.0) * sin(p.z * 10.0 + u_time * 4.0);\n      if (bubbles > 0.7) {\n        color += vec3(0.3, 0.5, 0.1);\n      }\n      \n      // Яркое свечение\n      color *= 2.0;\n      \n    } else if (mat == 14) {\n      // === АПТЕЧКА ===\n      // Красный крест с белым свечением\n      vec3 healthRed = vec3(1.0, 0.2, 0.2);\n      vec3 healthWhite = vec3(1.0, 0.9, 0.9);\n      \n      // Пульсация\n      float pulse = 0.7 + 0.3 * sin(u_time * 5.0);\n      color = mix(healthRed, healthWhite, pulse * 0.3);\n      \n      // Яркое свечение\n      color *= 2.5;\n      \n    } else if (mat == 15) {\n      // === СТИМПАК ===\n      // Жёлто-оранжевый энергетический шар\n      vec3 stimYellow = vec3(1.0, 0.8, 0.2);\n      vec3 stimOrange = vec3(1.0, 0.5, 0.1);\n      \n      // Быстрая пульсация\n      float pulse = 0.5 + 0.5 * sin(u_time * 8.0);\n      color = mix(stimOrange, stimYellow, pulse);\n      \n      // Электрические искры\n      float spark = fract(sin(dot(p.xz + u_time * 10.0, vec2(12.9898, 78.233))) * 43758.5453);\n      if (spark > 0.95) {\n        color += vec3(1.0, 1.0, 0.5);\n      }\n      \n      // Яркое свечение\n      color *= 2.5;\n      \n    } else if (mat == 16) {\n      // === БАЛКОН ===\n      vec3 balconyColor = vec3(0.3, 0.25, 0.4); // Тёмно-фиолетовый\n      \n      // Светящиеся линии\n      float gridX = step(0.9, fract(p.x * 2.0));\n      float gridZ = step(0.9, fract(p.z * 2.0));\n      float grid = max(gridX, gridZ);\n      \n      color = mix(balconyColor, accentColor, grid * 0.5);\n      color += accentColor * 0.1; // Лёгкое свечение\n      \n    } else if (mat == 17) {\n      // === ЗАРЯД КАТАНЫ (энергетическая сфера) ===\n      vec3 chargeColor1 = vec3(0.0, 0.8, 1.0); // Бирюзовый\n      vec3 chargeColor2 = vec3(0.0, 1.0, 1.0); // Циан\n      vec3 chargeColor3 = vec3(0.5, 0.8, 1.0); // Светло-голубой\n      \n      // Интенсивная пульсация\n      float pulse = 0.5 + 0.5 * sin(u_time * 6.0);\n      float pulse2 = 0.5 + 0.5 * sin(u_time * 8.0 + 1.0);\n      color = mix(chargeColor1, chargeColor2, pulse);\n      color = mix(color, chargeColor3, pulse2 * 0.3);\n      \n      // Электрические разряды\n      float spark = fract(sin(dot(p.xy + u_time * 10.0, vec2(12.9898, 78.233))) * 43758.5453);\n      if (spark > 0.85) {\n        color += vec3(1.0, 1.0, 1.0); // Белые искры\n      }\n      \n      // Вращающиеся кольца энергии\n      float ring = sin(atan(p.y, p.x) * 3.0 + u_time * 5.0);\n      color += chargeColor2 * max(0.0, ring) * 0.3;\n      \n      // Очень яркое свечение\n      color *= 4.0;\n      \n    } else {\n      // === ПОЛ / СТЕНЫ ===\n      vec3 baseColor = vec3(0.15, 0.14, 0.12);\n      \n      // Простая плитка\n      if (abs(n.y) > 0.9) {\n        vec2 tile = fract(p.xz * 0.25);\n        float tileEdge = step(0.04, min(min(tile.x, tile.y), min(1.0 - tile.x, 1.0 - tile.y)));\n        baseColor *= 0.8 + 0.2 * tileEdge;\n      }\n      \n      color = baseColor * ambient * 2.0;\n      color += baseColor * mainLight * mainDot * 0.5;\n      color += baseColor * torchLight * 1.2;\n      color += baseColor * poolLight * 1.0;\n    }\n    \n    // Вспышка от выстрела\n    if (u_muzzleFlash > 0.0) {\n      color += vec3(1.0, 0.7, 0.4) * u_muzzleFlash * 0.4;\n    }\n    \n    // Туман по эпохе\n    float fog = 1.0 - exp(-d * 0.02);\n    color = mix(color, fogColor, fog * 0.5);\n  }\n  \n  // Тонмаппинг\n  color = color / (color + vec3(1.0));\n  color = pow(color, vec3(0.9));\n  \n  // Цветокоррекция - добавляем голубой оттенок для ночной атмосферы\n  color = mix(color, color * vec3(0.9, 0.95, 1.1), 0.25);\n  \n  // Небольшое насыщение\n  float gray = dot(color, vec3(0.299, 0.587, 0.114));\n  color = mix(vec3(gray), color, 1.15);\n  \n  // Виньетка\n  float vig = 1.0 - length(v_uv - 0.5) * 0.4;\n  color *= vig;\n  \n  fragColor = vec4(color, 1.0);\n}\n`;\n","import { VERTEX_SHADER, FRAGMENT_SHADER } from './Shaders';\nimport type { ShaderUniforms, Vec3 } from '@/types';\n\n/**\n * WebGL2 рендерер\n * Ray marching через фрагментный шейдер\n */\nexport class WebGLRenderer {\n  private gl: WebGL2RenderingContext;\n  private program: WebGLProgram | null = null;\n  private uniforms: ShaderUniforms;\n  private vao: WebGLVertexArrayObject | null = null;\n\n  /** Масштаб рендеринга (0-1) */\n  public renderScale = 0.75;\n\n  constructor(private canvas: HTMLCanvasElement) {\n    const gl = canvas.getContext('webgl2');\n    if (!gl) {\n      throw new Error('WebGL2 не поддерживается');\n    }\n    this.gl = gl;\n\n    this.uniforms = {\n      resolution: null,\n      time: null,\n      cameraPos: null,\n      cameraDir: null,\n      cameraYaw: null,\n      cameraPitch: null,\n      targets: null,\n      targetCount: null,\n      muzzleFlash: null,\n      pools: null,\n      poolCount: null,\n      era: null,\n      pickups: null,\n      pickupCount: null,\n    };\n\n    this.init();\n  }\n\n  /** Инициализация WebGL */\n  private init(): void {\n    const gl = this.gl;\n\n    // Компилируем шейдеры\n    const vertShader = this.compileShader(gl.VERTEX_SHADER, VERTEX_SHADER);\n    const fragShader = this.compileShader(gl.FRAGMENT_SHADER, FRAGMENT_SHADER);\n\n    if (!vertShader || !fragShader) {\n      throw new Error('Ошибка компиляции шейдеров');\n    }\n\n    // Создаём программу\n    this.program = gl.createProgram()!;\n    gl.attachShader(this.program, vertShader);\n    gl.attachShader(this.program, fragShader);\n    gl.linkProgram(this.program);\n\n    if (!gl.getProgramParameter(this.program, gl.LINK_STATUS)) {\n      throw new Error('Ошибка линковки: ' + gl.getProgramInfoLog(this.program));\n    }\n\n    // Получаем uniform locations\n    this.uniforms.resolution = gl.getUniformLocation(this.program, 'u_resolution');\n    this.uniforms.time = gl.getUniformLocation(this.program, 'u_time');\n    this.uniforms.cameraPos = gl.getUniformLocation(this.program, 'u_cameraPos');\n    this.uniforms.cameraYaw = gl.getUniformLocation(this.program, 'u_cameraYaw');\n    this.uniforms.cameraPitch = gl.getUniformLocation(this.program, 'u_cameraPitch');\n    this.uniforms.targets = gl.getUniformLocation(this.program, 'u_targets');\n    this.uniforms.targetCount = gl.getUniformLocation(this.program, 'u_targetCount');\n    this.uniforms.muzzleFlash = gl.getUniformLocation(this.program, 'u_muzzleFlash');\n    this.uniforms.pools = gl.getUniformLocation(this.program, 'u_pools');\n    this.uniforms.poolCount = gl.getUniformLocation(this.program, 'u_poolCount');\n    this.uniforms.era = gl.getUniformLocation(this.program, 'u_era');\n    this.uniforms.pickups = gl.getUniformLocation(this.program, 'u_pickups');\n    this.uniforms.pickupCount = gl.getUniformLocation(this.program, 'u_pickupCount');\n\n    // Создаём fullscreen quad\n    this.createQuad();\n  }\n\n  /** Компиляция шейдера */\n  private compileShader(type: number, source: string): WebGLShader | null {\n    const gl = this.gl;\n    const shader = gl.createShader(type);\n    if (!shader) return null;\n\n    gl.shaderSource(shader, source);\n    gl.compileShader(shader);\n\n    if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n      console.error('Ошибка шейдера:', gl.getShaderInfoLog(shader));\n      gl.deleteShader(shader);\n      return null;\n    }\n\n    return shader;\n  }\n\n  /** Создание fullscreen quad */\n  private createQuad(): void {\n    const gl = this.gl;\n\n    // Вершины квада (-1 до 1)\n    const vertices = new Float32Array([\n      -1, -1,\n       1, -1,\n      -1,  1,\n       1,  1,\n    ]);\n\n    // VAO\n    this.vao = gl.createVertexArray();\n    gl.bindVertexArray(this.vao);\n\n    // VBO\n    const vbo = gl.createBuffer();\n    gl.bindBuffer(gl.ARRAY_BUFFER, vbo);\n    gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);\n\n    // Атрибут позиции\n    const posLoc = gl.getAttribLocation(this.program!, 'a_position');\n    gl.enableVertexAttribArray(posLoc);\n    gl.vertexAttribPointer(posLoc, 2, gl.FLOAT, false, 0, 0);\n\n    gl.bindVertexArray(null);\n  }\n\n  /** Обновить размер canvas */\n  public resize(): void {\n    const dpr = window.devicePixelRatio || 1;\n    const width = Math.floor(this.canvas.clientWidth * dpr * this.renderScale);\n    const height = Math.floor(this.canvas.clientHeight * dpr * this.renderScale);\n\n    if (this.canvas.width !== width || this.canvas.height !== height) {\n      this.canvas.width = width;\n      this.canvas.height = height;\n      this.gl.viewport(0, 0, width, height);\n    }\n  }\n\n  /** Рендеринг кадра */\n  public render(\n    time: number,\n    cameraPos: Vec3,\n    cameraYaw: number,\n    cameraPitch: number,\n    targetsData: Float32Array,\n    targetCount: number,\n    muzzleFlash: number,\n    poolsData?: Float32Array,\n    poolCount?: number,\n    era?: number,\n    pickupsData?: Float32Array,\n    pickupCount?: number\n  ): void {\n    const gl = this.gl;\n\n    this.resize();\n\n    gl.useProgram(this.program);\n    gl.bindVertexArray(this.vao);\n\n    // Устанавливаем uniforms\n    gl.uniform2f(this.uniforms.resolution, this.canvas.width, this.canvas.height);\n    gl.uniform1f(this.uniforms.time, time);\n    gl.uniform3f(this.uniforms.cameraPos, cameraPos.x, cameraPos.y, cameraPos.z);\n    gl.uniform1f(this.uniforms.cameraYaw, cameraYaw);\n    gl.uniform1f(this.uniforms.cameraPitch, cameraPitch);\n    gl.uniform4fv(this.uniforms.targets, targetsData);\n    gl.uniform1i(this.uniforms.targetCount, targetCount);\n    gl.uniform1f(this.uniforms.muzzleFlash, muzzleFlash);\n    \n    // Лужи\n    if (poolsData && poolCount !== undefined) {\n      gl.uniform4fv(this.uniforms.pools, poolsData);\n      gl.uniform1i(this.uniforms.poolCount, poolCount);\n    } else {\n      gl.uniform1i(this.uniforms.poolCount, 0);\n    }\n    \n    // Эпоха (1-3)\n    gl.uniform1i(this.uniforms.era, era || 1);\n    \n    // Пикапы\n    if (pickupsData && pickupCount !== undefined) {\n      gl.uniform4fv(this.uniforms.pickups, pickupsData);\n      gl.uniform1i(this.uniforms.pickupCount, pickupCount);\n    } else {\n      gl.uniform1i(this.uniforms.pickupCount, 0);\n    }\n\n    // Рисуем\n    gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n  }\n\n  /** Уничтожить рендерер */\n  public destroy(): void {\n    if (this.program) {\n      this.gl.deleteProgram(this.program);\n    }\n  }\n}\n\n","/**\n * HUD для Samurai Pool Arena\n * Здоровье, волна, счёт, эффекты\n */\nexport class HUD {\n  private healthEl: HTMLElement | null;\n  private ammoEl: HTMLElement | null;\n  private fragsEl: HTMLElement | null;\n  private crosshairEl: HTMLElement | null;\n  private hitmarkerEl: HTMLElement | null;\n  private reloadEl: HTMLElement | null;\n  private waveEl: HTMLElement | null;\n  private messageEl: HTMLElement | null;\n  private damageOverlay: HTMLElement | null;\n  private weaponEl: HTMLElement | null;\n\n  constructor() {\n    this.healthEl = document.getElementById('health-value');\n    this.ammoEl = document.getElementById('ammo-value');\n    this.fragsEl = document.getElementById('frags-value');\n    this.crosshairEl = document.getElementById('crosshair');\n    this.hitmarkerEl = document.getElementById('hitmarker');\n    this.reloadEl = document.getElementById('reload-indicator');\n    \n    // Скрываем перезарядку - катане не нужна\n    if (this.reloadEl) {\n      this.reloadEl.style.display = 'none';\n    }\n    \n    // Создаём элементы для волн\n    this.waveEl = this.createWaveElement();\n    this.messageEl = this.createMessageElement();\n    this.damageOverlay = this.createDamageOverlay();\n    this.weaponEl = this.createWeaponElement();\n  }\n\n  /** Создать элемент волны */\n  private createWaveElement(): HTMLElement {\n    let el = document.getElementById('wave-indicator');\n    if (!el) {\n      el = document.createElement('div');\n      el.id = 'wave-indicator';\n      el.style.cssText = `\n        position: fixed;\n        top: 15%;\n        left: 50%;\n        transform: translateX(-50%) scale(0.9);\n        font-family: 'Orbitron', sans-serif;\n        font-size: 28px;\n        font-weight: 700;\n        color: #00ffff;\n        text-shadow: \n          0 0 10px #00ffff,\n          0 0 20px rgba(0, 255, 255, 0.5);\n        opacity: 0;\n        padding: 12px 30px;\n        border: 2px solid rgba(255, 0, 255, 0.6);\n        border-radius: 4px;\n        box-shadow: \n          0 0 15px rgba(255, 0, 255, 0.3),\n          inset 0 0 20px rgba(0, 255, 255, 0.05);\n        background: linear-gradient(180deg, \n          rgba(0, 0, 20, 0.85) 0%,\n          rgba(10, 0, 30, 0.9) 100%\n        );\n        backdrop-filter: blur(5px);\n        transition: opacity 0.2s, transform 0.2s;\n        pointer-events: none;\n        z-index: 1000;\n        letter-spacing: 4px;\n      `;\n      \n      // Тонкие угловые акценты\n      const corners = ['top-left', 'top-right', 'bottom-left', 'bottom-right'];\n      corners.forEach(corner => {\n        const cornerEl = document.createElement('div');\n        const [v, h] = corner.split('-');\n        cornerEl.style.cssText = `\n          position: absolute;\n          ${v}: -2px;\n          ${h}: -2px;\n          width: 12px;\n          height: 12px;\n          border-${v}: 2px solid #00ffff;\n          border-${h}: 2px solid #00ffff;\n        `;\n        el!.appendChild(cornerEl);\n      });\n      \n      document.body.appendChild(el);\n    }\n    return el;\n  }\n\n  /** Создать элемент сообщений */\n  private createMessageElement(): HTMLElement {\n    let el = document.getElementById('game-message');\n    if (!el) {\n      el = document.createElement('div');\n      el.id = 'game-message';\n      el.style.cssText = `\n        position: fixed;\n        top: 50%;\n        left: 50%;\n        transform: translate(-50%, -50%);\n        font-family: 'Orbitron', sans-serif;\n        font-size: 36px;\n        font-weight: 700;\n        color: #ff0044;\n        text-shadow: \n          0 0 15px #ff0044,\n          0 0 30px rgba(255, 0, 68, 0.4);\n        opacity: 0;\n        padding: 25px 50px;\n        border: 2px solid rgba(255, 0, 68, 0.7);\n        border-radius: 4px;\n        box-shadow: \n          0 0 20px rgba(255, 0, 68, 0.4),\n          inset 0 0 30px rgba(255, 0, 68, 0.05);\n        background: linear-gradient(180deg, \n          rgba(20, 0, 5, 0.9) 0%,\n          rgba(30, 0, 10, 0.95) 100%\n        );\n        backdrop-filter: blur(5px);\n        transition: opacity 0.4s;\n        pointer-events: none;\n        text-align: center;\n        z-index: 1000;\n        letter-spacing: 4px;\n      `;\n      \n      // Угловые декорации\n      const corners = ['top-left', 'top-right', 'bottom-left', 'bottom-right'];\n      corners.forEach(corner => {\n        const cornerEl = document.createElement('div');\n        const [v, h] = corner.split('-');\n        cornerEl.style.cssText = `\n          position: absolute;\n          ${v}: -2px;\n          ${h}: -2px;\n          width: 15px;\n          height: 15px;\n          border-${v}: 2px solid #ff0044;\n          border-${h}: 2px solid #ff0044;\n        `;\n        el!.appendChild(cornerEl);\n      });\n      \n      document.body.appendChild(el);\n    }\n    return el;\n  }\n\n  /** Создать оверлей урона */\n  private createDamageOverlay(): HTMLElement {\n    let el = document.getElementById('damage-overlay');\n    if (!el) {\n      el = document.createElement('div');\n      el.id = 'damage-overlay';\n      el.style.cssText = `\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: radial-gradient(circle, \n          rgba(0, 255, 0, 0.3) 0%,\n          rgba(50, 255, 50, 0.4) 30%,\n          rgba(0, 150, 0, 0.5) 70%,\n          rgba(0, 100, 0, 0.6) 100%\n        );\n        opacity: 0;\n        transition: opacity 0.15s;\n        pointer-events: none;\n        z-index: 999;\n      `;\n      document.body.appendChild(el);\n    }\n    return el;\n  }\n\n  /** Создать элемент оружия */\n  private createWeaponElement(): HTMLElement {\n    let el = document.getElementById('weapon-indicator');\n    if (!el) {\n      el = document.createElement('div');\n      el.id = 'weapon-indicator';\n      el.style.cssText = `\n        position: fixed;\n        bottom: 90px;\n        right: 20px;\n        font-family: 'Orbitron', sans-serif;\n        font-size: 16px;\n        font-weight: 700;\n        color: #00ffff;\n        text-shadow: 0 0 10px currentColor;\n        padding: 8px 15px;\n        border: 1px solid rgba(0, 255, 255, 0.5);\n        border-radius: 4px;\n        background: rgba(0, 0, 0, 0.6);\n        z-index: 100;\n      `;\n      el.textContent = '⚔️ КАТАНА';\n      document.body.appendChild(el);\n    }\n    return el;\n  }\n\n  /** Обновить индикатор оружия */\n  public updateWeapon(weapon: 'katana' | 'axe', charges?: number): void {\n    if (this.weaponEl) {\n      if (weapon === 'katana') {\n        this.weaponEl.textContent = '⚔️ КАТАНА';\n        this.weaponEl.style.color = '#00ffff';\n        this.weaponEl.style.borderColor = 'rgba(0, 255, 255, 0.5)';\n      } else {\n        this.weaponEl.textContent = `🪓 ТОПОР (${charges})`;\n        this.weaponEl.style.color = '#ff8800';\n        this.weaponEl.style.borderColor = 'rgba(255, 136, 0, 0.5)';\n        \n        // Мигание при малом количестве зарядов\n        if (charges !== undefined && charges <= 2) {\n          this.weaponEl.style.animation = 'pulse 0.5s infinite';\n        } else {\n          this.weaponEl.style.animation = 'none';\n        }\n      }\n    }\n  }\n\n  /** Оверлей замедления */\n  private slowOverlay: HTMLElement | null = null;\n\n  /** Показать урон с определённым цветом */\n  public showDamage(color: 'green' | 'purple' = 'green'): void {\n    if (this.damageOverlay) {\n      if (color === 'purple') {\n        // Фиолетовый для фантома + ЗАМЕДЛЕНИЕ\n        this.damageOverlay.style.background = `radial-gradient(circle, \n          rgba(100, 0, 150, 0.3) 0%,\n          rgba(80, 0, 120, 0.4) 30%,\n          rgba(50, 0, 80, 0.5) 70%,\n          rgba(30, 0, 50, 0.6) 100%\n        )`;\n        // Показываем оверлей замедления\n        this.showSlowdown(2.0);\n      } else {\n        // Зелёный для бейнлинга\n        this.damageOverlay.style.background = `radial-gradient(circle, \n          rgba(0, 255, 0, 0.3) 0%,\n          rgba(50, 255, 50, 0.4) 30%,\n          rgba(0, 150, 0, 0.5) 70%,\n          rgba(0, 100, 0, 0.6) 100%\n        )`;\n      }\n      this.damageOverlay.style.opacity = '1';\n      setTimeout(() => {\n        if (this.damageOverlay) this.damageOverlay.style.opacity = '0';\n      }, 150);\n    }\n  }\n\n  /** Показать эффект замедления */\n  public showSlowdown(duration: number): void {\n    if (!this.slowOverlay) {\n      this.slowOverlay = document.createElement('div');\n      this.slowOverlay.id = 'slow-overlay';\n      this.slowOverlay.style.cssText = `\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: radial-gradient(circle,\n          transparent 0%,\n          rgba(50, 0, 80, 0.2) 50%,\n          rgba(30, 0, 60, 0.4) 100%\n        );\n        pointer-events: none;\n        z-index: 998;\n        opacity: 0;\n        transition: opacity 0.3s;\n      `;\n      document.body.appendChild(this.slowOverlay);\n    }\n\n    this.slowOverlay.style.opacity = '1';\n    \n    // Эффект пульсации\n    this.slowOverlay.animate([\n      { filter: 'hue-rotate(0deg) brightness(1)' },\n      { filter: 'hue-rotate(20deg) brightness(1.1)' },\n      { filter: 'hue-rotate(0deg) brightness(1)' }\n    ], {\n      duration: 500,\n      iterations: Math.ceil(duration * 2)\n    });\n\n    setTimeout(() => {\n      if (this.slowOverlay) {\n        this.slowOverlay.style.opacity = '0';\n      }\n    }, duration * 1000);\n  }\n\n  /** Обновить здоровье */\n  public updateHealth(health: number, maxHealth: number): void {\n    if (this.healthEl) {\n      this.healthEl.textContent = Math.floor(health).toString();\n      \n      const ratio = health / maxHealth;\n      if (ratio > 0.5) {\n        this.healthEl.style.color = '#00ffaa';\n      } else if (ratio > 0.25) {\n        this.healthEl.style.color = '#ffaa00';\n      } else {\n        this.healthEl.style.color = '#ff4444';\n      }\n    }\n  }\n\n  /** Обновить заряды сплеш-волны */\n  public updateSplashCharges(charges: number): void {\n    if (!this.splashChargesEl) {\n      this.createSplashChargesElement();\n    }\n    \n    if (this.splashChargesEl) {\n      if (charges > 0) {\n        this.splashChargesEl.style.display = 'block';\n        this.splashChargesEl.innerHTML = `⚡ ВОЛНА: ${'●'.repeat(charges)}${'○'.repeat(3 - charges)}`;\n        this.splashChargesEl.style.color = '#00ffff';\n        this.splashChargesEl.style.textShadow = '0 0 10px #00ffff, 0 0 20px #00ffff';\n      } else {\n        this.splashChargesEl.style.display = 'none';\n      }\n    }\n  }\n\n  /** Создать элемент зарядов */\n  private splashChargesEl: HTMLElement | null = null;\n  \n  /** Элемент кулдауна двойного прыжка */\n  private doubleJumpEl: HTMLElement | null = null;\n  \n  private createSplashChargesElement(): void {\n    this.splashChargesEl = document.createElement('div');\n    this.splashChargesEl.style.cssText = `\n      position: fixed;\n      bottom: 80px;\n      right: 20px;\n      font-family: 'Orbitron', 'Audiowide', monospace;\n      font-size: 18px;\n      color: #00ffff;\n      text-shadow: 0 0 10px #00ffff;\n      letter-spacing: 2px;\n      display: none;\n      z-index: 1000;\n    `;\n    document.body.appendChild(this.splashChargesEl);\n  }\n\n  /** Обновить индикатор двойного прыжка */\n  public updateDoubleJump(cooldown: number, isReady: boolean): void {\n    if (!this.doubleJumpEl) {\n      this.createDoubleJumpElement();\n    }\n    \n    if (this.doubleJumpEl) {\n      if (isReady) {\n        this.doubleJumpEl.innerHTML = '⬆️⬆️ ГОТОВ';\n        this.doubleJumpEl.style.color = '#00ff88';\n        this.doubleJumpEl.style.textShadow = '0 0 10px #00ff88';\n      } else {\n        const cd = Math.ceil(cooldown * 10) / 10;\n        this.doubleJumpEl.innerHTML = `⬆️⬆️ ${cd.toFixed(1)}s`;\n        this.doubleJumpEl.style.color = '#ff8800';\n        this.doubleJumpEl.style.textShadow = '0 0 10px #ff8800';\n      }\n    }\n  }\n\n  private createDoubleJumpElement(): void {\n    this.doubleJumpEl = document.createElement('div');\n    this.doubleJumpEl.style.cssText = `\n      position: fixed;\n      bottom: 120px;\n      left: 20px;\n      font-family: 'Orbitron', 'Audiowide', monospace;\n      font-size: 16px;\n      color: #00ff88;\n      text-shadow: 0 0 10px #00ff88;\n      letter-spacing: 2px;\n      z-index: 1000;\n    `;\n    document.body.appendChild(this.doubleJumpEl);\n  }\n\n  /** Обновить врагов */\n  public updateAmmo(_wave: number, enemiesLeft: number): void {\n    if (this.ammoEl) {\n      this.ammoEl.textContent = `⚔️ ${enemiesLeft}`;\n      this.ammoEl.style.color = enemiesLeft > 0 ? '#00ffff' : '#00ff00';\n    }\n  }\n\n  /** Обновить счёт */\n  public updateFrags(frags: number): void {\n    if (this.fragsEl) {\n      this.fragsEl.textContent = frags.toString();\n    }\n  }\n\n  /** Показать волну */\n  public showWave(wave: number): void {\n    if (this.waveEl) {\n      this.waveEl.textContent = `ВОЛНА ${wave}`;\n      this.waveEl.style.opacity = '1';\n      this.waveEl.style.transform = 'translateX(-50%) scale(1)';\n      this.waveEl.style.color = '#00ffff';\n      this.waveEl.style.borderColor = 'rgba(255, 0, 255, 0.6)';\n      \n      // Плавное появление сверху\n      this.waveEl.animate([\n        { transform: 'translateX(-50%) translateY(-20px) scale(0.9)', opacity: 0 },\n        { transform: 'translateX(-50%) translateY(0) scale(1)', opacity: 1 }\n      ], { duration: 300, easing: 'ease-out' });\n      \n      setTimeout(() => {\n        if (this.waveEl) {\n          this.waveEl.animate([\n            { opacity: 1 },\n            { opacity: 0 }\n          ], { duration: 250, easing: 'ease-in' });\n          setTimeout(() => {\n            if (this.waveEl) this.waveEl.style.opacity = '0';\n          }, 230);\n        }\n      }, 1500);\n    }\n  }\n\n  /** Показать завершение волны */\n  public showWaveComplete(wave: number): void {\n    if (this.waveEl) {\n      this.waveEl.textContent = `✓ ВОЛНА ${wave}`;\n      this.waveEl.style.color = '#00ff88';\n      this.waveEl.style.borderColor = 'rgba(0, 255, 136, 0.6)';\n      this.waveEl.style.opacity = '1';\n      this.waveEl.style.transform = 'translateX(-50%) scale(1)';\n      \n      // Мягкая победная анимация\n      this.waveEl.animate([\n        { transform: 'translateX(-50%) scale(0.95)', opacity: 0 },\n        { transform: 'translateX(-50%) scale(1.02)', opacity: 1 },\n        { transform: 'translateX(-50%) scale(1)', opacity: 1 }\n      ], { duration: 350, easing: 'ease-out' });\n      \n      // Показать \"пройдена\" потом \"готовься\"\n      setTimeout(() => {\n        if (this.waveEl) {\n          this.waveEl.textContent = `ГОТОВЬСЯ...`;\n          this.waveEl.style.color = '#ffaa00';\n          this.waveEl.style.borderColor = 'rgba(255, 170, 0, 0.5)';\n        }\n      }, 1200);\n      \n      setTimeout(() => {\n        if (this.waveEl) {\n          this.waveEl.style.opacity = '0';\n          this.waveEl.style.color = '#00ffff';\n          this.waveEl.style.borderColor = 'rgba(255, 0, 255, 0.6)';\n        }\n      }, 3500);\n    }\n  }\n\n  /** Показать Game Over */\n  public showGameOver(score: number, wave: number): void {\n    if (this.messageEl) {\n      this.messageEl.innerHTML = `\n        ☠ GAME OVER ☠<br>\n        <div style=\"\n          font-size: 24px; \n          color: #00ffff; \n          margin-top: 20px;\n          text-shadow: 0 0 10px #00ffff;\n          letter-spacing: 3px;\n        \">\n          СЧЁТ: <span style=\"color: #ff00ff;\">${score}</span><br>\n          ВОЛНА: <span style=\"color: #ff00ff;\">${wave}</span>\n        </div>\n      `;\n      this.messageEl.style.opacity = '1';\n      \n      // Драматичная анимация\n      this.messageEl.animate([\n        { transform: 'translate(-50%, -50%) scale(0.5)', opacity: 0 },\n        { transform: 'translate(-50%, -50%) scale(1.2)', opacity: 1 },\n        { transform: 'translate(-50%, -50%) scale(1)', opacity: 1 }\n      ], { duration: 600, easing: 'cubic-bezier(0.34, 1.56, 0.64, 1)' });\n      \n      setTimeout(() => {\n        if (this.messageEl) {\n          this.messageEl.animate([\n            { opacity: 1 },\n            { opacity: 0 }\n          ], { duration: 400 });\n          setTimeout(() => {\n            if (this.messageEl) this.messageEl.style.opacity = '0';\n          }, 380);\n        }\n      }, 2500);\n    }\n  }\n\n  /** Показать индикатор перезарядки - не используется для катаны */\n  public showReloading(_show: boolean): void {\n    // Катане не нужна перезарядка\n  }\n\n  /** Расширить прицел */\n  public expandCrosshair(): void {\n    if (this.crosshairEl) {\n      this.crosshairEl.classList.add('shooting');\n      setTimeout(() => {\n        this.crosshairEl?.classList.remove('shooting');\n      }, 100);\n    }\n  }\n\n  /** Показать хитмаркер */\n  public showHitmarker(isKill: boolean = false): void {\n    if (this.hitmarkerEl) {\n      this.hitmarkerEl.className = 'hitmarker active';\n      if (isKill) {\n        this.hitmarkerEl.classList.add('kill');\n      }\n      \n      setTimeout(() => {\n        this.hitmarkerEl?.classList.remove('active', 'kill');\n      }, 150);\n    }\n  }\n\n  /** Эффект урона (алиас) */\n  public showDamageEffect(): void {\n    this.showDamage('green');\n  }\n\n  /** Показать сообщение */\n  public showMessage(text: string, color: string = 'white'): void {\n    const msg = document.createElement('div');\n    msg.style.cssText = `\n      position: fixed;\n      top: 30%;\n      left: 50%;\n      transform: translateX(-50%);\n      font-family: 'Orbitron', sans-serif;\n      font-size: 24px;\n      color: ${color};\n      text-shadow: 0 0 10px ${color}, 0 0 20px ${color};\n      pointer-events: none;\n      z-index: 1100;\n      opacity: 1;\n      animation: messageFloat 1s ease-out forwards;\n    `;\n    msg.textContent = text;\n    document.body.appendChild(msg);\n\n    // Добавляем стиль анимации если его нет\n    if (!document.getElementById('message-anim-style')) {\n      const style = document.createElement('style');\n      style.id = 'message-anim-style';\n      style.textContent = `\n        @keyframes messageFloat {\n          0% { opacity: 1; transform: translateX(-50%) translateY(0); }\n          100% { opacity: 0; transform: translateX(-50%) translateY(-50px); }\n        }\n      `;\n      document.head.appendChild(style);\n    }\n\n    setTimeout(() => msg.remove(), 1000);\n  }\n\n  /** Показать оверлей буйства */\n  private rageOverlay: HTMLElement | null = null;\n\n  /** HP бар босса */\n  private bossHealthBar: HTMLElement | null = null;\n  private bossHealthFill: HTMLElement | null = null;\n  private bossNameEl: HTMLElement | null = null;\n\n  public showRageOverlay(duration: number): void {\n    if (!this.rageOverlay) {\n      this.rageOverlay = document.createElement('div');\n      this.rageOverlay.id = 'rage-overlay';\n      this.rageOverlay.style.cssText = `\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: radial-gradient(circle,\n          transparent 0%,\n          rgba(255, 50, 0, 0.15) 50%,\n          rgba(255, 0, 0, 0.3) 100%\n        );\n        pointer-events: none;\n        z-index: 997;\n        opacity: 0;\n        transition: opacity 0.3s;\n      `;\n      document.body.appendChild(this.rageOverlay);\n    }\n\n    this.rageOverlay.style.opacity = '1';\n    \n    this.rageOverlay.animate([\n      { filter: 'hue-rotate(0deg) brightness(1)' },\n      { filter: 'hue-rotate(-20deg) brightness(1.2)' },\n      { filter: 'hue-rotate(0deg) brightness(1)' }\n    ], {\n      duration: 300,\n      iterations: Math.ceil(duration * 3)\n    });\n\n    setTimeout(() => {\n      if (this.rageOverlay) {\n        this.rageOverlay.style.opacity = '0';\n      }\n    }, duration * 1000);\n  }\n\n  /** Показать HP босса */\n  public showBossHealth(hp: number, maxHp: number, bossType: string): void {\n    if (!this.bossHealthBar) {\n      // Создаём контейнер\n      this.bossHealthBar = document.createElement('div');\n      this.bossHealthBar.style.cssText = `\n        position: fixed;\n        top: 50px;\n        left: 50%;\n        transform: translateX(-50%);\n        width: 400px;\n        padding: 10px;\n        background: rgba(0, 0, 0, 0.7);\n        border: 2px solid #ff0000;\n        border-radius: 8px;\n        z-index: 1100;\n        text-align: center;\n        font-family: 'Orbitron', sans-serif;\n        box-shadow: 0 0 20px rgba(255, 0, 0, 0.5);\n      `;\n      \n      // Имя босса\n      this.bossNameEl = document.createElement('div');\n      this.bossNameEl.style.cssText = `\n        color: #ff4444;\n        font-size: 16px;\n        text-shadow: 0 0 10px #ff0000;\n        margin-bottom: 8px;\n        text-transform: uppercase;\n        letter-spacing: 3px;\n      `;\n      this.bossHealthBar.appendChild(this.bossNameEl);\n      \n      // Полоска HP\n      const barContainer = document.createElement('div');\n      barContainer.style.cssText = `\n        width: 100%;\n        height: 20px;\n        background: #333;\n        border-radius: 10px;\n        overflow: hidden;\n        border: 1px solid #666;\n      `;\n      \n      this.bossHealthFill = document.createElement('div');\n      this.bossHealthFill.style.cssText = `\n        height: 100%;\n        transition: width 0.3s ease-out;\n        border-radius: 10px;\n      `;\n      barContainer.appendChild(this.bossHealthFill);\n      this.bossHealthBar.appendChild(barContainer);\n      \n      document.body.appendChild(this.bossHealthBar);\n    }\n\n    // Имя и цвет\n    let bossName = 'БОСС';\n    let barColor = '#ff0000';\n    \n    if (bossType === 'boss_green') {\n      bossName = '☠️ ТОКСИЧНЫЙ ГИГАНТ ☠️';\n      barColor = 'linear-gradient(90deg, #00ff00, #88ff00)';\n      this.bossHealthBar.style.borderColor = '#00ff00';\n      this.bossHealthBar.style.boxShadow = '0 0 20px rgba(0, 255, 0, 0.5)';\n    } else if (bossType === 'boss_black') {\n      bossName = '🌀 ВЛАДЫКА ПУСТОТЫ 🌀';\n      barColor = 'linear-gradient(90deg, #4400aa, #8800ff)';\n      this.bossHealthBar.style.borderColor = '#8800ff';\n      this.bossHealthBar.style.boxShadow = '0 0 20px rgba(136, 0, 255, 0.5)';\n    } else if (bossType === 'boss_blue') {\n      bossName = '⚡ ФАНТОМ ХАОСА ⚡';\n      barColor = 'linear-gradient(90deg, #0088ff, #00ffff)';\n      this.bossHealthBar.style.borderColor = '#00ffff';\n      this.bossHealthBar.style.boxShadow = '0 0 20px rgba(0, 255, 255, 0.5)';\n    }\n    \n    if (this.bossNameEl) {\n      this.bossNameEl.textContent = bossName;\n    }\n    \n    if (this.bossHealthFill) {\n      const percent = (hp / maxHp) * 100;\n      this.bossHealthFill.style.width = percent + '%';\n      this.bossHealthFill.style.background = barColor;\n    }\n    \n    this.bossHealthBar.style.display = 'block';\n  }\n\n  /** Скрыть HP босса */\n  public hideBossHealth(): void {\n    if (this.bossHealthBar) {\n      this.bossHealthBar.style.display = 'none';\n    }\n  }\n}\n","import type { Vec3, ICollisionSystem } from '@/types';\n\n/**\n * Система коллизий для круглой арены с бассейнами\n * Исправленная версия с правильными лестницами и защитой от падения в воду\n */\nexport class CollisionSystem implements ICollisionSystem {\n  /** Радиус игрока */\n  private playerRadius = 0.4;\n\n  // Размеры круглой арены\n  private arenaRadius = 28.0;\n  \n  // Центральный бассейн\n  private poolRadius = 8.0;\n  \n  // Платформы (левая и правая)\n  private platformHeight = 2.0;\n  private platformX = 20.0;\n  \n  // Мосты\n  private bridgeWidth = 3.5;\n\n  /** Проверить коллизию в точке */\n  public checkCollision(pos: Vec3): boolean {\n    const r = this.playerRadius;\n\n    // Круглые стены арены\n    const distFromCenter = Math.sqrt(pos.x * pos.x + pos.z * pos.z);\n    if (distFromCenter > this.arenaRadius - r) return true;\n\n    // Центральная колонна (фонтан)\n    if (distFromCenter < 2.0 + r) return true;\n\n    // Колонны по периметру (4 основные)\n    const columnPositions = [\n      { x: 22, z: 0 },\n      { x: -22, z: 0 },\n      { x: 0, z: 22 },\n      { x: 0, z: -22 },\n    ];\n    \n    for (const col of columnPositions) {\n      const dx = pos.x - col.x;\n      const dz = pos.z - col.z;\n      if (Math.sqrt(dx * dx + dz * dz) < 0.7 + r) return true;\n    }\n\n    // Бортики центрального бассейна - нельзя войти в воду!\n    const onBridgeX = Math.abs(pos.z) < this.bridgeWidth / 2;\n    const onBridgeZ = Math.abs(pos.x) < this.bridgeWidth / 2;\n    const onBridge = onBridgeX || onBridgeZ;\n    \n    // Если не на мосту и пытаемся войти в бассейн - блокируем\n    if (!onBridge && distFromCenter > 2.0 && distFromCenter < this.poolRadius + r) {\n      return true;\n    }\n\n    // Края платформ (перила)\n    // Левая платформа\n    if (pos.x < -this.platformX + 3.5 && pos.x > -this.platformX - 3.5 &&\n        Math.abs(pos.z) < 6.5 && pos.y > this.platformHeight - 0.5) {\n      // Перила на краю\n      if (pos.x > -this.platformX + 2.8 && Math.abs(pos.z) < 6.0) {\n        return true;\n      }\n    }\n    \n    // Правая платформа\n    if (pos.x > this.platformX - 3.5 && pos.x < this.platformX + 3.5 &&\n        Math.abs(pos.z) < 6.5 && pos.y > this.platformHeight - 0.5) {\n      if (pos.x < this.platformX - 2.8 && Math.abs(pos.z) < 6.0) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  /** Получить высоту пола в точке */\n  public getFloorHeight(pos: Vec3): number {\n    const distFromCenter = Math.sqrt(pos.x * pos.x + pos.z * pos.z);\n\n    // === МОСТЫ (приоритет - они над бассейном) ===\n    const onBridgeX = Math.abs(pos.z) < this.bridgeWidth / 2 && \n                      Math.abs(pos.x) < this.poolRadius + 1;\n    const onBridgeZ = Math.abs(pos.x) < this.bridgeWidth / 2 && \n                      Math.abs(pos.z) < this.poolRadius + 1;\n    \n    if ((onBridgeX || onBridgeZ) && distFromCenter > 2.0) {\n      return 0.3; // Высота моста\n    }\n\n    // === ЛЕВАЯ ПЛАТФОРМА И ЛЕСТНИЦА ===\n    // Лестница идёт от X=-16 до X=-17 (справа от платформы)\n    const leftStairStartX = -16.0; // Начало лестницы (низ)\n    const leftStairEndX = -17.0;   // Конец лестницы (верх платформы)\n    const leftPlatformEnd = -23.0;\n    \n    if (Math.abs(pos.z) < 3.0) {\n      // На лестнице\n      if (pos.x >= leftStairEndX && pos.x <= leftStairStartX) {\n        const progress = (leftStairStartX - pos.x) / (leftStairStartX - leftStairEndX);\n        return progress * this.platformHeight;\n      }\n      // На платформе\n      if (pos.x < leftStairEndX && pos.x > leftPlatformEnd) {\n        return this.platformHeight;\n      }\n    }\n\n    // === ПРАВАЯ ПЛАТФОРМА И ЛЕСТНИЦА ===\n    const rightStairStartX = 16.0; // Начало лестницы (низ)\n    const rightStairEndX = 17.0;   // Конец лестницы (верх)\n    const rightPlatformEnd = 23.0;\n    \n    if (Math.abs(pos.z) < 3.0) {\n      // На лестнице\n      if (pos.x >= rightStairStartX && pos.x <= rightStairEndX) {\n        const progress = (pos.x - rightStairStartX) / (rightStairEndX - rightStairStartX);\n        return progress * this.platformHeight;\n      }\n      // На платформе\n      if (pos.x > rightStairEndX && pos.x < rightPlatformEnd) {\n        return this.platformHeight;\n      }\n    }\n\n    // === ВЕРХНИЙ БАЛКОН (Z = -24, высота 12) - требует двойной прыжок ===\n    const balconyHeight = 12.0;\n    \n    // Платформа 1 (высота 3) - первый прыжок\n    if (pos.x >= -8.0 && pos.x <= -5.0 && pos.z >= -26 && pos.z <= -22) {\n      return 3.0;\n    }\n    \n    // Платформа 2 (высота 6) - нужен двойной прыжок\n    if (pos.x >= -4.0 && pos.x <= -1.0 && pos.z >= -26 && pos.z <= -22) {\n      return 6.0;\n    }\n    \n    // Платформа 3 (высота 9) - нужен двойной прыжок\n    if (pos.x >= 0.0 && pos.x <= 3.0 && pos.z >= -26 && pos.z <= -22) {\n      return 9.0;\n    }\n    \n    // Сам балкон (высота 12) - нужен двойной прыжок\n    if (pos.x >= -4.0 && pos.x <= 4.0 && pos.z >= -26 && pos.z <= -20) {\n      return balconyHeight;\n    }\n\n    // Основной пол\n    return 0.0;\n  }\n\n  /** Получить высоту потолка */\n  public getCeilingHeight(_pos: Vec3): number {\n    return 18.0; // Выше балкона (12м)\n  }\n}\n","import type { GameState, GameConfig } from '@/types';\nimport { GameLoop } from './GameLoop';\nimport { Input } from './Input';\nimport { Player } from '@/player/Player';\nimport { Weapon } from '@/weapon/Weapon';\nimport { WeaponRenderer } from '@/weapon/WeaponRenderer';\nimport { TargetManager } from '@/enemies/Target';\nimport { PickupManager } from '@/items/Pickup';\nimport { AudioManager } from '@/audio/AudioManager';\nimport { WebGLRenderer } from '@/render/WebGLRenderer';\nimport { HUD } from '@/render/HUD';\nimport { CollisionSystem } from '@/world/Collision';\nimport { vec3 } from '@/utils/math';\n\n/** Конфигурация по умолчанию */\nconst DEFAULT_CONFIG: GameConfig = {\n  width: 1280,\n  height: 720,\n  renderScale: 0.4,\n  movement: {\n    walkSpeed: 9.0,\n    runSpeed: 16.0,\n    jumpForce: 8.0,\n    gravity: 25.0,\n    groundFriction: 12.0,\n    airControl: 0.3,\n    mouseSensitivity: 0.002,\n  },\n  weapon: {\n    name: 'Katana',\n    damage: 100,\n    fireRate: 2.5,\n    magazineSize: 999,\n    reloadTime: 0,\n    spread: 0,\n    automatic: false,\n  },\n};\n\n/**\n * Samurai Pool Arena\n * Руби врагов катаной пока они не долетели до тебя!\n */\nexport class Game {\n  // === СОСТОЯНИЕ ===\n  public state: GameState = {\n    isRunning: false,\n    isPaused: false,\n    frags: 0,\n    gameTime: 0,\n    soundEnabled: true,\n  };\n\n  // === КОНФИГУРАЦИЯ ===\n  public config: GameConfig;\n\n  // === СИСТЕМЫ ===\n  private gameLoop: GameLoop;\n  private input: Input;\n  private player: Player;\n  private weapon: Weapon;\n  private weaponRenderer: WeaponRenderer;\n  private targetManager: TargetManager;\n  private pickupManager: PickupManager;\n  private audio: AudioManager;\n  private renderer: WebGLRenderer;\n  private hud: HUD;\n  private collision: CollisionSystem;\n\n  // === CANVAS ===\n  private weaponCanvas: HTMLCanvasElement;\n\n  // === UI ===\n  private startScreen: HTMLElement | null;\n\n  // === ВРЕМЯ ===\n  private gameTime = 0;\n\n  // === СОСТОЯНИЕ ===\n  private footstepTimer = 0;\n  private wasGrounded = true;\n  private screenShake = 0;\n  private lastSliceTime = 0;\n  private wasJumpPressed = false;\n  \n  /** Текущая эпоха (1-3) для атмосферы */\n  private currentEra = 1;\n\n  /** Система комбо-убийств для адреналина */\n  private killTimes: number[] = [];\n  private readonly COMBO_WINDOW = 9.0; // 9 секунд\n  private readonly COMBO_KILLS_NEEDED = 3; // 3 убийства для адреналина\n\n  constructor(\n    canvas: HTMLCanvasElement,\n    weaponCanvas: HTMLCanvasElement,\n    config: Partial<GameConfig> = {}\n  ) {\n    this.weaponCanvas = weaponCanvas;\n    this.config = { ...DEFAULT_CONFIG, ...config };\n\n    // Инициализируем системы\n    this.collision = new CollisionSystem();\n    this.input = new Input(canvas);\n    this.audio = new AudioManager();\n    this.hud = new HUD();\n\n    // Игрок на мосту (безопасная позиция)\n    this.player = new Player(\n      vec3(0, 1.7, 12),\n      this.config.movement,\n      this.collision\n    );\n\n    // Катана\n    this.weapon = new Weapon();\n    this.weapon.onSlice = () => this.onKatanaSlice();\n\n    // Рендереры\n    this.renderer = new WebGLRenderer(canvas);\n    this.renderer.renderScale = this.config.renderScale;\n    this.weaponRenderer = new WeaponRenderer(weaponCanvas);\n\n    // Враги\n    this.targetManager = new TargetManager();\n    this.setupTargetCallbacks();\n\n    // Предметы\n    this.pickupManager = new PickupManager();\n\n    // Игровой цикл\n    this.gameLoop = new GameLoop(\n      (dt) => this.update(dt),\n      () => this.render()\n    );\n\n    // UI\n    this.startScreen = document.getElementById('click-to-start');\n\n    // Обработчики\n    this.setupEventHandlers();\n  }\n\n  /** Настройка callbacks для врагов */\n  private setupTargetCallbacks(): void {\n    this.targetManager.onTargetDestroyed = (target) => {\n      this.state.frags++;\n      this.audio.playSFX('kill');\n      this.hud.showHitmarker(true);\n      \n      // Шанс выпадения предмета\n      this.pickupManager.spawnAfterKill(target.position);\n      \n      // === СИСТЕМА КОМБО ДЛЯ АДРЕНАЛИНА ===\n      // Добавляем время убийства\n      this.killTimes.push(this.gameTime);\n      \n      // Удаляем старые убийства (старше 9 секунд)\n      this.killTimes = this.killTimes.filter(t => this.gameTime - t < this.COMBO_WINDOW);\n      \n      // Проверяем комбо (3 убийства за 9 секунд)\n      if (this.killTimes.length >= this.COMBO_KILLS_NEEDED && !this.player.rageMode) {\n        this.activateComboAdrenaline();\n      }\n      \n      // Показываем прогресс комбо\n      if (this.killTimes.length > 0 && this.killTimes.length < this.COMBO_KILLS_NEEDED) {\n        this.hud.showMessage(`🔥 КОМБО ${this.killTimes.length}/${this.COMBO_KILLS_NEEDED}`, 'orange');\n      }\n      \n      // Сообщение при убийстве босса\n      if (target.isBoss) {\n        this.hud.showMessage('💀 БОСС ПОВЕРЖЕН! 💀', 'gold');\n        // Босс роняет много аптечек\n        for (let i = 0; i < 3; i++) {\n          this.pickupManager.spawnAfterKill(target.position);\n        }\n      }\n    };\n\n    this.targetManager.onPlayerHit = (target) => {\n      // Урон игроку (зависит от типа врага)\n      this.player.takeDamage(target.damage);\n      \n      // Разные эффекты для разных врагов\n      switch (target.enemyType) {\n        case 'phantom':\n          this.audio.playSFX('phantom_pass');\n          this.screenShake = 0.3;\n          this.hud.showDamage('purple');\n          this.slowdownFactor = 0.3;\n          this.slowdownTimer = 2.0;\n          break;\n        case 'runner':\n          this.audio.playSFX('runner_hit');\n          this.screenShake = 0.4;\n          this.hud.showDamage('green');\n          break;\n        case 'hopper':\n          this.audio.playSFX('hopper_hit');\n          this.screenShake = 0.6;\n          this.hud.showDamage('green');\n          break;\n        case 'boss_green':\n          this.audio.playSFX('kill');\n          this.screenShake = 1.0; // Очень сильная тряска\n          this.hud.showDamage('green');\n          this.hud.showMessage('💀 ТОКСИЧНЫЙ УДАР!', 'lime');\n          break;\n        case 'boss_black':\n          this.audio.playSFX('phantom_pass');\n          this.screenShake = 0.8;\n          this.hud.showDamage('purple');\n          this.slowdownFactor = 0.2; // Сильное замедление!\n          this.slowdownTimer = 3.0;\n          this.hud.showMessage('🌀 ИСКРИВЛЕНИЕ!', 'purple');\n          break;\n        case 'boss_blue':\n          this.audio.playSFX('hopper_hit');\n          this.screenShake = 0.7;\n          this.hud.showDamage('purple');\n          this.hud.showMessage('⚡ ТЕЛЕПОРТ УДАР!', 'cyan');\n          break;\n        default:\n          this.audio.playSFX('hit');\n          this.screenShake = 0.5;\n          this.hud.showDamage('green');\n      }\n    };\n\n    this.targetManager.onWaveStart = (wave) => {\n      this.hud.showWave(wave);\n      \n      // Обновляем эпоху для музыки и атмосферы\n      this.audio.setEra(wave);\n      this.currentEra = wave > 10 ? 3 : wave > 5 ? 2 : 1;\n      \n      // Музыка и предупреждение о боссах\n      if (wave === 5) {\n        this.audio.setBossMusic('boss_green');\n        setTimeout(() => this.hud.showMessage('⚠️ ЗЕЛЁНЫЙ БОСС! ⚠️', 'lime'), 500);\n      } else if (wave === 10) {\n        this.audio.setBossMusic('boss_black');\n        setTimeout(() => this.hud.showMessage('☠️ ЧЁРНЫЙ БОСС! ☠️', 'purple'), 500);\n      } else if (wave === 15) {\n        this.audio.setBossMusic('boss_blue');\n        setTimeout(() => this.hud.showMessage('⚡ СИНИЙ БОСС! ⚡', 'cyan'), 500);\n      }\n      \n      // Сообщения о смене эпохи\n      if (wave === 6) {\n        setTimeout(() => this.hud.showMessage('🌀 ЗОНА ЧЁРНОЙ ДЫРЫ 🌀', 'purple'), 1000);\n      } else if (wave === 11) {\n        setTimeout(() => this.hud.showMessage('🚀 КОСМИЧЕСКАЯ ЗОНА 🚀', 'cyan'), 1000);\n      }\n    };\n\n    this.targetManager.onWaveComplete = (wave) => {\n      this.hud.showWaveComplete(wave);\n      \n      // Возврат к обычной музыке после босса\n      if (wave === 5 || wave === 10 || wave === 15) {\n        this.audio.setBossMusic(null);\n        // Обновляем эпоху после босса\n        this.audio.setEra(wave + 1);\n      }\n    };\n\n    // Урон от токсичных луж\n    this.targetManager.onPoolDamage = (damage) => {\n      this.player.takeDamage(damage);\n      this.hud.showDamage('green');\n      this.screenShake = 0.2;\n    };\n\n    // Смена фазы босса\n    this.targetManager.onBossPhaseChange = (bossType, phase) => {\n      if (bossType === 'boss_green' && phase === 2) {\n        // Зелёный босс перешёл во вторую фазу!\n        this.audio.setBossGreenPhase2();\n        this.hud.showMessage('☣️ ФАЗА 2: ЯРОСТЬ! ☣️', 'lime');\n        this.screenShake = 1.5; // Сильная тряска\n      }\n    };\n  }\n\n  /** Замедление от фантомов */\n  private slowdownFactor = 1.0;\n  private slowdownTimer = 0;\n\n  /** Настройка обработчиков событий */\n  private setupEventHandlers(): void {\n    // Обработчики слайдеров\n    const volumeSlider = document.getElementById('volume-slider') as HTMLInputElement;\n    const volumeValue = document.getElementById('volume-value');\n    const sensSlider = document.getElementById('sens-slider') as HTMLInputElement;\n    const sensValue = document.getElementById('sens-value');\n\n    volumeSlider?.addEventListener('input', (e) => {\n      e.stopPropagation(); // Не запускаем игру при клике на слайдер\n      const value = parseInt(volumeSlider.value);\n      if (volumeValue) volumeValue.textContent = `${value}%`;\n      this.audio.setVolume(value / 100);\n    });\n\n    sensSlider?.addEventListener('input', (e) => {\n      e.stopPropagation();\n      const value = parseInt(sensSlider.value);\n      if (sensValue) sensValue.textContent = `${value}%`;\n      // Чувствительность от 0.001 до 0.01\n      this.input.setSensitivity(0.001 + (value / 100) * 0.009);\n    });\n\n    // Предотвращаем запуск игры при клике на слайдеры и кнопки\n    document.getElementById('settings')?.addEventListener('click', (e) => {\n      e.stopPropagation();\n    });\n    document.getElementById('start-buttons')?.addEventListener('click', (e) => {\n      e.stopPropagation();\n    });\n\n    // Кнопка НАЧАТЬ\n    document.getElementById('btn-start')?.addEventListener('click', () => this.start());\n    \n    // Кнопки боссов\n    document.getElementById('btn-boss5')?.addEventListener('click', () => this.startFromWave(5));\n    document.getElementById('btn-boss10')?.addEventListener('click', () => this.startFromWave(10));\n    document.getElementById('btn-boss15')?.addEventListener('click', () => this.startFromWave(15));\n\n    // Клик по экрану тоже запускает\n    this.startScreen?.addEventListener('click', () => this.start());\n\n    document.addEventListener('keydown', (e) => {\n      if (e.code === 'KeyM') {\n        this.audio.toggleMute();\n      }\n      if (e.code === 'KeyF') {\n        this.toggleFullscreen();\n      }\n    });\n\n    window.addEventListener('resize', () => this.handleResize());\n  }\n\n  /** Запуск игры */\n  public start(): void {\n    this.startFromWave(1);\n  }\n\n  /** Запуск с определённой волны (для боссов) */\n  public startFromWave(wave: number): void {\n    if (this.state.isRunning) return;\n\n    // Читаем настройки\n    const volumeSlider = document.getElementById('volume-slider') as HTMLInputElement;\n    const sensSlider = document.getElementById('sens-slider') as HTMLInputElement;\n    \n    if (volumeSlider) {\n      this.audio.setVolume(parseInt(volumeSlider.value) / 100);\n    }\n    if (sensSlider) {\n      this.input.setSensitivity(0.001 + (parseInt(sensSlider.value) / 100) * 0.009);\n    }\n\n    if (this.startScreen) {\n      this.startScreen.style.display = 'none';\n    }\n\n    this.input.requestPointerLock();\n    this.audio.start();\n    this.gameLoop.start();\n    this.state.isRunning = true;\n\n    // Начинаем с указанной волны\n    this.targetManager.startGame(wave);\n    \n    // Сообщение о боссе\n    if (wave === 5) {\n      this.hud.showMessage('⚠️ ЗЕЛЁНЫЙ БОСС! ⚠️', 'lime');\n    } else if (wave === 10) {\n      this.hud.showMessage('☠️ ЧЁРНЫЙ БОСС! ☠️', 'purple');\n    } else if (wave === 15) {\n      this.hud.showMessage('⚡ СИНИЙ БОСС! ⚡', 'cyan');\n    }\n\n    this.handleResize();\n  }\n\n  /** Остановка игры */\n  public stop(): void {\n    this.gameLoop.stop();\n    this.state.isRunning = false;\n    this.input.exitPointerLock();\n  }\n\n  /** Обновление игры */\n  private update(dt: number): void {\n    if (this.state.isPaused) return;\n\n    this.gameTime += dt;\n\n    // Обновляем таймер замедления\n    if (this.slowdownTimer > 0) {\n      this.slowdownTimer -= dt;\n      if (this.slowdownTimer <= 0) {\n        this.slowdownFactor = 1.0;\n      }\n    }\n\n    // Обновляем игрока с учётом замедления\n    const effectiveDt = dt * this.slowdownFactor;\n    this.player.update(effectiveDt, this.input.state, {\n      x: this.input.mouseDelta.x * this.slowdownFactor,\n      y: this.input.mouseDelta.y * this.slowdownFactor\n    });\n    this.input.resetMouseDelta();\n\n    // Звуки движения\n    this.updateMovementSounds(dt);\n\n    // Обычная атака катаной (ЛКМ)\n    if (this.input.state.fire) {\n      if (this.weapon.tryAttack()) {\n        this.audio.playSFX('katana_swing');\n        this.checkNormalAttack();\n      }\n    }\n\n    // Сплеш-атака (ПКМ) - если есть заряды\n    if (this.input.state.altFire) {\n      if (this.weapon.trySplashAttack()) {\n        this.audio.playSFX('splash_wave');\n        this.checkSplashAttack();\n      }\n    }\n\n    // Обновляем катану\n    const isMoving = this.input.state.forward || this.input.state.backward ||\n                     this.input.state.left || this.input.state.right;\n    this.weapon.update(dt, isMoving, this.input.state.run);\n\n    // Синхронизируем анимацию с рендерером\n    this.weaponRenderer.isAttacking = this.weapon.isAttacking;\n    this.weaponRenderer.attackProgress = this.weapon.attackProgress;\n    this.weaponRenderer.isSplashAttack = this.weapon.isSplashAttack;\n    this.weaponRenderer.splashCharges = this.weapon.splashCharges;\n\n    // Обновляем врагов\n    const playerPos = this.player.getEyePosition();\n    this.targetManager.update(dt, playerPos, this.gameTime);\n\n    // Проверяем прицепившихся раннеров\n    this.checkAttachedRunners();\n\n    // Отслеживаем отпускание Space для двойного прыжка\n    if (!this.input.state.jump && this.wasJumpPressed) {\n      this.player.onJumpReleased();\n    }\n    this.wasJumpPressed = this.input.state.jump;\n\n    // Двойной прыжок для скидывания раннера\n    if (this.input.state.jump && !this.player.state.grounded) {\n      if (this.player.tryDoubleJump()) {\n        // Пробуем скинуть раннеров\n        this.detachRunners();\n        this.audio.playSFX('jump');\n      }\n    }\n\n    // Обновляем предметы\n    const pickedUp = this.pickupManager.update(dt, this.gameTime, playerPos);\n    if (pickedUp) {\n      this.onPickup(pickedUp);\n    }\n\n    // Звук приближения ближайшего врага\n    const closestDist = this.targetManager.getClosestEnemyDistance(playerPos);\n    if (closestDist < 15) {\n      const proximity = Math.max(0, 1 - closestDist / 15);\n      this.audio.updateProximitySound(proximity);\n    } else {\n      this.audio.updateProximitySound(0);\n    }\n\n    // Тряска экрана\n    if (this.screenShake > 0) {\n      this.screenShake -= dt * 2;\n    }\n\n    // Проверка смерти\n    if (this.player.isDead()) {\n      this.gameOver();\n    }\n\n    // Обновляем HUD\n    this.hud.updateHealth(this.player.state.health, this.player.state.maxHealth);\n    this.hud.updateAmmo(this.targetManager.wave, this.targetManager.getActiveCount());\n    this.hud.updateFrags(this.state.frags);\n    this.hud.updateSplashCharges(this.weapon.splashCharges);\n    this.hud.updateDoubleJump(this.player.getDoubleJumpCooldown(), this.player.isDoubleJumpReady());\n    \n    // Проверка низкого HP для тревожной музыки (меньше 30%)\n    const hpPercent = this.player.state.health / this.player.state.maxHealth;\n    this.audio.setLowHpMode(hpPercent < 0.3 && hpPercent > 0);\n    \n    // Показываем HP босса если есть\n    const boss = this.targetManager.getActiveBoss();\n    if (boss) {\n      this.hud.showBossHealth(boss.hp, boss.maxHp, boss.enemyType);\n    } else {\n      this.hud.hideBossHealth();\n    }\n  }\n\n  /** Звуки движения */\n  private updateMovementSounds(dt: number): void {\n    const isMoving = this.input.state.forward || this.input.state.backward ||\n                     this.input.state.left || this.input.state.right;\n\n    if (isMoving && this.player.state.grounded) {\n      this.footstepTimer -= dt;\n      if (this.footstepTimer <= 0) {\n        this.audio.playSFX('footstep');\n        this.footstepTimer = this.input.state.run ? 0.25 : 0.4;\n      }\n    }\n\n    if (this.player.state.grounded && !this.wasGrounded) {\n      this.audio.playSFX('land');\n    }\n    this.wasGrounded = this.player.state.grounded;\n  }\n\n  /** Callback при взмахе катаной */\n  private onKatanaSlice(): void {\n    this.audio.playSFX('katana_swing');\n  }\n\n  /** Game Over */\n  private gameOver(): void {\n    this.state.isPaused = true;\n    this.hud.showGameOver(this.state.frags, this.targetManager.wave);\n    \n    // Перезапуск через 3 секунды\n    setTimeout(() => {\n      this.restart();\n    }, 3000);\n  }\n\n  /** Перезапуск */\n  private restart(): void {\n    this.player.reset(vec3(0, 1.7, 12));\n    this.player.state.health = 100;\n    this.state.frags = 0;\n    this.state.isPaused = false;\n    this.targetManager.startGame();\n    this.pickupManager.pickups = [];\n  }\n\n  /** Проверка прицепившихся раннеров */\n  private checkAttachedRunners(): void {\n    for (const target of this.targetManager.targets) {\n      if (target.enemyType === 'runner' && target.isAttached) {\n        // Раннер прицепился - урон когда время выйдет\n        if (target.attachTimer <= 0 && target.active === false) {\n          this.player.takeDamage(target.damage);\n          this.audio.playSFX('runner_hit');\n          this.screenShake = 0.6;\n          this.hud.showDamage('green');\n          this.hud.showMessage('⚠️ РАННЕР УКУСИЛ!', 'orange');\n        }\n      }\n    }\n  }\n\n  /** Скинуть раннеров двойным прыжком */\n  private detachRunners(): void {\n    let detached = false;\n    for (const target of this.targetManager.targets) {\n      if (target.enemyType === 'runner' && target.isAttached) {\n        target.detachRunner();\n        detached = true;\n      }\n    }\n    if (detached) {\n      this.hud.showMessage('✓ РАННЕР СБРОШЕН!', 'cyan');\n    }\n  }\n\n  /** Подбор предмета */\n  private onPickup(type: string): void {\n    if (type === 'health') {\n      // Аптечка - восстанавливает HP\n      const heal = 30;\n      this.player.state.health = Math.min(\n        this.player.state.maxHealth,\n        this.player.state.health + heal\n      );\n      this.audio.playSFX('jump'); // Временный звук\n      this.hud.showMessage('+' + heal + ' HP', 'lime');\n      this.hud.updateHealth(this.player.state.health, this.player.state.maxHealth);\n      \n    } else if (type === 'stimpack') {\n      // Стимпак - буйство!\n      this.player.activateStimpack();\n      this.audio.playSFX('kill'); // Временный звук\n      this.hud.showMessage('🔥 БУЙСТВО! 🔥', 'red');\n      this.hud.showRageOverlay(8.0);\n      \n    } else if (type === 'charge') {\n      // Заряд катаны - 3 сплеш-удара!\n      this.weapon.chargeKatana();\n      this.audio.playSFX('charge_pickup');\n      this.hud.showMessage('⚡ КАТАНА ЗАРЯЖЕНА! (ПКМ x3) ⚡', 'cyan');\n      this.hud.updateSplashCharges(3);\n      this.screenShake = 0.5;\n    }\n  }\n\n  /** Проверка обычной атаки */\n  private checkNormalAttack(): void {\n    const playerPos = this.player.getEyePosition();\n    const hit = this.targetManager.trySlice(\n      playerPos,\n      this.player.state.yaw,\n      this.weapon.attackRange,\n      this.weapon.attackAngle\n    );\n    \n    if (hit) {\n      this.lastSliceTime = this.gameTime;\n      this.weaponRenderer.showHitEffect();\n      this.audio.playSFX('kill');\n    }\n  }\n\n  /** Проверка сплеш-атаки - горизонтальная волна */\n  private checkSplashAttack(): void {\n    const playerPos = this.player.getEyePosition();\n    \n    // Сплеш бьёт всех врагов в радиусе\n    const hits = this.targetManager.trySplashWave(\n      playerPos,\n      this.player.state.yaw,\n      this.weapon.splashRadius\n    );\n    \n    if (hits > 0) {\n      this.lastSliceTime = this.gameTime;\n      this.weaponRenderer.showSplashWave(this.player.state.yaw);\n      this.screenShake = 0.4;\n      this.audio.playSFX('kill');\n      \n      // Показываем сколько убито\n      this.hud.showMessage(`🌊 ВОЛНА x${hits}! 🌊`, 'cyan');\n    }\n    \n    // Обновляем HUD с зарядами\n    this.hud.updateSplashCharges(this.weapon.splashCharges);\n  }\n\n  /** Активация адреналина за комбо-убийства */\n  private activateComboAdrenaline(): void {\n    // Сбрасываем счётчик комбо\n    this.killTimes = [];\n    \n    // Активируем буйство\n    this.player.activateStimpack();\n    this.audio.playSFX('kill');\n    this.hud.showMessage('🔥🔥🔥 КОМБО АДРЕНАЛИН! 🔥🔥🔥', 'red');\n    this.hud.showRageOverlay(8.0);\n    this.screenShake = 0.5;\n  }\n\n  /** Рендеринг */\n  private render(): void {\n    // Данные врагов для шейдера\n    const targetsData = this.targetManager.getShaderData();\n    const targetCount = this.targetManager.targets.length;\n\n    // Данные луж для шейдера\n    const poolsData = this.targetManager.getPoolsShaderData();\n    const poolCount = this.targetManager.toxicPools.length;\n\n    // Данные пикапов для шейдера\n    const pickupsData = this.pickupManager.getShaderData();\n    const pickupCount = this.pickupManager.pickups.length;\n\n    // Тряска камеры\n    let yaw = this.player.state.yaw;\n    let pitch = this.player.state.pitch;\n    \n    if (this.screenShake > 0) {\n      yaw += (Math.random() - 0.5) * this.screenShake * 0.1;\n      pitch += (Math.random() - 0.5) * this.screenShake * 0.1;\n    }\n\n    // Вспышка при ударе\n    const sliceFlash = Math.max(0, 0.3 - (this.gameTime - this.lastSliceTime)) * 3;\n\n    // Рендерим сцену\n    this.renderer.render(\n      this.gameTime,\n      this.player.getEyePosition(),\n      yaw,\n      pitch,\n      targetsData,\n      targetCount,\n      sliceFlash,\n      poolsData,\n      poolCount,\n      this.currentEra,\n      pickupsData,\n      pickupCount\n    );\n\n    // Рендерим оружие\n    this.weaponRenderer.render(this.weapon.state, this.gameTime);\n  }\n\n  /** Обработка resize */\n  private handleResize(): void {\n    const dpr = window.devicePixelRatio || 1;\n\n    this.weaponCanvas.width = window.innerWidth * dpr;\n    this.weaponCanvas.height = window.innerHeight * dpr;\n    this.weaponCanvas.style.width = window.innerWidth + 'px';\n    this.weaponCanvas.style.height = window.innerHeight + 'px';\n\n    this.weaponRenderer.resize(this.weaponCanvas.width, this.weaponCanvas.height);\n  }\n\n  /** Полноэкранный режим */\n  private toggleFullscreen(): void {\n    if (!document.fullscreenElement) {\n      document.documentElement.requestFullscreen();\n    } else {\n      document.exitFullscreen();\n    }\n  }\n\n  /** Уничтожить игру */\n  public destroy(): void {\n    this.stop();\n    this.input.destroy();\n    this.audio.stop();\n    this.renderer.destroy();\n  }\n}\n","import { Game } from '@/core/Game';\nimport './styles.css';\n\n/**\n * Точка входа приложения\n * Dungeon Synth Shooter\n */\nfunction main(): void {\n  // Получаем canvas элементы\n  const canvas = document.getElementById('game-canvas') as HTMLCanvasElement;\n  const weaponCanvas = document.getElementById('weapon-canvas') as HTMLCanvasElement;\n\n  if (!canvas || !weaponCanvas) {\n    console.error('Canvas элементы не найдены!');\n    return;\n  }\n\n  // Создаём игру\n  const game = new Game(canvas, weaponCanvas);\n\n  // Делаем доступной глобально для отладки\n  (window as any).game = game;\n\n  console.log('🎮 Dungeon Synth Shooter загружен');\n  console.log('📖 Управление: WASD, SHIFT (бег), SPACE (прыжок), LMB (стрельба), R (перезарядка)');\n  console.log('🔊 M - mute, F - fullscreen');\n}\n\n// Запускаем после загрузки DOM\nif (document.readyState === 'loading') {\n  document.addEventListener('DOMContentLoaded', main);\n} else {\n  main();\n}\n\n"],"names":["GameLoop","updateFn","renderFn","currentTime","deltaTime","interpolation","Input","value","canvas","e","onLockChange","code","pressed","dx","dy","vec3","x","y","z","subVec3","a","b","lengthVec3","v","normalizeVec3","len","distanceVec3","clamp","min","max","DEFAULT_CONFIG","Player","startPosition","config","collision","dt","input","mouseDelta","state","moveX","moveZ","moveLen","sin","cos","worldMoveX","worldMoveZ","speed","targetVx","targetVz","targetY","friction","heightDiff","newPosX","newPosY","newPosZ","testPosX","testPosZ","minY","testPosY","ceilingHeight","yaw","pitch","amount","position","Weapon","isMoving","isRunning","bobSpeed","isSplash","playerPos","playerYaw","targetPos","dz","dist","angleDiff","bobX","bobY","attackOffsetX","attackOffsetY","t","_playerPos","_playerDir","WeaponRenderer","width","height","centerX","centerY","colors","i","angle","p","ctx","alpha","gradient","points","j","r","px","py","time","scale","baseX","baseY","rotation","easeOut","moveMultiplier","pulse","maxRadius","currentRadius","sparkCount","sparkR","size","progress","cyanGrad","offset","_state","tsukaGrad","glow","bladeGrad","wave","color","sparkColor","charges","intensity","weaponType","Target","id","type","dirX","dirY","dirZ","aggression","currentSpeed","offsetX","offsetY","offsetZ","perpX","perpZ","wobble","orbitRadius","orbitHeight","dodgedDirX","dodgedDirZ","zigzag","force","baseRadius","poolCooldown","poolPos","extraPool","orbitSpeed","targetX","targetZ","toOrbitX","toOrbitZ","distXZ","gravity","jumpSpeed","f","sliceDirection","numFragments","upAngle","vx","vy","vz","w","data","TargetManager","startWave","baseSpeed","pos","boss","phase","banelingCount","phantomCount","runnerCount","hopperCount","totalCount","idx","cd","target","pool","range","effectiveRange","killed","sliceDir","knockbackForce","radius","killCount","effectiveRadius","typeIntensity","allFragments","bossPos","baneling","minDist","_count","_position","_damage","Pickup","PickupManager","pickup","platform","AudioManager","distortion","samples","curve","deg","duration","convolver","rate","length","impulse","channel","decay","mod","proximity","freq","volume","filterFreq","vibrato","now","boom","boomGain","acidNoise","acidGain","acidFilter","acidFilter2","delay","bubble","bubbleGain","hiss","hissGain","hissFilter","swoosh","swooshGain","swooshFilter","dark","darkGain","whisper","whisperGain","whisperFilter","crackle","crackleGain","impact","impactGain","zap","zapGain","zapFilter","thud","thudGain","sparks","sparksGain","sparksFilter","osc","gain","filter","kick","kickGain","noise","noiseGain","noiseFilter","osc2","synth","synth2","synthGain","synthFilter","glitch","glitchGain","bufferSize","buffer","source","whoosh","whooshGain","whooshFilter","metal","metalGain","waveGain","waveFilter","noiseSource","resonance","resonanceGain","subBass","subGain","charge","charge2","chargeGain","chargeFilter","shimmer","shimmerGain","noiseSource2","noiseGain2","noiseFilter2","newEra","interval","bassNotes","noteIndex","playBass","arpNotes","arpIndex","playArp","playKick","playDrone","lfo","lfoGain","beat","playBeat","playEerie","playGravity","delayGain","playPad","chord","playZap","enabled","playHeartbeat","playSpark","playWarning","notes","note","playStatic","bossType","playHeavyKick","playAlarm","acidNotes","filterMod","playAcidBass","filterBase","playHihat","playAcidScream","bassIndex","hihatCounter","vol","playStab","playAtmosphere","playVoid","playBassNote","playArpNote","padChords","chordIndex","playPadChord","snare","snareGain","snareFilter","snareTone","snareToneGain","hihat","hihatGain","hihatFilter","VERTEX_SHADER","FRAGMENT_SHADER","WebGLRenderer","gl","vertShader","fragShader","shader","vertices","vbo","posLoc","dpr","cameraPos","cameraYaw","cameraPitch","targetsData","targetCount","muzzleFlash","poolsData","poolCount","era","pickupsData","pickupCount","HUD","el","corner","cornerEl","h","weapon","health","maxHealth","ratio","cooldown","isReady","_wave","enemiesLeft","frags","score","_show","isKill","text","msg","style","hp","maxHp","barContainer","bossName","barColor","percent","CollisionSystem","distFromCenter","columnPositions","col","onBridgeX","onBridgeZ","leftStairStartX","leftStairEndX","leftPlatformEnd","rightStairStartX","rightStairEndX","rightPlatformEnd","balconyHeight","_pos","Game","weaponCanvas","damage","volumeSlider","volumeValue","sensSlider","sensValue","effectiveDt","pickedUp","closestDist","hpPercent","detached","hits","sliceFlash","main","game"],"mappings":"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;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA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"}