{"version":3,"file":"index-B_oRVgCa.js","sources":["../../src/core/GameLoop.ts","../../src/core/Input.ts","../../src/utils/math.ts","../../src/player/Player.ts","../../src/weapon/Weapon.ts","../../src/weapon/WeaponRenderer.ts","../../src/enemies/Target.ts","../../src/items/Pickup.ts","../../src/audio/AudioManager.ts","../../src/render/Shaders.ts","../../src/render/WebGLRenderer.ts","../../src/render/HUD.ts","../../src/world/Collision.ts","../../src/core/Game.ts","../../src/main.ts"],"sourcesContent":["/**\n * Игровой цикл с фиксированным временным шагом\n */\nexport class GameLoop {\n  /** Функция обновления логики */\n  private updateFn: (dt: number) => void;\n\n  /** Функция рендеринга */\n  private renderFn: (interpolation: number) => void;\n\n  /** Время последнего кадра */\n  private lastTime = 0;\n\n  /** Накопленное время */\n  private accumulator = 0;\n\n  /** Фиксированный временной шаг (60 FPS) */\n  public readonly fixedDeltaTime = 1 / 60;\n\n  /** ID запроса анимации */\n  private animationFrameId: number | null = null;\n\n  /** Цикл запущен */\n  public isRunning = false;\n\n  /** Текущий FPS */\n  public fps = 0;\n\n  /** Счётчик кадров для FPS */\n  private frameCount = 0;\n\n  /** Время последнего замера FPS */\n  private fpsTime = 0;\n\n  constructor(\n    updateFn: (dt: number) => void,\n    renderFn: (interpolation: number) => void\n  ) {\n    this.updateFn = updateFn;\n    this.renderFn = renderFn;\n  }\n\n  /** Запустить цикл */\n  public start(): void {\n    if (this.isRunning) return;\n\n    this.isRunning = true;\n    this.lastTime = performance.now();\n    this.fpsTime = this.lastTime;\n    this.frameCount = 0;\n    this.animationFrameId = requestAnimationFrame(this.tick.bind(this));\n  }\n\n  /** Остановить цикл */\n  public stop(): void {\n    if (!this.isRunning) return;\n\n    this.isRunning = false;\n    if (this.animationFrameId !== null) {\n      cancelAnimationFrame(this.animationFrameId);\n      this.animationFrameId = null;\n    }\n  }\n\n  /** Один тик игрового цикла */\n  private tick(currentTime: number): void {\n    if (!this.isRunning) return;\n\n    // Вычисляем дельту времени\n    const deltaTime = Math.min((currentTime - this.lastTime) / 1000, 0.1);\n    this.lastTime = currentTime;\n\n    // Обновляем FPS\n    this.frameCount++;\n    if (currentTime - this.fpsTime >= 1000) {\n      this.fps = this.frameCount;\n      this.frameCount = 0;\n      this.fpsTime = currentTime;\n    }\n\n    // Накапливаем время для фиксированного шага\n    this.accumulator += deltaTime;\n\n    // Выполняем обновления с фиксированным шагом\n    while (this.accumulator >= this.fixedDeltaTime) {\n      this.updateFn(this.fixedDeltaTime);\n      this.accumulator -= this.fixedDeltaTime;\n    }\n\n    // Рендерим с интерполяцией\n    const interpolation = this.accumulator / this.fixedDeltaTime;\n    this.renderFn(interpolation);\n\n    // Следующий кадр\n    this.animationFrameId = requestAnimationFrame(this.tick.bind(this));\n  }\n}\n\n\n","import type { InputState } from '@/types';\n\n/**\n * Менеджер ввода\n * Обрабатывает клавиатуру и мышь\n */\nexport class Input {\n  /** Текущее состояние ввода */\n  public state: InputState = {\n    forward: false,\n    backward: false,\n    left: false,\n    right: false,\n    run: false,\n    jump: false,\n    fire: false,\n    altFire: false, // ПКМ для сплеш-атаки\n    reload: false,\n  };\n\n  /** Движение мыши за кадр */\n  public mouseDelta = { x: 0, y: 0 };\n\n  /** Pointer Lock активен */\n  public isPointerLocked = false;\n\n  /** Чувствительность мыши (выше = быстрее) */\n  public sensitivity = 0.005;\n\n  /** Установить чувствительность */\n  public setSensitivity(value: number): void {\n    this.sensitivity = Math.max(0.001, Math.min(0.015, value));\n  }\n\n  /** Инвертировать ось X */\n  public invertX = true;\n\n  /** Инвертировать ось Y */\n  public invertY = true;\n\n  private canvas: HTMLCanvasElement;\n  private onPointerLockChange?: () => void;\n\n  constructor(canvas: HTMLCanvasElement) {\n    this.canvas = canvas;\n    this.setupListeners();\n  }\n\n  /** Настройка обработчиков событий */\n  private setupListeners(): void {\n    // Клавиатура\n    document.addEventListener('keydown', this.handleKeyDown.bind(this));\n    document.addEventListener('keyup', this.handleKeyUp.bind(this));\n\n    // Мышь\n    document.addEventListener('mousemove', this.handleMouseMove.bind(this));\n    document.addEventListener('mousedown', this.handleMouseDown.bind(this));\n    document.addEventListener('mouseup', this.handleMouseUp.bind(this));\n\n    // Отключаем контекстное меню для ПКМ\n    this.canvas.addEventListener('contextmenu', (e) => e.preventDefault());\n\n    // Pointer Lock\n    document.addEventListener('pointerlockchange', this.handlePointerLockChange.bind(this));\n  }\n\n  /** Запросить Pointer Lock */\n  public requestPointerLock(onLockChange?: () => void): void {\n    this.onPointerLockChange = onLockChange;\n    this.canvas.requestPointerLock();\n  }\n\n  /** Выйти из Pointer Lock */\n  public exitPointerLock(): void {\n    document.exitPointerLock();\n  }\n\n  /** Сбросить дельту мыши (вызывать в конце кадра) */\n  public resetMouseDelta(): void {\n    this.mouseDelta.x = 0;\n    this.mouseDelta.y = 0;\n  }\n\n  /** Обработка нажатия клавиши */\n  private handleKeyDown(e: KeyboardEvent): void {\n    this.updateKeyState(e.code, true);\n  }\n\n  /** Обработка отпускания клавиши */\n  private handleKeyUp(e: KeyboardEvent): void {\n    this.updateKeyState(e.code, false);\n  }\n\n  /** Обновление состояния клавиши */\n  private updateKeyState(code: string, pressed: boolean): void {\n    switch (code) {\n      case 'KeyW':\n        this.state.forward = pressed;\n        break;\n      case 'KeyS':\n        this.state.backward = pressed;\n        break;\n      case 'KeyA':\n        this.state.left = pressed;\n        break;\n      case 'KeyD':\n        this.state.right = pressed;\n        break;\n      case 'ShiftLeft':\n      case 'ShiftRight':\n        this.state.run = pressed;\n        break;\n      case 'Space':\n        this.state.jump = pressed;\n        break;\n      case 'KeyR':\n        this.state.reload = pressed;\n        break;\n    }\n  }\n\n  /** Обработка движения мыши */\n  private handleMouseMove(e: MouseEvent): void {\n    if (!this.isPointerLocked) return;\n\n    // Инверсия осей как в оригинале\n    const dx = this.invertX ? -e.movementX : e.movementX;\n    const dy = this.invertY ? -e.movementY : e.movementY;\n\n    this.mouseDelta.x += dx * this.sensitivity;\n    this.mouseDelta.y += dy * this.sensitivity;\n  }\n\n  /** Обработка нажатия кнопки мыши */\n  private handleMouseDown(e: MouseEvent): void {\n    if (e.button === 0) {\n      this.state.fire = true;\n    } else if (e.button === 2) {\n      e.preventDefault();\n      this.state.altFire = true;\n    }\n  }\n\n  /** Обработка отпускания кнопки мыши */\n  private handleMouseUp(e: MouseEvent): void {\n    if (e.button === 0) {\n      this.state.fire = false;\n    } else if (e.button === 2) {\n      this.state.altFire = false;\n    }\n  }\n\n  /** Обработка изменения Pointer Lock */\n  private handlePointerLockChange(): void {\n    this.isPointerLocked = document.pointerLockElement === this.canvas;\n    this.onPointerLockChange?.();\n  }\n\n  /** Удалить обработчики */\n  public destroy(): void {\n    document.removeEventListener('keydown', this.handleKeyDown.bind(this));\n    document.removeEventListener('keyup', this.handleKeyUp.bind(this));\n    document.removeEventListener('mousemove', this.handleMouseMove.bind(this));\n    document.removeEventListener('mousedown', this.handleMouseDown.bind(this));\n    document.removeEventListener('mouseup', this.handleMouseUp.bind(this));\n    document.removeEventListener('pointerlockchange', this.handlePointerLockChange.bind(this));\n  }\n}\n\n","import type { Vec3, Vec2 } from '@/types';\n\n// ========== СОЗДАНИЕ ВЕКТОРОВ ==========\n\n/** Создать Vec3 */\nexport function vec3(x: number = 0, y: number = 0, z: number = 0): Vec3 {\n  return { x, y, z };\n}\n\n/** Создать Vec2 */\nexport function vec2(x: number = 0, y: number = 0): Vec2 {\n  return { x, y };\n}\n\n// ========== ОПЕРАЦИИ С VEC3 ==========\n\n/** Сложение векторов */\nexport function addVec3(a: Vec3, b: Vec3): Vec3 {\n  return { x: a.x + b.x, y: a.y + b.y, z: a.z + b.z };\n}\n\n/** Вычитание векторов */\nexport function subVec3(a: Vec3, b: Vec3): Vec3 {\n  return { x: a.x - b.x, y: a.y - b.y, z: a.z - b.z };\n}\n\n/** Умножение на скаляр */\nexport function mulVec3(v: Vec3, s: number): Vec3 {\n  return { x: v.x * s, y: v.y * s, z: v.z * s };\n}\n\n/** Длина вектора */\nexport function lengthVec3(v: Vec3): number {\n  return Math.sqrt(v.x * v.x + v.y * v.y + v.z * v.z);\n}\n\n/** Длина XZ компоненты */\nexport function lengthXZ(v: Vec3): number {\n  return Math.sqrt(v.x * v.x + v.z * v.z);\n}\n\n/** Нормализация вектора */\nexport function normalizeVec3(v: Vec3): Vec3 {\n  const len = lengthVec3(v);\n  if (len === 0) return { x: 0, y: 0, z: 0 };\n  return { x: v.x / len, y: v.y / len, z: v.z / len };\n}\n\n/** Скалярное произведение */\nexport function dotVec3(a: Vec3, b: Vec3): number {\n  return a.x * b.x + a.y * b.y + a.z * b.z;\n}\n\n/** Векторное произведение */\nexport function crossVec3(a: Vec3, b: Vec3): Vec3 {\n  return {\n    x: a.y * b.z - a.z * b.y,\n    y: a.z * b.x - a.x * b.z,\n    z: a.x * b.y - a.y * b.x,\n  };\n}\n\n/** Линейная интерполяция */\nexport function lerpVec3(a: Vec3, b: Vec3, t: number): Vec3 {\n  return {\n    x: a.x + (b.x - a.x) * t,\n    y: a.y + (b.y - a.y) * t,\n    z: a.z + (b.z - a.z) * t,\n  };\n}\n\n/** Расстояние между точками */\nexport function distanceVec3(a: Vec3, b: Vec3): number {\n  return lengthVec3(subVec3(a, b));\n}\n\n// ========== УТИЛИТЫ ==========\n\n/** Ограничить значение */\nexport function clamp(value: number, min: number, max: number): number {\n  return Math.max(min, Math.min(max, value));\n}\n\n/** Линейная интерполяция чисел */\nexport function lerp(a: number, b: number, t: number): number {\n  return a + (b - a) * t;\n}\n\n/** Плавный переход (smoothstep) */\nexport function smoothstep(edge0: number, edge1: number, x: number): number {\n  const t = clamp((x - edge0) / (edge1 - edge0), 0, 1);\n  return t * t * (3 - 2 * t);\n}\n\n/** Градусы в радианы */\nexport function degToRad(deg: number): number {\n  return deg * (Math.PI / 180);\n}\n\n/** Радианы в градусы */\nexport function radToDeg(rad: number): number {\n  return rad * (180 / Math.PI);\n}\n\n/** Случайное число в диапазоне */\nexport function randomRange(min: number, max: number): number {\n  return min + Math.random() * (max - min);\n}\n\n/** Случайный Vec3 в сфере */\nexport function randomInSphere(radius: number): Vec3 {\n  const theta = Math.random() * Math.PI * 2;\n  const phi = Math.acos(2 * Math.random() - 1);\n  const r = radius * Math.cbrt(Math.random());\n  return {\n    x: r * Math.sin(phi) * Math.cos(theta),\n    y: r * Math.sin(phi) * Math.sin(theta),\n    z: r * Math.cos(phi),\n  };\n}\n\n","import type { PlayerState, MovementConfig, InputState, Vec3, ICollisionSystem } from '@/types';\nimport { vec3, clamp } from '@/utils/math';\n\n/** Конфигурация по умолчанию */\nconst DEFAULT_CONFIG: MovementConfig = {\n  walkSpeed: 8.0,\n  runSpeed: 20.0,\n  jumpForce: 12.0,\n  gravity: 25.0,\n  groundFriction: 12.0,\n  airControl: 0.85,\n  mouseSensitivity: 0.002, // Высокая чувствительность\n};\n\n/**\n * Игрок\n * Управление позицией, движением и камерой\n * Поддержка лестниц через getFloorHeight\n */\nexport class Player {\n  /** Состояние игрока */\n  public state: PlayerState;\n\n  /** Конфигурация движения */\n  public config: MovementConfig;\n\n  /** Система коллизий */\n  private collision: ICollisionSystem;\n\n  /** Скорость подъёма/спуска по лестницам */\n  private stepSpeed = 12.0;\n\n  /** Максимальная высота автоматического подъёма */\n  private maxStepHeight = 0.5;\n\n  /** Целевые значения камеры */\n  private targetYaw = 0;\n  private targetPitch = -0.05;\n\n  /** Кулдаун воздушных прыжков (секунды) */\n  private airJumpCooldown = 0;\n  \n  /** Время кулдауна воздушных прыжков */\n  private readonly AIR_JUMP_COOLDOWN = 2.0;\n\n  /** Сколько воздушных прыжков осталось */\n  private airJumpsLeft = 0;\n  \n  /** Максимум воздушных прыжков (1 = двойной, 2 = тройной) */\n  public maxAirJumps = 1;\n\n  /** Можно ли делать воздушный прыжок (отпустили ли Space) */\n  private canAirJump = false;\n\n  /** Режим буйства */\n  public rageMode = false;\n  public rageModeTimer = 0;\n\n  /** Модификатор скорости (стимпак) */\n  public speedBoost = 1.0;\n  public speedBoostTimer = 0;\n\n  constructor(\n    startPosition: Vec3 = vec3(0, 1.7, 5),\n    config: Partial<MovementConfig> = {},\n    collision: ICollisionSystem\n  ) {\n    this.config = { ...DEFAULT_CONFIG, ...config };\n    this.collision = collision;\n\n    this.state = {\n      position: { ...startPosition },\n      velocity: vec3(),\n      yaw: 0, // Смотрим вперёд\n      pitch: -0.05, // Слегка вниз\n      grounded: true,\n      eyeHeight: 1.7, // Высота глаз над полом\n      health: 100,\n      maxHealth: 100,\n    };\n  }\n\n  /** Обновление игрока */\n  public update(dt: number, input: InputState, mouseDelta: { x: number; y: number }): void {\n    // Обновляем таймеры буйства и скорости\n    if (this.rageModeTimer > 0) {\n      this.rageModeTimer -= dt;\n      if (this.rageModeTimer <= 0) {\n        this.rageMode = false;\n      }\n    }\n    if (this.speedBoostTimer > 0) {\n      this.speedBoostTimer -= dt;\n      if (this.speedBoostTimer <= 0) {\n        this.speedBoost = 1.0;\n      }\n    }\n    \n    // Обновляем кулдаун воздушных прыжков\n    if (this.airJumpCooldown > 0) {\n      this.airJumpCooldown -= dt;\n    }\n\n    // Обновляем камеру\n    this.updateCamera(mouseDelta);\n\n    // Обновляем движение\n    this.updateMovement(dt, input);\n  }\n\n  /** Активировать стимпак */\n  public activateStimpack(): void {\n    this.rageMode = true;\n    this.rageModeTimer = 8.0; // 8 секунд буйства\n    this.speedBoost = 1.8; // +80% скорости\n    this.speedBoostTimer = 8.0;\n  }\n\n  /** Попытка воздушного прыжка - возвращает true если выполнен */\n  public tryDoubleJump(): boolean {\n    // Нужно отпустить Space после предыдущего прыжка\n    if (!this.canAirJump) return false;\n    \n    // Проверяем есть ли воздушные прыжки\n    if (this.airJumpsLeft <= 0) return false;\n    \n    // В режиме буйства - без кулдауна!\n    if (this.rageMode) {\n      this.state.velocity.y = this.config.jumpForce * 0.9;\n      this.airJumpsLeft--;\n      this.canAirJump = false;\n      return true;\n    }\n    \n    // Обычный воздушный прыжок с кулдауном\n    if (this.airJumpCooldown <= 0) {\n      this.airJumpCooldown = this.AIR_JUMP_COOLDOWN;\n      this.state.velocity.y = this.config.jumpForce;\n      this.airJumpsLeft--;\n      this.canAirJump = false;\n      return true;\n    }\n    \n    return false;\n  }\n\n  /** Сообщить что Space отпущен - можно делать воздушный прыжок */\n  public onJumpReleased(): void {\n    if (!this.state.grounded) {\n      this.canAirJump = true;\n    }\n  }\n\n  /** Получить оставшийся кулдаун воздушного прыжка */\n  public getDoubleJumpCooldown(): number {\n    return Math.max(0, this.airJumpCooldown);\n  }\n\n  /** Готов ли воздушный прыжок */\n  public isDoubleJumpReady(): boolean {\n    return (this.airJumpCooldown <= 0 && this.airJumpsLeft > 0) || this.rageMode;\n  }\n\n  /** Разблокировать тройной прыжок */\n  public unlockTripleJump(): void {\n    this.maxAirJumps = 2;\n  }\n\n  /** Получить количество оставшихся воздушных прыжков */\n  public getAirJumpsLeft(): number {\n    return this.airJumpsLeft;\n  }\n\n  /** Обновление камеры - быстрое и лёгкое */\n  private updateCamera(mouseDelta: { x: number; y: number }): void {\n    // Прямое применение движения мыши к целевым углам\n    this.targetYaw -= mouseDelta.x;\n    this.targetPitch += mouseDelta.y;\n\n    // Ограничиваем pitch\n    this.targetPitch = clamp(this.targetPitch, -Math.PI / 2 + 0.01, Math.PI / 2 - 0.01);\n\n    // Быстрая интерполяция (0.7 = почти мгновенно, но чуть сглажено)\n    this.state.yaw += (this.targetYaw - this.state.yaw) * 0.7;\n    this.state.pitch += (this.targetPitch - this.state.pitch) * 0.7;\n  }\n\n  /** Обновление движения с поддержкой лестниц */\n  private updateMovement(dt: number, input: InputState): void {\n    const { state, config } = this;\n\n    // Направление движения от ввода\n    let moveX = 0;\n    let moveZ = 0;\n\n    if (input.forward) moveZ -= 1;\n    if (input.backward) moveZ += 1;\n    if (input.left) moveX -= 1;\n    if (input.right) moveX += 1;\n\n    // Нормализуем если движемся по диагонали\n    const moveLen = Math.sqrt(moveX * moveX + moveZ * moveZ);\n    if (moveLen > 0) {\n      moveX /= moveLen;\n      moveZ /= moveLen;\n    }\n\n    // Поворачиваем направление по yaw\n    const sin = Math.sin(state.yaw);\n    const cos = Math.cos(state.yaw);\n    const worldMoveX = moveX * cos - moveZ * sin;\n    const worldMoveZ = moveX * sin + moveZ * cos;\n\n    // Скорость (бег или ходьба) с учётом буста\n    const baseSpeed = input.run ? config.runSpeed : config.walkSpeed;\n    const speed = baseSpeed * this.speedBoost;\n\n    // Целевая скорость\n    const targetVx = worldMoveX * speed;\n    const targetVz = worldMoveZ * speed;\n\n    // Получаем высоту пола в текущей позиции\n    const currentFloorHeight = this.collision.getFloorHeight(state.position);\n    const targetY = currentFloorHeight + state.eyeHeight;\n\n    if (state.grounded) {\n      // На земле — полный контроль и трение\n      const friction = config.groundFriction * dt;\n      state.velocity.x += (targetVx - state.velocity.x) * Math.min(friction, 1);\n      state.velocity.z += (targetVz - state.velocity.z) * Math.min(friction, 1);\n\n      // Прыжок\n      if (input.jump) {\n        state.velocity.y = config.jumpForce;\n        state.grounded = false;\n        this.airJumpsLeft = this.maxAirJumps; // Даём воздушные прыжки\n        this.canAirJump = false; // Нужно отпустить Space\n      } else {\n        // Плавное следование за полом (лестницы)\n        const heightDiff = targetY - state.position.y;\n        \n        if (Math.abs(heightDiff) < 0.01) {\n          // Почти на уровне - просто выравниваем\n          state.position.y = targetY;\n          state.velocity.y = 0;\n        } else if (heightDiff > 0 && heightDiff < this.maxStepHeight) {\n          // Подъём по лестнице - плавно поднимаемся\n          state.velocity.y = this.stepSpeed;\n        } else if (heightDiff < 0 && heightDiff > -this.maxStepHeight) {\n          // Спуск по лестнице - плавно опускаемся\n          state.velocity.y = -this.stepSpeed * 0.8;\n        } else if (heightDiff < -this.maxStepHeight) {\n          // Большой спуск - начинаем падать\n          state.grounded = false;\n          state.velocity.y = 0;\n        }\n      }\n    } else {\n      // В воздухе — почти полный контроль (сохраняем скорость)\n      // Быстро приближаемся к целевой скорости\n      const airFriction = 8.0 * dt;\n      state.velocity.x += (targetVx - state.velocity.x) * Math.min(airFriction, 1);\n      state.velocity.z += (targetVz - state.velocity.z) * Math.min(airFriction, 1);\n\n      // Гравитация\n      state.velocity.y -= config.gravity * dt;\n    }\n\n    // Применяем скорость к позиции\n    const newPosX = state.position.x + state.velocity.x * dt;\n    const newPosY = state.position.y + state.velocity.y * dt;\n    const newPosZ = state.position.z + state.velocity.z * dt;\n\n    // Проверяем коллизии по осям отдельно\n    // X\n    const testPosX = { x: newPosX, y: state.position.y, z: state.position.z };\n    if (!this.collision.checkCollision(testPosX)) {\n      state.position.x = newPosX;\n    } else {\n      state.velocity.x = 0;\n    }\n\n    // Z\n    const testPosZ = { x: state.position.x, y: state.position.y, z: newPosZ };\n    if (!this.collision.checkCollision(testPosZ)) {\n      state.position.z = newPosZ;\n    } else {\n      state.velocity.z = 0;\n    }\n\n    // Y (вертикаль) - с учётом пола\n    const newFloorHeight = this.collision.getFloorHeight(state.position);\n    const minY = newFloorHeight + state.eyeHeight;\n\n    if (!state.grounded) {\n      // В воздухе - проверяем приземление\n      if (newPosY <= minY) {\n        // Приземлились\n        state.position.y = minY;\n        state.velocity.y = 0;\n        state.grounded = true;\n        this.canAirJump = false;\n        this.airJumpsLeft = 0; // Сброс воздушных прыжков\n      } else {\n        // Ещё летим\n        const testPosY = { x: state.position.x, y: newPosY, z: state.position.z };\n        const ceilingHeight = this.collision.getCeilingHeight(state.position);\n        \n        if (newPosY < ceilingHeight - 0.3 && !this.collision.checkCollision(testPosY)) {\n          state.position.y = newPosY;\n        } else {\n          // Упёрлись в потолок\n          state.velocity.y = Math.min(state.velocity.y, 0);\n        }\n      }\n    } else {\n      // На земле - плавно следуем за полом\n      state.position.y += state.velocity.y * dt;\n      \n      // Не проваливаемся ниже пола\n      if (state.position.y < minY) {\n        state.position.y = minY;\n        state.velocity.y = 0;\n      }\n    }\n  }\n\n  /** Получить позицию глаз */\n  public getEyePosition(): Vec3 {\n    return {\n      x: this.state.position.x,\n      y: this.state.position.y,\n      z: this.state.position.z,\n    };\n  }\n\n  /** Получить направление взгляда */\n  public getLookDirection(): Vec3 {\n    const { yaw, pitch } = this.state;\n    return {\n      x: Math.sin(yaw) * Math.cos(pitch),\n      y: Math.sin(pitch),\n      z: -Math.cos(yaw) * Math.cos(pitch),\n    };\n  }\n\n  /** Нанести урон */\n  public takeDamage(amount: number): void {\n    this.state.health = Math.max(0, this.state.health - amount);\n  }\n\n  /** Вылечить */\n  public heal(amount: number): void {\n    this.state.health = Math.min(this.state.maxHealth, this.state.health + amount);\n  }\n\n  /** Игрок мёртв? */\n  public isDead(): boolean {\n    return this.state.health <= 0;\n  }\n\n  /** Сброс позиции */\n  public reset(position: Vec3): void {\n    this.state.position = { ...position };\n    this.state.velocity = vec3();\n    this.state.health = this.state.maxHealth;\n    this.state.grounded = true;\n  }\n}\n","import type { WeaponState, Vec3 } from '@/types';\n\n/** Тип оружия */\nexport type WeaponType = 'katana' | 'charged';\n\n/**\n * Катана - оружие ближнего боя\n * ЛКМ = обычный взмах\n * ПКМ = сплеш-волна (если заряжена)\n */\nexport class Weapon {\n  /** Состояние оружия */\n  public state: WeaponState;\n\n  /** Текущий тип оружия */\n  public currentWeapon: WeaponType = 'katana';\n\n  /** Заряды сплеш-атаки */\n  public splashCharges = 0;\n\n  /** Время до следующего удара */\n  private attackCooldown = 0;\n\n  /** Время атаки */\n  private attackDuration = 0.3;\n\n  /** Перезарядка между ударами */\n  private attackCooldownTime = 0.4;\n\n  /** Дальность удара */\n  public attackRange = 4.0;\n\n  /** Угол атаки (радианы) */\n  public attackAngle = Math.PI * 0.6; // 108 градусов\n\n  /** Урон */\n  public damage = 100;\n\n  /** Сейчас атакуем? */\n  public isAttacking = false;\n\n  /** Прогресс атаки (0-1) */\n  public attackProgress = 0;\n\n  /** Callback при ударе */\n  public onSlice?: () => void;\n\n  /** Callback при сплеш-атаке */\n  public onSplash?: () => void;\n\n  /** Это сплеш-атака? */\n  public isSplashAttack = false;\n\n  /** Радиус сплеш-волны */\n  public splashRadius = 10.0;\n\n  constructor() {\n    this.state = {\n      ammo: 999,\n      reserveAmmo: 999,\n      magazineSize: 999,\n      isReloading: false,\n      reloadTimeLeft: 0,\n      recoilX: 0,\n      recoilY: 0,\n      recoilBack: 0,\n      muzzleFlash: 0,\n      bobPhase: 0,\n    };\n  }\n\n  /** Обновление оружия */\n  public update(dt: number, isMoving: boolean, isRunning: boolean): void {\n    // Кулдаун атаки\n    if (this.attackCooldown > 0) {\n      this.attackCooldown -= dt;\n    }\n\n    // Прогресс анимации атаки\n    if (this.isAttacking) {\n      this.attackProgress += dt / this.attackDuration;\n      if (this.attackProgress >= 1) {\n        this.isAttacking = false;\n        this.attackProgress = 0;\n      }\n    }\n\n    // Покачивание при ходьбе\n    if (isMoving) {\n      const bobSpeed = isRunning ? 14 : 10;\n      this.state.bobPhase += dt * bobSpeed;\n    } else {\n      this.state.bobPhase *= 0.95;\n    }\n\n    // Затухание эффектов\n    this.state.recoilX *= 0.85;\n    this.state.recoilY *= 0.85;\n    this.state.muzzleFlash *= 0.8;\n  }\n\n  /** Попытка обычного удара (ЛКМ) */\n  public tryAttack(): boolean {\n    if (this.attackCooldown > 0) return false;\n    if (this.isAttacking) return false;\n\n    this.attack(false);\n    return true;\n  }\n\n  /** Попытка сплеш-атаки (ПКМ) */\n  public trySplashAttack(): boolean {\n    if (this.attackCooldown > 0) return false;\n    if (this.isAttacking) return false;\n    if (this.splashCharges <= 0) return false;\n\n    this.attack(true);\n    return true;\n  }\n\n  /** Удар катаной */\n  private attack(isSplash: boolean): void {\n    this.isAttacking = true;\n    this.attackProgress = 0;\n    this.attackCooldown = isSplash ? 0.6 : this.attackCooldownTime;\n    this.isSplashAttack = isSplash;\n    \n    if (isSplash) {\n      // Сплеш-волна\n      this.splashCharges--;\n      this.state.recoilX = 0.6;\n      this.state.muzzleFlash = 2.0;\n      \n      // Если закончились заряды - возвращаемся к обычной катане\n      if (this.splashCharges <= 0) {\n        this.currentWeapon = 'katana';\n      }\n      \n      this.onSplash?.();\n    } else {\n      // Обычный удар\n      this.state.recoilX = 0.3;\n      this.state.muzzleFlash = 1.0;\n      this.onSlice?.();\n    }\n  }\n\n  /** Зарядить катану (подбор на балконе) */\n  public chargeKatana(): void {\n    this.currentWeapon = 'charged';\n    this.splashCharges = 3; // 3 сплеш-удара\n  }\n\n  /** Проверить заряжена ли */\n  public isCharged(): boolean {\n    return this.splashCharges > 0;\n  }\n\n  /** Проверка попадания по врагу */\n  public checkHit(playerPos: Vec3, playerYaw: number, targetPos: Vec3): boolean {\n    if (!this.isAttacking) return false;\n    // Попадаем только в середине анимации\n    if (this.attackProgress < 0.2 || this.attackProgress > 0.6) return false;\n\n    // Вектор к цели\n    const dx = targetPos.x - playerPos.x;\n    const dz = targetPos.z - playerPos.z;\n    const dist = Math.sqrt(dx * dx + dz * dz);\n\n    // Сплеш-атака топором - бьёт всех в радиусе!\n    if (this.isSplashAttack) {\n      return dist <= this.splashRadius;\n    }\n\n    // Обычная атака катаной - проверка дистанции\n    if (dist > this.attackRange) return false;\n\n    // Проверка угла\n    const angleToTarget = Math.atan2(dx, -dz);\n    let angleDiff = angleToTarget - playerYaw;\n    \n    // Нормализуем угол\n    while (angleDiff > Math.PI) angleDiff -= Math.PI * 2;\n    while (angleDiff < -Math.PI) angleDiff += Math.PI * 2;\n\n    return Math.abs(angleDiff) < this.attackAngle / 2;\n  }\n\n  /** Получить смещение от покачивания */\n  public getWeaponOffset(): { x: number; y: number; z: number } {\n    const bobX = Math.sin(this.state.bobPhase) * 0.02;\n    const bobY = Math.abs(Math.sin(this.state.bobPhase * 2)) * 0.015;\n\n    // Анимация атаки\n    let attackOffsetX = 0;\n    let attackOffsetY = 0;\n\n    if (this.isAttacking) {\n      // Взмах справа налево\n      const t = this.attackProgress;\n      attackOffsetX = Math.sin(t * Math.PI) * 0.3;\n      attackOffsetY = -Math.sin(t * Math.PI * 2) * 0.1;\n    }\n\n    return {\n      x: bobX + this.state.recoilX + attackOffsetX,\n      y: bobY - this.state.recoilY + attackOffsetY,\n      z: 0,\n    };\n  }\n\n  // Заглушки для совместимости\n  public tryShoot(_playerPos: Vec3, _playerDir: Vec3): boolean {\n    return this.tryAttack();\n  }\n  \n  public startReload(): boolean {\n    return false;\n  }\n  \n  public projectiles: never[] = [];\n}\n","import type { WeaponState } from '@/types';\nimport type { WeaponType } from './Weapon';\n\n/** 2D частица для эффектов */\ninterface Particle {\n  x: number;\n  y: number;\n  vx: number;\n  vy: number;\n  size: number;\n  color: string;\n  life: number;\n  maxLife: number;\n  type: 'fragment' | 'spark' | 'trail';\n}\n\n/**\n * Рендерер катаны в стиле Retrowave\n * Неоновые эффекты при взмахе + частицы осколков\n */\nexport class WeaponRenderer {\n  private ctx: CanvasRenderingContext2D;\n  private width: number;\n  private height: number;\n\n  /** Прогресс атаки (0-1) */\n  public attackProgress = 0;\n\n  /** Сейчас атакуем? */\n  public isAttacking = false;\n\n  /** Это сплеш-атака? */\n  public isSplashAttack = false;\n\n  /** Заряды сплеша */\n  public splashCharges = 0;\n\n  /** Вспышка попадания */\n  private hitFlash = 0;\n\n  /** Частицы */\n  private particles: Particle[] = [];\n\n  /** Максимум частиц для производительности */\n  private static readonly MAX_PARTICLES = 50;\n\n  /** Активна сплеш-волна */\n  private splashWaveActive = false;\n  \n  /** Прогресс волны (0-1) */\n  private splashWaveProgress = 0;\n  \n  /** Направление волны (yaw) */\n  private splashWaveYaw = 0;\n\n  constructor(canvas: HTMLCanvasElement) {\n    this.ctx = canvas.getContext('2d')!;\n    this.width = canvas.width;\n    this.height = canvas.height;\n  }\n\n  public resize(width: number, height: number): void {\n    this.width = width;\n    this.height = height;\n  }\n\n  /** Показать эффект попадания - взрыв осколков! */\n  public showHitEffect(): void {\n    this.hitFlash = 1.0;\n    this.spawnFragments();\n  }\n\n  /** Показать эффект сплеш-атаки топором! */\n  public showSplashEffect(): void {\n    this.hitFlash = 1.2;\n    this.spawnAxeSplash();\n  }\n\n  /** Показать горизонтальную сплеш-волну! */\n  public showSplashWave(yaw: number): void {\n    this.splashWaveActive = true;\n    this.splashWaveProgress = 0;\n    this.splashWaveYaw = yaw;\n    this.hitFlash = 1.5;\n    this.spawnWaveParticles();\n  }\n\n  /** Создать частицы волны (оптимизировано) */\n  private spawnWaveParticles(): void {\n    if (this.particles.length > WeaponRenderer.MAX_PARTICLES) return;\n\n    const centerX = this.width / 2;\n    const centerY = this.height / 2;\n    const colors = ['#00ffff', '#00e5ff', '#00bfff', '#40e0d0'];\n\n    // Частицы расходятся горизонтально (уменьшено с 30 до 12)\n    for (let i = 0; i < 12; i++) {\n      const angle = (i / 12) * Math.PI - Math.PI / 2;\n      const speed = 600 + Math.random() * 300;\n      this.particles.push({\n        x: centerX,\n        y: centerY,\n        vx: Math.cos(angle) * speed,\n        vy: Math.sin(angle) * speed * 0.3,\n        size: 5 + Math.random() * 6,\n        color: colors[i % colors.length],\n        life: 0.4 + Math.random() * 0.3,\n        maxLife: 0.4 + Math.random() * 0.3,\n        type: 'spark',\n      });\n    }\n\n    // Большие капли энергии (уменьшено с 15 до 6)\n    for (let i = 0; i < 6; i++) {\n      const angle = (Math.random() - 0.5) * Math.PI * 0.8;\n      const speed = 600 + Math.random() * 300;\n      this.particles.push({\n        x: centerX + (Math.random() - 0.5) * 100,\n        y: centerY + (Math.random() - 0.5) * 50,\n        vx: Math.cos(angle) * speed,\n        vy: Math.sin(angle) * speed * 0.2,\n        size: 12 + Math.random() * 18,\n        color: colors[Math.floor(Math.random() * colors.length)],\n        life: 0.8 + Math.random() * 0.4,\n        maxLife: 0.8 + Math.random() * 0.4,\n        type: 'fragment',\n      });\n    }\n  }\n\n  /** Создать осколки врага (оптимизировано!) */\n  private spawnFragments(): void {\n    // Ограничиваем количество частиц\n    if (this.particles.length > WeaponRenderer.MAX_PARTICLES) return;\n\n    const centerX = this.width / 2;\n    const centerY = this.height / 2;\n    const colors = ['#00ff00', '#33ff00', '#66ff33', '#00ff66'];\n\n    // Крупные осколки (уменьшено с 12 до 6)\n    for (let i = 0; i < 6; i++) {\n      const angle = (i / 6) * Math.PI * 2 + Math.random() * 0.5;\n      const speed = 400 + Math.random() * 400;\n      this.particles.push({\n        x: centerX + (Math.random() - 0.5) * 40,\n        y: centerY + (Math.random() - 0.5) * 40,\n        vx: Math.cos(angle) * speed,\n        vy: Math.sin(angle) * speed - 150,\n        size: 6 + Math.random() * 8,\n        color: colors[i % colors.length],\n        life: 0.5 + Math.random() * 0.3,\n        maxLife: 0.5 + Math.random() * 0.3,\n        type: 'fragment',\n      });\n    }\n\n    // Искры (уменьшено с 25 до 10)\n    for (let i = 0; i < 10; i++) {\n      const angle = Math.random() * Math.PI * 2;\n      const speed = 200 + Math.random() * 300;\n      this.particles.push({\n        x: centerX + (Math.random() - 0.5) * 20,\n        y: centerY + (Math.random() - 0.5) * 20,\n        vx: Math.cos(angle) * speed,\n        vy: Math.sin(angle) * speed - 80,\n        size: 2 + Math.random() * 3,\n        color: colors[i % colors.length],\n        life: 0.3 + Math.random() * 0.2,\n        maxLife: 0.3 + Math.random() * 0.2,\n        type: 'spark',\n      });\n    }\n  }\n\n  /** Обновить частицы (оптимизировано) */\n  private updateParticles(dt: number): void {\n    const gravity = 800;\n    const heightLimit = this.height + 50;\n    let writeIndex = 0;\n\n    // Обновляем и фильтруем за один проход (без splice)\n    for (let i = 0; i < this.particles.length; i++) {\n      const p = this.particles[i];\n\n      // Физика\n      p.x += p.vx * dt;\n      p.y += p.vy * dt;\n      p.vy += gravity * dt;\n      p.vx *= 0.98;\n      p.life -= dt;\n\n      // Сохраняем живые частицы\n      if (p.life > 0 && p.y < heightLimit) {\n        this.particles[writeIndex++] = p;\n      }\n    }\n\n    // Обрезаем массив\n    this.particles.length = writeIndex;\n  }\n\n  /** Рендер частиц (оптимизировано - без градиентов и теней!) */\n  private renderParticles(ctx: CanvasRenderingContext2D): void {\n    // Отключаем тени для производительности\n    ctx.shadowBlur = 0;\n\n    for (const p of this.particles) {\n      const alpha = Math.min(1, p.life / p.maxLife * 2);\n\n      ctx.globalAlpha = alpha;\n      ctx.fillStyle = p.color;\n\n      if (p.type === 'fragment') {\n        // Простой круг вместо сложной формы\n        ctx.beginPath();\n        ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);\n        ctx.fill();\n\n        // Яркий центр\n        ctx.globalAlpha = alpha * 0.8;\n        ctx.fillStyle = '#ffffff';\n        ctx.beginPath();\n        ctx.arc(p.x, p.y, p.size * 0.4, 0, Math.PI * 2);\n        ctx.fill();\n\n      } else {\n        // Искра - простой круг\n        ctx.beginPath();\n        ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);\n        ctx.fill();\n\n        // Короткий хвост\n        ctx.globalAlpha = alpha * 0.5;\n        ctx.strokeStyle = p.color;\n        ctx.lineWidth = p.size * 0.5;\n        ctx.beginPath();\n        ctx.moveTo(p.x, p.y);\n        ctx.lineTo(p.x - p.vx * 0.02, p.y - p.vy * 0.02);\n        ctx.stroke();\n      }\n    }\n\n    // Восстанавливаем альфу\n    ctx.globalAlpha = 1;\n  }\n\n  public render(state: WeaponState, time: number): void {\n    const ctx = this.ctx;\n    ctx.clearRect(0, 0, this.width, this.height);\n\n    // Обновляем частицы\n    this.updateParticles(1 / 60);\n\n    // Обновляем сплеш-волну\n    if (this.splashWaveActive) {\n      this.splashWaveProgress += 0.03;\n      if (this.splashWaveProgress >= 1) {\n        this.splashWaveActive = false;\n      }\n    }\n\n    const scale = Math.min(this.width, this.height) / 600;\n\n    // Покачивание\n    const bobX = Math.sin(state.bobPhase) * 8 * scale;\n    const bobY = Math.abs(Math.sin(state.bobPhase * 2)) * 6 * scale;\n\n    // Затухание вспышки попадания\n    if (this.hitFlash > 0) {\n      this.hitFlash -= 0.04;\n    }\n\n    // Рисуем сплеш-волну на фоне\n    if (this.splashWaveActive) {\n      this.drawSplashWaveEffect(ctx, time);\n    }\n\n    ctx.save();\n\n    // Позиция оружия\n    let baseX = this.width * 0.65;\n    let baseY = this.height * 0.8;\n    let rotation = -0.4;\n\n    // Анимация атаки - мощный взмах\n    if (this.isAttacking) {\n      const t = this.attackProgress;\n      // Быстрый взмах с замедлением в конце\n      const easeOut = 1 - Math.pow(1 - t, 3);\n      // Сплеш-атака - более мощный горизонтальный взмах\n      const swingAngle = Math.sin(easeOut * Math.PI) * (this.isSplashAttack ? 3.2 : 2.5);\n      rotation = -0.4 - swingAngle;\n\n      // Движение к центру и вверх (сплеш движется сильнее)\n      const moveMultiplier = this.isSplashAttack ? 1.5 : 1.0;\n      baseX -= Math.sin(t * Math.PI) * this.width * 0.3 * moveMultiplier;\n      baseY -= Math.sin(t * Math.PI) * this.height * 0.15 * moveMultiplier;\n    }\n\n    ctx.translate(baseX + bobX, baseY + bobY);\n    ctx.rotate(rotation);\n    ctx.scale(scale, scale);\n\n    // Эффект следа\n    if (this.isAttacking && this.attackProgress > 0.05 && this.attackProgress < 0.8) {\n      if (this.isSplashAttack) {\n        this.drawSplashSlash(ctx, this.attackProgress, time);\n      } else {\n        this.drawRetrowaveSlash(ctx, this.attackProgress, time);\n      }\n    }\n\n    // Катана (всегда катана теперь)\n    this.drawKatana(ctx, state, time);\n\n    // Индикатор заряда сверху катаны если есть заряды\n    if (this.splashCharges > 0) {\n      this.drawChargeIndicator(ctx, time);\n    }\n\n    // Эффект попадания\n    if (this.hitFlash > 0) {\n      this.drawHitGlow(ctx, this.hitFlash, this.isSplashAttack ? 'charged' : 'katana');\n    }\n\n    ctx.restore();\n\n    // Рендерим частицы поверх всего\n    this.renderParticles(ctx);\n\n    // Полноэкранная вспышка при попадании\n    if (this.hitFlash > 0.5) {\n      this.drawScreenFlash(ctx, this.isSplashAttack ? 'charged' : 'katana');\n    }\n  }\n\n  /** Рисуем индикатор заряда */\n  private drawChargeIndicator(ctx: CanvasRenderingContext2D, time: number): void {\n    // 3 точки энергии вдоль лезвия\n    ctx.save();\n    ctx.shadowColor = '#00ffff';\n    ctx.shadowBlur = 15;\n    \n    for (let i = 0; i < 3; i++) {\n      const y = -50 - i * 60;\n      const pulse = 0.7 + 0.3 * Math.sin(time * 5 + i);\n      \n      if (this.splashCharges > i) {\n        ctx.fillStyle = `rgba(0, 255, 255, ${pulse})`;\n        ctx.beginPath();\n        ctx.arc(0, y, 8, 0, Math.PI * 2);\n        ctx.fill();\n        \n        // Внешнее кольцо\n        ctx.strokeStyle = `rgba(0, 255, 255, ${pulse * 0.5})`;\n        ctx.lineWidth = 2;\n        ctx.beginPath();\n        ctx.arc(0, y, 12 + Math.sin(time * 8 + i) * 3, 0, Math.PI * 2);\n        ctx.stroke();\n      } else {\n        ctx.fillStyle = 'rgba(100, 100, 100, 0.3)';\n        ctx.beginPath();\n        ctx.arc(0, y, 6, 0, Math.PI * 2);\n        ctx.fill();\n      }\n    }\n    \n    ctx.restore();\n  }\n\n  /** Эффект сплеш-волны на экране */\n  private drawSplashWaveEffect(ctx: CanvasRenderingContext2D, time: number): void {\n    const centerX = this.width / 2;\n    const centerY = this.height / 2;\n    const maxRadius = Math.max(this.width, this.height) * 0.8;\n    const currentRadius = this.splashWaveProgress * maxRadius;\n    \n    ctx.save();\n    \n    // Несколько концентрических волн\n    for (let i = 0; i < 3; i++) {\n      const r = currentRadius - i * 30;\n      if (r > 0) {\n        const alpha = (1 - this.splashWaveProgress) * (0.5 - i * 0.1);\n        \n        // Основная волна\n        ctx.strokeStyle = `rgba(0, 255, 255, ${alpha})`;\n        ctx.lineWidth = 8 - i * 2;\n        ctx.shadowColor = '#00ffff';\n        ctx.shadowBlur = 20;\n        \n        ctx.beginPath();\n        // Рисуем полукруг вперёд (горизонтальная волна)\n        ctx.ellipse(centerX, centerY + 100, r, r * 0.3, 0, Math.PI, 0);\n        ctx.stroke();\n        \n        // Искрящаяся линия\n        if (i === 0) {\n          ctx.strokeStyle = `rgba(255, 255, 255, ${alpha * 0.8})`;\n          ctx.lineWidth = 2;\n          ctx.beginPath();\n          ctx.ellipse(centerX, centerY + 100, r - 5, (r - 5) * 0.3, 0, Math.PI, 0);\n          ctx.stroke();\n        }\n      }\n    }\n    \n    // Добавляем искры на волне\n    const sparkCount = Math.floor((1 - this.splashWaveProgress) * 20);\n    ctx.fillStyle = '#ffffff';\n    for (let i = 0; i < sparkCount; i++) {\n      const angle = Math.PI + Math.random() * Math.PI;\n      const sparkR = currentRadius + (Math.random() - 0.5) * 20;\n      const x = centerX + Math.cos(angle) * sparkR;\n      const y = centerY + 100 + Math.sin(angle) * sparkR * 0.3;\n      const size = 2 + Math.random() * 4;\n      \n      ctx.beginPath();\n      ctx.arc(x, y, size, 0, Math.PI * 2);\n      ctx.fill();\n    }\n    \n    ctx.restore();\n  }\n\n  /** След сплеш-атаки (более широкий и яркий) */\n  private drawSplashSlash(ctx: CanvasRenderingContext2D, progress: number, time: number): void {\n    ctx.save();\n    ctx.globalCompositeOperation = 'lighter';\n\n    // Основной широкий след - бирюзовый\n    const cyanGrad = ctx.createLinearGradient(-200, -350, 50, 0);\n    cyanGrad.addColorStop(0, 'rgba(0, 255, 255, 0)');\n    cyanGrad.addColorStop(0.3, 'rgba(0, 255, 255, 0.8)');\n    cyanGrad.addColorStop(0.6, 'rgba(0, 255, 255, 1)');\n    cyanGrad.addColorStop(1, 'rgba(0, 255, 255, 0)');\n\n    ctx.strokeStyle = cyanGrad;\n    ctx.lineWidth = 30 + Math.sin(progress * Math.PI) * 20; // Шире!\n    ctx.lineCap = 'round';\n    ctx.shadowColor = '#00ffff';\n    ctx.shadowBlur = 40;\n\n    ctx.beginPath();\n    ctx.moveTo(-200, -350);\n    ctx.quadraticCurveTo(\n      -100 + Math.sin(time * 30) * 20,\n      -200,\n      50, 0\n    );\n    ctx.stroke();\n\n    // Внутреннее ядро - белое\n    ctx.strokeStyle = 'rgba(255, 255, 255, 0.9)';\n    ctx.lineWidth = 6;\n    ctx.shadowBlur = 20;\n    ctx.stroke();\n\n    // Дополнительные волны\n    for (let i = 0; i < 3; i++) {\n      const offset = i * 15;\n      ctx.strokeStyle = `rgba(0, 200, 255, ${0.4 - i * 0.1})`;\n      ctx.lineWidth = 4 - i;\n      ctx.beginPath();\n      ctx.moveTo(-200 - offset, -350 + offset);\n      ctx.quadraticCurveTo(\n        -100 - offset + Math.sin(time * 30 + i) * 15,\n        -200 + offset,\n        50 - offset, 0 + offset\n      );\n      ctx.stroke();\n    }\n\n    ctx.restore();\n  }\n\n  private drawKatana(ctx: CanvasRenderingContext2D, _state: WeaponState, time: number): void {\n    // === РУКА ===\n    ctx.fillStyle = '#8a7a6a';\n    ctx.beginPath();\n    ctx.ellipse(0, 80, 40, 50, 0.2, 0, Math.PI * 2);\n    ctx.fill();\n\n    // === ЦУКА (рукоять) ===\n    const tsukaGrad = ctx.createLinearGradient(0, 40, 0, 160);\n    tsukaGrad.addColorStop(0, '#2a1a1a');\n    tsukaGrad.addColorStop(0.5, '#1a0a0a');\n    tsukaGrad.addColorStop(1, '#2a1a1a');\n\n    ctx.fillStyle = tsukaGrad;\n    ctx.beginPath();\n    ctx.moveTo(-14, 40);\n    ctx.lineTo(14, 40);\n    ctx.lineTo(12, 160);\n    ctx.lineTo(-12, 160);\n    ctx.closePath();\n    ctx.fill();\n\n    // Обмотка с неоном\n    ctx.strokeStyle = '#ff00ff';\n    ctx.shadowColor = '#ff00ff';\n    ctx.shadowBlur = 10;\n    ctx.lineWidth = 2;\n    for (let i = 0; i < 10; i++) {\n      const y = 50 + i * 11;\n      const glow = 0.5 + 0.5 * Math.sin(time * 3 + i * 0.5);\n      ctx.strokeStyle = `rgba(255, 0, 255, ${glow})`;\n      ctx.beginPath();\n      ctx.moveTo(-12, y);\n      ctx.lineTo(0, y + 5);\n      ctx.lineTo(12, y);\n      ctx.stroke();\n    }\n    ctx.shadowBlur = 0;\n\n    // === ЦУБА (гарда) - неоновая ===\n    ctx.fillStyle = '#1a1a2a';\n    ctx.beginPath();\n    ctx.ellipse(0, 35, 35, 12, 0, 0, Math.PI * 2);\n    ctx.fill();\n\n    // Неоновый контур гарды\n    ctx.strokeStyle = '#00ffff';\n    ctx.shadowColor = '#00ffff';\n    ctx.shadowBlur = 15;\n    ctx.lineWidth = 2;\n    ctx.beginPath();\n    ctx.ellipse(0, 35, 32, 10, 0, 0, Math.PI * 2);\n    ctx.stroke();\n    ctx.shadowBlur = 0;\n\n    // === КЛИНОК ===\n    // Основа\n    const bladeGrad = ctx.createLinearGradient(-10, 0, 10, 0);\n    bladeGrad.addColorStop(0, '#8080a0');\n    bladeGrad.addColorStop(0.3, '#c0c0e0');\n    bladeGrad.addColorStop(0.5, '#ffffff');\n    bladeGrad.addColorStop(0.7, '#c0c0e0');\n    bladeGrad.addColorStop(1, '#6060a0');\n\n    ctx.fillStyle = bladeGrad;\n    ctx.beginPath();\n    ctx.moveTo(-10, 30);\n    ctx.lineTo(10, 30);\n    ctx.lineTo(7, -280);\n    ctx.lineTo(0, -320);\n    ctx.lineTo(-5, -280);\n    ctx.closePath();\n    ctx.fill();\n\n    // Неоновая кромка\n    ctx.strokeStyle = '#00ffff';\n    ctx.shadowColor = '#00ffff';\n    ctx.shadowBlur = 8;\n    ctx.lineWidth = 2;\n    ctx.beginPath();\n    ctx.moveTo(9, 30);\n    ctx.lineTo(6, -280);\n    ctx.lineTo(0, -320);\n    ctx.stroke();\n\n    // Пульсирующий хамон\n    ctx.strokeStyle = `rgba(255, 0, 255, ${0.5 + 0.3 * Math.sin(time * 4)})`;\n    ctx.shadowColor = '#ff00ff';\n    ctx.shadowBlur = 5;\n    ctx.lineWidth = 1.5;\n    ctx.beginPath();\n    ctx.moveTo(-4, 30);\n    for (let i = 0; i < 25; i++) {\n      const y = 30 - i * 13;\n      const wave = Math.sin(i * 0.7 + time * 2) * 4;\n      ctx.lineTo(-4 + wave, y);\n    }\n    ctx.stroke();\n    ctx.shadowBlur = 0;\n\n    // Блик\n    ctx.fillStyle = 'rgba(255, 255, 255, 0.4)';\n    ctx.beginPath();\n    ctx.moveTo(3, 25);\n    ctx.lineTo(5, 25);\n    ctx.lineTo(3, -270);\n    ctx.lineTo(1, -270);\n    ctx.closePath();\n    ctx.fill();\n  }\n\n  private drawRetrowaveSlash(ctx: CanvasRenderingContext2D, progress: number, time: number): void {\n    ctx.save();\n    ctx.translate(0, -150);\n\n    const alpha = Math.sin(progress * Math.PI);\n\n    // Множественные неоновые дуги\n    const colors = [\n      { color: '#ff00ff', offset: 0 },\n      { color: '#00ffff', offset: 15 },\n      { color: '#ff0080', offset: 30 },\n      { color: '#8000ff', offset: 45 },\n    ];\n\n    for (const { color, offset } of colors) {\n      ctx.strokeStyle = color;\n      ctx.shadowColor = color;\n      ctx.shadowBlur = 25;\n      ctx.lineWidth = 10 - offset * 0.15;\n      ctx.lineCap = 'round';\n\n      ctx.beginPath();\n      ctx.arc(0, 100, 200 + offset, -Math.PI * 0.7, Math.PI * 0.15);\n      ctx.globalAlpha = alpha * (1 - offset * 0.015);\n      ctx.stroke();\n    }\n\n    // Искры\n    ctx.globalAlpha = alpha;\n    for (let i = 0; i < 15; i++) {\n      const angle = -Math.PI * 0.7 + (Math.PI * 0.85) * (i / 15) + Math.sin(time * 10 + i) * 0.1;\n      const dist = 200 + Math.random() * 50;\n      const x = Math.cos(angle) * dist;\n      const y = 100 + Math.sin(angle) * dist;\n\n      const sparkColor = i % 2 === 0 ? '#ff00ff' : '#00ffff';\n      ctx.fillStyle = sparkColor;\n      ctx.shadowColor = sparkColor;\n      ctx.shadowBlur = 15;\n      ctx.beginPath();\n      ctx.arc(x, y, 4 + Math.random() * 4, 0, Math.PI * 2);\n      ctx.fill();\n    }\n\n    ctx.globalAlpha = 1;\n    ctx.shadowBlur = 0;\n    ctx.restore();\n  }\n\n  /** Рисуем ТОПОР ХАОСА - как катана, но с широким лезвием! */\n  private drawAxe(ctx: CanvasRenderingContext2D, _state: WeaponState, time: number, charges: number): void {\n    // === РУКА ===\n    ctx.fillStyle = '#8a7a6a';\n    ctx.beginPath();\n    ctx.ellipse(0, 80, 40, 50, 0.2, 0, Math.PI * 2);\n    ctx.fill();\n\n    // === РУКОЯТЬ (как у катаны) ===\n    const tsukaGrad = ctx.createLinearGradient(0, 40, 0, 160);\n    tsukaGrad.addColorStop(0, '#3a2010');\n    tsukaGrad.addColorStop(0.5, '#2a1005');\n    tsukaGrad.addColorStop(1, '#3a2010');\n\n    ctx.fillStyle = tsukaGrad;\n    ctx.beginPath();\n    ctx.moveTo(-14, 40);\n    ctx.lineTo(14, 40);\n    ctx.lineTo(12, 160);\n    ctx.lineTo(-12, 160);\n    ctx.closePath();\n    ctx.fill();\n\n    // Обмотка - огненная (как у катаны но оранжевая)\n    ctx.strokeStyle = '#ff6600';\n    ctx.shadowColor = '#ff6600';\n    ctx.shadowBlur = 10;\n    ctx.lineWidth = 2;\n    for (let i = 0; i < 10; i++) {\n      const y = 50 + i * 11;\n      const glow = 0.5 + 0.5 * Math.sin(time * 4 + i * 0.5);\n      ctx.strokeStyle = `rgba(255, 100, 0, ${glow})`;\n      ctx.beginPath();\n      ctx.moveTo(-12, y);\n      ctx.lineTo(0, y + 5);\n      ctx.lineTo(12, y);\n      ctx.stroke();\n    }\n    ctx.shadowBlur = 0;\n\n    // === ГАРДА (как цуба но квадратная) ===\n    ctx.fillStyle = '#2a2020';\n    ctx.beginPath();\n    ctx.rect(-30, 25, 60, 20);\n    ctx.fill();\n\n    // Огненный контур гарды\n    ctx.strokeStyle = '#ff6600';\n    ctx.shadowColor = '#ff6600';\n    ctx.shadowBlur = 15;\n    ctx.lineWidth = 2;\n    ctx.strokeRect(-28, 27, 56, 16);\n    ctx.shadowBlur = 0;\n\n    // === ЛЕЗВИЕ ТОПОРА (широкое, как секира) ===\n    // Основа - широкий клинок\n    const bladeGrad = ctx.createLinearGradient(-40, 0, 40, 0);\n    bladeGrad.addColorStop(0, '#6060a0');\n    bladeGrad.addColorStop(0.2, '#8080b0');\n    bladeGrad.addColorStop(0.4, '#b0b0d0');\n    bladeGrad.addColorStop(0.5, '#e0e0f0');\n    bladeGrad.addColorStop(0.6, '#b0b0d0');\n    bladeGrad.addColorStop(0.8, '#8080b0');\n    bladeGrad.addColorStop(1, '#6060a0');\n\n    ctx.fillStyle = bladeGrad;\n    ctx.beginPath();\n    // Широкое лезвие секиры\n    ctx.moveTo(-12, 20);\n    ctx.lineTo(12, 20);\n    ctx.lineTo(15, -50);\n    // Расширение к голове\n    ctx.lineTo(50, -180);\n    ctx.lineTo(55, -220);\n    // Острие\n    ctx.lineTo(0, -300);\n    // Обратная сторона\n    ctx.lineTo(-55, -220);\n    ctx.lineTo(-50, -180);\n    ctx.lineTo(-15, -50);\n    ctx.closePath();\n    ctx.fill();\n\n    // Огненная кромка (как неоновая у катаны но оранжевая)\n    ctx.strokeStyle = '#ff6600';\n    ctx.shadowColor = '#ff6600';\n    ctx.shadowBlur = 12;\n    ctx.lineWidth = 3;\n    ctx.beginPath();\n    ctx.moveTo(14, 20);\n    ctx.lineTo(52, -180);\n    ctx.lineTo(57, -220);\n    ctx.lineTo(0, -305);\n    ctx.stroke();\n\n    // Вторая кромка\n    ctx.beginPath();\n    ctx.moveTo(-14, 20);\n    ctx.lineTo(-52, -180);\n    ctx.lineTo(-57, -220);\n    ctx.lineTo(0, -305);\n    ctx.stroke();\n\n    // Пульсирующая линия по центру (как хамон)\n    ctx.strokeStyle = `rgba(255, 150, 0, ${0.5 + 0.3 * Math.sin(time * 5)})`;\n    ctx.shadowColor = '#ff9900';\n    ctx.shadowBlur = 8;\n    ctx.lineWidth = 2;\n    ctx.beginPath();\n    ctx.moveTo(0, 15);\n    for (let i = 0; i < 20; i++) {\n      const y = 15 - i * 15;\n      const wave = Math.sin(i * 0.8 + time * 3) * (3 + i * 0.3);\n      ctx.lineTo(wave, y);\n    }\n    ctx.stroke();\n    ctx.shadowBlur = 0;\n\n    // Индикатор зарядов - огненные точки вдоль лезвия\n    for (let i = 0; i < 5; i++) {\n      const y = -50 - i * 45;\n      \n      if (i < charges) {\n        ctx.fillStyle = '#ff8800';\n        ctx.shadowColor = '#ff8800';\n        ctx.shadowBlur = 15;\n      } else {\n        ctx.fillStyle = '#333333';\n        ctx.shadowColor = 'transparent';\n        ctx.shadowBlur = 0;\n      }\n      \n      ctx.beginPath();\n      ctx.arc(0, y, 4, 0, Math.PI * 2);\n      ctx.fill();\n    }\n    ctx.shadowBlur = 0;\n\n    // Блик\n    ctx.fillStyle = 'rgba(255, 255, 255, 0.4)';\n    ctx.beginPath();\n    ctx.moveTo(5, 15);\n    ctx.lineTo(8, 15);\n    ctx.lineTo(40, -170);\n    ctx.lineTo(37, -170);\n    ctx.closePath();\n    ctx.fill();\n  }\n\n  /** След от топора - как у катаны но с разлётом! */\n  private drawAxeSlash(ctx: CanvasRenderingContext2D, progress: number, time: number): void {\n    ctx.save();\n    ctx.translate(0, -150);\n\n    const alpha = Math.sin(progress * Math.PI);\n\n    // Огненные дуги (как у катаны)\n    const colors = [\n      { color: '#ff6600', offset: 0 },\n      { color: '#ff9900', offset: 15 },\n      { color: '#ff3300', offset: 30 },\n      { color: '#ffcc00', offset: 45 },\n    ];\n\n    for (const { color, offset } of colors) {\n      ctx.strokeStyle = color;\n      ctx.shadowColor = color;\n      ctx.shadowBlur = 25;\n      ctx.lineWidth = 12 - offset * 0.15;\n      ctx.lineCap = 'round';\n\n      ctx.beginPath();\n      ctx.arc(0, 100, 200 + offset, -Math.PI * 0.7, Math.PI * 0.15);\n      ctx.globalAlpha = alpha * (1 - offset * 0.015);\n      ctx.stroke();\n    }\n\n    // Искры разлетаются!\n    ctx.globalAlpha = alpha;\n    for (let i = 0; i < 15; i++) {\n      const angle = -Math.PI * 0.7 + (Math.PI * 0.85) * (i / 15) + Math.sin(time * 10 + i) * 0.1;\n      const dist = 200 + Math.random() * 50;\n      const x = Math.cos(angle) * dist;\n      const y = 100 + Math.sin(angle) * dist;\n\n      const sparkColor = i % 2 === 0 ? '#ff6600' : '#ffaa00';\n      ctx.fillStyle = sparkColor;\n      ctx.shadowColor = sparkColor;\n      ctx.shadowBlur = 15;\n      ctx.beginPath();\n      ctx.arc(x, y, 4 + Math.random() * 4, 0, Math.PI * 2);\n      ctx.fill();\n    }\n\n    ctx.globalAlpha = 1;\n    ctx.shadowBlur = 0;\n    ctx.restore();\n  }\n\n  /** Создать огненные осколки при сплеше топора (оптимизировано) */\n  public spawnAxeSplash(): void {\n    if (this.particles.length > WeaponRenderer.MAX_PARTICLES) return;\n\n    const centerX = this.width / 2;\n    const centerY = this.height / 2;\n    const colors = ['#ff6600', '#ff9900', '#ff3300', '#ffcc00'];\n\n    // Крупные огненные осколки (уменьшено с 20 до 8)\n    for (let i = 0; i < 8; i++) {\n      const angle = (i / 8) * Math.PI * 2 + Math.random() * 0.3;\n      const speed = 400 + Math.random() * 500;\n      this.particles.push({\n        x: centerX + (Math.random() - 0.5) * 60,\n        y: centerY + (Math.random() - 0.5) * 60,\n        vx: Math.cos(angle) * speed,\n        vy: Math.sin(angle) * speed - 120,\n        size: 8 + Math.random() * 10,\n        color: colors[i % colors.length],\n        life: 0.5 + Math.random() * 0.3,\n        maxLife: 0.5 + Math.random() * 0.3,\n        type: 'fragment',\n      });\n    }\n\n    // Искры (уменьшено с 35 до 12)\n    for (let i = 0; i < 12; i++) {\n      const angle = Math.random() * Math.PI * 2;\n      const speed = 250 + Math.random() * 400;\n      this.particles.push({\n        x: centerX + (Math.random() - 0.5) * 30,\n        y: centerY + (Math.random() - 0.5) * 30,\n        vx: Math.cos(angle) * speed,\n        vy: Math.sin(angle) * speed - 80,\n        size: 2 + Math.random() * 4,\n        color: colors[i % colors.length],\n        life: 0.3 + Math.random() * 0.3,\n        maxLife: 0.3 + Math.random() * 0.3,\n        type: 'spark',\n      });\n    }\n  }\n\n  private drawHitGlow(ctx: CanvasRenderingContext2D, intensity: number, weaponType: WeaponType = 'katana'): void {\n    ctx.save();\n    ctx.globalAlpha = intensity;\n\n    if (weaponType === 'charged') {\n      // Электрическое свечение для заряженной катаны\n      ctx.strokeStyle = '#ffffff';\n      ctx.shadowColor = '#00ffff';\n      ctx.shadowBlur = 50 * intensity;\n      ctx.lineWidth = 10;\n\n      // Обводка всего лезвия\n      ctx.beginPath();\n      ctx.moveTo(9, 30);\n      ctx.lineTo(6, -280);\n      ctx.lineTo(0, -320);\n      ctx.stroke();\n\n      // Дополнительные волны энергии\n      ctx.strokeStyle = '#00ffff';\n      ctx.shadowColor = '#0088ff';\n      ctx.shadowBlur = 30 * intensity;\n      ctx.lineWidth = 4;\n      for (let i = 0; i < 3; i++) {\n        ctx.beginPath();\n        ctx.arc(0, -150, 50 + i * 30, 0, Math.PI * 2);\n        ctx.stroke();\n      }\n    } else {\n      // Неоновое свечение для катаны\n      ctx.strokeStyle = '#ffffff';\n      ctx.shadowColor = '#00ffff';\n      ctx.shadowBlur = 30 * intensity;\n      ctx.lineWidth = 6;\n\n      ctx.beginPath();\n      ctx.moveTo(9, 30);\n      ctx.lineTo(6, -280);\n      ctx.lineTo(0, -320);\n      ctx.stroke();\n\n      ctx.strokeStyle = '#ff00ff';\n      ctx.shadowColor = '#ff00ff';\n      ctx.shadowBlur = 20 * intensity;\n      ctx.lineWidth = 3;\n      ctx.stroke();\n    }\n\n    ctx.restore();\n  }\n\n  private drawScreenFlash(ctx: CanvasRenderingContext2D, weaponType: WeaponType = 'katana'): void {\n    ctx.save();\n    ctx.resetTransform();\n\n    const gradient = ctx.createRadialGradient(\n      this.width / 2, this.height / 2, 0,\n      this.width / 2, this.height / 2, this.width\n    );\n    \n    if (weaponType === 'charged') {\n      // Электрическая вспышка для заряженной катаны\n      gradient.addColorStop(0, `rgba(255, 255, 255, ${this.hitFlash * 0.6})`);\n      gradient.addColorStop(0.2, `rgba(0, 255, 255, ${this.hitFlash * 0.4})`);\n      gradient.addColorStop(0.5, `rgba(0, 150, 255, ${this.hitFlash * 0.2})`);\n      gradient.addColorStop(0.8, `rgba(0, 80, 255, ${this.hitFlash * 0.1})`);\n      gradient.addColorStop(1, 'rgba(0, 0, 0, 0)');\n    } else {\n      // Неоновая вспышка для катаны\n      gradient.addColorStop(0, `rgba(255, 255, 255, ${this.hitFlash * 0.4})`);\n      gradient.addColorStop(0.3, `rgba(255, 0, 255, ${this.hitFlash * 0.2})`);\n      gradient.addColorStop(0.6, `rgba(0, 255, 255, ${this.hitFlash * 0.1})`);\n      gradient.addColorStop(1, 'rgba(0, 0, 0, 0)');\n    }\n\n    ctx.fillStyle = gradient;\n    ctx.fillRect(0, 0, this.width, this.height);\n\n    ctx.restore();\n  }\n}\n","import type { Vec3, ICollisionSystem } from '@/types';\nimport { vec3, distanceVec3, normalizeVec3 } from '@/utils/math';\n\n/** Тип врага */\nexport type EnemyType = 'baneling' | 'phantom' | 'runner' | 'hopper' | 'boss_green' | 'boss_black' | 'boss_blue';\n\n/** Осколок после разрубания */\nexport interface Fragment {\n  position: Vec3;\n  velocity: Vec3;\n  size: number;\n  lifetime: number;\n  rotation: number;\n  rotationSpeed: number;\n}\n\n/** Токсичная лужа (от Зелёного Босса) */\nexport interface ToxicPool {\n  position: Vec3;\n  radius: number;\n  maxRadius: number;      // Максимальный радиус после растекания\n  lifetime: number;\n  maxLifetime: number;    // Начальное время жизни\n  damage: number;\n  spreadProgress: number; // 0-1 прогресс растекания\n}\n\n/** Зона кислотного дождя (метка на земле → дождь сверху) */\nexport interface AcidRainZone {\n  position: Vec3;         // Центр зоны\n  radius: number;         // Радиус зоны\n  lifetime: number;       // Время жизни\n  markTime: number;       // Время показа метки перед дождём\n  isRaining: boolean;     // Идёт ли дождь\n  damage: number;         // Урон за тик\n}\n\n/** Снаряд кислоты (летящий плевок) */\nexport interface AcidProjectile {\n  position: Vec3;      // Текущая позиция\n  targetPos: Vec3;     // Куда летит\n  startPos: Vec3;      // Откуда летит\n  progress: number;    // 0-1 прогресс полёта\n  flightTime: number;  // Время полёта\n}\n\n/** Роль зелёного босса в паре */\nexport type GreenBossRole = 'hunter' | 'blocker';\n\n/**\n * Враг-шар который летит к игроку\n * - baneling: зелёная жижа, взрывается при столкновении\n * - phantom: чёрный шар, пронзает насквозь с инерцией\n */\nexport class Target {\n  /** Позиция */\n  public position: Vec3;\n\n  /** Скорость полёта */\n  public velocity: Vec3 = vec3();\n\n  /** Радиус */\n  public radius = 0.8;\n\n  /** Активен? */\n  public active = true;\n\n  /** Базовая скорость движения */\n  public speed = 4.0;\n\n  /** Интенсивность огня (для шейдера) */\n  public fireIntensity = 1.0;\n\n  /** Осколки после разрубания */\n  public fragments: Fragment[] = [];\n\n  /** Время до удаления */\n  private removeTimer = 0;\n\n  /** Уникальный ID для разного поведения */\n  private id: number;\n\n  /** Фаза синусоиды */\n  private phase: number;\n\n  /** Тип движения (0-3) */\n  private moveType: number;\n\n  /** Тип врага */\n  public enemyType: EnemyType = 'baneling';\n\n  /** Урон при столкновении */\n  public damage: number = 25;\n\n  /** Фантом: текущая скорость (для разгона) */\n  private currentSpeed = 0;\n\n  /** Фантом: набирает разгон? */\n  private isCharging = true;\n\n  /** Фантом: направление атаки (фиксируется при разгоне) */\n  private chargeDirection: Vec3 = vec3();\n\n  /** Фантом: время после пролёта через игрока */\n  private passedThroughTimer = 0;\n\n  /** Hopper: вертикальная скорость */\n  private verticalVelocity = 0;\n\n  /** Hopper: на земле? */\n  private onGround = true;\n\n  /** Hopper: время до следующего прыжка */\n  private hopTimer = 0;\n\n  /** Runner: угол уклонения */\n  private dodgeAngle = 0;\n\n  /** Runner: время до смены направления */\n  private dodgeTimer = 0;\n\n  /** Runner: прицепился к игроку? */\n  public isAttached = false;\n\n  /** Runner: время на прицепе (сколько осталось чтобы скинуть) */\n  public attachTimer = 0;\n\n  /** Runner: угол вращения вокруг игрока */\n  private orbitAngle = 0;\n\n  /** Босс: HP (обычные враги имеют 1) */\n  public hp = 1;\n  public maxHp = 1;\n\n  /** Босс: это босс? */\n  public isBoss = false;\n\n  /** Синий босс: таймер телепортации */\n  private teleportTimer = 0;\n\n  /** Чёрный босс: интенсивность искривления */\n  public distortionPower = 0;\n\n  /** Чёрный босс: таймер спавна фантома */\n  private spawnPhantomTimer = 5.0;\n\n  /** Чёрный босс: фаза вихря (всасывание) */\n  public isVortexActive = false;\n  private vortexTimer = 0;\n  private vortexCooldown = 0;\n  private vortexWarningPlayed = false;\n\n  /** Чёрный босс: колбэк спавна фантома */\n  public onSpawnPhantom?: (pos: Vec3) => void;\n\n  /** Чёрный босс: колбэк начала вихря (для звука) */\n  public onVortexStart?: () => void;\n  public onVortexEnd?: () => void;\n  /** Колбэк предупреждения о вихре (райзер) */\n  public onVortexWarning?: () => void;\n\n  /** Зелёный босс: таймер создания лужи */\n  private poolTimer = 0;\n\n  /** Зелёный босс: таймер плевка */\n  private spitTimer = 0;\n  private spitCooldown = 3.0;\n\n  /** Зелёный босс: роль (охотник/загонщик) */\n  public greenBossRole: GreenBossRole = 'hunter';\n\n  /** Зелёный босс: последняя известная скорость игрока */\n  private lastPlayerPos: Vec3 = vec3();\n  private playerVelocity: Vec3 = vec3();\n\n  /** Callback при плевке (стартовая позиция, целевая позиция) */\n  public onSpit?: (startPos: Vec3, targetPos: Vec3) => void;\n\n  /** Callback при установке метки кислотного дождя */\n  public onAcidRainMark?: (pos: Vec3) => void;\n\n  /** Зелёный босс: фаза (1 или 2) */\n  public bossPhase = 1;\n\n  /** Callback при смене фазы босса */\n  public onPhaseChange?: (phase: number) => void;\n\n  /** Система коллизий */\n  private collision: ICollisionSystem | null = null;\n\n  constructor(position: Vec3, speed: number = 4.0, id: number = 0, type: EnemyType = 'baneling', collision?: ICollisionSystem) {\n    this.position = { ...position };\n    this.speed = speed;\n    this.id = id;\n    this.phase = Math.random() * Math.PI * 2;\n    this.moveType = id % 4;\n    this.enemyType = type;\n    this.collision = collision || null;\n\n    // Настройки по типу врага\n    if (type === 'phantom') {\n      this.speed = speed * 2; // В 2 раза быстрее\n      this.damage = 10; // Меньше урона\n      this.radius = 0.6;\n      this.currentSpeed = 0;\n      this.isCharging = true;\n    } else if (type === 'runner') {\n      this.speed = speed * 2.5; // Очень быстрый!\n      this.damage = 15;\n      this.radius = 0.4; // Маленький и низкий\n      this.position.y = 0.5; // Бежит по земле\n    } else if (type === 'hopper') {\n      this.speed = speed * 1.2;\n      this.damage = 20;\n      this.radius = 0.5;\n      this.verticalVelocity = 8;\n      this.onGround = false;\n    } else if (type === 'boss_green') {\n      // ЗЕЛЁНЫЙ БОСС - плюётся кислотой!\n      this.isBoss = true;\n      this.speed = speed * 0.6; // Медленный\n      this.damage = 40;\n      this.radius = 2.5; // ОГРОМНЫЙ!\n      this.hp = 10;      // В 2 раза меньше HP (их двое!)\n      this.maxHp = 10;\n      this.spitCooldown = 3.0; // Плюёт каждые 3 секунды\n    } else if (type === 'boss_black') {\n      // ЧЁРНЫЙ БОСС - искривляет пространство\n      // HP = 10 базовых (половина зелёного) + 60 от 6 кристаллей (по 10 каждый)\n      // Без уничтожения кристаллей его невозможно убить!\n      this.isBoss = true;\n      this.speed = speed * 0.8;\n      this.damage = 30;\n      this.radius = 2.0;\n      this.hp = 70;    // 10 базовых + 6*10 от кристаллей\n      this.maxHp = 70;\n      this.distortionPower = 1.0;\n    } else if (type === 'boss_blue') {\n      // СИНИЙ БОСС - телепортируется\n      this.isBoss = true;\n      this.speed = speed * 1.5; // Быстрый между телепортами\n      this.damage = 25;\n      this.radius = 1.8;\n      this.hp = 24;\n      this.maxHp = 24;\n      this.teleportTimer = 3.0;\n    } else {\n      this.damage = 25;\n      this.currentSpeed = speed;\n    }\n  }\n\n  /** Обновление - движение к игроку с паттерном */\n  public update(dt: number, playerPos: Vec3, time: number): void {\n    // Пульсирующий эффект\n    this.fireIntensity = 0.6 + Math.sin(time * 8 + this.id) * 0.4;\n\n    if (this.active) {\n      switch (this.enemyType) {\n        case 'phantom':\n          this.updatePhantom(dt, playerPos, time);\n          break;\n        case 'runner':\n          this.updateRunner(dt, playerPos, time);\n          break;\n        case 'hopper':\n          this.updateHopper(dt, playerPos, time);\n          break;\n        case 'boss_green':\n          this.updateBossGreen(dt, playerPos, time);\n          break;\n        case 'boss_black':\n          this.updateBossBlack(dt, playerPos, time);\n          break;\n        case 'boss_blue':\n          this.updateBossBlue(dt, playerPos, time);\n          break;\n        default:\n          this.updateBaneling(dt, playerPos, time);\n      }\n    }\n\n    // Обновление осколков\n    this.updateFragments(dt);\n\n    // Таймер удаления\n    if (!this.active && this.removeTimer > 0) {\n      this.removeTimer -= dt;\n    }\n  }\n\n  /** Обновление бейнлинга - медленное преследование с паттернами */\n  private updateBaneling(dt: number, playerPos: Vec3, time: number): void {\n    const dx = playerPos.x - this.position.x;\n    const dy = (playerPos.y - 0.3) - this.position.y;\n    const dz = playerPos.z - this.position.z;\n    const dist = Math.sqrt(dx * dx + dy * dy + dz * dz);\n\n    if (dist > 0.1) {\n      const dirX = dx / dist;\n      const dirY = dy / dist;\n      const dirZ = dz / dist;\n\n      const aggression = 1.0 + Math.max(0, (15 - dist) / 15) * 0.8;\n      const currentSpeed = this.speed * aggression;\n\n      let offsetX = 0, offsetY = 0, offsetZ = 0;\n      const wave = time * 4 + this.phase;\n\n      switch (this.moveType) {\n        case 0:\n          offsetX = Math.cos(wave) * 3;\n          offsetZ = Math.sin(wave) * 3;\n          offsetY = Math.sin(wave * 0.5) * 1.5;\n          break;\n        case 1:\n          offsetX = Math.sin(wave * 2) * 4;\n          offsetY = Math.cos(wave) * 0.5;\n          break;\n        case 2:\n          offsetY = Math.sin(wave * 1.5) * 2.5;\n          offsetX = Math.cos(wave * 0.7) * 1;\n          break;\n        case 3:\n          const pulse = Math.sin(wave) > 0 ? 1.5 : 0.5;\n          offsetX = Math.cos(wave * 3) * 2 * pulse;\n          offsetZ = Math.sin(wave * 3) * 2 * pulse;\n          break;\n      }\n\n      const perpX = -dirZ;\n      const perpZ = dirX;\n\n      this.velocity.x = dirX * currentSpeed + perpX * offsetX * 0.3 + offsetX * 0.1;\n      this.velocity.y = dirY * currentSpeed + offsetY * 0.3;\n      this.velocity.z = dirZ * currentSpeed + perpZ * offsetZ * 0.3 + offsetZ * 0.1;\n\n      // Применяем движение с проверкой коллизий\n      const newX = this.position.x + this.velocity.x * dt;\n      const newZ = this.position.z + this.velocity.z * dt;\n      \n      if (!this.collision?.checkEnemyCollision || \n          !this.collision.checkEnemyCollision({ x: newX, y: this.position.y, z: newZ }, this.radius)) {\n        this.position.x = newX;\n        this.position.z = newZ;\n      } else {\n        // Облетаем препятствие сверху\n        this.velocity.y += 5 * dt;\n      }\n      \n      this.position.y += this.velocity.y * dt;\n      this.position.y = Math.max(0.5, Math.min(6.0, this.position.y));\n    }\n  }\n\n  /** Обновление фантома - разгон и пронзание */\n  private updatePhantom(dt: number, playerPos: Vec3, time: number): void {\n    const dx = playerPos.x - this.position.x;\n    const dy = (playerPos.y - 0.3) - this.position.y;\n    const dz = playerPos.z - this.position.z;\n    const dist = Math.sqrt(dx * dx + dy * dy + dz * dz);\n\n    if (this.isCharging) {\n      // Фаза разгона - набираем скорость, направляемся к игроку\n      this.currentSpeed = Math.min(this.currentSpeed + dt * 15, this.speed);\n\n      // Обновляем направление пока разгоняемся\n      if (dist > 0.1) {\n        this.chargeDirection.x = dx / dist;\n        this.chargeDirection.y = dy / dist;\n        this.chargeDirection.z = dz / dist;\n      }\n\n      // Слегка покачиваемся пока набираем разгон\n      const wobble = Math.sin(time * 10) * 0.3;\n      \n      this.velocity.x = this.chargeDirection.x * this.currentSpeed + wobble;\n      this.velocity.y = this.chargeDirection.y * this.currentSpeed;\n      this.velocity.z = this.chargeDirection.z * this.currentSpeed;\n\n      // Когда набрали полную скорость - фиксируем направление\n      if (this.currentSpeed >= this.speed * 0.9) {\n        this.isCharging = false;\n      }\n    } else {\n      // Фаза атаки - летим по инерции в зафиксированном направлении\n      this.passedThroughTimer += dt;\n\n      // Продолжаем лететь в том же направлении\n      this.velocity.x = this.chargeDirection.x * this.speed;\n      this.velocity.y = this.chargeDirection.y * this.speed;\n      this.velocity.z = this.chargeDirection.z * this.speed;\n\n      // После пролёта через игрока (3 сек) - разворачиваемся\n      if (this.passedThroughTimer > 2.5) {\n        this.isCharging = true;\n        this.currentSpeed = this.speed * 0.3; // Частичный разгон\n        this.passedThroughTimer = 0;\n      }\n    }\n\n    // Движение\n    this.position.x += this.velocity.x * dt;\n    this.position.y += this.velocity.y * dt;\n    this.position.z += this.velocity.z * dt;\n\n    // Ограничения высоты\n    this.position.y = Math.max(0.5, Math.min(4.0, this.position.y));\n\n    // Если улетел слишком далеко - начинаем разгон заново\n    if (dist > 35) {\n      this.isCharging = true;\n      this.currentSpeed = 0;\n      this.passedThroughTimer = 0;\n    }\n  }\n\n  /** Вертикальная скорость раннера */\n  private runnerVerticalVel = 0;\n  /** Раннер на земле? */\n  private runnerOnGround = true;\n\n  /** Обновление раннера - быстрый бегун, прицепляется к игроку */\n  private updateRunner(dt: number, playerPos: Vec3, time: number): void {\n    if (this.isAttached) {\n      // === РЕЖИМ ПРИЦЕПА - летает вокруг игрока ===\n      this.attachTimer -= dt;\n      this.orbitAngle += dt * 12;\n\n      const orbitRadius = 1.2;\n      const orbitHeight = Math.sin(time * 8) * 0.3;\n      \n      this.position.x = playerPos.x + Math.cos(this.orbitAngle) * orbitRadius;\n      this.position.y = playerPos.y + orbitHeight;\n      this.position.z = playerPos.z + Math.sin(this.orbitAngle) * orbitRadius;\n\n      if (this.attachTimer <= 0) {\n        this.isAttached = false;\n        this.active = false;\n        this.removeTimer = 0.5;\n      }\n      return;\n    }\n\n    // === РЕЖИМ ПОГОНИ ===\n    const dx = playerPos.x - this.position.x;\n    const dz = playerPos.z - this.position.z;\n    const dist = Math.sqrt(dx * dx + dz * dz);\n\n    if (dist < 1.5) {\n      this.isAttached = true;\n      this.attachTimer = 3.0;\n      this.orbitAngle = Math.atan2(dz, dx);\n      return;\n    }\n\n    if (dist > 0.1) {\n      const dirX = dx / dist;\n      const dirZ = dz / dist;\n\n      // Проверяем препятствие впереди\n      if (this.collision?.getObstacleHeight && this.runnerOnGround) {\n        const obstacleHeight = this.collision.getObstacleHeight(this.position, dirX, dirZ, 1.5);\n        // Если есть препятствие - прыгаем!\n        if (obstacleHeight > this.position.y && obstacleHeight < 10) {\n          this.runnerVerticalVel = 12; // Сильный прыжок\n          this.runnerOnGround = false;\n        }\n      }\n\n      // Проверяем коллизию\n      if (this.collision?.checkEnemyCollision) {\n        const testPos = { \n          x: this.position.x + dirX * this.speed * dt, \n          y: this.position.y, \n          z: this.position.z + dirZ * this.speed * dt \n        };\n        if (this.collision.checkEnemyCollision(testPos, this.radius)) {\n          // Пытаемся обойти\n          this.dodgeAngle = (Math.random() > 0.5 ? 1 : -1) * Math.PI * 0.5;\n        }\n      }\n\n      // Таймер уклонения\n      this.dodgeTimer -= dt;\n      if (this.dodgeTimer <= 0) {\n        this.dodgeAngle = (Math.random() - 0.5) * Math.PI * 0.8;\n        this.dodgeTimer = 0.3 + Math.random() * 0.4;\n      }\n\n      const cos = Math.cos(this.dodgeAngle);\n      const sin = Math.sin(this.dodgeAngle);\n      const dodgedDirX = dirX * cos - dirZ * sin;\n      const dodgedDirZ = dirX * sin + dirZ * cos;\n\n      const aggression = 1.0 + Math.max(0, (10 - dist) / 10) * 0.5;\n      const currentSpeed = this.speed * aggression;\n      const zigzag = Math.sin(time * 15 + this.phase) * 2;\n\n      this.velocity.x = dodgedDirX * currentSpeed + zigzag * 0.3;\n      this.velocity.z = dodgedDirZ * currentSpeed;\n\n      // Применяем горизонтальное движение с проверкой коллизий\n      const newX = this.position.x + this.velocity.x * dt;\n      const newZ = this.position.z + this.velocity.z * dt;\n      \n      if (!this.collision?.checkEnemyCollision || \n          !this.collision.checkEnemyCollision({ x: newX, y: this.position.y, z: newZ }, this.radius)) {\n        this.position.x = newX;\n        this.position.z = newZ;\n      }\n\n      // Вертикальное движение (прыжки)\n      if (!this.runnerOnGround) {\n        this.runnerVerticalVel -= 25 * dt; // Гравитация\n        this.position.y += this.runnerVerticalVel * dt;\n        \n        if (this.position.y <= 0.5) {\n          this.position.y = 0.5;\n          this.runnerVerticalVel = 0;\n          this.runnerOnGround = true;\n        }\n      } else {\n        this.position.y = 0.5 + Math.abs(Math.sin(time * 20)) * 0.1;\n      }\n    }\n  }\n\n  /** Откидывание от удара (для боссов) */\n  public applyKnockback(dirX: number, dirZ: number, force: number): void {\n    // Нормализуем направление\n    const len = Math.sqrt(dirX * dirX + dirZ * dirZ);\n    if (len > 0) {\n      this.velocity.x = (dirX / len) * force;\n      this.velocity.z = (dirZ / len) * force;\n      // Немного подбрасываем\n      this.velocity.y = force * 0.3;\n    }\n    // Таймер стана - босс замирает на мгновение\n    this.knockbackTimer = 0.3;\n  }\n\n  /** Таймер отката от удара */\n  private knockbackTimer = 0;\n\n  /** Скинуть раннера (двойной прыжок) */\n  public detachRunner(): boolean {\n    if (this.isAttached && this.enemyType === 'runner') {\n      this.isAttached = false;\n      const angle = this.orbitAngle + Math.PI;\n      this.velocity.x = Math.cos(angle) * 15;\n      this.velocity.y = 8;\n      this.velocity.z = Math.sin(angle) * 15;\n      this.attachTimer = 0;\n      return true;\n    }\n    return false;\n  }\n\n  /** Callback для создания лужи */\n  public onCreatePool?: (pos: Vec3) => void;\n\n  /** Зелёный босс - работает в паре: охотник гонит, загонщик отрезает путь */\n  private updateBossGreen(dt: number, playerPos: Vec3, time: number): void {\n    // Обработка отката от удара\n    if (this.knockbackTimer > 0) {\n      this.knockbackTimer -= dt;\n      this.position.x += this.velocity.x * dt;\n      this.position.y += this.velocity.y * dt;\n      this.position.z += this.velocity.z * dt;\n      this.velocity.x *= 0.9;\n      this.velocity.y *= 0.9;\n      this.velocity.z *= 0.9;\n      this.velocity.y -= 15 * dt;\n      this.position.y = Math.max(this.radius, this.position.y);\n      return;\n    }\n\n    // Вычисляем скорость игрока (для предсказания)\n    this.playerVelocity.x = (playerPos.x - this.lastPlayerPos.x) / Math.max(dt, 0.001);\n    this.playerVelocity.z = (playerPos.z - this.lastPlayerPos.z) / Math.max(dt, 0.001);\n    this.lastPlayerPos = { ...playerPos };\n\n    const dx = playerPos.x - this.position.x;\n    const dy = playerPos.y - this.position.y;\n    const dz = playerPos.z - this.position.z;\n    const dist = Math.sqrt(dx * dx + dy * dy + dz * dz);\n\n    // Пульсирующий размер (больше во второй фазе)\n    const baseRadius = this.bossPhase === 2 ? 2.8 : 2.5;\n    this.radius = baseRadius + Math.sin(time * 3) * 0.3;\n\n    // === ПОВЕДЕНИЕ ЗАВИСИТ ОТ РОЛИ ===\n    if (this.greenBossRole === 'hunter') {\n      // ОХОТНИК: вызывает КИСЛОТНЫЙ ДОЖДЬ с неба!\n      this.spitTimer -= dt;\n      const spitCooldownActual = this.bossPhase === 2 ? 5.0 : 8.0;\n      \n      if (this.spitTimer <= 0 && dist < 25) {\n        this.spitTimer = spitCooldownActual;\n        \n        // Ставим метку на позицию игрока\n        const rainTarget = vec3(playerPos.x, 0.05, playerPos.z);\n        this.onAcidRainMark?.(rainTarget);\n        \n        // Во второй фазе - больше меток!\n        if (this.bossPhase === 2) {\n          setTimeout(() => {\n            this.onAcidRainMark?.(vec3(rainTarget.x + 6, 0.05, rainTarget.z));\n            this.onAcidRainMark?.(vec3(rainTarget.x - 6, 0.05, rainTarget.z));\n          }, 800);\n        }\n      }\n      \n      // Охотник идёт медленно, держит дистанцию\n      if (dist > 8) {\n        const dirX = dx / dist;\n        const dirZ = dz / dist;\n        this.velocity.x = dirX * this.speed * 0.5;\n        this.velocity.z = dirZ * this.speed * 0.5;\n        this.position.x += this.velocity.x * dt;\n        this.position.z += this.velocity.z * dt;\n      }\n      this.position.y = Math.max(this.radius, this.position.y);\n      \n    } else {\n      // ЗАГОНЩИК: кидает ЛУЖИ (плевки)!\n      this.spitTimer -= dt;\n      const spitCooldownActual = this.bossPhase === 2 ? 2.0 : 3.5;\n      \n      if (this.spitTimer <= 0 && dist < 20) {\n        this.spitTimer = spitCooldownActual;\n        \n        // Плюём в игрока!\n        const spitTarget = vec3(\n          playerPos.x + (Math.random() - 0.5) * 2,\n          0.05,\n          playerPos.z + (Math.random() - 0.5) * 2\n        );\n        const spitStart = vec3(this.position.x, this.position.y + 1, this.position.z);\n        this.onSpit?.(spitStart, spitTarget);\n        \n        // Во второй фазе - серия плевков!\n        if (this.bossPhase === 2) {\n          setTimeout(() => {\n            const extra = vec3(playerPos.x + 3, 0.05, playerPos.z);\n            this.onSpit?.(spitStart, extra);\n          }, 300);\n          setTimeout(() => {\n            const extra = vec3(playerPos.x - 3, 0.05, playerPos.z);\n            this.onSpit?.(spitStart, extra);\n          }, 600);\n        }\n      }\n      \n      // Загонщик быстро бежит к игроку!\n      if (dist > 0.1) {\n        const dirX = dx / dist;\n        const dirY = dy / dist;\n        const dirZ = dz / dist;\n        const wobble = Math.sin(time * 2) * 0.5;\n        \n        const speedMult = this.bossPhase === 2 ? 1.4 : 1.0;\n        this.velocity.x = dirX * this.speed * speedMult + wobble;\n        this.velocity.y = dirY * this.speed * 0.3;\n        this.velocity.z = dirZ * this.speed * speedMult;\n\n        this.position.x += this.velocity.x * dt;\n        this.position.y += this.velocity.y * dt;\n        this.position.z += this.velocity.z * dt;\n        this.position.y = Math.max(this.radius, this.position.y);\n      }\n    }\n  }\n\n  /** Чёрный босс - искривляет пространство вокруг себя */\n  private updateBossBlack(dt: number, playerPos: Vec3, time: number): void {\n    // Обработка отката от удара\n    if (this.knockbackTimer > 0) {\n      this.knockbackTimer -= dt;\n      this.position.x += this.velocity.x * dt;\n      this.position.y += this.velocity.y * dt;\n      this.position.z += this.velocity.z * dt;\n      this.velocity.x *= 0.92;\n      this.velocity.y *= 0.92;\n      this.velocity.z *= 0.92;\n      this.velocity.y -= 10 * dt;\n      this.position.y = Math.max(1.0, this.position.y);\n      return;\n    }\n\n    const dx = playerPos.x - this.position.x;\n    const dy = playerPos.y - this.position.y;\n    const dz = playerPos.z - this.position.z;\n    const dist = Math.sqrt(dx * dx + dy * dy + dz * dz);\n\n    // === СПАВН ФАНТОМОВ КАЖДЫЕ 5 СЕКУНД ===\n    this.spawnPhantomTimer -= dt;\n    if (this.spawnPhantomTimer <= 0) {\n      this.spawnPhantomTimer = 5.0;\n      // Спавним фантома рядом с боссом\n      const spawnAngle = Math.random() * Math.PI * 2;\n      const spawnDist = 3 + Math.random() * 2;\n      const spawnPos = vec3(\n        this.position.x + Math.cos(spawnAngle) * spawnDist,\n        this.position.y,\n        this.position.z + Math.sin(spawnAngle) * spawnDist\n      );\n      this.onSpawnPhantom?.(spawnPos);\n    }\n\n    // === ФАЗА ВИХРЯ (ВСАСЫВАНИЕ) ===\n    this.vortexCooldown -= dt;\n    \n    if (this.isVortexActive) {\n      // Вихрь активен - всасываем игрока\n      this.vortexTimer -= dt;\n      \n      // Босс крутится на месте\n      this.position.y = 2.0 + Math.sin(time * 10) * 0.3;\n      \n      // Интенсивное искривление\n      this.distortionPower = 1.5 + Math.sin(time * 15) * 0.5;\n      \n      if (this.vortexTimer <= 0) {\n        // Вихрь закончился\n        this.isVortexActive = false;\n        this.vortexCooldown = 12.0; // Кулдаун 12 секунд\n        this.vortexWarningPlayed = false; // Сбрасываем флаг предупреждения\n        this.onVortexEnd?.();\n      }\n      return; // Не двигаемся во время вихря\n    }\n    \n    // Предупреждение о вихре за 2 секунды (райзер)\n    if (this.vortexCooldown > 0 && this.vortexCooldown <= 2.0 && !this.vortexWarningPlayed && dist < 15) {\n      this.vortexWarningPlayed = true;\n      this.onVortexWarning?.();\n    }\n    \n    // Начинаем вихрь каждые 12 секунд (если игрок близко)\n    if (this.vortexCooldown <= 0 && dist < 15) {\n      this.isVortexActive = true;\n      this.vortexTimer = 4.0; // Вихрь длится 4 секунды\n      this.onVortexStart?.();\n    }\n\n    // === ОБЫЧНОЕ ДВИЖЕНИЕ ===\n    // Орбитальное движение вокруг центра + приближение к игроку\n    const orbitSpeed = 0.5;\n    const orbitRadius = 8 + Math.sin(time * 0.3) * 3;\n    \n    const targetX = Math.cos(time * orbitSpeed) * orbitRadius;\n    const targetZ = Math.sin(time * orbitSpeed) * orbitRadius;\n    \n    // Притяжение к орбите + направление к игроку\n    const toOrbitX = targetX - this.position.x;\n    const toOrbitZ = targetZ - this.position.z;\n    \n    this.velocity.x = toOrbitX * 0.5 + (dx / dist) * this.speed * 0.3;\n    this.velocity.y = (1.5 - this.position.y) * 2; // Держится на высоте\n    this.velocity.z = toOrbitZ * 0.5 + (dz / dist) * this.speed * 0.3;\n\n    this.position.x += this.velocity.x * dt;\n    this.position.y += this.velocity.y * dt;\n    this.position.z += this.velocity.z * dt;\n\n    // Интенсивность искривления зависит от расстояния до игрока\n    this.distortionPower = Math.max(0, 1.0 - dist / 20);\n  }\n\n  /** Получить силу притяжения вихря (для игрока) */\n  public getVortexPull(playerPos: Vec3): Vec3 {\n    if (!this.isVortexActive) return vec3(0, 0, 0);\n    \n    const dx = this.position.x - playerPos.x;\n    const dz = this.position.z - playerPos.z;\n    const dist = Math.sqrt(dx * dx + dz * dz);\n    \n    if (dist < 0.5) return vec3(0, 0, 0);\n    \n    // Сила притяжения - сильнее когда ближе (ослаблена в 2 раза)\n    const pullStrength = Math.max(0, 1 - dist / 20) * 7.5;\n    \n    return vec3(\n      (dx / dist) * pullStrength,\n      0,\n      (dz / dist) * pullStrength\n    );\n  }\n\n  /** Синий босс - телепортируется */\n  private updateBossBlue(dt: number, playerPos: Vec3, time: number): void {\n    // Обработка отката от удара - синий откидывается сильно!\n    if (this.knockbackTimer > 0) {\n      this.knockbackTimer -= dt;\n      this.position.x += this.velocity.x * dt;\n      this.position.y += this.velocity.y * dt;\n      this.position.z += this.velocity.z * dt;\n      this.velocity.x *= 0.85; // Быстрее затухает\n      this.velocity.y *= 0.85;\n      this.velocity.z *= 0.85;\n      this.velocity.y -= 20 * dt;\n      this.position.y = Math.max(0.5, this.position.y);\n      return;\n    }\n\n    this.teleportTimer -= dt;\n\n    if (this.teleportTimer <= 0) {\n      // ТЕЛЕПОРТ!\n      const angle = Math.random() * Math.PI * 2;\n      const dist = 5 + Math.random() * 10;\n      \n      this.position.x = playerPos.x + Math.cos(angle) * dist;\n      this.position.y = 1.5 + Math.random() * 2;\n      this.position.z = playerPos.z + Math.sin(angle) * dist;\n      \n      this.teleportTimer = 2.0 + Math.random() * 2.0; // 2-4 сек между телепортами\n      return;\n    }\n\n    // Между телепортами - агрессивное преследование\n    const dx = playerPos.x - this.position.x;\n    const dy = playerPos.y - this.position.y;\n    const dz = playerPos.z - this.position.z;\n    const dist = Math.sqrt(dx * dx + dy * dy + dz * dz);\n\n    if (dist > 0.1) {\n      // Зигзаг движение\n      const zigzag = Math.sin(time * 10) * 3;\n      \n      this.velocity.x = (dx / dist) * this.speed + zigzag * 0.5;\n      this.velocity.y = (dy / dist) * this.speed * 0.5;\n      this.velocity.z = (dz / dist) * this.speed;\n\n      this.position.x += this.velocity.x * dt;\n      this.position.y += this.velocity.y * dt;\n      this.position.z += this.velocity.z * dt;\n\n      this.position.y = Math.max(0.5, Math.min(4.0, this.position.y));\n    }\n  }\n\n  /** Получить урон (для боссов) */\n  public takeDamage(amount: number = 1): boolean {\n    this.hp -= amount;\n    \n    // Проверка смены фазы для Зелёного Босса\n    if (this.enemyType === 'boss_green' && this.bossPhase === 1) {\n      if (this.hp <= this.maxHp / 2) {\n        this.bossPhase = 2;\n        this.speed *= 1.3; // Быстрее во второй фазе\n        this.onPhaseChange?.(2);\n      }\n    }\n    \n    if (this.hp <= 0) {\n      this.hp = 0;\n      return true; // Убит\n    }\n    return false;\n  }\n\n  /** Обновление хоппера - прыгающий враг */\n  private updateHopper(dt: number, playerPos: Vec3, _time: number): void {\n    const dx = playerPos.x - this.position.x;\n    const dz = playerPos.z - this.position.z;\n    const distXZ = Math.sqrt(dx * dx + dz * dz);\n\n    const gravity = 18.0;\n\n    if (this.onGround) {\n      this.hopTimer -= dt;\n      \n      if (this.hopTimer <= 0) {\n        // ПРЫЖОК!\n        this.onGround = false;\n        \n        // Проверяем препятствие - прыгаем выше если нужно\n        let jumpForce = 10 + Math.random() * 4;\n        if (this.collision?.getObstacleHeight && distXZ > 0.1) {\n          const dirX = dx / distXZ;\n          const dirZ = dz / distXZ;\n          const obstacleHeight = this.collision.getObstacleHeight(this.position, dirX, dirZ, 3);\n          if (obstacleHeight > this.position.y) {\n            // Прыгаем выше чтобы перепрыгнуть\n            jumpForce = Math.max(jumpForce, (obstacleHeight - this.position.y + 2) * 3);\n          }\n        }\n        \n        this.verticalVelocity = jumpForce;\n        this.hopTimer = 0.5 + Math.random() * 0.5;\n\n        if (distXZ > 0.1) {\n          const jumpSpeed = this.speed * 1.5;\n          this.velocity.x = (dx / distXZ) * jumpSpeed;\n          this.velocity.z = (dz / distXZ) * jumpSpeed;\n        }\n      } else {\n        this.velocity.x *= 0.9;\n        this.velocity.z *= 0.9;\n      }\n    } else {\n      this.verticalVelocity -= gravity * dt;\n      \n      if (distXZ > 0.1) {\n        this.velocity.x += (dx / distXZ) * dt * 3;\n        this.velocity.z += (dz / distXZ) * dt * 3;\n      }\n    }\n\n    // Применяем движение с проверкой коллизий\n    const newX = this.position.x + this.velocity.x * dt;\n    const newZ = this.position.z + this.velocity.z * dt;\n    \n    if (!this.collision?.checkEnemyCollision || \n        !this.collision.checkEnemyCollision({ x: newX, y: this.position.y, z: newZ }, this.radius)) {\n      this.position.x = newX;\n      this.position.z = newZ;\n    } else {\n      // Отскакиваем при столкновении\n      this.velocity.x *= -0.5;\n      this.velocity.z *= -0.5;\n    }\n    \n    this.position.y += this.verticalVelocity * dt;\n\n    // Проверка земли\n    if (this.position.y <= 0.5) {\n      this.position.y = 0.5;\n      this.onGround = true;\n      this.verticalVelocity = 0;\n    }\n\n    this.position.y = Math.min(12.0, this.position.y); // Выше могут прыгать\n  }\n\n  /** Обновление осколков */\n  private updateFragments(dt: number): void {\n    const gravity = 15.0;\n\n    for (let i = this.fragments.length - 1; i >= 0; i--) {\n      const f = this.fragments[i];\n\n      // Физика\n      f.position.x += f.velocity.x * dt;\n      f.position.y += f.velocity.y * dt;\n      f.position.z += f.velocity.z * dt;\n\n      // Гравитация\n      f.velocity.y -= gravity * dt;\n\n      // Вращение\n      f.rotation += f.rotationSpeed * dt;\n\n      // Время жизни\n      f.lifetime -= dt;\n\n      // Удаляем мёртвые\n      if (f.lifetime <= 0 || f.position.y < -5) {\n        this.fragments.splice(i, 1);\n      }\n    }\n  }\n\n  /** Проверка столкновения с игроком */\n  public checkPlayerCollision(playerPos: Vec3): boolean {\n    if (!this.active) return false;\n\n    const dist = distanceVec3(this.position, playerPos);\n    return dist < this.radius + 0.5; // Радиус игрока ~0.5\n  }\n\n  /** Разрубить на куски! */\n  public slice(sliceDirection: Vec3): void {\n    if (!this.active) return;\n\n    this.active = false;\n    this.removeTimer = 3.0;\n\n    // Создаём осколки\n    const numFragments = 4 + Math.floor(Math.random() * 4); // 4-7 кусков\n\n    for (let i = 0; i < numFragments; i++) {\n      // Случайное направление разлёта\n      const angle = Math.random() * Math.PI * 2;\n      const upAngle = Math.random() * Math.PI * 0.5;\n      \n      const speed = 8 + Math.random() * 12;\n      \n      // Основное направление - от удара + случайное\n      const vx = sliceDirection.x * speed * 0.5 + Math.cos(angle) * Math.cos(upAngle) * speed;\n      const vy = Math.sin(upAngle) * speed + 3;\n      const vz = sliceDirection.z * speed * 0.5 + Math.sin(angle) * Math.cos(upAngle) * speed;\n\n      this.fragments.push({\n        position: { \n          x: this.position.x + (Math.random() - 0.5) * this.radius,\n          y: this.position.y + (Math.random() - 0.5) * this.radius,\n          z: this.position.z + (Math.random() - 0.5) * this.radius,\n        },\n        velocity: { x: vx, y: vy, z: vz },\n        size: 0.15 + Math.random() * 0.25,\n        lifetime: 1.5 + Math.random() * 1.0,\n        rotation: Math.random() * Math.PI * 2,\n        rotationSpeed: (Math.random() - 0.5) * 15,\n      });\n    }\n  }\n\n  /** Можно удалить? */\n  public canRemove(): boolean {\n    return !this.active && this.removeTimer <= 0 && this.fragments.length === 0;\n  }\n\n  /** Данные для шейдера [x, y, z, type+intensity] */\n  public getShaderData(): [number, number, number, number] {\n    // w компонент: 0 = неактивен\n    // 1.0-1.9 = бейнлинг (зелёный)\n    // 3.0-3.9 = фантом (чёрный)\n    // 5.0-5.9 = runner (оранжевый)\n    // 7.0-7.9 = hopper (синий)\n    // 11.0-11.9 = boss_green (огромный зелёный)\n    // 13.0-13.9 = boss_black (чёрный, искривление)\n    // 15.0-15.9 = boss_blue (синий, телепорт)\n    let w = 0;\n    if (this.active) {\n      const intensity = this.fireIntensity * 0.5;\n      switch (this.enemyType) {\n        case 'phantom':\n          w = 3 + intensity;\n          break;\n        case 'runner':\n          w = 5 + intensity;\n          break;\n        case 'hopper':\n          w = 7 + intensity;\n          break;\n        case 'boss_green':\n          w = 11 + intensity;\n          break;\n        case 'boss_black':\n          w = 13 + intensity;\n          break;\n        case 'boss_blue':\n          w = 15 + intensity;\n          break;\n        default: // baneling\n          w = 1 + intensity;\n      }\n    }\n    return [this.position.x, this.position.y, this.position.z, w];\n  }\n\n  /** Данные осколков для шейдера */\n  public getFragmentsData(): number[] {\n    const data: number[] = [];\n    for (const f of this.fragments) {\n      data.push(f.position.x, f.position.y, f.position.z, f.size);\n    }\n    return data;\n  }\n}\n\n/** Кристалл силы чёрного босса */\nexport interface PowerCrystal {\n  x: number;\n  z: number;\n  height: number;\n  active: boolean;\n  platformIndex: number; // На какой платформе\n}\n\n/**\n * Менеджер врагов с системой волн\n */\nexport class TargetManager {\n  /** Все враги */\n  public targets: Target[] = [];\n\n  /** Текущая волна */\n  public wave = 0;\n\n  /** Волна активна? */\n  public waveActive = false;\n\n  /** Задержка между волнами (секунды) */\n  private waveDelay = 4.0;\n  private waveTimer = 0;\n\n  /** Счёт */\n  public score = 0;\n\n  /** Кристаллы силы для чёрного босса */\n  public powerCrystals: PowerCrystal[] = [];\n\n  /** Callback при уничтожении */\n  public onTargetDestroyed?: (target: Target) => void;\n\n  /** Callback при столкновении с игроком */\n  public onPlayerHit?: (target: Target) => void;\n\n  /** Callback при завершении волны */\n  public onWaveComplete?: (wave: number) => void;\n\n  /** Callback при старте волны */\n  public onWaveStart?: (wave: number) => void;\n\n  /** Callback при уроне от лужи */\n  public onPoolDamage?: (damage: number) => void;\n\n  /** Callback при уничтожении кристалла */\n  public onCrystalDestroyed?: (remaining: number) => void;\n\n  /** Callback при смене фазы босса */\n  public onBossPhaseChange?: (bossType: EnemyType, phase: number) => void;\n\n  /** Callback при кислотном дожде (зелёный босс плюнул) */\n  public onAcidRain?: (pos: Vec3) => void;\n\n  /** Callback при начале/конце вихря чёрного босса */\n  public onBossVortexStart?: () => void;\n  public onBossVortexEnd?: () => void;\n  public onBossVortexWarning?: () => void;\n\n  /** Токсичные лужи */\n  public toxicPools: ToxicPool[] = [];\n\n  /** Зоны кислотного дождя */\n  public acidRainZones: AcidRainZone[] = [];\n\n  /** Летящие снаряды кислоты */\n  public acidProjectiles: AcidProjectile[] = [];\n\n  /** Таймер урона от луж и дождя */\n  private poolDamageTimer = 0;\n\n  /** Система коллизий */\n  private collision: ICollisionSystem | null = null;\n\n  constructor(collision?: ICollisionSystem) {\n    this.collision = collision || null;\n  }\n\n  /** Проверить находится ли игрок под платформой (укрытие от дождя) */\n  private isPlayerUnderPlatform(playerPos: Vec3): boolean {\n    if (!this.collision) return false;\n    \n    // Проверяем есть ли потолок над игроком\n    const ceiling = this.collision.getCeilingHeight(playerPos);\n    // Если есть потолок ниже 15м - игрок под укрытием\n    return ceiling < 15;\n  }\n\n  /** Начать игру с указанной волны */\n  public startGame(startWave: number = 1): void {\n    this.wave = startWave - 1; // -1 потому что startNextWave сделает +1\n    this.score = 0;\n    this.targets = [];\n    this.toxicPools = [];\n    this.startNextWave();\n  }\n\n  /** Начать следующую волну */\n  public startNextWave(): void {\n    this.wave++;\n    this.waveActive = true;\n    \n    // Спавним N врагов (N = номер волны)\n    this.spawnEnemies(this.wave);\n    \n    this.onWaveStart?.(this.wave);\n  }\n\n  /** Счётчик для ID */\n  private enemyIdCounter = 0;\n\n  /**\n   * Спавн врагов по волнам:\n   * - Волна 5: ЗЕЛЁНЫЙ БОСС + враги\n   * - Волна 10: ЧЁРНЫЙ БОСС + враги\n   * - Волна 15: СИНИЙ БОСС + враги\n   */\n  private spawnEnemies(wave: number): void {\n    const spawnRadius = 18;\n    const baseSpeed = 3.5 + wave * 0.3;\n\n    // === БОССЫ ===\n    if (wave === 5) {\n      // ДВА ЗЕЛЁНЫХ БОССА - охотник и загонщик!\n      const bossConfigs: Array<{ pos: Vec3; role: GreenBossRole }> = [\n        { pos: vec3(-8, 3.0, -spawnRadius), role: 'hunter' },   // Охотник - гонит\n        { pos: vec3(8, 3.0, -spawnRadius), role: 'blocker' },   // Загонщик - плюёт впереди\n      ];\n      \n      for (const config of bossConfigs) {\n        const boss = new Target(config.pos, baseSpeed, this.enemyIdCounter++, 'boss_green', this.collision || undefined);\n        boss.greenBossRole = config.role;\n        \n        if (config.role === 'hunter') {\n          // ОХОТНИК: вызывает кислотный дождь с неба!\n          boss.onAcidRainMark = (pos) => {\n            this.spawnAcidRainZone(pos);\n          };\n        } else {\n          // ЗАГОНЩИК: кидает лужи (плевки)\n          boss.onSpit = (startPos, targetPos) => {\n            this.spawnAcidProjectile(startPos, targetPos);\n          };\n        }\n        \n        // Callback для смены фазы\n        boss.onPhaseChange = (phase) => {\n          this.onBossPhaseChange?.(boss.enemyType, phase);\n        };\n        \n        this.targets.push(boss);\n      }\n    } else if (wave === 10) {\n      // ЧЁРНЫЙ БОСС!\n      const pos = vec3(0, 2.5, -spawnRadius);\n      const boss = new Target(pos, baseSpeed, this.enemyIdCounter++, 'boss_black', this.collision || undefined);\n      \n      // Колбэк для спавна фантомов\n      boss.onSpawnPhantom = (spawnPos) => {\n        this.spawnPhantomFromBoss(spawnPos);\n      };\n      \n      // Колбэки для вихря (звук)\n      boss.onVortexWarning = () => {\n        this.onBossVortexWarning?.();\n      };\n      boss.onVortexStart = () => {\n        this.onBossVortexStart?.();\n      };\n      boss.onVortexEnd = () => {\n        this.onBossVortexEnd?.();\n      };\n      \n      this.targets.push(boss);\n\n      // === КРИСТАЛЛЫ СИЛЫ НА ПЛАТФОРМАХ ===\n      // 6 кристаллов на 6 платформах\n      const platformPositions = [\n        { x: 10.0, z: 0.0, height: 2.3 },     // Платформа 1\n        { x: 5.0, z: 8.66, height: 3.5 },     // Платформа 2\n        { x: -5.0, z: 8.66, height: 4.7 },    // Платформа 3\n        { x: -10.0, z: 0.0, height: 5.9 },    // Платформа 4\n        { x: -5.0, z: -8.66, height: 7.1 },   // Платформа 5\n        { x: 5.0, z: -8.66, height: 8.3 },    // Платформа 6\n      ];\n      \n      this.powerCrystals = platformPositions.map((pos, i) => ({\n        x: pos.x,\n        z: pos.z,\n        height: pos.height,\n        active: true,\n        platformIndex: i\n      }));\n    } else if (wave === 15) {\n      // СИНИЙ БОСС!\n      const pos = vec3(0, 2.0, -spawnRadius);\n      this.targets.push(new Target(pos, baseSpeed, this.enemyIdCounter++, 'boss_blue', this.collision || undefined));\n    }\n\n    // На волнах боссов - ТОЛЬКО БОСС!\n    const isBossWave = wave === 5 || wave === 10 || wave === 15;\n    if (isBossWave) return; // Не спавним обычных врагов на волнах боссов\n    \n    // === СБАЛАНСИРОВАННОЕ КОЛИЧЕСТВО ВРАГОВ ===\n    // Эпоха 1 (1-5): умеренно\n    // Эпоха 2 (6-10): сложнее, но без раннеров\n    // Эпоха 3 (11-15): максимальная сложность с раннерами\n    \n    let banelingCount: number;\n    let phantomCount: number;\n    let runnerCount: number;\n    let hopperCount: number;\n    \n    if (wave <= 5) {\n      // Эпоха 1: кислотная - простая\n      banelingCount = Math.floor(wave * 1.2);\n      phantomCount = wave >= 3 ? Math.floor((wave - 2) * 0.8) : 0;\n      runnerCount = 0; // Нет раннеров\n      hopperCount = wave >= 4 ? Math.floor((wave - 3) * 0.5) : 0;\n    } else if (wave <= 10) {\n      // Эпоха 2: чёрная дыра - средняя сложность\n      banelingCount = Math.floor(wave * 0.8); // Меньше бейнлингов\n      phantomCount = Math.floor((wave - 3) * 0.6); // Меньше фантомов\n      runnerCount = 0; // Нет раннеров до 11 волны!\n      hopperCount = Math.floor((wave - 4) * 0.6); // Меньше хопперов\n    } else {\n      // Эпоха 3: космическая - с раннерами\n      banelingCount = Math.floor(wave * 0.7);\n      phantomCount = Math.floor((wave - 5) * 0.5);\n      runnerCount = Math.floor((wave - 10) * 1.5); // Раннеры с 11 волны!\n      hopperCount = Math.floor((wave - 6) * 0.5);\n    }\n\n    const totalCount = Math.max(1, banelingCount + phantomCount + runnerCount + hopperCount);\n    let idx = 0;\n\n    // Спавним бейнлингов (зелёные)\n    for (let i = 0; i < banelingCount; i++) {\n      const angle = (idx / totalCount) * Math.PI * 2 + Math.random() * 0.3;\n      const height = 1.0 + Math.random() * 2.5;\n\n      const pos = vec3(\n        Math.cos(angle) * spawnRadius,\n        height,\n        Math.sin(angle) * spawnRadius\n      );\n\n      const speed = baseSpeed + Math.random() * 1.5;\n      this.targets.push(new Target(pos, speed, this.enemyIdCounter++, 'baneling', this.collision || undefined));\n      idx++;\n    }\n\n    // Спавним раннеров (оранжевые, бегут по земле)\n    for (let i = 0; i < runnerCount; i++) {\n      const angle = (idx / totalCount) * Math.PI * 2 + Math.random() * 0.3;\n\n      const pos = vec3(\n        Math.cos(angle) * spawnRadius,\n        0.5,\n        Math.sin(angle) * spawnRadius\n      );\n\n      const speed = baseSpeed + Math.random() * 1.0;\n      this.targets.push(new Target(pos, speed, this.enemyIdCounter++, 'runner', this.collision || undefined));\n      idx++;\n    }\n\n    // Спавним хопперов (синие, прыгают)\n    for (let i = 0; i < hopperCount; i++) {\n      const angle = (idx / totalCount) * Math.PI * 2 + Math.random() * 0.3;\n\n      const pos = vec3(\n        Math.cos(angle) * spawnRadius,\n        0.5,\n        Math.sin(angle) * spawnRadius\n      );\n\n      const speed = baseSpeed + Math.random() * 1.0;\n      this.targets.push(new Target(pos, speed, this.enemyIdCounter++, 'hopper', this.collision || undefined));\n      idx++;\n    }\n\n    // Спавним фантомов (чёрные)\n    for (let i = 0; i < phantomCount; i++) {\n      const angle = ((banelingCount + i) / totalCount) * Math.PI * 2 + Math.random() * 0.3;\n      const height = 1.5 + Math.random() * 2.0;\n\n      const pos = vec3(\n        Math.cos(angle) * spawnRadius,\n        height,\n        Math.sin(angle) * spawnRadius\n      );\n\n      const speed = baseSpeed + Math.random() * 1.0;\n      this.targets.push(new Target(pos, speed, this.enemyIdCounter++, 'phantom', this.collision || undefined));\n    }\n  }\n\n  /** Кулдаун на урон от фантомов (чтобы не спамил урон) */\n  private phantomDamageCooldown: Map<number, number> = new Map();\n\n  /** Обновление */\n  public update(dt: number, playerPos: Vec3, time: number): void {\n    // Таймер между волнами\n    if (!this.waveActive && this.waveTimer > 0) {\n      this.waveTimer -= dt;\n      if (this.waveTimer <= 0) {\n        this.startNextWave();\n      }\n      return;\n    }\n\n    // Уменьшаем кулдауны фантомов\n    for (const [id, cd] of this.phantomDamageCooldown) {\n      if (cd > 0) {\n        this.phantomDamageCooldown.set(id, cd - dt);\n      }\n    }\n\n    // Обновляем врагов\n    for (const target of this.targets) {\n      target.update(dt, playerPos, time);\n\n      // Проверка столкновения с игроком\n      if (target.checkPlayerCollision(playerPos)) {\n        if (target.enemyType === 'phantom') {\n          // Фантом пролетает сквозь, но наносит урон с кулдауном\n          const cd = this.phantomDamageCooldown.get(target['id'] as number) || 0;\n          if (cd <= 0) {\n            this.onPlayerHit?.(target);\n            this.phantomDamageCooldown.set(target['id'] as number, 1.0); // 1 сек кулдаун\n          }\n          // НЕ деактивируем - фантом летит дальше!\n        } else if (target.isBoss) {\n          // Боссы наносят урон но НЕ умирают при столкновении!\n          const cd = this.phantomDamageCooldown.get(target['id'] as number) || 0;\n          if (cd <= 0) {\n            this.onPlayerHit?.(target);\n            this.phantomDamageCooldown.set(target['id'] as number, 1.5); // 1.5 сек кулдаун для боссов\n          }\n        } else {\n          // Обычные враги взрываются\n          this.onPlayerHit?.(target);\n          target.active = false;\n        }\n      }\n    }\n\n    // Удаляем мёртвых\n    this.targets = this.targets.filter(t => !t.canRemove());\n\n    // === ЛЕТЯЩИЕ СНАРЯДЫ КИСЛОТЫ ===\n    for (const proj of this.acidProjectiles) {\n      proj.progress += dt / proj.flightTime;\n      \n      // Параболическая траектория\n      const t = proj.progress;\n      proj.position.x = proj.startPos.x + (proj.targetPos.x - proj.startPos.x) * t;\n      proj.position.z = proj.startPos.z + (proj.targetPos.z - proj.startPos.z) * t;\n      // Дуга вверх и вниз\n      proj.position.y = proj.startPos.y + (1 - (2 * t - 1) * (2 * t - 1)) * 8; // Макс высота 8м\n      \n      // Снаряд приземлился\n      if (proj.progress >= 1) {\n        // Создаём растекающуюся лужу\n        this.toxicPools.push({\n          position: { ...proj.targetPos },\n          radius: 0.5,          // Начальный радиус маленький\n          maxRadius: 3.5,       // Растечётся до 3.5м\n          lifetime: 6.0,\n          maxLifetime: 6.0,\n          damage: 8,\n          spreadProgress: 0     // Начинает растекаться\n        });\n        this.onAcidRain?.(proj.targetPos);\n      }\n    }\n    // Удаляем приземлившиеся снаряды\n    this.acidProjectiles = this.acidProjectiles.filter(p => p.progress < 1);\n\n    // === ТОКСИЧНЫЕ ЛУЖИ ===\n    for (const pool of this.toxicPools) {\n      pool.lifetime -= dt;\n      // Растекание: радиус увеличивается в первые 1.5 сек\n      if (pool.spreadProgress < 1) {\n        pool.spreadProgress = Math.min(1, pool.spreadProgress + dt / 1.5);\n        pool.radius = pool.maxRadius * (0.3 + 0.7 * pool.spreadProgress);\n      }\n    }\n    // Удаляем истёкшие\n    this.toxicPools = this.toxicPools.filter(p => p.lifetime > 0);\n\n    // === ЗОНЫ КИСЛОТНОГО ДОЖДЯ ===\n    for (const zone of this.acidRainZones) {\n      if (!zone.isRaining) {\n        // Ещё показываем метку\n        zone.markTime -= dt;\n        if (zone.markTime <= 0) {\n          zone.isRaining = true;\n          this.onAcidRainStart?.(zone.position);\n        }\n      } else {\n        // Дождь идёт\n        zone.lifetime -= dt;\n      }\n    }\n    // Удаляем истёкшие зоны\n    this.acidRainZones = this.acidRainZones.filter(z => z.lifetime > 0 || !z.isRaining);\n\n    // Урон от луж и дождя (каждые 0.5 сек)\n    this.poolDamageTimer -= dt;\n    if (this.poolDamageTimer <= 0) {\n      this.poolDamageTimer = 0.5;\n      \n      // Урон от луж (только на земле)\n      for (const pool of this.toxicPools) {\n        const dx = playerPos.x - pool.position.x;\n        const dz = playerPos.z - pool.position.z;\n        const dist = Math.sqrt(dx * dx + dz * dz);\n        \n        // Проверяем только если игрок НА ЗЕМЛЕ (не в прыжке)\n        if (dist < pool.radius && playerPos.y < 0.8) {\n          this.onPoolDamage?.(pool.damage);\n          break;\n        }\n      }\n      \n      // Урон от кислотного дождя (если не под платформой)\n      for (const zone of this.acidRainZones) {\n        if (!zone.isRaining) continue;\n        \n        const dx = playerPos.x - zone.position.x;\n        const dz = playerPos.z - zone.position.z;\n        const dist = Math.sqrt(dx * dx + dz * dz);\n        \n        if (dist < zone.radius) {\n          // Проверяем есть ли платформа над игроком (укрытие от дождя)\n          const isUnderCover = this.isPlayerUnderPlatform(playerPos);\n          if (!isUnderCover) {\n            this.onPoolDamage?.(zone.damage);\n            break;\n          }\n        }\n      }\n    }\n\n    // Проверяем завершение волны\n    if (this.waveActive && this.getActiveCount() === 0) {\n      this.waveActive = false;\n      this.waveTimer = this.waveDelay;\n      this.onWaveComplete?.(this.wave);\n      // Очищаем лужи при завершении волны\n      this.toxicPools = [];\n    }\n  }\n\n  /** Попытка разрубить катаной */\n  public trySlice(playerPos: Vec3, playerYaw: number, range: number, angle: number): Target | null {\n    for (const target of this.targets) {\n      if (!target.active) continue;\n\n      // Расстояние (для боссов увеличиваем хитбокс)\n      const dx = target.position.x - playerPos.x;\n      const dz = target.position.z - playerPos.z;\n      const dist = Math.sqrt(dx * dx + dz * dz);\n      \n      // Учитываем размер врага\n      const effectiveRange = range + (target.isBoss ? target.radius : 0);\n      if (dist > effectiveRange) continue;\n\n      // Угол\n      const angleToTarget = Math.atan2(dx, -dz);\n      let angleDiff = angleToTarget - playerYaw;\n      \n      while (angleDiff > Math.PI) angleDiff -= Math.PI * 2;\n      while (angleDiff < -Math.PI) angleDiff += Math.PI * 2;\n\n      if (Math.abs(angleDiff) > angle / 2) continue;\n\n      // Попали!\n      if (target.isBoss) {\n        // Босс - уменьшаем HP\n        const killed = target.takeDamage(1);\n        \n        // Зелёный босс выпускает бейнлинга при каждом ударе!\n        if (target.enemyType === 'boss_green' && !killed) {\n          this.spawnBanelingFromBoss(target.position);\n        }\n        \n        if (killed) {\n          // Босс убит! Эпичный взрыв\n          const sliceDir = normalizeVec3({ x: dx, y: 0, z: dz });\n          target.slice(sliceDir);\n          this.score += 1000 * this.wave; // Много очков за босса!\n          this.onTargetDestroyed?.(target);\n          \n          // Зелёный босс при смерти выпускает кучу бейнлингов!\n          if (target.enemyType === 'boss_green') {\n            for (let i = 0; i < 5; i++) {\n              this.spawnBanelingFromBoss(target.position);\n            }\n          }\n        } else {\n          // Не убит - откидываем босса назад!\n          const knockbackForce = target.enemyType === 'boss_green' ? 8 : \n                                 target.enemyType === 'boss_black' ? 5 : 12; // Синий откидывается сильнее\n          target.applyKnockback(dx, dz, knockbackForce);\n        }\n        // Возвращаем даже если не убит - чтобы был хитмаркер\n        return target;\n      } else {\n        // Обычный враг - убиваем сразу\n        const sliceDir = normalizeVec3({ x: dx, y: 0, z: dz });\n        target.slice(sliceDir);\n        \n        this.score += 100 * this.wave;\n        this.onTargetDestroyed?.(target);\n        \n        return target;\n      }\n    }\n\n    return null;\n  }\n\n  /** Сплеш-волна - бьёт всех врагов в радиусе горизонтально */\n  public trySplashWave(playerPos: Vec3, playerYaw: number, radius: number): number {\n    let killCount = 0;\n    \n    for (const target of this.targets) {\n      if (!target.active) continue;\n\n      // Расстояние от игрока\n      const dx = target.position.x - playerPos.x;\n      const dz = target.position.z - playerPos.z;\n      const dist = Math.sqrt(dx * dx + dz * dz);\n      \n      // Учитываем размер врага для радиуса\n      const effectiveRadius = radius + (target.isBoss ? target.radius : target.radius);\n      if (dist > effectiveRadius) continue;\n\n      // Попали!\n      if (target.isBoss) {\n        // Босс - уменьшаем HP (сплеш наносит 2 урона)\n        const killed = target.takeDamage(2);\n        \n        // Зелёный босс выпускает бейнлинга при каждом ударе!\n        if (target.enemyType === 'boss_green' && !killed) {\n          this.spawnBanelingFromBoss(target.position);\n        }\n        \n        if (killed) {\n          // Босс убит!\n          const sliceDir = normalizeVec3({ x: dx, y: 0, z: dz });\n          target.slice(sliceDir);\n          this.score += 1000 * this.wave;\n          this.onTargetDestroyed?.(target);\n          killCount++;\n          \n          // Зелёный босс при смерти выпускает бейнлингов\n          if (target.enemyType === 'boss_green') {\n            for (let i = 0; i < 5; i++) {\n              this.spawnBanelingFromBoss(target.position);\n            }\n          }\n        } else {\n          // Откидываем босса назад (сплеш сильнее)\n          const knockbackForce = (target.enemyType === 'boss_green' ? 12 : \n                                  target.enemyType === 'boss_black' ? 8 : 18);\n          target.applyKnockback(dx, dz, knockbackForce);\n        }\n      } else {\n        // Обычный враг - убиваем сразу\n        const sliceDir = normalizeVec3({ x: dx, y: 0, z: dz });\n        target.slice(sliceDir);\n        \n        this.score += 100 * this.wave;\n        this.onTargetDestroyed?.(target);\n        killCount++;\n      }\n    }\n\n    return killCount;\n  }\n\n  /** Данные для шейдера (4 компонента: x, y, z, type) */\n  public getShaderData(): Float32Array {\n    const data = new Float32Array(this.targets.length * 4);\n    for (let i = 0; i < this.targets.length; i++) {\n      const [x, y, z, typeIntensity] = this.targets[i].getShaderData();\n      data[i * 4 + 0] = x;\n      data[i * 4 + 1] = y;\n      data[i * 4 + 2] = z;\n      data[i * 4 + 3] = typeIntensity;\n    }\n    return data;\n  }\n\n  /** Данные всех осколков */\n  public getAllFragmentsData(): Float32Array {\n    const allFragments: number[] = [];\n    for (const target of this.targets) {\n      allFragments.push(...target.getFragmentsData());\n    }\n    return new Float32Array(allFragments);\n  }\n\n  /** Данные луж для шейдера [x, z, radius, animData] */\n  /** animData: старшие биты = lifetime (0-1), младшие = spreadProgress (0-1) */\n  public getPoolsShaderData(): Float32Array {\n    const data = new Float32Array(this.toxicPools.length * 4);\n    for (let i = 0; i < this.toxicPools.length; i++) {\n      const pool = this.toxicPools[i];\n      data[i * 4 + 0] = pool.position.x;\n      data[i * 4 + 1] = pool.position.z;\n      data[i * 4 + 2] = pool.radius;\n      // Комбинируем lifetime и spreadProgress\n      const lifetimeNorm = pool.lifetime / pool.maxLifetime;\n      data[i * 4 + 3] = lifetimeNorm + pool.spreadProgress * 0.01; // spreadProgress в дробной части\n    }\n    return data;\n  }\n\n  /** Данные снарядов кислоты для шейдера [x, y, z, progress] */\n  public getAcidProjectilesData(): Float32Array {\n    const data = new Float32Array(this.acidProjectiles.length * 4);\n    for (let i = 0; i < this.acidProjectiles.length; i++) {\n      const proj = this.acidProjectiles[i];\n      data[i * 4 + 0] = proj.position.x;\n      data[i * 4 + 1] = proj.position.y;\n      data[i * 4 + 2] = proj.position.z;\n      data[i * 4 + 3] = proj.progress;\n    }\n    return data;\n  }\n\n  /** Данные зон кислотного дождя для шейдера [x, z, radius, isRaining] */\n  public getAcidRainZonesData(): Float32Array {\n    const data = new Float32Array(this.acidRainZones.length * 4);\n    for (let i = 0; i < this.acidRainZones.length; i++) {\n      const zone = this.acidRainZones[i];\n      data[i * 4 + 0] = zone.position.x;\n      data[i * 4 + 1] = zone.position.z;\n      data[i * 4 + 2] = zone.radius;\n      data[i * 4 + 3] = zone.isRaining ? 1.0 : (1.0 - zone.markTime / 1.5) * 0.5; // 0-0.5 = метка, 1 = дождь\n    }\n    return data;\n  }\n\n  /** Создать летящий снаряд кислоты */\n  private spawnAcidProjectile(startPos: Vec3, targetPos: Vec3): void {\n    this.acidProjectiles.push({\n      position: { ...startPos },\n      targetPos: { ...targetPos },\n      startPos: { ...startPos },\n      progress: 0,\n      flightTime: 1.2 // 1.2 секунды полёта\n    });\n    // Звук плевка\n    this.onAcidSpit?.();\n  }\n\n  /** Создать зону кислотного дождя (метка → дождь) */\n  private spawnAcidRainZone(pos: Vec3): void {\n    this.acidRainZones.push({\n      position: { ...pos },\n      radius: 4.0,       // Радиус зоны\n      lifetime: 5.0,     // 5 секунд дождя\n      markTime: 1.5,     // 1.5 секунды предупреждение\n      isRaining: false,\n      damage: 6\n    });\n    // Звук установки метки\n    this.onAcidRainMarkSound?.();\n  }\n\n  /** Callback при плевке (звук) */\n  public onAcidSpit?: () => void;\n\n  /** Callback при установке метки дождя (звук) */\n  public onAcidRainMarkSound?: () => void;\n\n  /** Callback когда дождь начинается */\n  public onAcidRainStart?: (pos: Vec3) => void;\n\n  /** Спавн бейнлинга из Зелёного Босса */\n  private spawnBanelingFromBoss(bossPos: Vec3): void {\n    const angle = Math.random() * Math.PI * 2;\n    const speed = 5 + Math.random() * 3;\n    \n    const pos = vec3(\n      bossPos.x + Math.cos(angle) * 2,\n      bossPos.y + Math.random() * 1.5,\n      bossPos.z + Math.sin(angle) * 2\n    );\n    \n    const baneling = new Target(pos, speed, this.enemyIdCounter++, 'baneling', this.collision || undefined);\n    \n    baneling.velocity = vec3(\n      Math.cos(angle) * 8,\n      3 + Math.random() * 3,\n      Math.sin(angle) * 8\n    );\n    \n    this.targets.push(baneling);\n  }\n\n  /** Спавн фантома из Чёрного Босса */\n  private spawnPhantomFromBoss(spawnPos: Vec3): void {\n    const speed = 8 + Math.random() * 4;\n    const phantom = new Target(spawnPos, speed, this.enemyIdCounter++, 'phantom', this.collision || undefined);\n    this.targets.push(phantom);\n  }\n\n  /** Получить силу притяжения вихря для игрока */\n  public getVortexPull(playerPos: Vec3): Vec3 {\n    for (const target of this.targets) {\n      if (target.active && target.enemyType === 'boss_black') {\n        return target.getVortexPull(playerPos);\n      }\n    }\n    return vec3(0, 0, 0);\n  }\n\n  /** Попытка разрубить кристалл */\n  public trySliceCrystal(playerPos: Vec3, playerYaw: number, range: number): boolean {\n    for (const crystal of this.powerCrystals) {\n      if (!crystal.active) continue;\n\n      const dx = crystal.x - playerPos.x;\n      const dy = crystal.height - playerPos.y;\n      const dz = crystal.z - playerPos.z;\n      const dist = Math.sqrt(dx * dx + dy * dy + dz * dz);\n\n      if (dist > range + 1.0) continue; // +1 для размера кристалла\n\n      // Угол\n      const angleToTarget = Math.atan2(dx, -dz);\n      let angleDiff = angleToTarget - playerYaw;\n      while (angleDiff > Math.PI) angleDiff -= Math.PI * 2;\n      while (angleDiff < -Math.PI) angleDiff += Math.PI * 2;\n\n      if (Math.abs(angleDiff) > Math.PI / 3) continue; // 60° угол атаки\n\n      // Попали по кристаллу!\n      crystal.active = false;\n      \n      const remaining = this.powerCrystals.filter(c => c.active).length;\n      this.onCrystalDestroyed?.(remaining);\n\n      // Спавним фантома из разбитого кристалла\n      this.spawnPhantomFromBoss(vec3(crystal.x, crystal.height, crystal.z));\n\n      // Каждый кристалл = 10 HP босса (половина HP зелёного босса)\n      // Уничтожение кристалла уменьшает maxHp босса на 10\n      for (const target of this.targets) {\n        if (target.active && target.enemyType === 'boss_black') {\n          target.maxHp -= 10; // Убираем защиту кристалла\n          // HP не может быть больше maxHp\n          if (target.hp > target.maxHp) {\n            target.hp = target.maxHp;\n          }\n        }\n      }\n\n      return true;\n    }\n    return false;\n  }\n\n  /** Данные кристаллов для шейдера */\n  public getCrystalsData(): Float32Array {\n    // 6 кристаллов * 4 компонента (x, z, height, active)\n    const data = new Float32Array(24);\n    for (let i = 0; i < 6; i++) {\n      if (i < this.powerCrystals.length) {\n        const c = this.powerCrystals[i];\n        data[i * 4 + 0] = c.x;\n        data[i * 4 + 1] = c.z;\n        data[i * 4 + 2] = c.height;\n        data[i * 4 + 3] = c.active ? 1.0 : 0.0;\n      } else {\n        data[i * 4 + 3] = 0.0; // Неактивен\n      }\n    }\n    return data;\n  }\n\n  /** Количество активных врагов */\n  public getActiveCount(): number {\n    return this.targets.filter(t => t.active).length;\n  }\n\n  /** Получить активного босса (если есть) */\n  public getActiveBoss(): Target | null {\n    return this.targets.find(t => t.active && t.isBoss) || null;\n  }\n\n  /** Расстояние до ближайшего врага */\n  public getClosestEnemyDistance(playerPos: Vec3): number {\n    let minDist = Infinity;\n    for (const target of this.targets) {\n      if (!target.active) continue;\n      const dx = target.position.x - playerPos.x;\n      const dy = target.position.y - playerPos.y;\n      const dz = target.position.z - playerPos.z;\n      const dist = Math.sqrt(dx * dx + dy * dy + dz * dz);\n      if (dist < minDist) minDist = dist;\n    }\n    return minDist;\n  }\n\n  /** Создать мишени для арены (заглушка для совместимости) */\n  public createArenaTargets(_count: number = 8): void {\n    this.startGame();\n  }\n\n  /** Проверить попадание снаряда (заглушка) */\n  public checkProjectileHit(_position: Vec3, _damage: number): Target | null {\n    return null;\n  }\n}\n","import type { Vec3 } from '@/types';\nimport { vec3, distanceVec3 } from '@/utils/math';\n\n/** Тип предмета */\nexport type PickupType = 'health' | 'stimpack' | 'charge';\n\n/**\n * Предмет для подбора\n */\nexport class Pickup {\n  /** Позиция */\n  public position: Vec3;\n\n  /** Тип предмета */\n  public type: PickupType;\n\n  /** Радиус подбора */\n  public radius = 1.0;\n\n  /** Активен? */\n  public active = true;\n\n  /** Время жизни */\n  public lifetime: number;\n\n  /** Фаза анимации */\n  private phase: number;\n\n  /** Базовая высота */\n  private baseY: number;\n\n  constructor(position: Vec3, type: PickupType) {\n    this.position = { ...position };\n    this.type = type;\n    this.phase = Math.random() * Math.PI * 2;\n    this.baseY = position.y;\n    this.lifetime = 30; // 30 секунд жизни\n  }\n\n  /** Обновление */\n  public update(dt: number, time: number): void {\n    if (!this.active) return;\n\n    // Парящий эффект\n    this.position.y = this.baseY + Math.sin(time * 3 + this.phase) * 0.2;\n\n    // Уменьшение времени жизни\n    this.lifetime -= dt;\n    if (this.lifetime <= 0) {\n      this.active = false;\n    }\n  }\n\n  /** Проверка подбора */\n  public checkPickup(playerPos: Vec3): boolean {\n    if (!this.active) return false;\n\n    const dist = distanceVec3(this.position, playerPos);\n    if (dist < this.radius + 0.5) {\n      this.active = false;\n      return true;\n    }\n    return false;\n  }\n\n  /** Данные для шейдера [x, y, z, type] */\n  public getShaderData(): [number, number, number, number] {\n    // type: 0 = неактивен, 9 = health, 10 = stimpack, 11 = charge\n    let w = 0;\n    if (this.active) {\n      if (this.type === 'health') w = 9;\n      else if (this.type === 'stimpack') w = 10;\n      else if (this.type === 'charge') w = 11;\n    }\n    return [this.position.x, this.position.y, this.position.z, w];\n  }\n}\n\n/**\n * Менеджер предметов\n */\nexport class PickupManager {\n  /** Все предметы */\n  public pickups: Pickup[] = [];\n\n  /** Время между спавнами */\n  private spawnTimer = 10;\n\n  /** Таймер спавна на возвышенности */\n  private platformSpawnTimer = 30;\n\n  /** Позиции возвышенностей */\n  private platformPositions = [\n    { x: -20, y: 2.5, z: 0 },  // Левая платформа\n    { x: 20, y: 2.5, z: 0 },   // Правая платформа\n  ];\n\n  /** Текущая платформа для спавна */\n  private currentPlatform = 0;\n\n  /** Максимум предметов на карте */\n  private maxPickups = 5;\n\n  /** Заряд катаны на балконе */\n  private chargeOnBalcony: Pickup | null = null;\n  \n  /** Таймер респавна заряда */\n  private chargeRespawnTimer = 0;\n\n  constructor() {\n    // Спавним заряд на балконе сразу\n    this.spawnChargeOnBalcony();\n  }\n\n  /** Обновление */\n  public update(dt: number, time: number, playerPos: Vec3): PickupType | null {\n    // Обновляем существующие\n    for (const pickup of this.pickups) {\n      pickup.update(dt, time);\n    }\n\n    // Удаляем неактивные\n    this.pickups = this.pickups.filter(p => p.active);\n\n    // Спавним новые случайные\n    this.spawnTimer -= dt;\n    if (this.spawnTimer <= 0 && this.pickups.length < this.maxPickups) {\n      this.spawnRandom();\n      this.spawnTimer = 8 + Math.random() * 7; // 8-15 сек между спавнами\n    }\n\n    // Спавн аптечки на возвышенности каждые 30 секунд\n    this.platformSpawnTimer -= dt;\n    if (this.platformSpawnTimer <= 0) {\n      this.spawnOnPlatform();\n      this.platformSpawnTimer = 30;\n    }\n\n    // Обновляем респавн заряда\n    this.updateChargeRespawn(dt);\n\n    // Проверяем подбор заряда (только на балконе)\n    if (this.checkChargePickup(playerPos)) {\n      return 'charge';\n    }\n\n    // Проверяем подбор обычных предметов\n    for (const pickup of this.pickups) {\n      // Пропускаем заряд, он уже проверен выше\n      if (pickup.type === 'charge') continue;\n      \n      if (pickup.checkPickup(playerPos)) {\n        return pickup.type;\n      }\n    }\n\n    return null;\n  }\n\n  /** Спавн случайного предмета */\n  private spawnRandom(): void {\n    const spawnRadius = 15;\n    const angle = Math.random() * Math.PI * 2;\n    const dist = 5 + Math.random() * spawnRadius;\n    \n    const pos = vec3(\n      Math.cos(angle) * dist,\n      1.0,\n      Math.sin(angle) * dist\n    );\n\n    // Только аптечки (стимпаки за быстрые убийства)\n    this.pickups.push(new Pickup(pos, 'health'));\n  }\n\n  /** Спавн аптечки на возвышенности */\n  private spawnOnPlatform(): void {\n    // Чередуем платформы\n    const platform = this.platformPositions[this.currentPlatform];\n    this.currentPlatform = (this.currentPlatform + 1) % this.platformPositions.length;\n\n    const pos = vec3(\n      platform.x + (Math.random() - 0.5) * 4, // Небольшой разброс по X\n      platform.y,\n      platform.z + (Math.random() - 0.5) * 8  // Разброс по Z\n    );\n\n    // На платформе всегда аптечка\n    this.pickups.push(new Pickup(pos, 'health'));\n  }\n\n  /** Принудительный спавн после убийства */\n  public spawnAfterKill(position: Vec3): void {\n    // 25% шанс выпадения аптечки (стимпаки за быстрые убийства)\n    if (Math.random() < 0.25) {\n      const pos = vec3(\n        position.x + (Math.random() - 0.5) * 2,\n        1.0,\n        position.z + (Math.random() - 0.5) * 2\n      );\n      this.pickups.push(new Pickup(pos, 'health'));\n    }\n  }\n\n  /** Спавн заряда катаны на верхней платформе */\n  private spawnChargeOnBalcony(): void {\n    // Позиция на верхней круглой платформе (центр, высота 9.5)\n    const pos = vec3(0, 10.3, 0);\n    this.chargeOnBalcony = new Pickup(pos, 'charge');\n    this.chargeOnBalcony.lifetime = 999999; // Не исчезает\n    this.pickups.push(this.chargeOnBalcony);\n  }\n\n  /** Проверка подбора заряда (только на верхней платформе!) */\n  public checkChargePickup(playerPos: Vec3): boolean {\n    if (!this.chargeOnBalcony || !this.chargeOnBalcony.active) return false;\n    \n    // Заряд можно подобрать только если игрок на верхней платформе (высота 9.5 + eyeHeight 1.7 ≈ 11+)\n    if (playerPos.y < 10.5) return false;\n    \n    if (this.chargeOnBalcony.checkPickup(playerPos)) {\n      this.chargeOnBalcony = null;\n      this.chargeRespawnTimer = 60; // Респавн через 60 секунд\n      return true;\n    }\n    return false;\n  }\n\n  /** Респавн заряда после убийства босса */\n  public respawnChargeAfterBoss(): void {\n    // Если заряда нет - спавним сразу\n    if (!this.chargeOnBalcony || !this.chargeOnBalcony.active) {\n      // Удаляем старый из списка если есть\n      this.pickups = this.pickups.filter(p => p !== this.chargeOnBalcony);\n      this.chargeOnBalcony = null;\n      this.chargeRespawnTimer = 0;\n      this.spawnChargeOnBalcony();\n    }\n  }\n\n  /** Обновление респавна заряда */\n  public updateChargeRespawn(dt: number): void {\n    if (this.chargeOnBalcony === null && this.chargeRespawnTimer > 0) {\n      this.chargeRespawnTimer -= dt;\n      if (this.chargeRespawnTimer <= 0) {\n        this.spawnChargeOnBalcony();\n      }\n    }\n  }\n\n  /** Данные для шейдера */\n  public getShaderData(): Float32Array {\n    const data = new Float32Array(this.pickups.length * 4);\n    for (let i = 0; i < this.pickups.length; i++) {\n      const [x, y, z, w] = this.pickups[i].getShaderData();\n      data[i * 4 + 0] = x;\n      data[i * 4 + 1] = y;\n      data[i * 4 + 2] = z;\n      data[i * 4 + 3] = w;\n    }\n    return data;\n  }\n}\n\n","import type { SFXType } from '@/types';\n\n/**\n * Менеджер аудио - SYNTHWAVE/RETROWAVE стиль\n * Дисторшн, глитчи, реверб, энергия!\n */\nexport class AudioManager {\n  private ctx: AudioContext | null = null;\n  private masterGain: GainNode | null = null;\n  private musicGain: GainNode | null = null;\n  private sfxGain: GainNode | null = null;\n\n  // Эффекты\n  private reverb: ConvolverNode | null = null;\n  private distortion: WaveShaperNode | null = null;\n  private compressor: DynamicsCompressorNode | null = null;\n\n  /** Аудио запущено */\n  public isStarted = false;\n\n  /** Звук включён */\n  public isMuted = false;\n\n  /** Запустить аудио */\n  public start(): void {\n    if (this.isStarted) return;\n\n    this.ctx = new (window.AudioContext || (window as any).webkitAudioContext)();\n\n    // Компрессор для панча\n    this.compressor = this.ctx.createDynamicsCompressor();\n    this.compressor.threshold.value = -24;\n    this.compressor.knee.value = 30;\n    this.compressor.ratio.value = 12;\n    this.compressor.attack.value = 0.003;\n    this.compressor.release.value = 0.25;\n    this.compressor.connect(this.ctx.destination);\n\n    // Мастер громкость (уменьшена в 2 раза)\n    this.masterGain = this.ctx.createGain();\n    this.masterGain.gain.value = 0.4;\n    this.masterGain.connect(this.compressor);\n\n    // Дисторшн\n    this.distortion = this.createDistortion(20);\n    this.distortion.connect(this.masterGain);\n\n    // Реверб\n    this.reverb = this.createReverb(2.5);\n    this.reverb.connect(this.masterGain);\n\n    // Музыка\n    this.musicGain = this.ctx.createGain();\n    this.musicGain.gain.value = 0.12;\n    this.musicGain.connect(this.masterGain);\n\n    // Звуковые эффекты\n    this.sfxGain = this.ctx.createGain();\n    this.sfxGain.gain.value = 0.3;\n    this.sfxGain.connect(this.distortion);\n\n    this.isStarted = true;\n\n    // Запускаем музыку\n    this.startSynthwaveMusic();\n  }\n\n  /** Создать дисторшн */\n  private createDistortion(amount: number): WaveShaperNode {\n    const distortion = this.ctx!.createWaveShaper();\n    const samples = 44100;\n    const curve = new Float32Array(samples);\n    const deg = Math.PI / 180;\n\n    for (let i = 0; i < samples; i++) {\n      const x = (i * 2) / samples - 1;\n      curve[i] = ((3 + amount) * x * 20 * deg) / (Math.PI + amount * Math.abs(x));\n    }\n\n    distortion.curve = curve;\n    distortion.oversample = '4x';\n    return distortion;\n  }\n\n  /** Создать реверб */\n  private createReverb(duration: number): ConvolverNode {\n    const convolver = this.ctx!.createConvolver();\n    const rate = this.ctx!.sampleRate;\n    const length = rate * duration;\n    const impulse = this.ctx!.createBuffer(2, length, rate);\n\n    for (let channel = 0; channel < 2; channel++) {\n      const data = impulse.getChannelData(channel);\n      for (let i = 0; i < length; i++) {\n        // Экспоненциальное затухание с модуляцией\n        const decay = Math.exp(-3 * i / length);\n        const mod = Math.sin(i * 0.001) * 0.3 + 0.7;\n        data[i] = (Math.random() * 2 - 1) * decay * mod;\n      }\n    }\n\n    convolver.buffer = impulse;\n    return convolver;\n  }\n\n  /** Переключить звук */\n  public toggleMute(): void {\n    this.isMuted = !this.isMuted;\n    if (this.masterGain) {\n      this.masterGain.gain.value = this.isMuted ? 0 : this.volume;\n    }\n  }\n\n  /** Громкость (0-1) */\n  private volume = 0.5;\n\n  /** Установить громкость */\n  public setVolume(value: number): void {\n    this.volume = Math.max(0, Math.min(1, value));\n    if (this.masterGain && !this.isMuted) {\n      this.masterGain.gain.value = this.volume;\n    }\n  }\n\n  // Звук приближения врага\n  private proximityOsc: OscillatorNode | null = null;\n  private proximityGain: GainNode | null = null;\n  private proximityFilter: BiquadFilterNode | null = null;\n\n  /** Воспроизвести звуковой эффект */\n  public playSFX(type: SFXType): void {\n    if (!this.ctx || !this.sfxGain || this.isMuted) return;\n\n    switch (type) {\n      case 'gunshot':\n        this.playKatanaSwing();\n        break;\n      case 'reload':\n        this.playGlitch();\n        break;\n      case 'footstep':\n        this.playFootstep();\n        break;\n      case 'jump':\n        this.playJump();\n        break;\n      case 'land':\n        this.playLand();\n        break;\n      case 'hit':\n        this.playBanelingExplosion(); // Взрыв бейнлинга!\n        break;\n      case 'phantom_pass':\n        this.playPhantomPass();\n        break;\n      case 'runner_hit':\n        this.playRunnerHit();\n        break;\n      case 'hopper_hit':\n        this.playHopperHit();\n        break;\n      case 'kill':\n        this.playKill();\n        break;\n      case 'katana_swing':\n        this.playKatanaSwing();\n        break;\n      case 'splash_wave':\n        this.playSplashWave();\n        break;\n      case 'charge_pickup':\n        this.playChargePickup();\n        break;\n      case 'acid_spit':\n        this.playAcidSpit();\n        break;\n    }\n  }\n\n  /** Обновить звук приближения врага (0-1, где 1 = очень близко) */\n  public updateProximitySound(proximity: number): void {\n    if (!this.ctx || !this.sfxGain || this.isMuted) return;\n\n    // Создаём осциллятор если нет\n    if (!this.proximityOsc) {\n      this.proximityOsc = this.ctx.createOscillator();\n      this.proximityGain = this.ctx.createGain();\n      this.proximityFilter = this.ctx.createBiquadFilter();\n\n      this.proximityOsc.type = 'sawtooth';\n      this.proximityFilter!.type = 'lowpass';\n      this.proximityFilter!.Q.value = 5;\n\n      this.proximityOsc.connect(this.proximityFilter!);\n      this.proximityFilter!.connect(this.proximityGain!);\n      this.proximityGain!.connect(this.sfxGain);\n\n      this.proximityOsc.start();\n    }\n\n    // Частота и громкость зависят от близости\n    const freq = 80 + proximity * 200; // 80-280 Hz\n    const volume = proximity * 0.25; // 0-0.25\n    const filterFreq = 200 + proximity * 1500; // 200-1700 Hz\n\n    this.proximityOsc.frequency.setTargetAtTime(freq, this.ctx.currentTime, 0.1);\n    this.proximityGain!.gain.setTargetAtTime(volume, this.ctx.currentTime, 0.1);\n    this.proximityFilter!.frequency.setTargetAtTime(filterFreq, this.ctx.currentTime, 0.1);\n\n    // Добавляем вибрато при высокой близости\n    if (proximity > 0.6) {\n      const vibrato = Math.sin(this.ctx.currentTime * 20) * 20 * proximity;\n      this.proximityOsc.frequency.setTargetAtTime(freq + vibrato, this.ctx.currentTime, 0.02);\n    }\n  }\n\n  /** Таймеры для звуков приближения каждого типа врага */\n  private enemySoundCooldowns: Map<string, number> = new Map();\n\n  /** Звук приближения врага определённого типа */\n  public playEnemyProximitySound(enemyType: string, distance: number): void {\n    if (!this.ctx || !this.sfxGain || this.isMuted) return;\n    if (distance > 8) return; // Слишком далеко\n\n    // Кулдаун для каждого типа врага\n    const now = Date.now();\n    const lastPlayed = this.enemySoundCooldowns.get(enemyType) || 0;\n    const cooldown = enemyType.startsWith('boss') ? 500 : 300; // Боссы чаще\n    if (now - lastPlayed < cooldown) return;\n    this.enemySoundCooldowns.set(enemyType, now);\n\n    const volume = Math.max(0.1, (8 - distance) / 8) * 0.4; // Громче когда ближе\n    const ctxNow = this.ctx.currentTime;\n\n    switch (enemyType) {\n      case 'baneling':\n        this.playBanelingProximity(volume, ctxNow);\n        break;\n      case 'phantom':\n        this.playPhantomProximity(volume, ctxNow);\n        break;\n      case 'runner':\n        this.playRunnerProximity(volume, ctxNow);\n        break;\n      case 'hopper':\n        this.playHopperProximity(volume, ctxNow);\n        break;\n      case 'boss_green':\n        this.playBossGreenProximity(volume, ctxNow);\n        break;\n      case 'boss_black':\n        this.playBossBlackProximity(volume, ctxNow);\n        break;\n      case 'boss_blue':\n        this.playBossBlueProximity(volume, ctxNow);\n        break;\n    }\n  }\n\n  /** Baneling - булькающий кислотный звук */\n  private playBanelingProximity(vol: number, now: number): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    // Булькание\n    const osc = this.ctx.createOscillator();\n    const gain = this.ctx.createGain();\n    const filter = this.ctx.createBiquadFilter();\n\n    osc.type = 'sine';\n    // Случайные \"буль-буль\"\n    osc.frequency.setValueAtTime(150 + Math.random() * 50, now);\n    osc.frequency.setValueAtTime(100 + Math.random() * 30, now + 0.05);\n    osc.frequency.setValueAtTime(180 + Math.random() * 40, now + 0.1);\n\n    filter.type = 'lowpass';\n    filter.frequency.value = 400;\n    filter.Q.value = 8;\n\n    gain.gain.setValueAtTime(vol * 0.5, now);\n    gain.gain.exponentialRampToValueAtTime(0.01, now + 0.15);\n\n    osc.connect(filter);\n    filter.connect(gain);\n    gain.connect(this.sfxGain);\n\n    osc.start(now);\n    osc.stop(now + 0.2);\n  }\n\n  /** Phantom - жуткий шёпот/завывание */\n  private playPhantomProximity(vol: number, now: number): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    // Жуткий шёпот\n    const osc1 = this.ctx.createOscillator();\n    const osc2 = this.ctx.createOscillator();\n    const gain = this.ctx.createGain();\n    const filter = this.ctx.createBiquadFilter();\n\n    osc1.type = 'sine';\n    osc1.frequency.setValueAtTime(200, now);\n    osc1.frequency.linearRampToValueAtTime(150, now + 0.3);\n\n    osc2.type = 'sine';\n    osc2.frequency.setValueAtTime(203, now); // Лёгкая расстройка = биение\n    osc2.frequency.linearRampToValueAtTime(148, now + 0.3);\n\n    filter.type = 'bandpass';\n    filter.frequency.value = 300;\n    filter.Q.value = 5;\n\n    gain.gain.setValueAtTime(0, now);\n    gain.gain.linearRampToValueAtTime(vol * 0.4, now + 0.1);\n    gain.gain.linearRampToValueAtTime(0, now + 0.35);\n\n    osc1.connect(filter);\n    osc2.connect(filter);\n    filter.connect(gain);\n    gain.connect(this.sfxGain);\n\n    osc1.start(now);\n    osc1.stop(now + 0.4);\n    osc2.start(now);\n    osc2.stop(now + 0.4);\n  }\n\n  /** Runner - быстрое шуршание/топот */\n  private playRunnerProximity(vol: number, now: number): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    // Быстрый топот\n    for (let i = 0; i < 3; i++) {\n      const osc = this.ctx.createOscillator();\n      const gain = this.ctx.createGain();\n      const time = now + i * 0.06;\n\n      osc.type = 'triangle';\n      osc.frequency.setValueAtTime(80 + Math.random() * 40, time);\n      osc.frequency.exponentialRampToValueAtTime(40, time + 0.03);\n\n      gain.gain.setValueAtTime(vol * 0.3, time);\n      gain.gain.exponentialRampToValueAtTime(0.01, time + 0.04);\n\n      osc.connect(gain);\n      gain.connect(this.sfxGain);\n\n      osc.start(time);\n      osc.stop(time + 0.05);\n    }\n  }\n\n  /** Hopper - пружинистый звук прыжка */\n  private playHopperProximity(vol: number, now: number): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    const osc = this.ctx.createOscillator();\n    const gain = this.ctx.createGain();\n\n    osc.type = 'sine';\n    // Пружина вверх\n    osc.frequency.setValueAtTime(100, now);\n    osc.frequency.exponentialRampToValueAtTime(400, now + 0.1);\n    osc.frequency.exponentialRampToValueAtTime(150, now + 0.2);\n\n    gain.gain.setValueAtTime(vol * 0.4, now);\n    gain.gain.exponentialRampToValueAtTime(0.01, now + 0.25);\n\n    osc.connect(gain);\n    gain.connect(this.sfxGain);\n\n    osc.start(now);\n    osc.stop(now + 0.3);\n  }\n\n  /** Boss Green - токсичное шипение */\n  private playBossGreenProximity(vol: number, now: number): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    // Шипение кислоты\n    const bufferSize = this.ctx.sampleRate * 0.3;\n    const buffer = this.ctx.createBuffer(1, bufferSize, this.ctx.sampleRate);\n    const data = buffer.getChannelData(0);\n    for (let i = 0; i < bufferSize; i++) {\n      data[i] = (Math.random() * 2 - 1) * Math.exp(-i / (this.ctx.sampleRate * 0.15));\n    }\n\n    const noise = this.ctx.createBufferSource();\n    noise.buffer = buffer;\n\n    const filter = this.ctx.createBiquadFilter();\n    filter.type = 'bandpass';\n    filter.frequency.value = 4000;\n    filter.Q.value = 3;\n\n    const gain = this.ctx.createGain();\n    gain.gain.setValueAtTime(vol * 0.5, now);\n    gain.gain.exponentialRampToValueAtTime(0.01, now + 0.3);\n\n    noise.connect(filter);\n    filter.connect(gain);\n    gain.connect(this.sfxGain);\n\n    noise.start(now);\n    noise.stop(now + 0.35);\n\n    // Низкий рык\n    const growl = this.ctx.createOscillator();\n    const growlGain = this.ctx.createGain();\n\n    growl.type = 'sawtooth';\n    growl.frequency.setValueAtTime(50, now);\n    growl.frequency.linearRampToValueAtTime(40, now + 0.3);\n\n    growlGain.gain.setValueAtTime(vol * 0.3, now);\n    growlGain.gain.exponentialRampToValueAtTime(0.01, now + 0.35);\n\n    growl.connect(growlGain);\n    growlGain.connect(this.sfxGain);\n\n    growl.start(now);\n    growl.stop(now + 0.4);\n  }\n\n  /** Boss Black - гулкий низкий гул искривления */\n  private playBossBlackProximity(vol: number, now: number): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    // Гулкий гул\n    const osc1 = this.ctx.createOscillator();\n    const osc2 = this.ctx.createOscillator();\n    const gain = this.ctx.createGain();\n    const filter = this.ctx.createBiquadFilter();\n\n    osc1.type = 'sine';\n    osc1.frequency.setValueAtTime(40, now);\n\n    osc2.type = 'sine';\n    osc2.frequency.setValueAtTime(42, now); // Биение\n\n    filter.type = 'lowpass';\n    filter.frequency.value = 100;\n    filter.Q.value = 10;\n\n    gain.gain.setValueAtTime(0, now);\n    gain.gain.linearRampToValueAtTime(vol * 0.6, now + 0.15);\n    gain.gain.linearRampToValueAtTime(0, now + 0.4);\n\n    osc1.connect(filter);\n    osc2.connect(filter);\n    filter.connect(gain);\n    gain.connect(this.sfxGain);\n\n    osc1.start(now);\n    osc1.stop(now + 0.45);\n    osc2.start(now);\n    osc2.stop(now + 0.45);\n\n    // Искажение пространства\n    const warp = this.ctx.createOscillator();\n    const warpGain = this.ctx.createGain();\n\n    warp.type = 'sawtooth';\n    warp.frequency.setValueAtTime(80, now);\n    warp.frequency.exponentialRampToValueAtTime(30, now + 0.3);\n\n    warpGain.gain.setValueAtTime(vol * 0.2, now);\n    warpGain.gain.exponentialRampToValueAtTime(0.01, now + 0.35);\n\n    warp.connect(warpGain);\n    warpGain.connect(this.sfxGain);\n\n    warp.start(now);\n    warp.stop(now + 0.4);\n  }\n\n  /** Boss Blue - электрический разряд/телепорт */\n  private playBossBlueProximity(vol: number, now: number): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    // Электрический треск\n    const bufferSize = this.ctx.sampleRate * 0.15;\n    const buffer = this.ctx.createBuffer(1, bufferSize, this.ctx.sampleRate);\n    const data = buffer.getChannelData(0);\n    for (let i = 0; i < bufferSize; i++) {\n      // Случайные щелчки\n      data[i] = Math.random() > 0.95 ? (Math.random() * 2 - 1) : 0;\n    }\n\n    const noise = this.ctx.createBufferSource();\n    noise.buffer = buffer;\n\n    const filter = this.ctx.createBiquadFilter();\n    filter.type = 'highpass';\n    filter.frequency.value = 3000;\n\n    const gain = this.ctx.createGain();\n    gain.gain.setValueAtTime(vol * 0.4, now);\n    gain.gain.exponentialRampToValueAtTime(0.01, now + 0.15);\n\n    noise.connect(filter);\n    filter.connect(gain);\n    gain.connect(this.sfxGain);\n\n    noise.start(now);\n    noise.stop(now + 0.18);\n\n    // Высокий писк энергии\n    const zap = this.ctx.createOscillator();\n    const zapGain = this.ctx.createGain();\n\n    zap.type = 'sine';\n    zap.frequency.setValueAtTime(2000 + Math.random() * 500, now);\n    zap.frequency.exponentialRampToValueAtTime(500, now + 0.1);\n\n    zapGain.gain.setValueAtTime(vol * 0.25, now);\n    zapGain.gain.exponentialRampToValueAtTime(0.01, now + 0.12);\n\n    zap.connect(zapGain);\n    zapGain.connect(this.sfxGain);\n\n    zap.start(now);\n    zap.stop(now + 0.15);\n  }\n\n  /** Взрыв бейнлинга! */\n  private playBanelingExplosion(): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    const now = this.ctx.currentTime;\n\n    // Мощный низкочастотный взрыв\n    const boom = this.ctx.createOscillator();\n    const boomGain = this.ctx.createGain();\n\n    boom.type = 'sine';\n    boom.frequency.setValueAtTime(100, now);\n    boom.frequency.exponentialRampToValueAtTime(20, now + 0.3);\n\n    boomGain.gain.setValueAtTime(0.7, now);\n    boomGain.gain.exponentialRampToValueAtTime(0.01, now + 0.4);\n\n    boom.connect(boomGain);\n    boomGain.connect(this.sfxGain);\n    boomGain.connect(this.reverb!);\n\n    boom.start(now);\n    boom.stop(now + 0.5);\n\n    // Звук разбрызгивания кислоты\n    const acidNoise = this.createNoise(0.4);\n    const acidGain = this.ctx.createGain();\n    const acidFilter = this.ctx.createBiquadFilter();\n    const acidFilter2 = this.ctx.createBiquadFilter();\n\n    acidFilter.type = 'bandpass';\n    acidFilter.frequency.setValueAtTime(3000, now);\n    acidFilter.frequency.exponentialRampToValueAtTime(500, now + 0.3);\n    acidFilter.Q.value = 3;\n\n    acidFilter2.type = 'highpass';\n    acidFilter2.frequency.value = 1000;\n\n    acidGain.gain.setValueAtTime(0.5, now);\n    acidGain.gain.exponentialRampToValueAtTime(0.01, now + 0.35);\n\n    acidNoise.connect(acidFilter);\n    acidFilter.connect(acidFilter2);\n    acidFilter2.connect(acidGain);\n    acidGain.connect(this.sfxGain);\n\n    // Булькающий звук\n    for (let i = 0; i < 5; i++) {\n      const delay = i * 0.04;\n      const bubble = this.ctx.createOscillator();\n      const bubbleGain = this.ctx.createGain();\n\n      bubble.type = 'sine';\n      bubble.frequency.setValueAtTime(400 + Math.random() * 600, now + delay);\n      bubble.frequency.exponentialRampToValueAtTime(100 + Math.random() * 100, now + delay + 0.08);\n\n      bubbleGain.gain.setValueAtTime(0.15, now + delay);\n      bubbleGain.gain.exponentialRampToValueAtTime(0.01, now + delay + 0.1);\n\n      bubble.connect(bubbleGain);\n      bubbleGain.connect(this.sfxGain);\n\n      bubble.start(now + delay);\n      bubble.stop(now + delay + 0.15);\n    }\n\n    // Шипение кислоты (затухающее)\n    const hiss = this.createNoise(0.8);\n    const hissGain = this.ctx.createGain();\n    const hissFilter = this.ctx.createBiquadFilter();\n\n    hissFilter.type = 'highpass';\n    hissFilter.frequency.value = 4000;\n\n    hissGain.gain.setValueAtTime(0.2, now + 0.1);\n    hissGain.gain.exponentialRampToValueAtTime(0.01, now + 0.7);\n\n    hiss.connect(hissFilter);\n    hissFilter.connect(hissGain);\n    hissGain.connect(this.sfxGain);\n  }\n\n  /** Фантом пролетает сквозь игрока */\n  private playPhantomPass(): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    const now = this.ctx.currentTime;\n\n    // Жуткий низкий свист (доплер эффект)\n    const swoosh = this.ctx.createOscillator();\n    const swooshGain = this.ctx.createGain();\n    const swooshFilter = this.ctx.createBiquadFilter();\n\n    swoosh.type = 'sawtooth';\n    // Частота падает как будто пролетает мимо\n    swoosh.frequency.setValueAtTime(400, now);\n    swoosh.frequency.exponentialRampToValueAtTime(100, now + 0.3);\n\n    swooshFilter.type = 'lowpass';\n    swooshFilter.frequency.setValueAtTime(2000, now);\n    swooshFilter.frequency.exponentialRampToValueAtTime(300, now + 0.3);\n    swooshFilter.Q.value = 2;\n\n    swooshGain.gain.setValueAtTime(0.3, now);\n    swooshGain.gain.exponentialRampToValueAtTime(0.01, now + 0.4);\n\n    swoosh.connect(swooshFilter);\n    swooshFilter.connect(swooshGain);\n    swooshGain.connect(this.sfxGain);\n    swooshGain.connect(this.reverb!);\n\n    swoosh.start(now);\n    swoosh.stop(now + 0.5);\n\n    // Тёмный резонанс\n    const dark = this.ctx.createOscillator();\n    const darkGain = this.ctx.createGain();\n\n    dark.type = 'sine';\n    dark.frequency.setValueAtTime(60, now);\n    dark.frequency.exponentialRampToValueAtTime(30, now + 0.5);\n\n    darkGain.gain.setValueAtTime(0.4, now);\n    darkGain.gain.exponentialRampToValueAtTime(0.01, now + 0.6);\n\n    dark.connect(darkGain);\n    darkGain.connect(this.sfxGain);\n\n    dark.start(now);\n    dark.stop(now + 0.7);\n\n    // Шёпот/шорох (высокочастотный шум)\n    const whisper = this.createNoise(0.3);\n    const whisperGain = this.ctx.createGain();\n    const whisperFilter = this.ctx.createBiquadFilter();\n\n    whisperFilter.type = 'bandpass';\n    whisperFilter.frequency.value = 3000;\n    whisperFilter.Q.value = 5;\n\n    whisperGain.gain.setValueAtTime(0.15, now);\n    whisperGain.gain.exponentialRampToValueAtTime(0.01, now + 0.25);\n\n    whisper.connect(whisperFilter);\n    whisperFilter.connect(whisperGain);\n    whisperGain.connect(this.sfxGain);\n  }\n\n  /** Runner врезался - быстрый огненный удар */\n  private playRunnerHit(): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    const now = this.ctx.currentTime;\n\n    // Быстрый свист\n    const swoosh = this.ctx.createOscillator();\n    const swooshGain = this.ctx.createGain();\n\n    swoosh.type = 'sawtooth';\n    swoosh.frequency.setValueAtTime(800, now);\n    swoosh.frequency.exponentialRampToValueAtTime(200, now + 0.15);\n\n    swooshGain.gain.setValueAtTime(0.3, now);\n    swooshGain.gain.exponentialRampToValueAtTime(0.01, now + 0.2);\n\n    swoosh.connect(swooshGain);\n    swooshGain.connect(this.sfxGain);\n\n    swoosh.start(now);\n    swoosh.stop(now + 0.25);\n\n    // Огненный треск\n    for (let i = 0; i < 4; i++) {\n      const crackle = this.ctx.createOscillator();\n      const crackleGain = this.ctx.createGain();\n\n      crackle.type = 'square';\n      crackle.frequency.value = 1000 + Math.random() * 2000;\n\n      const t = now + i * 0.03;\n      crackleGain.gain.setValueAtTime(0.15, t);\n      crackleGain.gain.setValueAtTime(0, t + 0.02);\n\n      crackle.connect(crackleGain);\n      crackleGain.connect(this.sfxGain);\n\n      crackle.start(t);\n      crackle.stop(t + 0.03);\n    }\n\n    // Низкий удар\n    const impact = this.ctx.createOscillator();\n    const impactGain = this.ctx.createGain();\n\n    impact.type = 'sine';\n    impact.frequency.setValueAtTime(120, now);\n    impact.frequency.exponentialRampToValueAtTime(40, now + 0.15);\n\n    impactGain.gain.setValueAtTime(0.4, now);\n    impactGain.gain.exponentialRampToValueAtTime(0.01, now + 0.2);\n\n    impact.connect(impactGain);\n    impactGain.connect(this.sfxGain);\n\n    impact.start(now);\n    impact.stop(now + 0.25);\n  }\n\n  /** Hopper приземлился на игрока - электрический удар сверху */\n  private playHopperHit(): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    const now = this.ctx.currentTime;\n\n    // Электрический разряд (высокий → низкий)\n    const zap = this.ctx.createOscillator();\n    const zapGain = this.ctx.createGain();\n    const zapFilter = this.ctx.createBiquadFilter();\n\n    zap.type = 'sawtooth';\n    zap.frequency.setValueAtTime(2000, now);\n    zap.frequency.exponentialRampToValueAtTime(100, now + 0.2);\n\n    zapFilter.type = 'bandpass';\n    zapFilter.frequency.value = 1500;\n    zapFilter.Q.value = 3;\n\n    zapGain.gain.setValueAtTime(0.35, now);\n    zapGain.gain.exponentialRampToValueAtTime(0.01, now + 0.25);\n\n    zap.connect(zapFilter);\n    zapFilter.connect(zapGain);\n    zapGain.connect(this.sfxGain);\n    zapGain.connect(this.reverb!);\n\n    zap.start(now);\n    zap.stop(now + 0.3);\n\n    // Тяжёлый удар сверху\n    const thud = this.ctx.createOscillator();\n    const thudGain = this.ctx.createGain();\n\n    thud.type = 'sine';\n    thud.frequency.setValueAtTime(80, now + 0.05);\n    thud.frequency.exponentialRampToValueAtTime(25, now + 0.3);\n\n    thudGain.gain.setValueAtTime(0.5, now + 0.05);\n    thudGain.gain.exponentialRampToValueAtTime(0.01, now + 0.35);\n\n    thud.connect(thudGain);\n    thudGain.connect(this.sfxGain);\n\n    thud.start(now + 0.05);\n    thud.stop(now + 0.4);\n\n    // Искры (шум)\n    const sparks = this.createNoise(0.25);\n    const sparksGain = this.ctx.createGain();\n    const sparksFilter = this.ctx.createBiquadFilter();\n\n    sparksFilter.type = 'highpass';\n    sparksFilter.frequency.value = 3000;\n\n    sparksGain.gain.setValueAtTime(0.2, now);\n    sparksGain.gain.exponentialRampToValueAtTime(0.01, now + 0.15);\n\n    sparks.connect(sparksFilter);\n    sparksFilter.connect(sparksGain);\n    sparksGain.connect(this.sfxGain);\n  }\n\n  /** Глитч эффект */\n  private playGlitch(): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    const now = this.ctx.currentTime;\n\n    // Случайные частоты и длительности\n    for (let i = 0; i < 5; i++) {\n      const delay = i * 0.03 + Math.random() * 0.02;\n      const osc = this.ctx.createOscillator();\n      const gain = this.ctx.createGain();\n      const filter = this.ctx.createBiquadFilter();\n\n      osc.type = Math.random() > 0.5 ? 'square' : 'sawtooth';\n      osc.frequency.value = 100 + Math.random() * 2000;\n\n      filter.type = 'bandpass';\n      filter.frequency.value = 500 + Math.random() * 3000;\n      filter.Q.value = 5 + Math.random() * 10;\n\n      gain.gain.setValueAtTime(0.15, now + delay);\n      gain.gain.setValueAtTime(0, now + delay + 0.02 + Math.random() * 0.03);\n\n      osc.connect(filter);\n      filter.connect(gain);\n      gain.connect(this.sfxGain);\n      gain.connect(this.reverb!);\n\n      osc.start(now + delay);\n      osc.stop(now + delay + 0.1);\n    }\n  }\n\n  /** Шаг с басовым ударом */\n  private playFootstep(): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    const now = this.ctx.currentTime;\n\n    // Низкий удар\n    const kick = this.ctx.createOscillator();\n    const kickGain = this.ctx.createGain();\n\n    kick.type = 'sine';\n    kick.frequency.setValueAtTime(80, now);\n    kick.frequency.exponentialRampToValueAtTime(30, now + 0.08);\n\n    kickGain.gain.setValueAtTime(0.2, now);\n    kickGain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);\n\n    kick.connect(kickGain);\n    kickGain.connect(this.sfxGain);\n\n    kick.start(now);\n    kick.stop(now + 0.12);\n\n    // Шум поверхности\n    const noise = this.createNoise(0.06);\n    const noiseGain = this.ctx.createGain();\n    const noiseFilter = this.ctx.createBiquadFilter();\n\n    noiseFilter.type = 'lowpass';\n    noiseFilter.frequency.value = 300 + Math.random() * 200;\n\n    noiseGain.gain.setValueAtTime(0.1, now);\n    noiseGain.gain.exponentialRampToValueAtTime(0.01, now + 0.05);\n\n    noise.connect(noiseFilter);\n    noiseFilter.connect(noiseGain);\n    noiseGain.connect(this.sfxGain);\n  }\n\n  /** Прыжок - восходящий синт */\n  private playJump(): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    const now = this.ctx.currentTime;\n\n    const osc = this.ctx.createOscillator();\n    const osc2 = this.ctx.createOscillator();\n    const gain = this.ctx.createGain();\n\n    osc.type = 'square';\n    osc.frequency.setValueAtTime(150, now);\n    osc.frequency.exponentialRampToValueAtTime(600, now + 0.1);\n\n    osc2.type = 'sawtooth';\n    osc2.frequency.setValueAtTime(155, now);\n    osc2.frequency.exponentialRampToValueAtTime(605, now + 0.1);\n\n    gain.gain.setValueAtTime(0.15, now);\n    gain.gain.exponentialRampToValueAtTime(0.01, now + 0.15);\n\n    osc.connect(gain);\n    osc2.connect(gain);\n    gain.connect(this.sfxGain);\n    gain.connect(this.reverb!);\n\n    osc.start(now);\n    osc.stop(now + 0.15);\n    osc2.start(now);\n    osc2.stop(now + 0.15);\n  }\n\n  /** Приземление - удар + реверб */\n  private playLand(): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    const now = this.ctx.currentTime;\n\n    // Тяжёлый удар\n    const kick = this.ctx.createOscillator();\n    const kickGain = this.ctx.createGain();\n\n    kick.type = 'sine';\n    kick.frequency.setValueAtTime(100, now);\n    kick.frequency.exponentialRampToValueAtTime(20, now + 0.15);\n\n    kickGain.gain.setValueAtTime(0.5, now);\n    kickGain.gain.exponentialRampToValueAtTime(0.01, now + 0.2);\n\n    kick.connect(kickGain);\n    kickGain.connect(this.sfxGain);\n    kickGain.connect(this.reverb!);\n\n    kick.start(now);\n    kick.stop(now + 0.25);\n\n    // Шум удара\n    const noise = this.createNoise(0.15);\n    const noiseGain = this.ctx.createGain();\n    const noiseFilter = this.ctx.createBiquadFilter();\n\n    noiseFilter.type = 'lowpass';\n    noiseFilter.frequency.value = 400;\n\n    noiseGain.gain.setValueAtTime(0.3, now);\n    noiseGain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);\n\n    noise.connect(noiseFilter);\n    noiseFilter.connect(noiseGain);\n    noiseGain.connect(this.sfxGain);\n  }\n\n  /** Убийство врага - ЭПИЧНЫЙ взрыв! */\n  private playKill(): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    const now = this.ctx.currentTime;\n\n    // Мощный басовый взрыв\n    const boom = this.ctx.createOscillator();\n    const boomGain = this.ctx.createGain();\n\n    boom.type = 'sine';\n    boom.frequency.setValueAtTime(150, now);\n    boom.frequency.exponentialRampToValueAtTime(20, now + 0.4);\n\n    boomGain.gain.setValueAtTime(0.6, now);\n    boomGain.gain.exponentialRampToValueAtTime(0.01, now + 0.5);\n\n    boom.connect(boomGain);\n    boomGain.connect(this.sfxGain);\n    boomGain.connect(this.reverb!);\n\n    boom.start(now);\n    boom.stop(now + 0.6);\n\n    // Восходящий синт (сатисфакция)\n    const synth = this.ctx.createOscillator();\n    const synth2 = this.ctx.createOscillator();\n    const synthGain = this.ctx.createGain();\n    const synthFilter = this.ctx.createBiquadFilter();\n\n    synth.type = 'sawtooth';\n    synth.frequency.setValueAtTime(200, now);\n    synth.frequency.exponentialRampToValueAtTime(800, now + 0.2);\n\n    synth2.type = 'square';\n    synth2.frequency.setValueAtTime(203, now);\n    synth2.frequency.exponentialRampToValueAtTime(806, now + 0.2);\n\n    synthFilter.type = 'lowpass';\n    synthFilter.frequency.setValueAtTime(500, now);\n    synthFilter.frequency.exponentialRampToValueAtTime(4000, now + 0.15);\n    synthFilter.Q.value = 3;\n\n    synthGain.gain.setValueAtTime(0.25, now);\n    synthGain.gain.exponentialRampToValueAtTime(0.01, now + 0.3);\n\n    synth.connect(synthFilter);\n    synth2.connect(synthFilter);\n    synthFilter.connect(synthGain);\n    synthGain.connect(this.sfxGain);\n    synthGain.connect(this.reverb!);\n\n    synth.start(now);\n    synth.stop(now + 0.35);\n    synth2.start(now);\n    synth2.stop(now + 0.35);\n\n    // Глитч-хвост\n    for (let i = 0; i < 4; i++) {\n      const delay = 0.1 + i * 0.05;\n      const glitch = this.ctx.createOscillator();\n      const glitchGain = this.ctx.createGain();\n\n      glitch.type = 'square';\n      glitch.frequency.value = 400 + Math.random() * 1000;\n\n      glitchGain.gain.setValueAtTime(0.1, now + delay);\n      glitchGain.gain.exponentialRampToValueAtTime(0.01, now + delay + 0.03);\n\n      glitch.connect(glitchGain);\n      glitchGain.connect(this.distortion!);\n\n      glitch.start(now + delay);\n      glitch.stop(now + delay + 0.05);\n    }\n\n    // Шум взрыва\n    const noise = this.createNoise(0.3);\n    const noiseGain = this.ctx.createGain();\n    const noiseFilter = this.ctx.createBiquadFilter();\n\n    noiseFilter.type = 'bandpass';\n    noiseFilter.frequency.setValueAtTime(2000, now);\n    noiseFilter.frequency.exponentialRampToValueAtTime(200, now + 0.3);\n    noiseFilter.Q.value = 1;\n\n    noiseGain.gain.setValueAtTime(0.3, now);\n    noiseGain.gain.exponentialRampToValueAtTime(0.01, now + 0.25);\n\n    noise.connect(noiseFilter);\n    noiseFilter.connect(noiseGain);\n    noiseGain.connect(this.sfxGain);\n  }\n\n  /** Создать источник шума */\n  private createNoise(duration: number): AudioBufferSourceNode {\n    if (!this.ctx) throw new Error('AudioContext not initialized');\n\n    const bufferSize = this.ctx.sampleRate * duration;\n    const buffer = this.ctx.createBuffer(1, bufferSize, this.ctx.sampleRate);\n    const data = buffer.getChannelData(0);\n\n    for (let i = 0; i < bufferSize; i++) {\n      data[i] = Math.random() * 2 - 1;\n    }\n\n    const source = this.ctx.createBufferSource();\n    source.buffer = buffer;\n    source.start();\n\n    return source;\n  }\n\n  /** Взмах катаной */\n  private playKatanaSwing(): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    const now = this.ctx.currentTime;\n\n    // Свист лезвия\n    const whoosh = this.ctx.createOscillator();\n    const whooshGain = this.ctx.createGain();\n    const whooshFilter = this.ctx.createBiquadFilter();\n\n    whoosh.type = 'sawtooth';\n    whoosh.frequency.setValueAtTime(600, now);\n    whoosh.frequency.exponentialRampToValueAtTime(100, now + 0.12);\n\n    whooshFilter.type = 'bandpass';\n    whooshFilter.frequency.setValueAtTime(800, now);\n    whooshFilter.frequency.exponentialRampToValueAtTime(300, now + 0.12);\n    whooshFilter.Q.value = 4;\n\n    whooshGain.gain.setValueAtTime(0.25, now);\n    whooshGain.gain.exponentialRampToValueAtTime(0.01, now + 0.15);\n\n    whoosh.connect(whooshFilter);\n    whooshFilter.connect(whooshGain);\n    whooshGain.connect(this.sfxGain);\n\n    whoosh.start(now);\n    whoosh.stop(now + 0.2);\n\n    // Лёгкий металлический звон\n    const metal = this.ctx.createOscillator();\n    const metalGain = this.ctx.createGain();\n\n    metal.type = 'sine';\n    metal.frequency.value = 1800;\n\n    metalGain.gain.setValueAtTime(0.08, now + 0.03);\n    metalGain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);\n\n    metal.connect(metalGain);\n    metalGain.connect(this.sfxGain);\n\n    metal.start(now + 0.03);\n    metal.stop(now + 0.15);\n  }\n\n  /** Сплеш-волна энергии - МОЩНАЯ! */\n  private playSplashWave(): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    const now = this.ctx.currentTime;\n\n    // Волна энергии - нарастает и расходится\n    const wave = this.ctx.createOscillator();\n    const waveGain = this.ctx.createGain();\n    const waveFilter = this.ctx.createBiquadFilter();\n\n    wave.type = 'sawtooth';\n    wave.frequency.setValueAtTime(200, now);\n    wave.frequency.exponentialRampToValueAtTime(80, now + 0.4);\n\n    waveFilter.type = 'lowpass';\n    waveFilter.frequency.setValueAtTime(2000, now);\n    waveFilter.frequency.exponentialRampToValueAtTime(400, now + 0.4);\n    waveFilter.Q.value = 10;\n\n    waveGain.gain.setValueAtTime(0.5, now);\n    waveGain.gain.exponentialRampToValueAtTime(0.01, now + 0.5);\n\n    wave.connect(waveFilter);\n    waveFilter.connect(waveGain);\n    waveGain.connect(this.sfxGain);\n    waveGain.connect(this.reverb!);\n\n    wave.start(now);\n    wave.stop(now + 0.5);\n\n    // Электрический треск\n    const noiseSource = this.createNoise(0.3);\n    const noiseGain = this.ctx.createGain();\n    const noiseFilter = this.ctx.createBiquadFilter();\n\n    noiseFilter.type = 'bandpass';\n    noiseFilter.frequency.value = 3000;\n    noiseFilter.Q.value = 5;\n\n    noiseGain.gain.setValueAtTime(0.2, now);\n    noiseGain.gain.exponentialRampToValueAtTime(0.01, now + 0.25);\n\n    noiseSource.connect(noiseFilter);\n    noiseFilter.connect(noiseGain);\n    noiseGain.connect(this.sfxGain);\n\n    // Высокий тон резонанса\n    const resonance = this.ctx.createOscillator();\n    const resonanceGain = this.ctx.createGain();\n\n    resonance.type = 'sine';\n    resonance.frequency.setValueAtTime(800, now);\n    resonance.frequency.exponentialRampToValueAtTime(400, now + 0.3);\n\n    resonanceGain.gain.setValueAtTime(0.15, now);\n    resonanceGain.gain.exponentialRampToValueAtTime(0.01, now + 0.35);\n\n    resonance.connect(resonanceGain);\n    resonanceGain.connect(this.sfxGain);\n\n    resonance.start(now);\n    resonance.stop(now + 0.4);\n\n    // Суб-бас удар\n    const subBass = this.ctx.createOscillator();\n    const subGain = this.ctx.createGain();\n\n    subBass.type = 'sine';\n    subBass.frequency.setValueAtTime(60, now);\n    subBass.frequency.exponentialRampToValueAtTime(30, now + 0.3);\n\n    subGain.gain.setValueAtTime(0.6, now);\n    subGain.gain.exponentialRampToValueAtTime(0.01, now + 0.4);\n\n    subBass.connect(subGain);\n    subGain.connect(this.sfxGain);\n\n    subBass.start(now);\n    subBass.stop(now + 0.45);\n  }\n\n  /** Подбор заряда катаны - электрический эффект */\n  private playChargePickup(): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    const now = this.ctx.currentTime;\n\n    // Нарастающий электрический звук\n    const charge = this.ctx.createOscillator();\n    const charge2 = this.ctx.createOscillator();\n    const chargeGain = this.ctx.createGain();\n    const chargeFilter = this.ctx.createBiquadFilter();\n\n    charge.type = 'sawtooth';\n    charge.frequency.setValueAtTime(150, now);\n    charge.frequency.exponentialRampToValueAtTime(800, now + 0.3);\n\n    charge2.type = 'square';\n    charge2.frequency.setValueAtTime(152, now);\n    charge2.frequency.exponentialRampToValueAtTime(810, now + 0.3);\n\n    chargeFilter.type = 'bandpass';\n    chargeFilter.frequency.setValueAtTime(500, now);\n    chargeFilter.frequency.exponentialRampToValueAtTime(2000, now + 0.3);\n    chargeFilter.Q.value = 8;\n\n    chargeGain.gain.setValueAtTime(0.15, now);\n    chargeGain.gain.linearRampToValueAtTime(0.35, now + 0.2);\n    chargeGain.gain.exponentialRampToValueAtTime(0.01, now + 0.5);\n\n    charge.connect(chargeFilter);\n    charge2.connect(chargeFilter);\n    chargeFilter.connect(chargeGain);\n    chargeGain.connect(this.sfxGain);\n    chargeGain.connect(this.reverb!);\n\n    charge.start(now);\n    charge.stop(now + 0.5);\n    charge2.start(now);\n    charge2.stop(now + 0.5);\n\n    // Высокий блеск энергии\n    const shimmer = this.ctx.createOscillator();\n    const shimmerGain = this.ctx.createGain();\n\n    shimmer.type = 'sine';\n    shimmer.frequency.value = 2500;\n\n    shimmerGain.gain.setValueAtTime(0.12, now + 0.15);\n    shimmerGain.gain.exponentialRampToValueAtTime(0.01, now + 0.5);\n\n    shimmer.connect(shimmerGain);\n    shimmerGain.connect(this.reverb!);\n\n    shimmer.start(now + 0.15);\n    shimmer.stop(now + 0.55);\n\n    // Электрический треск\n    const noiseSource2 = this.createNoise(0.2);\n    const noiseGain2 = this.ctx.createGain();\n    const noiseFilter2 = this.ctx.createBiquadFilter();\n\n    noiseFilter2.type = 'highpass';\n    noiseFilter2.frequency.value = 4000;\n\n    noiseGain2.gain.setValueAtTime(0.1, now + 0.1);\n    noiseGain2.gain.exponentialRampToValueAtTime(0.01, now + 0.3);\n\n    noiseSource2.connect(noiseFilter2);\n    noiseFilter2.connect(noiseGain2);\n    noiseGain2.connect(this.sfxGain);\n  }\n\n  /** Кислотный плевок - звук выплёвывания */\n  private playAcidSpit(): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    const now = this.ctx.currentTime;\n\n    // Хлюпающий звук плевка\n    const spit = this.ctx.createOscillator();\n    const spitGain = this.ctx.createGain();\n\n    spit.type = 'sawtooth';\n    spit.frequency.setValueAtTime(150, now);\n    spit.frequency.exponentialRampToValueAtTime(80, now + 0.15);\n\n    spitGain.gain.setValueAtTime(0.25, now);\n    spitGain.gain.exponentialRampToValueAtTime(0.01, now + 0.2);\n\n    spit.connect(spitGain);\n    spitGain.connect(this.sfxGain);\n\n    spit.start(now);\n    spit.stop(now + 0.2);\n\n    // Свистящий звук летящей кислоты\n    const swoosh = this.ctx.createOscillator();\n    const swooshGain = this.ctx.createGain();\n    const swooshFilter = this.ctx.createBiquadFilter();\n\n    swoosh.type = 'sawtooth';\n    swoosh.frequency.setValueAtTime(500, now + 0.1);\n    swoosh.frequency.exponentialRampToValueAtTime(150, now + 1.2);\n\n    swooshFilter.type = 'bandpass';\n    swooshFilter.frequency.setValueAtTime(400, now);\n    swooshFilter.frequency.exponentialRampToValueAtTime(200, now + 1.0);\n    swooshFilter.Q.value = 3;\n\n    swooshGain.gain.setValueAtTime(0, now);\n    swooshGain.gain.linearRampToValueAtTime(0.15, now + 0.1);\n    swooshGain.gain.exponentialRampToValueAtTime(0.01, now + 1.2);\n\n    swoosh.connect(swooshFilter);\n    swooshFilter.connect(swooshGain);\n    swooshGain.connect(this.sfxGain);\n\n    swoosh.start(now);\n    swoosh.stop(now + 1.2);\n  }\n\n  /** Всплеск кислоты - приземление снаряда */\n  public playAcidSplash(): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    const now = this.ctx.currentTime;\n\n    // Мощный плюх\n    const splash = this.createNoise(0.8);\n    const splashGain = this.ctx.createGain();\n    const splashFilter = this.ctx.createBiquadFilter();\n\n    splashFilter.type = 'lowpass';\n    splashFilter.frequency.setValueAtTime(1200, now);\n    splashFilter.frequency.exponentialRampToValueAtTime(400, now + 0.3);\n\n    splashGain.gain.setValueAtTime(0.4, now);\n    splashGain.gain.exponentialRampToValueAtTime(0.01, now + 0.5);\n\n    splash.connect(splashFilter);\n    splashFilter.connect(splashGain);\n    splashGain.connect(this.sfxGain);\n\n    // Шипение кислоты\n    const hiss = this.createNoise(2.0);\n    const hissGain = this.ctx.createGain();\n    const hissFilter = this.ctx.createBiquadFilter();\n\n    hissFilter.type = 'highpass';\n    hissFilter.frequency.value = 3500;\n\n    hissGain.gain.setValueAtTime(0, now + 0.1);\n    hissGain.gain.linearRampToValueAtTime(0.2, now + 0.2);\n    hissGain.gain.exponentialRampToValueAtTime(0.01, now + 2.0);\n\n    hiss.connect(hissFilter);\n    hissFilter.connect(hissGain);\n    hissGain.connect(this.sfxGain);\n\n    // Низкочастотный удар\n    const impact = this.ctx.createOscillator();\n    const impactGain = this.ctx.createGain();\n\n    impact.type = 'sine';\n    impact.frequency.setValueAtTime(80, now);\n    impact.frequency.exponentialRampToValueAtTime(40, now + 0.2);\n\n    impactGain.gain.setValueAtTime(0.35, now);\n    impactGain.gain.exponentialRampToValueAtTime(0.01, now + 0.3);\n\n    impact.connect(impactGain);\n    impactGain.connect(this.sfxGain);\n\n    impact.start(now);\n    impact.stop(now + 0.3);\n  }\n\n  /** Звук установки метки для кислотного дождя - зловещее предупреждение */\n  public playAcidRainMark(): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    const now = this.ctx.currentTime;\n\n    // Нарастающий тревожный тон\n    const warn = this.ctx.createOscillator();\n    const warnGain = this.ctx.createGain();\n    const warnFilter = this.ctx.createBiquadFilter();\n\n    warn.type = 'sawtooth';\n    warn.frequency.setValueAtTime(200, now);\n    warn.frequency.exponentialRampToValueAtTime(600, now + 1.0);\n\n    warnFilter.type = 'bandpass';\n    warnFilter.frequency.setValueAtTime(400, now);\n    warnFilter.Q.value = 5;\n\n    warnGain.gain.setValueAtTime(0.1, now);\n    warnGain.gain.linearRampToValueAtTime(0.25, now + 0.8);\n    warnGain.gain.exponentialRampToValueAtTime(0.01, now + 1.2);\n\n    warn.connect(warnFilter);\n    warnFilter.connect(warnGain);\n    warnGain.connect(this.sfxGain);\n\n    warn.start(now);\n    warn.stop(now + 1.2);\n\n    // Пульсирующий сигнал тревоги\n    for (let i = 0; i < 3; i++) {\n      const beep = this.ctx.createOscillator();\n      const beepGain = this.ctx.createGain();\n\n      beep.type = 'square';\n      beep.frequency.value = 800;\n\n      beepGain.gain.setValueAtTime(0, now + i * 0.3);\n      beepGain.gain.linearRampToValueAtTime(0.1, now + i * 0.3 + 0.05);\n      beepGain.gain.exponentialRampToValueAtTime(0.01, now + i * 0.3 + 0.15);\n\n      beep.connect(beepGain);\n      beepGain.connect(this.sfxGain);\n\n      beep.start(now + i * 0.3);\n      beep.stop(now + i * 0.3 + 0.2);\n    }\n  }\n\n  /** Звук начала кислотного дождя - шипение и хлещущий звук */\n  public playAcidRainStart(): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    const now = this.ctx.currentTime;\n\n    // Мощный шум падающей жидкости\n    const rain = this.createNoise(3.0);\n    const rainGain = this.ctx.createGain();\n    const rainFilter = this.ctx.createBiquadFilter();\n\n    rainFilter.type = 'bandpass';\n    rainFilter.frequency.value = 2000;\n    rainFilter.Q.value = 1;\n\n    rainGain.gain.setValueAtTime(0, now);\n    rainGain.gain.linearRampToValueAtTime(0.3, now + 0.2);\n    rainGain.gain.setValueAtTime(0.25, now + 2.5);\n    rainGain.gain.exponentialRampToValueAtTime(0.01, now + 3.0);\n\n    rain.connect(rainFilter);\n    rainFilter.connect(rainGain);\n    rainGain.connect(this.sfxGain);\n\n    // Шипение кислоты\n    const hiss = this.createNoise(3.0);\n    const hissGain = this.ctx.createGain();\n    const hissFilter = this.ctx.createBiquadFilter();\n\n    hissFilter.type = 'highpass';\n    hissFilter.frequency.value = 5000;\n\n    hissGain.gain.setValueAtTime(0, now + 0.1);\n    hissGain.gain.linearRampToValueAtTime(0.15, now + 0.3);\n    hissGain.gain.exponentialRampToValueAtTime(0.01, now + 3.0);\n\n    hiss.connect(hissFilter);\n    hissFilter.connect(hissGain);\n    hissGain.connect(this.sfxGain);\n\n    // Низкий гул\n    const rumble = this.ctx.createOscillator();\n    const rumbleGain = this.ctx.createGain();\n\n    rumble.type = 'sine';\n    rumble.frequency.value = 50;\n\n    rumbleGain.gain.setValueAtTime(0.2, now);\n    rumbleGain.gain.exponentialRampToValueAtTime(0.01, now + 2.0);\n\n    rumble.connect(rumbleGain);\n    rumbleGain.connect(this.sfxGain);\n\n    rumble.start(now);\n    rumble.stop(now + 2.0);\n  }\n\n  /** Звук предупреждения о боссе */\n  public playBossWarning(): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    const now = this.ctx.currentTime;\n\n    // Эпичный гонг\n    const gong = this.ctx.createOscillator();\n    const gongGain = this.ctx.createGain();\n\n    gong.type = 'sine';\n    gong.frequency.setValueAtTime(120, now);\n    gong.frequency.exponentialRampToValueAtTime(80, now + 2.0);\n\n    gongGain.gain.setValueAtTime(0.5, now);\n    gongGain.gain.exponentialRampToValueAtTime(0.01, now + 2.5);\n\n    gong.connect(gongGain);\n    gongGain.connect(this.sfxGain);\n    gongGain.connect(this.reverb!);\n\n    gong.start(now);\n    gong.stop(now + 2.5);\n\n    // Второй гонг повыше\n    const gong2 = this.ctx.createOscillator();\n    const gong2Gain = this.ctx.createGain();\n\n    gong2.type = 'sine';\n    gong2.frequency.setValueAtTime(180, now + 0.5);\n    gong2.frequency.exponentialRampToValueAtTime(100, now + 2.5);\n\n    gong2Gain.gain.setValueAtTime(0.3, now + 0.5);\n    gong2Gain.gain.exponentialRampToValueAtTime(0.01, now + 3.0);\n\n    gong2.connect(gong2Gain);\n    gong2Gain.connect(this.sfxGain);\n    gong2Gain.connect(this.reverb!);\n\n    gong2.start(now + 0.5);\n    gong2.stop(now + 3.0);\n\n    // Зловещий шёпот (шум)\n    const whisper = this.createNoise(2.0);\n    const whisperGain = this.ctx.createGain();\n    const whisperFilter = this.ctx.createBiquadFilter();\n\n    whisperFilter.type = 'bandpass';\n    whisperFilter.frequency.value = 800;\n    whisperFilter.Q.value = 5;\n\n    whisperGain.gain.setValueAtTime(0, now + 1.0);\n    whisperGain.gain.linearRampToValueAtTime(0.1, now + 1.5);\n    whisperGain.gain.exponentialRampToValueAtTime(0.01, now + 2.5);\n\n    whisper.connect(whisperFilter);\n    whisperFilter.connect(whisperGain);\n    whisperGain.connect(this.reverb!);\n  }\n\n  // ==================== SYNTHWAVE МУЗЫКА ====================\n\n  private arpInterval: number | null = null;\n\n  /** Текущий режим музыки */\n  private currentMusicMode: 'normal' | 'low_hp' | 'boss_green' | 'boss_black' | 'boss_blue' = 'normal';\n  \n  /** Интервалы музыки для остановки */\n  private musicIntervals: number[] = [];\n\n  /** Флаг тревожного режима */\n  private isLowHpMode = false;\n\n  /** Текущая эпоха (1-3) */\n  private currentEra = 1;\n\n  /** Звук дождя и грома */\n  private rainGain: GainNode | null = null;\n  private rainSource: AudioBufferSourceNode | null = null;\n  private isRainPlaying = false;\n  private thunderInterval: number | null = null;\n\n  /** Установить эпоху музыки */\n  public setEra(wave: number): void {\n    let newEra = 1;\n    if (wave > 10) newEra = 3;\n    else if (wave > 5) newEra = 2;\n\n    // Включаем дождь на волне 15+\n    if (wave >= 15 && !this.isRainPlaying) {\n      this.startRain();\n    } else if (wave < 15 && this.isRainPlaying) {\n      this.stopRain();\n    }\n\n    if (newEra !== this.currentEra && this.currentMusicMode === 'normal') {\n      this.currentEra = newEra;\n      // Перезапускаем музыку для новой эпохи\n      for (const interval of this.musicIntervals) {\n        clearInterval(interval);\n        clearTimeout(interval);\n      }\n      this.musicIntervals = [];\n      this.startSynthwaveMusic();\n    } else {\n      this.currentEra = newEra;\n    }\n  }\n\n  /** Запуск звука дождя */\n  private startRain(): void {\n    if (!this.ctx || !this.masterGain || this.isRainPlaying) return;\n\n    this.isRainPlaying = true;\n\n    // Создаём gain для дождя\n    this.rainGain = this.ctx.createGain();\n    this.rainGain.gain.value = 0;\n    this.rainGain.connect(this.masterGain);\n\n    // Создаём буфер с шумом дождя (белый шум + фильтр)\n    const sampleRate = this.ctx.sampleRate;\n    const duration = 4; // 4 секунды зациклированного шума\n    const bufferSize = sampleRate * duration;\n    const buffer = this.ctx.createBuffer(2, bufferSize, sampleRate);\n\n    // Заполняем буфер шумом капель\n    for (let channel = 0; channel < 2; channel++) {\n      const data = buffer.getChannelData(channel);\n      for (let i = 0; i < bufferSize; i++) {\n        // Базовый шум\n        let sample = (Math.random() * 2 - 1) * 0.3;\n        \n        // Добавляем случайные \"капли\" - короткие щелчки\n        if (Math.random() < 0.001) {\n          sample += (Math.random() * 2 - 1) * 0.8;\n        }\n        \n        // Добавляем низкочастотный гул ветра\n        sample += Math.sin(i / sampleRate * 2 * Math.PI * 0.5) * 0.05;\n        \n        data[i] = sample;\n      }\n    }\n\n    // Создаём источник\n    this.rainSource = this.ctx.createBufferSource();\n    this.rainSource.buffer = buffer;\n    this.rainSource.loop = true;\n\n    // Низкочастотный фильтр для реалистичного звука дождя\n    const lowpass = this.ctx.createBiquadFilter();\n    lowpass.type = 'lowpass';\n    lowpass.frequency.value = 3000;\n    lowpass.Q.value = 0.5;\n\n    // Highpass для убирания низкого гула\n    const highpass = this.ctx.createBiquadFilter();\n    highpass.type = 'highpass';\n    highpass.frequency.value = 200;\n    highpass.Q.value = 0.5;\n\n    this.rainSource.connect(highpass);\n    highpass.connect(lowpass);\n    lowpass.connect(this.rainGain);\n\n    this.rainSource.start();\n\n    // Плавное нарастание громкости\n    this.rainGain.gain.linearRampToValueAtTime(0.25, this.ctx.currentTime + 2);\n\n    // Запускаем периодические раскаты грома\n    this.startThunder();\n  }\n\n  /** Запуск звуков грома */\n  private startThunder(): void {\n    if (!this.ctx || !this.masterGain) return;\n\n    const playThunder = () => {\n      if (!this.ctx || !this.masterGain || !this.isRainPlaying) return;\n\n      const now = this.ctx.currentTime;\n\n      // Создаём gain для грома\n      const thunderGain = this.ctx.createGain();\n      thunderGain.gain.value = 0;\n      thunderGain.connect(this.masterGain);\n\n      // === НИЗКИЙ РАСКАТ ГРОМА ===\n      // Шум для грома\n      const noiseBuffer = this.ctx.createBuffer(1, this.ctx.sampleRate * 3, this.ctx.sampleRate);\n      const noiseData = noiseBuffer.getChannelData(0);\n      for (let i = 0; i < noiseData.length; i++) {\n        noiseData[i] = (Math.random() * 2 - 1) * Math.exp(-i / (this.ctx.sampleRate * 0.8));\n      }\n\n      const noiseSource = this.ctx.createBufferSource();\n      noiseSource.buffer = noiseBuffer;\n\n      // Низкочастотный фильтр для грома\n      const lowpass = this.ctx.createBiquadFilter();\n      lowpass.type = 'lowpass';\n      lowpass.frequency.value = 150 + Math.random() * 100;\n      lowpass.Q.value = 1;\n\n      noiseSource.connect(lowpass);\n      lowpass.connect(thunderGain);\n\n      // === ТРЕСК МОЛНИИ ===\n      const crackOsc = this.ctx.createOscillator();\n      crackOsc.type = 'sawtooth';\n      crackOsc.frequency.value = 80 + Math.random() * 40;\n\n      const crackGain = this.ctx.createGain();\n      crackGain.gain.value = 0;\n\n      const crackFilter = this.ctx.createBiquadFilter();\n      crackFilter.type = 'bandpass';\n      crackFilter.frequency.value = 2000;\n      crackFilter.Q.value = 2;\n\n      crackOsc.connect(crackFilter);\n      crackFilter.connect(crackGain);\n      crackGain.connect(thunderGain);\n\n      // Огибающая грома - нарастание и долгий спад\n      thunderGain.gain.setValueAtTime(0, now);\n      thunderGain.gain.linearRampToValueAtTime(0.6, now + 0.1);\n      thunderGain.gain.exponentialRampToValueAtTime(0.01, now + 2.5);\n\n      // Огибающая треска - короткий резкий\n      crackGain.gain.setValueAtTime(0, now);\n      crackGain.gain.linearRampToValueAtTime(0.4, now + 0.02);\n      crackGain.gain.exponentialRampToValueAtTime(0.01, now + 0.2);\n\n      noiseSource.start(now);\n      crackOsc.start(now);\n      noiseSource.stop(now + 3);\n      crackOsc.stop(now + 0.3);\n    };\n\n    // Первый гром через 2-4 секунды\n    setTimeout(playThunder, 2000 + Math.random() * 2000);\n\n    // Периодические раскаты каждые 3-6 секунд\n    this.thunderInterval = setInterval(() => {\n      if (this.isRainPlaying) {\n        playThunder();\n      }\n    }, 3000 + Math.random() * 3000) as unknown as number;\n  }\n\n  /** Остановка звука дождя */\n  private stopRain(): void {\n    if (!this.ctx || !this.isRainPlaying) return;\n\n    this.isRainPlaying = false;\n\n    // Останавливаем грозу\n    if (this.thunderInterval) {\n      clearInterval(this.thunderInterval);\n      this.thunderInterval = null;\n    }\n\n    // Плавное затухание\n    if (this.rainGain) {\n      this.rainGain.gain.linearRampToValueAtTime(0, this.ctx.currentTime + 1);\n    }\n\n    // Останавливаем источник через секунду\n    setTimeout(() => {\n      if (this.rainSource) {\n        try {\n          this.rainSource.stop();\n        } catch (e) {\n          // Уже остановлен\n        }\n        this.rainSource = null;\n      }\n      this.rainGain = null;\n    }, 1100);\n  }\n\n  /** Запустить synthwave музыку */\n  private startSynthwaveMusic(): void {\n    if (!this.ctx || !this.musicGain) return;\n\n    switch (this.currentEra) {\n      case 1:\n        this.playEra1Music(); // Кислотная\n        break;\n      case 2:\n        this.playEra2Music(); // Чёрная дыра\n        break;\n      case 3:\n        this.playEra3Music(); // Космическая\n        break;\n    }\n  }\n\n  /** ЭПОХА 1: Кислотная (волны 1-5) */\n  private playEra1Music(): void {\n    if (!this.ctx || !this.musicGain) return;\n\n    // Агрессивный acid бас\n    const bassNotes = [55, 55, 73.4, 55, 82.4, 55, 73.4, 65.4];\n    let noteIndex = 0;\n\n    const playBass = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'normal' || this.currentEra !== 1) return;\n\n      const now = this.ctx.currentTime;\n      const osc = this.ctx.createOscillator();\n      const filter = this.ctx.createBiquadFilter();\n      const gain = this.ctx.createGain();\n\n      osc.type = 'sawtooth';\n      osc.frequency.value = bassNotes[noteIndex];\n\n      filter.type = 'lowpass';\n      filter.frequency.setValueAtTime(300, now);\n      filter.frequency.exponentialRampToValueAtTime(800, now + 0.05);\n      filter.frequency.exponentialRampToValueAtTime(200, now + 0.2);\n      filter.Q.value = 10;\n\n      gain.gain.setValueAtTime(0.15, now);\n      gain.gain.exponentialRampToValueAtTime(0.01, now + 0.25);\n\n      osc.connect(filter);\n      filter.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 0.3);\n\n      noteIndex = (noteIndex + 1) % bassNotes.length;\n    };\n\n    this.musicIntervals.push(setInterval(playBass, 250) as unknown as number);\n\n    // Кислотное арпеджио\n    const arpNotes = [220, 277, 330, 440, 330, 277];\n    let arpIndex = 0;\n\n    const playArp = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'normal' || this.currentEra !== 1) return;\n\n      const now = this.ctx.currentTime;\n      const osc = this.ctx.createOscillator();\n      const gain = this.ctx.createGain();\n\n      osc.type = 'square';\n      osc.frequency.value = arpNotes[arpIndex];\n\n      gain.gain.setValueAtTime(0.06, now);\n      gain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);\n\n      osc.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 0.12);\n\n      arpIndex = (arpIndex + 1) % arpNotes.length;\n    };\n\n    this.musicIntervals.push(setInterval(playArp, 125) as unknown as number);\n\n    // Кик\n    const playKick = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'normal' || this.currentEra !== 1) return;\n\n      const now = this.ctx.currentTime;\n      const osc = this.ctx.createOscillator();\n      const gain = this.ctx.createGain();\n\n      osc.type = 'sine';\n      osc.frequency.setValueAtTime(150, now);\n      osc.frequency.exponentialRampToValueAtTime(40, now + 0.1);\n\n      gain.gain.setValueAtTime(0.25, now);\n      gain.gain.exponentialRampToValueAtTime(0.01, now + 0.15);\n\n      osc.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 0.15);\n    };\n\n    this.musicIntervals.push(setInterval(playKick, 500) as unknown as number);\n  }\n\n  /** ЭПОХА 2: Чёрная дыра (волны 6-10) */\n  private playEra2Music(): void {\n    if (!this.ctx || !this.musicGain) return;\n\n    // Глубокий мрачный дрон\n    const playDrone = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'normal' || this.currentEra !== 2) return;\n\n      const now = this.ctx.currentTime;\n      const osc = this.ctx.createOscillator();\n      const osc2 = this.ctx.createOscillator();\n      const lfo = this.ctx.createOscillator();\n      const lfoGain = this.ctx.createGain();\n      const gain = this.ctx.createGain();\n      const filter = this.ctx.createBiquadFilter();\n\n      osc.type = 'sawtooth';\n      osc.frequency.value = 41; // E1 - очень низкий\n\n      osc2.type = 'triangle';\n      osc2.frequency.value = 41.2; // Биения\n\n      lfo.type = 'sine';\n      lfo.frequency.value = 0.1;\n      lfoGain.gain.value = 20;\n\n      lfo.connect(lfoGain);\n      lfoGain.connect(osc.frequency);\n\n      filter.type = 'lowpass';\n      filter.frequency.value = 150;\n\n      gain.gain.setValueAtTime(0.12, now);\n      gain.gain.linearRampToValueAtTime(0.08, now + 3);\n      gain.gain.exponentialRampToValueAtTime(0.01, now + 4);\n\n      osc.connect(filter);\n      osc2.connect(filter);\n      filter.connect(gain);\n      gain.connect(this.musicGain!);\n\n      lfo.start(now);\n      osc.start(now);\n      osc2.start(now);\n      lfo.stop(now + 4);\n      osc.stop(now + 4);\n      osc2.stop(now + 4);\n    };\n\n    playDrone();\n    this.musicIntervals.push(setInterval(playDrone, 4000) as unknown as number);\n\n    // Медленный тяжёлый бит\n    let beat = 0;\n    const playBeat = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'normal' || this.currentEra !== 2) return;\n\n      const now = this.ctx.currentTime;\n\n      if (beat % 2 === 0) {\n        // Глухой удар\n        const osc = this.ctx.createOscillator();\n        const gain = this.ctx.createGain();\n\n        osc.type = 'sine';\n        osc.frequency.setValueAtTime(80, now);\n        osc.frequency.exponentialRampToValueAtTime(20, now + 0.3);\n\n        gain.gain.setValueAtTime(0.3, now);\n        gain.gain.exponentialRampToValueAtTime(0.01, now + 0.4);\n\n        osc.connect(gain);\n        gain.connect(this.musicGain!);\n\n        osc.start(now);\n        osc.stop(now + 0.4);\n      }\n\n      beat++;\n    };\n\n    this.musicIntervals.push(setInterval(playBeat, 600) as unknown as number);\n\n    // Жуткие высокие тона\n    const playEerie = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'normal' || this.currentEra !== 2) return;\n\n      const now = this.ctx.currentTime;\n      const freq = 600 + Math.random() * 400;\n\n      const osc = this.ctx.createOscillator();\n      const gain = this.ctx.createGain();\n\n      osc.type = 'sine';\n      osc.frequency.setValueAtTime(freq, now);\n      osc.frequency.linearRampToValueAtTime(freq * 0.7, now + 2);\n\n      gain.gain.setValueAtTime(0, now);\n      gain.gain.linearRampToValueAtTime(0.04, now + 0.5);\n      gain.gain.linearRampToValueAtTime(0, now + 2);\n\n      osc.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 2);\n    };\n\n    this.musicIntervals.push(setInterval(playEerie, 3000 + Math.random() * 2000) as unknown as number);\n\n    // Гравитационный шум\n    const playGravity = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'normal' || this.currentEra !== 2) return;\n\n      const now = this.ctx.currentTime;\n\n      const bufferSize = this.ctx.sampleRate * 0.5;\n      const buffer = this.ctx.createBuffer(1, bufferSize, this.ctx.sampleRate);\n      const data = buffer.getChannelData(0);\n      \n      for (let i = 0; i < bufferSize; i++) {\n        data[i] = (Math.random() * 2 - 1) * Math.exp(-i / (bufferSize * 0.5));\n      }\n\n      const noise = this.ctx.createBufferSource();\n      noise.buffer = buffer;\n\n      const filter = this.ctx.createBiquadFilter();\n      filter.type = 'lowpass';\n      filter.frequency.value = 200;\n\n      const gain = this.ctx.createGain();\n      gain.gain.setValueAtTime(0.08, now);\n      gain.gain.exponentialRampToValueAtTime(0.01, now + 0.5);\n\n      noise.connect(filter);\n      filter.connect(gain);\n      gain.connect(this.musicGain!);\n\n      noise.start(now);\n      noise.stop(now + 0.5);\n    };\n\n    this.musicIntervals.push(setInterval(playGravity, 1500) as unknown as number);\n  }\n\n  /** ЭПОХА 3: Космическая технологическая (волны 11-15) */\n  private playEra3Music(): void {\n    if (!this.ctx || !this.musicGain) return;\n\n    // Быстрый синтвейв бас\n    const bassNotes = [110, 110, 146.8, 110, 130.8, 110, 164.8, 146.8];\n    let noteIndex = 0;\n\n    const playBass = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'normal' || this.currentEra !== 3) return;\n\n      const now = this.ctx.currentTime;\n      const osc = this.ctx.createOscillator();\n      const filter = this.ctx.createBiquadFilter();\n      const gain = this.ctx.createGain();\n\n      osc.type = 'sawtooth';\n      osc.frequency.value = bassNotes[noteIndex];\n\n      filter.type = 'lowpass';\n      filter.frequency.setValueAtTime(400, now);\n      filter.frequency.exponentialRampToValueAtTime(150, now + 0.15);\n\n      gain.gain.setValueAtTime(0.12, now);\n      gain.gain.exponentialRampToValueAtTime(0.01, now + 0.2);\n\n      osc.connect(filter);\n      filter.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 0.22);\n\n      noteIndex = (noteIndex + 1) % bassNotes.length;\n    };\n\n    this.musicIntervals.push(setInterval(playBass, 200) as unknown as number);\n\n    // Космическое арпеджио (высокое)\n    const arpNotes = [880, 1046, 1318, 1760, 1318, 1046, 880, 659];\n    let arpIndex = 0;\n\n    const playArp = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'normal' || this.currentEra !== 3) return;\n\n      const now = this.ctx.currentTime;\n      const osc = this.ctx.createOscillator();\n      const gain = this.ctx.createGain();\n      const delay = this.ctx.createDelay();\n      const delayGain = this.ctx.createGain();\n\n      osc.type = 'triangle';\n      osc.frequency.value = arpNotes[arpIndex];\n\n      delay.delayTime.value = 0.15;\n      delayGain.gain.value = 0.3;\n\n      gain.gain.setValueAtTime(0.05, now);\n      gain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);\n\n      osc.connect(gain);\n      osc.connect(delay);\n      delay.connect(delayGain);\n      delayGain.connect(this.musicGain!);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 0.12);\n\n      arpIndex = (arpIndex + 1) % arpNotes.length;\n    };\n\n    this.musicIntervals.push(setInterval(playArp, 100) as unknown as number);\n\n    // Техно кик\n    const playKick = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'normal' || this.currentEra !== 3) return;\n\n      const now = this.ctx.currentTime;\n      const osc = this.ctx.createOscillator();\n      const gain = this.ctx.createGain();\n\n      osc.type = 'sine';\n      osc.frequency.setValueAtTime(200, now);\n      osc.frequency.exponentialRampToValueAtTime(50, now + 0.08);\n\n      gain.gain.setValueAtTime(0.2, now);\n      gain.gain.exponentialRampToValueAtTime(0.01, now + 0.12);\n\n      osc.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 0.12);\n    };\n\n    this.musicIntervals.push(setInterval(playKick, 400) as unknown as number);\n\n    // Космический пэд\n    const playPad = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'normal' || this.currentEra !== 3) return;\n\n      const now = this.ctx.currentTime;\n      const chord = [220, 277, 330, 440]; // Am7\n\n      for (const freq of chord) {\n        const osc = this.ctx.createOscillator();\n        const gain = this.ctx.createGain();\n\n        osc.type = 'sine';\n        osc.frequency.value = freq;\n\n        gain.gain.setValueAtTime(0, now);\n        gain.gain.linearRampToValueAtTime(0.03, now + 0.5);\n        gain.gain.linearRampToValueAtTime(0.02, now + 2);\n        gain.gain.linearRampToValueAtTime(0, now + 3);\n\n        osc.connect(gain);\n        gain.connect(this.musicGain!);\n\n        osc.start(now);\n        osc.stop(now + 3.5);\n      }\n    };\n\n    playPad();\n    this.musicIntervals.push(setInterval(playPad, 4000) as unknown as number);\n\n    // Электрические разряды\n    const playZap = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'normal' || this.currentEra !== 3) return;\n\n      const now = this.ctx.currentTime;\n\n      const osc = this.ctx.createOscillator();\n      const gain = this.ctx.createGain();\n\n      osc.type = 'sawtooth';\n      osc.frequency.setValueAtTime(1500 + Math.random() * 1000, now);\n      osc.frequency.exponentialRampToValueAtTime(100, now + 0.1);\n\n      gain.gain.setValueAtTime(0.06, now);\n      gain.gain.exponentialRampToValueAtTime(0.001, now + 0.1);\n\n      osc.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 0.1);\n    };\n\n    this.musicIntervals.push(setInterval(playZap, 800 + Math.random() * 600) as unknown as number);\n  }\n\n  /** Включить/выключить режим низкого HP */\n  public setLowHpMode(enabled: boolean): void {\n    if (!this.ctx || !this.musicGain) return;\n    \n    // Не переключаем если сейчас босс\n    if (this.currentMusicMode !== 'normal' && this.currentMusicMode !== 'low_hp') return;\n    \n    if (enabled && !this.isLowHpMode) {\n      // Включаем тревожный режим\n      this.isLowHpMode = true;\n      this.currentMusicMode = 'low_hp';\n      \n      // Останавливаем обычную музыку\n      for (const interval of this.musicIntervals) {\n        clearInterval(interval);\n        clearTimeout(interval);\n      }\n      this.musicIntervals = [];\n      \n      this.playLowHpMusic();\n      \n    } else if (!enabled && this.isLowHpMode) {\n      // Выключаем тревожный режим\n      this.isLowHpMode = false;\n      this.currentMusicMode = 'normal';\n      \n      // Останавливаем тревожную музыку\n      for (const interval of this.musicIntervals) {\n        clearInterval(interval);\n        clearTimeout(interval);\n      }\n      this.musicIntervals = [];\n      \n      this.startSynthwaveMusic();\n    }\n  }\n\n  /** Тревожная музыка при низком HP */\n  private playLowHpMusic(): void {\n    if (!this.ctx || !this.musicGain) return;\n\n    // === ТРЕВОЖНЫЙ ПУЛЬС ===\n    const playHeartbeat = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'low_hp') return;\n\n      const now = this.ctx.currentTime;\n\n      // Двойной удар сердца\n      for (let i = 0; i < 2; i++) {\n        const osc = this.ctx.createOscillator();\n        const gain = this.ctx.createGain();\n\n        osc.type = 'sine';\n        osc.frequency.value = 40;\n\n        const offset = i * 0.15;\n        gain.gain.setValueAtTime(0, now + offset);\n        gain.gain.linearRampToValueAtTime(0.3, now + offset + 0.05);\n        gain.gain.exponentialRampToValueAtTime(0.01, now + offset + 0.2);\n\n        osc.connect(gain);\n        gain.connect(this.musicGain!);\n\n        osc.start(now + offset);\n        osc.stop(now + offset + 0.25);\n      }\n    };\n\n    this.musicIntervals.push(setInterval(playHeartbeat, 800) as unknown as number);\n\n    // === ТРЕВОЖНЫЙ ДРОН ===\n    const playDrone = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'low_hp') return;\n\n      const now = this.ctx.currentTime;\n\n      const osc = this.ctx.createOscillator();\n      const osc2 = this.ctx.createOscillator();\n      const gain = this.ctx.createGain();\n      const filter = this.ctx.createBiquadFilter();\n\n      // Низкий тревожный тон\n      osc.type = 'sawtooth';\n      osc.frequency.value = 55;\n\n      osc2.type = 'sawtooth';\n      osc2.frequency.value = 55.5; // Биения для тревожности\n\n      filter.type = 'lowpass';\n      filter.frequency.value = 200;\n      filter.Q.value = 5;\n\n      gain.gain.setValueAtTime(0.1, now);\n      gain.gain.linearRampToValueAtTime(0.15, now + 1);\n      gain.gain.linearRampToValueAtTime(0.05, now + 2);\n\n      osc.connect(filter);\n      osc2.connect(filter);\n      filter.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 2.5);\n      osc2.start(now);\n      osc2.stop(now + 2.5);\n    };\n\n    playDrone();\n    this.musicIntervals.push(setInterval(playDrone, 2500) as unknown as number);\n\n    // === ИСКРЫ ===\n    const playSpark = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'low_hp') return;\n\n      const now = this.ctx.currentTime;\n\n      // Случайные искры\n      const sparkCount = 1 + Math.floor(Math.random() * 3);\n      for (let i = 0; i < sparkCount; i++) {\n        const bufferSize = Math.floor(this.ctx.sampleRate * (0.02 + Math.random() * 0.03));\n        const buffer = this.ctx.createBuffer(1, bufferSize, this.ctx.sampleRate);\n        const data = buffer.getChannelData(0);\n        \n        for (let j = 0; j < bufferSize; j++) {\n          data[j] = (Math.random() * 2 - 1) * Math.exp(-j / (bufferSize * 0.3));\n        }\n\n        const noise = this.ctx.createBufferSource();\n        noise.buffer = buffer;\n\n        const filter = this.ctx.createBiquadFilter();\n        filter.type = 'highpass';\n        filter.frequency.value = 3000 + Math.random() * 5000;\n\n        const gain = this.ctx.createGain();\n        gain.gain.setValueAtTime(0.05 + Math.random() * 0.05, now + i * 0.05);\n        gain.gain.exponentialRampToValueAtTime(0.001, now + i * 0.05 + 0.05);\n\n        noise.connect(filter);\n        filter.connect(gain);\n        gain.connect(this.musicGain!);\n\n        noise.start(now + i * 0.05);\n        noise.stop(now + i * 0.05 + 0.05);\n      }\n    };\n\n    this.musicIntervals.push(setInterval(playSpark, 500 + Math.random() * 500) as unknown as number);\n\n    // === ТРЕВОЖНЫЕ НОТЫ ===\n    const playWarning = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'low_hp') return;\n\n      const now = this.ctx.currentTime;\n\n      const osc = this.ctx.createOscillator();\n      const gain = this.ctx.createGain();\n\n      osc.type = 'square';\n      // Тревожная секунда (минорный интервал)\n      const notes = [220, 233.1]; // A3, Bb3\n      const note = notes[Math.floor(Math.random() * notes.length)];\n      osc.frequency.value = note;\n\n      gain.gain.setValueAtTime(0, now);\n      gain.gain.linearRampToValueAtTime(0.08, now + 0.1);\n      gain.gain.linearRampToValueAtTime(0.06, now + 0.3);\n      gain.gain.exponentialRampToValueAtTime(0.01, now + 0.5);\n\n      osc.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 0.5);\n    };\n\n    this.musicIntervals.push(setInterval(playWarning, 1500 + Math.random() * 1000) as unknown as number);\n\n    // === СТАТИЧЕСКИЕ ПОМЕХИ ===\n    const playStatic = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'low_hp') return;\n\n      const now = this.ctx.currentTime;\n\n      const bufferSize = this.ctx.sampleRate * 0.1;\n      const buffer = this.ctx.createBuffer(1, bufferSize, this.ctx.sampleRate);\n      const data = buffer.getChannelData(0);\n      \n      for (let i = 0; i < bufferSize; i++) {\n        // Прерывистый шум\n        data[i] = Math.random() > 0.7 ? (Math.random() * 2 - 1) * 0.5 : 0;\n      }\n\n      const noise = this.ctx.createBufferSource();\n      noise.buffer = buffer;\n\n      const filter = this.ctx.createBiquadFilter();\n      filter.type = 'bandpass';\n      filter.frequency.value = 2000;\n      filter.Q.value = 3;\n\n      const gain = this.ctx.createGain();\n      gain.gain.setValueAtTime(0.03, now);\n      gain.gain.exponentialRampToValueAtTime(0.001, now + 0.1);\n\n      noise.connect(filter);\n      filter.connect(gain);\n      gain.connect(this.musicGain!);\n\n      noise.start(now);\n      noise.stop(now + 0.1);\n    };\n\n    this.musicIntervals.push(setInterval(playStatic, 300 + Math.random() * 400) as unknown as number);\n  }\n\n  /** Фаза Зелёного Босса */\n  private bossGreenPhase = 1;\n\n  /** Переключить музыку для босса */\n  public setBossMusic(bossType: 'boss_green' | 'boss_black' | 'boss_blue' | null): void {\n    if (!this.ctx || !this.musicGain) return;\n\n    // Останавливаем все текущие интервалы\n    for (const interval of this.musicIntervals) {\n      clearInterval(interval);\n      clearTimeout(interval);\n    }\n    this.musicIntervals = [];\n    this.bossGreenPhase = 1; // Сброс фазы\n\n    if (bossType === null) {\n      // Обычная музыка\n      this.currentMusicMode = 'normal';\n      this.startSynthwaveMusic();\n    } else {\n      this.currentMusicMode = bossType;\n      \n      switch (bossType) {\n        case 'boss_green':\n          this.playBossGreenMusic();\n          break;\n        case 'boss_black':\n          this.playBossBlackMusic();\n          break;\n        case 'boss_blue':\n          this.playBossBlueMusic();\n          break;\n      }\n    }\n  }\n\n  /** Переход в фазу 2 для Зелёного Босса - добавляем БОЧКУ! */\n  public setBossGreenPhase2(): void {\n    if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'boss_green') return;\n    if (this.bossGreenPhase === 2) return; // Уже во второй фазе\n\n    this.bossGreenPhase = 2;\n\n    // === ТЯЖЁЛАЯ БОЧКА (808 стиль) ===\n    const playHeavyKick = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'boss_green') return;\n\n      const now = this.ctx.currentTime;\n\n      // Основной кик\n      const osc = this.ctx.createOscillator();\n      const osc2 = this.ctx.createOscillator();\n      const gain = this.ctx.createGain();\n      const distortion = this.ctx.createWaveShaper();\n\n      osc.type = 'sine';\n      osc.frequency.setValueAtTime(200, now);\n      osc.frequency.exponentialRampToValueAtTime(30, now + 0.15);\n\n      osc2.type = 'sine';\n      osc2.frequency.setValueAtTime(100, now);\n      osc2.frequency.exponentialRampToValueAtTime(20, now + 0.2);\n\n      // Дисторшн для грязи\n      const curve = new Float32Array(256);\n      for (let i = 0; i < 256; i++) {\n        const x = (i / 128) - 1;\n        curve[i] = Math.tanh(x * 5);\n      }\n      distortion.curve = curve;\n\n      gain.gain.setValueAtTime(0.5, now);\n      gain.gain.exponentialRampToValueAtTime(0.01, now + 0.25);\n\n      osc.connect(distortion);\n      osc2.connect(distortion);\n      distortion.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 0.25);\n      osc2.start(now);\n      osc2.stop(now + 0.25);\n    };\n\n    // Тяжёлая бочка на каждую восьмую - агрессивнее!\n    this.musicIntervals.push(setInterval(playHeavyKick, 207) as unknown as number);\n\n    // === СИРЕНА ТРЕВОГИ ===\n    const playAlarm = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'boss_green') return;\n\n      const now = this.ctx.currentTime;\n\n      const osc = this.ctx.createOscillator();\n      const gain = this.ctx.createGain();\n\n      osc.type = 'square';\n      osc.frequency.setValueAtTime(600, now);\n      osc.frequency.linearRampToValueAtTime(800, now + 0.2);\n      osc.frequency.linearRampToValueAtTime(600, now + 0.4);\n\n      gain.gain.setValueAtTime(0.08, now);\n      gain.gain.linearRampToValueAtTime(0.12, now + 0.2);\n      gain.gain.linearRampToValueAtTime(0.0, now + 0.4);\n\n      osc.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 0.4);\n    };\n\n    // Сирена каждые 2 секунды\n    this.musicIntervals.push(setInterval(playAlarm, 2000) as unknown as number);\n  }\n\n  /** Звук вихря чёрного босса */\n  private vortexGain: GainNode | null = null;\n  private vortexOsc: OscillatorNode | null = null;\n  private vortexNoise: AudioBufferSourceNode | null = null;\n  \n  /** Флаг storm режима для музыки */\n  private isStormMode = false;\n  private stormGain: GainNode | null = null;\n\n  public playVortexSound(start: boolean): void {\n    if (!this.ctx || !this.masterGain) return;\n\n    if (start) {\n      // === ЗАПУСК ВИХРЯ ===\n      \n      // Создаём gain\n      this.vortexGain = this.ctx.createGain();\n      this.vortexGain.gain.value = 0;\n      this.vortexGain.connect(this.masterGain);\n\n      // Низкий гудящий осциллятор (ветер)\n      this.vortexOsc = this.ctx.createOscillator();\n      this.vortexOsc.type = 'sawtooth';\n      this.vortexOsc.frequency.value = 60;\n      \n      const oscGain = this.ctx.createGain();\n      oscGain.gain.value = 0.15;\n      \n      // LFO для модуляции частоты (эффект вращения)\n      const lfo = this.ctx.createOscillator();\n      lfo.type = 'sine';\n      lfo.frequency.value = 3; // 3 оборота в секунду\n      \n      const lfoGain = this.ctx.createGain();\n      lfoGain.gain.value = 30; // Модуляция ±30 Гц\n      \n      lfo.connect(lfoGain);\n      lfoGain.connect(this.vortexOsc.frequency);\n      \n      // Фильтр для глубокого звука\n      const lowpass = this.ctx.createBiquadFilter();\n      lowpass.type = 'lowpass';\n      lowpass.frequency.value = 200;\n      lowpass.Q.value = 5;\n      \n      this.vortexOsc.connect(lowpass);\n      lowpass.connect(oscGain);\n      oscGain.connect(this.vortexGain);\n      \n      // Шум ветра\n      const noiseBuffer = this.ctx.createBuffer(1, this.ctx.sampleRate * 4, this.ctx.sampleRate);\n      const noiseData = noiseBuffer.getChannelData(0);\n      for (let i = 0; i < noiseData.length; i++) {\n        noiseData[i] = (Math.random() * 2 - 1) * 0.5;\n      }\n      \n      this.vortexNoise = this.ctx.createBufferSource();\n      this.vortexNoise.buffer = noiseBuffer;\n      this.vortexNoise.loop = true;\n      \n      const noiseFilter = this.ctx.createBiquadFilter();\n      noiseFilter.type = 'bandpass';\n      noiseFilter.frequency.value = 400;\n      noiseFilter.Q.value = 2;\n      \n      const noiseGain = this.ctx.createGain();\n      noiseGain.gain.value = 0.3;\n      \n      this.vortexNoise.connect(noiseFilter);\n      noiseFilter.connect(noiseGain);\n      noiseGain.connect(this.vortexGain);\n      \n      // Запускаем всё\n      this.vortexOsc.start();\n      lfo.start();\n      this.vortexNoise.start();\n      \n      // Плавное нарастание\n      this.vortexGain.gain.linearRampToValueAtTime(0.5, this.ctx.currentTime + 0.5);\n      \n      // Активируем storm режим музыки\n      this.activateStormMode();\n      \n    } else {\n      // === ОСТАНОВКА ВИХРЯ ===\n      if (this.vortexGain) {\n        this.vortexGain.gain.linearRampToValueAtTime(0, this.ctx.currentTime + 0.5);\n      }\n      \n      // Деактивируем storm режим\n      this.deactivateStormMode();\n      \n      setTimeout(() => {\n        if (this.vortexOsc) {\n          try { this.vortexOsc.stop(); } catch (e) {}\n          this.vortexOsc = null;\n        }\n        if (this.vortexNoise) {\n          try { this.vortexNoise.stop(); } catch (e) {}\n          this.vortexNoise = null;\n        }\n        this.vortexGain = null;\n      }, 600);\n    }\n  }\n\n  /** Активация storm режима музыки */\n  private activateStormMode(): void {\n    if (!this.ctx || !this.musicGain || this.isStormMode) return;\n    this.isStormMode = true;\n\n    // Создаём gain для storm элементов\n    this.stormGain = this.ctx.createGain();\n    this.stormGain.gain.value = 0;\n    this.stormGain.connect(this.musicGain);\n    this.stormGain.gain.linearRampToValueAtTime(1, this.ctx.currentTime + 0.5);\n\n    // === STORM: ИНТЕНСИВНЫЙ РЕЙЗЕР ===\n    const playRiser = () => {\n      if (!this.ctx || !this.stormGain || !this.isStormMode) return;\n\n      const now = this.ctx.currentTime;\n      const osc = this.ctx.createOscillator();\n      const filter = this.ctx.createBiquadFilter();\n      const gain = this.ctx.createGain();\n\n      osc.type = 'sawtooth';\n      osc.frequency.setValueAtTime(100, now);\n      osc.frequency.exponentialRampToValueAtTime(800, now + 2);\n\n      filter.type = 'lowpass';\n      filter.frequency.setValueAtTime(200, now);\n      filter.frequency.exponentialRampToValueAtTime(4000, now + 2);\n      filter.Q.value = 8;\n\n      gain.gain.setValueAtTime(0, now);\n      gain.gain.linearRampToValueAtTime(0.15, now + 1);\n      gain.gain.linearRampToValueAtTime(0, now + 2);\n\n      osc.connect(filter);\n      filter.connect(gain);\n      gain.connect(this.stormGain!);\n\n      osc.start(now);\n      osc.stop(now + 2.1);\n    };\n\n    // Рейзер каждые 2 секунды\n    this.musicIntervals.push(setInterval(playRiser, 2000) as unknown as number);\n    playRiser();\n\n    // === STORM: ТЯЖЁЛЫЙ SUB DROP ===\n    const playSubDrop = () => {\n      if (!this.ctx || !this.stormGain || !this.isStormMode) return;\n\n      const now = this.ctx.currentTime;\n      const osc = this.ctx.createOscillator();\n      const gain = this.ctx.createGain();\n\n      osc.type = 'sine';\n      osc.frequency.setValueAtTime(80, now);\n      osc.frequency.exponentialRampToValueAtTime(25, now + 0.5);\n\n      gain.gain.setValueAtTime(0.4, now);\n      gain.gain.exponentialRampToValueAtTime(0.01, now + 0.6);\n\n      osc.connect(gain);\n      gain.connect(this.stormGain!);\n\n      osc.start(now);\n      osc.stop(now + 0.7);\n    };\n\n    // Sub drop каждые 500ms\n    this.musicIntervals.push(setInterval(playSubDrop, 500) as unknown as number);\n\n    // === STORM: ШУМОВОЙ SWEEP ===\n    const playNoiseSweep = () => {\n      if (!this.ctx || !this.stormGain || !this.isStormMode) return;\n\n      const now = this.ctx.currentTime;\n      const bufferSize = this.ctx.sampleRate * 1;\n      const buffer = this.ctx.createBuffer(1, bufferSize, this.ctx.sampleRate);\n      const data = buffer.getChannelData(0);\n      for (let i = 0; i < bufferSize; i++) {\n        data[i] = Math.random() * 2 - 1;\n      }\n\n      const noise = this.ctx.createBufferSource();\n      noise.buffer = buffer;\n\n      const filter = this.ctx.createBiquadFilter();\n      filter.type = 'bandpass';\n      filter.frequency.setValueAtTime(500, now);\n      filter.frequency.exponentialRampToValueAtTime(8000, now + 0.5);\n      filter.frequency.exponentialRampToValueAtTime(500, now + 1);\n      filter.Q.value = 5;\n\n      const gain = this.ctx.createGain();\n      gain.gain.setValueAtTime(0, now);\n      gain.gain.linearRampToValueAtTime(0.1, now + 0.25);\n      gain.gain.linearRampToValueAtTime(0.1, now + 0.75);\n      gain.gain.linearRampToValueAtTime(0, now + 1);\n\n      noise.connect(filter);\n      filter.connect(gain);\n      gain.connect(this.stormGain!);\n\n      noise.start(now);\n      noise.stop(now + 1.1);\n    };\n\n    this.musicIntervals.push(setInterval(playNoiseSweep, 1000) as unknown as number);\n    playNoiseSweep();\n\n    // === STORM: БЫСТРЫЕ ХАЙХЭТЫ ===\n    const playFastHihat = () => {\n      if (!this.ctx || !this.stormGain || !this.isStormMode) return;\n\n      const now = this.ctx.currentTime;\n      const bufferSize = this.ctx.sampleRate * 0.02;\n      const buffer = this.ctx.createBuffer(1, bufferSize, this.ctx.sampleRate);\n      const data = buffer.getChannelData(0);\n      for (let i = 0; i < bufferSize; i++) {\n        data[i] = Math.random() * 2 - 1;\n      }\n\n      const noise = this.ctx.createBufferSource();\n      noise.buffer = buffer;\n\n      const filter = this.ctx.createBiquadFilter();\n      filter.type = 'highpass';\n      filter.frequency.value = 10000;\n\n      const gain = this.ctx.createGain();\n      gain.gain.setValueAtTime(0.12, now);\n      gain.gain.exponentialRampToValueAtTime(0.001, now + 0.02);\n\n      noise.connect(filter);\n      filter.connect(gain);\n      gain.connect(this.stormGain!);\n\n      noise.start(now);\n      noise.stop(now + 0.03);\n    };\n\n    // 16th notes (очень быстро)\n    this.musicIntervals.push(setInterval(playFastHihat, 119) as unknown as number);\n  }\n\n  /** Деактивация storm режима */\n  private deactivateStormMode(): void {\n    if (!this.isStormMode) return;\n    this.isStormMode = false;\n\n    if (this.stormGain && this.ctx) {\n      this.stormGain.gain.linearRampToValueAtTime(0, this.ctx.currentTime + 1);\n    }\n\n    setTimeout(() => {\n      this.stormGain = null;\n    }, 1100);\n  }\n\n  /** Музыка Зелёного Босса - ЖЁСТКОЕ ACID TECHNO */\n  private playBossGreenMusic(): void {\n    if (!this.ctx || !this.musicGain) return;\n\n    // === АГРЕССИВНЫЙ 303 ACID ===\n    const acidPattern = [55, 55, 110, 55, 82.4, 110, 73.4, 55]; // Более агрессивный паттерн\n    const slidePattern = [0, 0, 1, 0, 1, 1, 0, 1]; // Глайды\n    let step = 0;\n    let acidFilter: BiquadFilterNode | null = null;\n\n    const playAcidBass = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'boss_green') return;\n      const now = this.ctx.currentTime;\n\n      const osc = this.ctx.createOscillator();\n      const osc2 = this.ctx.createOscillator();\n      const filter = this.ctx.createBiquadFilter();\n      const gain = this.ctx.createGain();\n\n      // Два осциллятора для жирности\n      osc.type = 'sawtooth';\n      osc2.type = 'square';\n      const freq = acidPattern[step];\n      osc.frequency.value = freq;\n      osc2.frequency.value = freq * 1.01; // Лёгкая расстройка\n\n      // ОЧЕНЬ резонансный фильтр - главная фишка ACID!\n      filter.type = 'lowpass';\n      filter.Q.value = 22; // МАКСИМАЛЬНЫЙ резонанс!\n      \n      // Агрессивная модуляция фильтра\n      const isSlide = slidePattern[step] === 1;\n      const filterStart = 150 + Math.random() * 100;\n      const filterPeak = 1200 + Math.random() * 800;\n      \n      filter.frequency.setValueAtTime(filterStart, now);\n      filter.frequency.exponentialRampToValueAtTime(filterPeak, now + 0.03);\n      filter.frequency.exponentialRampToValueAtTime(isSlide ? filterPeak * 0.7 : 200, now + 0.1);\n\n      // Акцент\n      const accent = step % 4 === 0 ? 0.35 : 0.2;\n      gain.gain.setValueAtTime(accent, now);\n      gain.gain.exponentialRampToValueAtTime(0.01, now + 0.12);\n\n      osc.connect(filter);\n      osc2.connect(filter);\n      filter.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc2.start(now);\n      osc.stop(now + 0.15);\n      osc2.stop(now + 0.15);\n\n      step = (step + 1) % acidPattern.length;\n      acidFilter = filter;\n    };\n\n    // 150 BPM 16-е ноты\n    this.musicIntervals.push(setInterval(playAcidBass, 100) as unknown as number);\n\n    // === ЖЁСТКИЙ КИК ===\n    const playKick = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'boss_green') return;\n      const now = this.ctx.currentTime;\n\n      const osc = this.ctx.createOscillator();\n      const click = this.ctx.createOscillator();\n      const gain = this.ctx.createGain();\n      const clickGain = this.ctx.createGain();\n\n      // Основа кика\n      osc.type = 'sine';\n      osc.frequency.setValueAtTime(180, now);\n      osc.frequency.exponentialRampToValueAtTime(35, now + 0.08);\n\n      // Клик атаки\n      click.type = 'triangle';\n      click.frequency.value = 1500;\n\n      gain.gain.setValueAtTime(0.5, now);\n      gain.gain.exponentialRampToValueAtTime(0.01, now + 0.25);\n\n      clickGain.gain.setValueAtTime(0.15, now);\n      clickGain.gain.exponentialRampToValueAtTime(0.001, now + 0.02);\n\n      osc.connect(gain);\n      click.connect(clickGain);\n      gain.connect(this.musicGain!);\n      clickGain.connect(this.musicGain!);\n\n      osc.start(now);\n      click.start(now);\n      osc.stop(now + 0.3);\n      click.stop(now + 0.03);\n    };\n\n    this.musicIntervals.push(setInterval(playKick, 400) as unknown as number);\n\n    // === ХАЙХЭТ ===\n    let hihatStep = 0;\n    const playHihat = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'boss_green') return;\n      const now = this.ctx.currentTime;\n\n      const noise = this.createNoise(0.04);\n      const filter = this.ctx.createBiquadFilter();\n      const gain = this.ctx.createGain();\n\n      filter.type = 'highpass';\n      filter.frequency.value = 9000;\n\n      // Акцент на оффбит\n      const isOffbeat = hihatStep % 2 === 1;\n      gain.gain.setValueAtTime(isOffbeat ? 0.12 : 0.06, now);\n      gain.gain.exponentialRampToValueAtTime(0.001, now + 0.04);\n\n      noise.connect(filter);\n      filter.connect(gain);\n      gain.connect(this.musicGain!);\n\n      hihatStep++;\n    };\n\n    // Хайхэт на каждую восьмую\n    this.musicIntervals.push(setInterval(playHihat, 207) as unknown as number);\n\n    // === КИСЛОТНЫЙ СКРИМ (acid scream) ===\n    const playAcidScream = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'boss_green') return;\n\n      const now = this.ctx.currentTime;\n\n      const osc = this.ctx.createOscillator();\n      const filter = this.ctx.createBiquadFilter();\n      const gain = this.ctx.createGain();\n\n      osc.type = 'sawtooth';\n      osc.frequency.setValueAtTime(200 + Math.random() * 100, now);\n      osc.frequency.exponentialRampToValueAtTime(800 + Math.random() * 400, now + 0.3);\n\n      filter.type = 'bandpass';\n      filter.frequency.setValueAtTime(500, now);\n      filter.frequency.exponentialRampToValueAtTime(3000, now + 0.3);\n      filter.Q.value = 10;\n\n      gain.gain.setValueAtTime(0.1, now);\n      gain.gain.linearRampToValueAtTime(0.15, now + 0.15);\n      gain.gain.exponentialRampToValueAtTime(0.01, now + 0.4);\n\n      osc.connect(filter);\n      filter.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 0.4);\n    };\n\n    // Скрим каждые 2 такта\n    this.musicIntervals.push(setInterval(playAcidScream, 1656) as unknown as number);\n  }\n\n  /** Музыка Чёрного Босса - DUB TECHNO с жёсткой бочкой */\n  private playBossBlackMusic(): void {\n    if (!this.ctx || !this.musicGain) return;\n\n    // === ЖЁСТКАЯ БОЧКА (130 BPM - агрессивный темп для босс-файта) ===\n    const playKick = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'boss_black') return;\n\n      const now = this.ctx.currentTime;\n\n      // Жёсткий индустриальный кик\n      const osc = this.ctx.createOscillator();\n      const osc2 = this.ctx.createOscillator();\n      const distortion = this.ctx.createWaveShaper();\n      const gain = this.ctx.createGain();\n\n      // Агрессивный pitch envelope\n      osc.type = 'sine';\n      osc.frequency.setValueAtTime(200, now);\n      osc.frequency.exponentialRampToValueAtTime(50, now + 0.04);\n      osc.frequency.exponentialRampToValueAtTime(30, now + 0.15);\n\n      // Тяжёлый sub\n      osc2.type = 'sine';\n      osc2.frequency.setValueAtTime(60, now);\n      osc2.frequency.exponentialRampToValueAtTime(25, now + 0.25);\n\n      // Дисторшн для жёсткости\n      const curve = new Float32Array(256);\n      for (let i = 0; i < 256; i++) {\n        const x = (i / 128) - 1;\n        curve[i] = Math.tanh(x * 8); // Жёсткий клиппинг\n      }\n      distortion.curve = curve;\n\n      gain.gain.setValueAtTime(0.9, now);\n      gain.gain.exponentialRampToValueAtTime(0.01, now + 0.3);\n\n      osc.connect(distortion);\n      osc2.connect(gain);\n      distortion.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 0.3);\n      osc2.start(now);\n      osc2.stop(now + 0.35);\n    };\n\n    // 130 BPM = ~461ms\n    this.musicIntervals.push(setInterval(playKick, 461) as unknown as number);\n\n    // === ДАБОВЫЙ БАС С ДИЛЭЕМ ===\n    const bassNotes = [36.7, 36.7, 32.7, 36.7, 41.2, 36.7, 32.7, 29.1]; // D минор\n    let bassIndex = 0;\n\n    const playDubBass = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'boss_black') return;\n\n      const now = this.ctx.currentTime;\n      const note = bassNotes[bassIndex];\n\n      // Основной бас\n      const osc = this.ctx.createOscillator();\n      const filter = this.ctx.createBiquadFilter();\n      const gain = this.ctx.createGain();\n\n      osc.type = 'sawtooth';\n      osc.frequency.value = note;\n\n      filter.type = 'lowpass';\n      filter.frequency.setValueAtTime(400, now);\n      filter.frequency.exponentialRampToValueAtTime(80, now + 0.3);\n      filter.Q.value = 10;\n\n      gain.gain.setValueAtTime(0.35, now);\n      gain.gain.exponentialRampToValueAtTime(0.01, now + 0.4);\n\n      osc.connect(filter);\n      filter.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 0.45);\n\n      // Дабовое эхо (3 повтора с затуханием)\n      for (let echo = 1; echo <= 3; echo++) {\n        const echoOsc = this.ctx.createOscillator();\n        const echoFilter = this.ctx.createBiquadFilter();\n        const echoGain = this.ctx.createGain();\n        const echoTime = now + echo * 0.15;\n        const echoVol = 0.15 / echo;\n\n        echoOsc.type = 'sine';\n        echoOsc.frequency.value = note;\n\n        echoFilter.type = 'lowpass';\n        echoFilter.frequency.value = 200 - echo * 40;\n\n        echoGain.gain.setValueAtTime(echoVol, echoTime);\n        echoGain.gain.exponentialRampToValueAtTime(0.001, echoTime + 0.25);\n\n        echoOsc.connect(echoFilter);\n        echoFilter.connect(echoGain);\n        echoGain.connect(this.musicGain!);\n\n        echoOsc.start(echoTime);\n        echoOsc.stop(echoTime + 0.3);\n      }\n\n      bassIndex = (bassIndex + 1) % bassNotes.length;\n    };\n\n    this.musicIntervals.push(setInterval(playDubBass, 461) as unknown as number);\n\n    // === БРЕЙКБИТ (Amen-style паттерн) ===\n    // Классический брейк: kick-snare-kick-kick-snare с вариациями\n    // 16 шагов паттерна: K=kick, S=snare, H=hihat, _=пауза\n    // Pattern: K_H_S_HK__H_S_HK\n    const breakPattern = [\n      { type: 'kick', vol: 1.0 },\n      { type: 'none', vol: 0 },\n      { type: 'hat', vol: 0.6 },\n      { type: 'none', vol: 0 },\n      { type: 'snare', vol: 1.0 },\n      { type: 'none', vol: 0 },\n      { type: 'hat', vol: 0.5 },\n      { type: 'kick', vol: 0.8 },\n      { type: 'none', vol: 0 },\n      { type: 'none', vol: 0 },\n      { type: 'hat', vol: 0.7 },\n      { type: 'none', vol: 0 },\n      { type: 'snare', vol: 1.0 },\n      { type: 'none', vol: 0 },\n      { type: 'hat', vol: 0.5 },\n      { type: 'kick', vol: 0.7 },\n    ];\n    let breakIndex = 0;\n\n    const playBreakHit = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'boss_black') return;\n\n      const now = this.ctx.currentTime;\n      const hit = breakPattern[breakIndex];\n\n      if (hit.type === 'kick') {\n        // Брейкбит кик - короткий и панчевый\n        const osc = this.ctx.createOscillator();\n        const gain = this.ctx.createGain();\n\n        osc.type = 'sine';\n        osc.frequency.setValueAtTime(180, now);\n        osc.frequency.exponentialRampToValueAtTime(60, now + 0.03);\n        osc.frequency.exponentialRampToValueAtTime(40, now + 0.08);\n\n        gain.gain.setValueAtTime(0.5 * hit.vol, now);\n        gain.gain.exponentialRampToValueAtTime(0.01, now + 0.12);\n\n        osc.connect(gain);\n        gain.connect(this.musicGain!);\n\n        osc.start(now);\n        osc.stop(now + 0.15);\n\n      } else if (hit.type === 'snare') {\n        // Брейкбит снэйр - хрустящий\n        const osc = this.ctx.createOscillator();\n        const oscGain = this.ctx.createGain();\n\n        osc.type = 'triangle';\n        osc.frequency.setValueAtTime(250, now);\n        osc.frequency.exponentialRampToValueAtTime(150, now + 0.02);\n\n        oscGain.gain.setValueAtTime(0.2 * hit.vol, now);\n        oscGain.gain.exponentialRampToValueAtTime(0.01, now + 0.08);\n\n        osc.connect(oscGain);\n        oscGain.connect(this.musicGain!);\n\n        osc.start(now);\n        osc.stop(now + 0.1);\n\n        // Шум\n        const bufferSize = this.ctx.sampleRate * 0.1;\n        const buffer = this.ctx.createBuffer(1, bufferSize, this.ctx.sampleRate);\n        const data = buffer.getChannelData(0);\n        for (let i = 0; i < bufferSize; i++) {\n          data[i] = (Math.random() * 2 - 1) * Math.exp(-i / (this.ctx.sampleRate * 0.025));\n        }\n        const noise = this.ctx.createBufferSource();\n        noise.buffer = buffer;\n\n        const noiseFilter = this.ctx.createBiquadFilter();\n        noiseFilter.type = 'bandpass';\n        noiseFilter.frequency.value = 3000;\n        noiseFilter.Q.value = 1;\n\n        const noiseGain = this.ctx.createGain();\n        noiseGain.gain.setValueAtTime(0.35 * hit.vol, now);\n        noiseGain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);\n\n        noise.connect(noiseFilter);\n        noiseFilter.connect(noiseGain);\n        noiseGain.connect(this.musicGain!);\n\n        noise.start(now);\n        noise.stop(now + 0.12);\n\n      } else if (hit.type === 'hat') {\n        // Брейкбит хайхэт\n        const bufferSize = this.ctx.sampleRate * 0.04;\n        const buffer = this.ctx.createBuffer(1, bufferSize, this.ctx.sampleRate);\n        const data = buffer.getChannelData(0);\n        for (let i = 0; i < bufferSize; i++) {\n          data[i] = Math.random() * 2 - 1;\n        }\n        const noise = this.ctx.createBufferSource();\n        noise.buffer = buffer;\n\n        const filter = this.ctx.createBiquadFilter();\n        filter.type = 'highpass';\n        filter.frequency.value = 7000;\n\n        const gain = this.ctx.createGain();\n        gain.gain.setValueAtTime(0.15 * hit.vol, now);\n        gain.gain.exponentialRampToValueAtTime(0.001, now + 0.035);\n\n        noise.connect(filter);\n        filter.connect(gain);\n        gain.connect(this.musicGain!);\n\n        noise.start(now);\n        noise.stop(now + 0.045);\n      }\n\n      breakIndex = (breakIndex + 1) % breakPattern.length;\n    };\n\n    // 16th notes при 130 BPM\n    this.musicIntervals.push(setInterval(playBreakHit, 115) as unknown as number);\n\n    // Снэйр и хайхэты уже в брейкбите!\n\n    // === ДАБОВЫЙ CHORD STAB С ЭХОМ ===\n    const playDubChord = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'boss_black') return;\n\n      const now = this.ctx.currentTime;\n      const chord = [146.8, 174.6, 220]; // Dm: D3, F3, A3\n\n      for (const freq of chord) {\n        const osc = this.ctx.createOscillator();\n        const filter = this.ctx.createBiquadFilter();\n        const gain = this.ctx.createGain();\n\n        osc.type = 'sawtooth';\n        osc.frequency.value = freq;\n\n        filter.type = 'lowpass';\n        filter.frequency.setValueAtTime(2000, now);\n        filter.frequency.exponentialRampToValueAtTime(300, now + 0.2);\n        filter.Q.value = 5;\n\n        gain.gain.setValueAtTime(0.08, now);\n        gain.gain.exponentialRampToValueAtTime(0.001, now + 0.25);\n\n        osc.connect(filter);\n        filter.connect(gain);\n        gain.connect(this.musicGain!);\n\n        osc.start(now);\n        osc.stop(now + 0.3);\n\n        // Множественное эхо (даб!)\n        for (let e = 1; e <= 5; e++) {\n          const echoOsc = this.ctx.createOscillator();\n          const echoFilter = this.ctx.createBiquadFilter();\n          const echoGain = this.ctx.createGain();\n          const echoTime = now + e * 0.18;\n\n          echoOsc.type = 'sine';\n          echoOsc.frequency.value = freq;\n          echoFilter.type = 'lowpass';\n          echoFilter.frequency.value = 800 - e * 120;\n\n          echoGain.gain.setValueAtTime(0.04 / e, echoTime);\n          echoGain.gain.exponentialRampToValueAtTime(0.001, echoTime + 0.2);\n\n          echoOsc.connect(echoFilter);\n          echoFilter.connect(echoGain);\n          echoGain.connect(this.musicGain!);\n\n          echoOsc.start(echoTime);\n          echoOsc.stop(echoTime + 0.25);\n        }\n      }\n    };\n\n    this.musicIntervals.push(setInterval(playDubChord, 1844) as unknown as number); // Каждые 4 такта\n\n    // === ГЛУБОКИЙ SUB DRONE ===\n    const playSubDrone = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'boss_black') return;\n\n      const now = this.ctx.currentTime;\n\n      const osc = this.ctx.createOscillator();\n      const lfo = this.ctx.createOscillator();\n      const lfoGain = this.ctx.createGain();\n      const gain = this.ctx.createGain();\n\n      osc.type = 'sine';\n      osc.frequency.value = 36.7; // D1\n\n      lfo.type = 'sine';\n      lfo.frequency.value = 0.2;\n      lfoGain.gain.value = 3;\n\n      lfo.connect(lfoGain);\n      lfoGain.connect(osc.frequency);\n\n      gain.gain.setValueAtTime(0, now);\n      gain.gain.linearRampToValueAtTime(0.25, now + 1);\n      gain.gain.linearRampToValueAtTime(0.2, now + 3);\n      gain.gain.linearRampToValueAtTime(0, now + 4);\n\n      osc.connect(gain);\n      gain.connect(this.musicGain!);\n\n      lfo.start(now);\n      osc.start(now);\n      lfo.stop(now + 4.5);\n      osc.stop(now + 4.5);\n    };\n\n    playSubDrone();\n    this.musicIntervals.push(setInterval(playSubDrone, 3688) as unknown as number);\n\n    // === FX: РЕЙЗЕР/ПАДЕНИЕ (каждые 8 тактов) ===\n    const playFx = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'boss_black') return;\n      if (Math.random() > 0.5) return;\n\n      const now = this.ctx.currentTime;\n\n      const osc = this.ctx.createOscillator();\n      const filter = this.ctx.createBiquadFilter();\n      const gain = this.ctx.createGain();\n\n      osc.type = 'sawtooth';\n      // Случайно вверх или вниз\n      if (Math.random() > 0.5) {\n        osc.frequency.setValueAtTime(100, now);\n        osc.frequency.exponentialRampToValueAtTime(800, now + 1);\n      } else {\n        osc.frequency.setValueAtTime(600, now);\n        osc.frequency.exponentialRampToValueAtTime(50, now + 1.5);\n      }\n\n      filter.type = 'lowpass';\n      filter.frequency.setValueAtTime(3000, now);\n      filter.frequency.exponentialRampToValueAtTime(200, now + 1.5);\n      filter.Q.value = 8;\n\n      gain.gain.setValueAtTime(0.1, now);\n      gain.gain.exponentialRampToValueAtTime(0.001, now + 1.5);\n\n      osc.connect(filter);\n      filter.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 1.6);\n    };\n\n    this.musicIntervals.push(setInterval(playFx, 3688) as unknown as number);\n  }\n\n  /** Райзер перед вихрем */\n  public playVortexRiser(): void {\n    if (!this.ctx || !this.musicGain) return;\n\n    const now = this.ctx.currentTime;\n    const duration = 2.0; // 2 секунды райзера\n\n    // === ОСНОВНОЙ РАЙЗЕР (нарастающий шум) ===\n    const bufferSize = this.ctx.sampleRate * duration;\n    const buffer = this.ctx.createBuffer(1, bufferSize, this.ctx.sampleRate);\n    const data = buffer.getChannelData(0);\n    for (let i = 0; i < bufferSize; i++) {\n      data[i] = Math.random() * 2 - 1;\n    }\n\n    const noise = this.ctx.createBufferSource();\n    noise.buffer = buffer;\n\n    const filter = this.ctx.createBiquadFilter();\n    filter.type = 'bandpass';\n    filter.frequency.setValueAtTime(200, now);\n    filter.frequency.exponentialRampToValueAtTime(8000, now + duration);\n    filter.Q.value = 5;\n\n    const gain = this.ctx.createGain();\n    gain.gain.setValueAtTime(0, now);\n    gain.gain.linearRampToValueAtTime(0.3, now + duration * 0.8);\n    gain.gain.linearRampToValueAtTime(0.5, now + duration);\n\n    noise.connect(filter);\n    filter.connect(gain);\n    gain.connect(this.musicGain);\n\n    noise.start(now);\n    noise.stop(now + duration + 0.1);\n\n    // === ТОНАЛЬНЫЙ РАЙЗЕР (нарастающий тон) ===\n    const osc = this.ctx.createOscillator();\n    const oscFilter = this.ctx.createBiquadFilter();\n    const oscGain = this.ctx.createGain();\n\n    osc.type = 'sawtooth';\n    osc.frequency.setValueAtTime(50, now);\n    osc.frequency.exponentialRampToValueAtTime(400, now + duration);\n\n    oscFilter.type = 'lowpass';\n    oscFilter.frequency.setValueAtTime(100, now);\n    oscFilter.frequency.exponentialRampToValueAtTime(2000, now + duration);\n    oscFilter.Q.value = 8;\n\n    oscGain.gain.setValueAtTime(0, now);\n    oscGain.gain.linearRampToValueAtTime(0.25, now + duration);\n\n    osc.connect(oscFilter);\n    oscFilter.connect(oscGain);\n    oscGain.connect(this.musicGain);\n\n    osc.start(now);\n    osc.stop(now + duration + 0.1);\n\n    // === УДАРНЫЕ АКЦЕНТЫ (нарастающие) ===\n    const playRiserHit = (time: number, vol: number) => {\n      if (!this.ctx || !this.musicGain) return;\n\n      const hitOsc = this.ctx.createOscillator();\n      const hitGain = this.ctx.createGain();\n\n      hitOsc.type = 'sine';\n      hitOsc.frequency.setValueAtTime(100, time);\n      hitOsc.frequency.exponentialRampToValueAtTime(30, time + 0.1);\n\n      hitGain.gain.setValueAtTime(vol, time);\n      hitGain.gain.exponentialRampToValueAtTime(0.001, time + 0.15);\n\n      hitOsc.connect(hitGain);\n      hitGain.connect(this.musicGain);\n\n      hitOsc.start(time);\n      hitOsc.stop(time + 0.2);\n    };\n\n    // Ускоряющиеся удары\n    playRiserHit(now + 0.5, 0.15);\n    playRiserHit(now + 1.0, 0.2);\n    playRiserHit(now + 1.3, 0.25);\n    playRiserHit(now + 1.5, 0.3);\n    playRiserHit(now + 1.65, 0.35);\n    playRiserHit(now + 1.8, 0.4);\n    playRiserHit(now + 1.9, 0.45);\n  }\n\n  /** Музыка Синего Босса - быстрый электронный бит */\n  private playBossBlueMusic(): void {\n    if (!this.ctx || !this.musicGain) return;\n\n    // Быстрый синтезаторный бас\n    const bassNotes = [110, 110, 146.8, 164.8, 110, 130.8, 146.8, 110]; // Быстрая прогрессия\n    let noteIndex = 0;\n\n    const playBass = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'boss_blue') return;\n\n      const now = this.ctx.currentTime;\n\n      const osc = this.ctx.createOscillator();\n      const gain = this.ctx.createGain();\n      const filter = this.ctx.createBiquadFilter();\n\n      osc.type = 'square';\n      osc.frequency.value = bassNotes[noteIndex];\n\n      filter.type = 'lowpass';\n      filter.frequency.setValueAtTime(800, now);\n      filter.frequency.exponentialRampToValueAtTime(200, now + 0.2);\n\n      gain.gain.setValueAtTime(0.15, now);\n      gain.gain.linearRampToValueAtTime(0, now + 0.2);\n\n      osc.connect(filter);\n      filter.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 0.25);\n\n      noteIndex = (noteIndex + 1) % bassNotes.length;\n    };\n\n    this.musicIntervals.push(setInterval(playBass, 250) as unknown as number);\n\n    // Быстрое арпеджио\n    const arpNotes = [880, 1046, 1318, 1567, 1318, 1046];\n    let arpIndex = 0;\n\n    const playArp = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'boss_blue') return;\n\n      const now = this.ctx.currentTime;\n\n      const osc = this.ctx.createOscillator();\n      const gain = this.ctx.createGain();\n\n      osc.type = 'triangle';\n      osc.frequency.value = arpNotes[arpIndex];\n\n      gain.gain.setValueAtTime(0.08, now);\n      gain.gain.exponentialRampToValueAtTime(0.001, now + 0.1);\n\n      osc.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 0.12);\n\n      arpIndex = (arpIndex + 1) % arpNotes.length;\n    };\n\n    this.musicIntervals.push(setInterval(playArp, 125) as unknown as number);\n\n    // Электрические разряды\n    const playZap = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'boss_blue') return;\n\n      const now = this.ctx.currentTime;\n\n      const osc = this.ctx.createOscillator();\n      const gain = this.ctx.createGain();\n\n      osc.type = 'sawtooth';\n      osc.frequency.setValueAtTime(2000, now);\n      osc.frequency.exponentialRampToValueAtTime(100, now + 0.15);\n\n      gain.gain.setValueAtTime(0.1, now);\n      gain.gain.exponentialRampToValueAtTime(0.001, now + 0.15);\n\n      osc.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 0.15);\n    };\n\n    this.musicIntervals.push(setInterval(playZap, 500 + Math.random() * 300) as unknown as number);\n\n    // Быстрые удары\n    const playKick = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'boss_blue') return;\n\n      const now = this.ctx.currentTime;\n\n      const osc = this.ctx.createOscillator();\n      const gain = this.ctx.createGain();\n\n      osc.type = 'sine';\n      osc.frequency.setValueAtTime(150, now);\n      osc.frequency.exponentialRampToValueAtTime(50, now + 0.1);\n\n      gain.gain.setValueAtTime(0.2, now);\n      gain.gain.exponentialRampToValueAtTime(0.001, now + 0.15);\n\n      osc.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 0.15);\n    };\n\n    this.musicIntervals.push(setInterval(playKick, 500) as unknown as number);\n  }\n\n  /** Бас-линия */\n  private playBassline(): void {\n    if (!this.ctx || !this.musicGain) return;\n\n    const bassNotes = [55, 55, 73.4, 82.4]; // A1, A1, D2, E2\n    let noteIndex = 0;\n\n    const playBassNote = () => {\n      // Останавливаем если переключились на босса\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'normal') return;\n\n      const now = this.ctx.currentTime;\n\n      const osc = this.ctx.createOscillator();\n      const osc2 = this.ctx.createOscillator();\n      const gain = this.ctx.createGain();\n      const filter = this.ctx.createBiquadFilter();\n\n      osc.type = 'sawtooth';\n      osc.frequency.value = bassNotes[noteIndex];\n\n      osc2.type = 'square';\n      osc2.frequency.value = bassNotes[noteIndex] * 1.005; // Детюн\n\n      filter.type = 'lowpass';\n      filter.frequency.setValueAtTime(300, now);\n      filter.frequency.linearRampToValueAtTime(150, now + 0.8);\n\n      gain.gain.setValueAtTime(0.2, now);\n      gain.gain.linearRampToValueAtTime(0.15, now + 0.1);\n      gain.gain.linearRampToValueAtTime(0, now + 0.9);\n\n      osc.connect(filter);\n      osc2.connect(filter);\n      filter.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 1);\n      osc2.start(now);\n      osc2.stop(now + 1);\n\n      noteIndex = (noteIndex + 1) % bassNotes.length;\n\n      setTimeout(playBassNote, 1000);\n    };\n\n    playBassNote();\n  }\n\n  /** Арпеджио */\n  private playArpeggio(): void {\n    if (!this.ctx || !this.musicGain) return;\n\n    // A minor pentatonic: A, C, D, E, G\n    const arpNotes = [440, 523, 587, 659, 784, 659, 587, 523];\n    let noteIndex = 0;\n\n    const playArpNote = () => {\n      // Останавливаем если переключились на босса\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'normal') return;\n\n      const now = this.ctx.currentTime;\n\n      const osc = this.ctx.createOscillator();\n      const gain = this.ctx.createGain();\n      const filter = this.ctx.createBiquadFilter();\n      const delay = this.ctx.createDelay();\n      const delayGain = this.ctx.createGain();\n\n      osc.type = 'square';\n      osc.frequency.value = arpNotes[noteIndex];\n\n      filter.type = 'lowpass';\n      filter.frequency.setValueAtTime(2000, now);\n      filter.frequency.exponentialRampToValueAtTime(500, now + 0.15);\n      filter.Q.value = 5;\n\n      gain.gain.setValueAtTime(0.08, now);\n      gain.gain.exponentialRampToValueAtTime(0.01, now + 0.12);\n\n      // Дилей для глубины\n      delay.delayTime.value = 0.25;\n      delayGain.gain.value = 0.3;\n\n      osc.connect(filter);\n      filter.connect(gain);\n      gain.connect(this.musicGain!);\n      gain.connect(delay);\n      delay.connect(delayGain);\n      delayGain.connect(this.musicGain!);\n      delayGain.connect(this.reverb!);\n\n      osc.start(now);\n      osc.stop(now + 0.15);\n\n      noteIndex = (noteIndex + 1) % arpNotes.length;\n\n      setTimeout(playArpNote, 125); // 16th notes at 120 BPM\n    };\n\n    setTimeout(playArpNote, 2000);\n  }\n\n  /** Атмосферный пэд */\n  private playPad(): void {\n    if (!this.ctx || !this.musicGain) return;\n\n    const padChords = [\n      [220, 261.6, 329.6], // Am\n      [196, 246.9, 293.7], // G\n      [174.6, 220, 261.6], // F\n      [164.8, 196, 246.9], // Em\n    ];\n    let chordIndex = 0;\n\n    const playPadChord = () => {\n      // Останавливаем если переключились на босса\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'normal') return;\n\n      const now = this.ctx.currentTime;\n      const chord = padChords[chordIndex];\n\n      chord.forEach((freq, i) => {\n        const osc = this.ctx!.createOscillator();\n        const osc2 = this.ctx!.createOscillator();\n        const gain = this.ctx!.createGain();\n        const filter = this.ctx!.createBiquadFilter();\n\n        osc.type = 'sawtooth';\n        osc.frequency.value = freq;\n\n        osc2.type = 'triangle';\n        osc2.frequency.value = freq * 1.002;\n\n        filter.type = 'lowpass';\n        filter.frequency.value = 800;\n        filter.Q.value = 1;\n\n        // Медленное нарастание\n        gain.gain.setValueAtTime(0, now);\n        gain.gain.linearRampToValueAtTime(0.03, now + 1);\n        gain.gain.linearRampToValueAtTime(0.03, now + 3);\n        gain.gain.linearRampToValueAtTime(0, now + 4);\n\n        osc.connect(filter);\n        osc2.connect(filter);\n        filter.connect(gain);\n        gain.connect(this.musicGain!);\n        gain.connect(this.reverb!);\n\n        osc.start(now + i * 0.1);\n        osc.stop(now + 4.5);\n        osc2.start(now + i * 0.1);\n        osc2.stop(now + 4.5);\n      });\n\n      chordIndex = (chordIndex + 1) % padChords.length;\n\n      setTimeout(playPadChord, 4000);\n    };\n\n    setTimeout(playPadChord, 500);\n  }\n\n  /** Драм-машина */\n  private playDrums(): void {\n    if (!this.ctx || !this.musicGain) return;\n\n    let beat = 0;\n\n    const playBeat = () => {\n      // Останавливаем если переключились на босса\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'normal') return;\n\n      const now = this.ctx.currentTime;\n\n      // Кик на 1 и 3\n      if (beat % 4 === 0 || beat % 4 === 2) {\n        const kick = this.ctx.createOscillator();\n        const kickGain = this.ctx.createGain();\n\n        kick.type = 'sine';\n        kick.frequency.setValueAtTime(150, now);\n        kick.frequency.exponentialRampToValueAtTime(40, now + 0.1);\n\n        kickGain.gain.setValueAtTime(0.3, now);\n        kickGain.gain.exponentialRampToValueAtTime(0.01, now + 0.15);\n\n        kick.connect(kickGain);\n        kickGain.connect(this.musicGain!);\n\n        kick.start(now);\n        kick.stop(now + 0.2);\n      }\n\n      // Снэйр на 2 и 4\n      if (beat % 4 === 1 || beat % 4 === 3) {\n        const snare = this.createNoise(0.15);\n        const snareGain = this.ctx.createGain();\n        const snareFilter = this.ctx.createBiquadFilter();\n\n        snareFilter.type = 'highpass';\n        snareFilter.frequency.value = 1000;\n\n        snareGain.gain.setValueAtTime(0.15, now);\n        snareGain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);\n\n        snare.connect(snareFilter);\n        snareFilter.connect(snareGain);\n        snareGain.connect(this.musicGain!);\n\n        // Тональная часть снэйра\n        const snareTone = this.ctx.createOscillator();\n        const snareToneGain = this.ctx.createGain();\n\n        snareTone.type = 'triangle';\n        snareTone.frequency.value = 180;\n\n        snareToneGain.gain.setValueAtTime(0.1, now);\n        snareToneGain.gain.exponentialRampToValueAtTime(0.01, now + 0.08);\n\n        snareTone.connect(snareToneGain);\n        snareToneGain.connect(this.musicGain!);\n\n        snareTone.start(now);\n        snareTone.stop(now + 0.1);\n      }\n\n      // Хай-хэт на каждый бит\n      const hihat = this.createNoise(0.03);\n      const hihatGain = this.ctx.createGain();\n      const hihatFilter = this.ctx.createBiquadFilter();\n\n      hihatFilter.type = 'highpass';\n      hihatFilter.frequency.value = 8000;\n\n      hihatGain.gain.setValueAtTime(beat % 2 === 0 ? 0.08 : 0.04, now);\n      hihatGain.gain.exponentialRampToValueAtTime(0.01, now + 0.03);\n\n      hihat.connect(hihatFilter);\n      hihatFilter.connect(hihatGain);\n      hihatGain.connect(this.musicGain!);\n\n      beat = (beat + 1) % 16;\n\n      setTimeout(playBeat, 250); // 120 BPM\n    };\n\n    setTimeout(playBeat, 1000);\n  }\n\n  /** Остановить аудио */\n  public stop(): void {\n    if (this.arpInterval) {\n      clearInterval(this.arpInterval);\n    }\n    if (this.ctx) {\n      this.ctx.close();\n      this.ctx = null;\n    }\n    this.isStarted = false;\n  }\n}\n","/** Вершинный шейдер */\nexport const VERTEX_SHADER = `#version 300 es\nprecision highp float;\n\nin vec2 a_position;\nout vec2 v_uv;\n\nvoid main() {\n  v_uv = a_position * 0.5 + 0.5;\n  gl_Position = vec4(a_position, 0.0, 1.0);\n}\n`;\n\n/** Фрагментный шейдер - Circular Arena with Pools */\nexport const FRAGMENT_SHADER = `#version 300 es\nprecision highp float;\n\nuniform vec2 u_resolution;\nuniform float u_time;\nuniform vec3 u_cameraPos;\nuniform float u_cameraYaw;\nuniform float u_cameraPitch;\nuniform vec4 u_targets[16];\nuniform int u_targetCount;\nuniform float u_muzzleFlash;\nuniform vec4 u_pools[8]; // Токсичные лужи [x, z, radius, lifetime]\nuniform int u_poolCount;\nuniform vec4 u_acidProjectiles[4]; // Летящие снаряды кислоты [x, y, z, progress]\nuniform int u_acidProjectileCount;\nuniform vec4 u_acidRainZones[4]; // Зоны кислотного дождя [x, z, radius, state]\nuniform int u_acidRainZoneCount;\nuniform int u_era; // Эпоха: 1=кислотная, 2=чёрная дыра, 3=космическая\nuniform int u_wave; // Текущая волна (для эффекта дождя на 15+)\nuniform vec4 u_pickups[8]; // Пикапы [x, y, z, type] type: 9=health, 10=stimpack, 11=charge\nuniform int u_pickupCount;\nuniform vec4 u_crystals[6]; // Кристаллы силы [x, z, height, active]\n\nin vec2 v_uv;\nout vec4 fragColor;\n\n// === ОПТИМИЗИРОВАННЫЕ ПАРАМЕТРЫ ===\n#define MAX_STEPS 20\n#define MAX_DIST 40.0\n#define SURF_DIST 0.03\n#define PI 3.14159265\n\n// === РАЗМЕРЫ АРЕНЫ ===\n#define ARENA_RADIUS 28.0\n#define DOME_HEIGHT 18.0\n#define POOL_RADIUS 8.0\n#define POOL_DEPTH 2.0\n// Малые бассейны удалены для упрощения\n#define PLATFORM_HEIGHT 2.0\n#define PLATFORM_X 20.0\n#define BRIDGE_WIDTH 3.0\n\n// === NOISE ===\nfloat hash(vec2 p) {\n  return fract(sin(dot(p, vec2(127.1, 311.7))) * 43758.5453);\n}\n\nfloat noise(vec2 p) {\n  vec2 i = floor(p);\n  vec2 f = fract(p);\n  f = f * f * (3.0 - 2.0 * f);\n  return mix(\n    mix(hash(i), hash(i + vec2(1, 0)), f.x),\n    mix(hash(i + vec2(0, 1)), hash(i + vec2(1, 1)), f.x),\n    f.y\n  );\n}\n\nfloat waterWaves(vec2 p, float t) {\n  float wave = 0.0;\n  wave += sin(p.x * 0.5 + t * 0.8) * 0.08;\n  wave += sin(p.y * 0.4 + t * 0.6) * 0.06;\n  wave += sin((p.x + p.y) * 0.7 + t) * 0.04;\n  return wave;\n}\n\n// === SDF ПРИМИТИВЫ ===\nfloat sdSphere(vec3 p, float r) {\n  return length(p) - r;\n}\n\nfloat sdBox(vec3 p, vec3 b) {\n  vec3 q = abs(p) - b;\n  return length(max(q, 0.0)) + min(max(q.x, max(q.y, q.z)), 0.0);\n}\n\nfloat sdCylinder(vec3 p, float r, float h) {\n  vec2 d = abs(vec2(length(p.xz), p.y)) - vec2(r, h);\n  return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));\n}\n\nfloat sdTorus(vec3 p, vec2 t) {\n  vec2 q = vec2(length(p.xz) - t.x, p.y);\n  return length(q) - t.y;\n}\n\n// Октаэдр (кристалл)\nfloat sdOctahedron(vec3 p, float s) {\n  p = abs(p);\n  return (p.x + p.y + p.z - s) * 0.57735027;\n}\n\nfloat sdCappedCone(vec3 p, float h, float r1, float r2) {\n  vec2 q = vec2(length(p.xz), p.y);\n  vec2 k1 = vec2(r2, h);\n  vec2 k2 = vec2(r2 - r1, 2.0 * h);\n  vec2 ca = vec2(q.x - min(q.x, (q.y < 0.0) ? r1 : r2), abs(q.y) - h);\n  vec2 cb = q - k1 + k2 * clamp(dot(k1 - q, k2) / dot(k2, k2), 0.0, 1.0);\n  float s = (cb.x < 0.0 && ca.y < 0.0) ? -1.0 : 1.0;\n  return s * sqrt(min(dot(ca, ca), dot(cb, cb)));\n}\n\n// Плавное объединение\nfloat smin(float a, float b, float k) {\n  float h = clamp(0.5 + 0.5 * (b - a) / k, 0.0, 1.0);\n  return mix(b, a, h) - k * h * (1.0 - h);\n}\n\n// === МАТЕРИАЛ ===\n// 0 = стены/пол, 1 = вода, 2 = растения, 3 = металл, 4 = свечение\nint materialId = 0;\n\n// === ПАЛЬМА ===\nfloat sdPalm(vec3 p, vec3 pos) {\n  vec3 lp = p - pos;\n  float d = MAX_DIST;\n  \n  // Горшок\n  float pot = sdCappedCone(lp - vec3(0.0, 0.3, 0.0), 0.3, 0.5, 0.4);\n  d = min(d, pot);\n  \n  // Ствол\n  float trunk = sdCylinder(lp - vec3(0.0, 1.5, 0.0), 0.12, 1.2);\n  d = min(d, trunk);\n  \n  // Крона (несколько сфер)\n  float crown = sdSphere(lp - vec3(0.0, 3.0, 0.0), 1.0);\n  crown = min(crown, sdSphere(lp - vec3(0.5, 2.8, 0.3), 0.7));\n  crown = min(crown, sdSphere(lp - vec3(-0.5, 2.8, -0.3), 0.7));\n  crown = min(crown, sdSphere(lp - vec3(0.3, 2.9, -0.5), 0.6));\n  crown = min(crown, sdSphere(lp - vec3(-0.3, 2.9, 0.5), 0.6));\n  d = min(d, crown);\n  \n  return d;\n}\n\n// === КУСТ ===\nfloat sdBush(vec3 p, vec3 pos, float size) {\n  vec3 lp = p - pos;\n  float d = sdSphere(lp, size);\n  // Добавляем неровности\n  d += sin(lp.x * 8.0) * sin(lp.y * 8.0) * sin(lp.z * 8.0) * 0.05 * size;\n  return d;\n}\n\n// === ФАКЕЛ ===\nfloat sdTorch(vec3 p, vec3 pos) {\n  vec3 lp = p - pos;\n  float holder = sdCylinder(lp, 0.08, 0.3);\n  float bowl = sdCappedCone(lp - vec3(0.0, 0.35, 0.0), 0.15, 0.05, 0.15);\n  return min(holder, bowl);\n}\n\n// === ЛЕСТНИЦА ===\nfloat sdStairs(vec3 p, vec3 pos, float width, float height, float depth, int steps) {\n  vec3 lp = p - pos;\n  float d = MAX_DIST;\n  \n  float stepH = height / float(steps);\n  float stepD = depth / float(steps);\n  \n  for (int i = 0; i < steps; i++) {\n    if (i >= 10) break; // Ограничение для производительности\n    float y = float(i) * stepH;\n    float z = float(i) * stepD;\n    float step = sdBox(lp - vec3(0.0, y + stepH * 0.5, z + stepD * 0.5), \n                       vec3(width * 0.5, stepH * 0.5, stepD * 0.5));\n    d = min(d, step);\n  }\n  \n  return d;\n}\n\n// === СЦЕНА ===\nfloat map(vec3 p) {\n  float d = MAX_DIST;\n  materialId = 0;\n  \n  float distFromCenter = length(p.xz);\n  \n  // === ПОЛ ===\n  float floor_d = p.y;\n  d = min(d, floor_d);\n  \n  // === ТОКСИЧНЫЕ ЛУЖИ (оптимизировано) ===\n  for (int i = 0; i < u_poolCount; i++) {\n    if (i >= 8) break;\n    vec4 pool = u_pools[i];\n    if (pool.w > 0.0 && p.y < 0.15 && p.y > -0.1) {\n      float distToPool = length(p.xz - pool.xy);\n      if (distToPool < pool.z) {\n        float poolSurface = p.y - 0.08;\n        if (poolSurface < d) {\n          d = poolSurface;\n          materialId = 13;\n        }\n      }\n    }\n  }\n  \n  // === ЗОНЫ КИСЛОТНОГО ДОЖДЯ (оптимизировано) ===\n  for (int i = 0; i < u_acidRainZoneCount; i++) {\n    if (i >= 4) break;\n    vec4 zone = u_acidRainZones[i];\n    float state = zone.w;\n    \n    if (state < 1.0 && p.y < 0.1 && p.y > -0.05) {\n      float distToZone = length(p.xz - zone.xy);\n      float markRadius = zone.z * (0.3 + state * 1.4);\n      \n      if (distToZone < markRadius) {\n        // Простые кольца + пульсация\n        float ring = smoothstep(0.2, 0.0, abs(distToZone - markRadius * 0.85));\n        float pulse = sin(u_time * 10.0) * 0.5 + 0.5;\n        float center = step(distToZone, markRadius * 0.3) * pulse;\n        \n        if (ring + center > 0.3) {\n          d = p.y - 0.02;\n          materialId = 20;\n        }\n      }\n    }\n  }\n  \n  // === ЛЕТЯЩИЕ СНАРЯДЫ КИСЛОТЫ ===\n  for (int i = 0; i < u_acidProjectileCount; i++) {\n    if (i >= 4) break;\n    vec4 proj = u_acidProjectiles[i];\n    vec3 projPos = proj.xyz;\n    float progress = proj.w;\n    \n    if (progress > 0.0 && progress < 1.0) {\n      // Основная сфера кислоты\n      float projSphere = length(p - projPos) - 0.5;\n      if (projSphere < d) {\n        d = projSphere;\n        materialId = 19; // Снаряд кислоты\n      }\n      \n      // Хвост из капель\n      for (int j = 1; j <= 3; j++) {\n        vec3 tailPos = projPos - vec3(0.0, float(j) * 0.4, 0.0);\n        float tailDrop = length(p - tailPos) - (0.3 - float(j) * 0.08);\n        if (tailDrop < d) {\n          d = tailDrop;\n          materialId = 19;\n        }\n      }\n    }\n  }\n  \n  // === ПИКАПЫ ===\n  for (int i = 0; i < u_pickupCount; i++) {\n    if (i >= 8) break;\n    vec4 pickup = u_pickups[i];\n    float pType = pickup.w;\n    \n    if (pType > 0.0) {\n      vec3 pickupPos = pickup.xyz;\n      float pickupDist = length(p - pickupPos);\n      \n      // Парящая сфера/куб\n      if (pType == 9.0) {\n        // Аптечка - красный крест (сфера + кубы)\n        float sphere = length(p - pickupPos) - 0.4;\n        // Простая сфера для производительности\n        if (sphere < d) {\n          d = sphere;\n          materialId = 14; // Аптечка\n        }\n      } else if (pType == 10.0) {\n        // Стимпак - жёлтая звезда (сфера)\n        float sphere = length(p - pickupPos) - 0.35;\n        if (sphere < d) {\n          d = sphere;\n          materialId = 15; // Стимпак\n        }\n      } else if (pType == 11.0) {\n        // Заряд катаны - энергетическая сфера\n        float chargeSphere = length(p - pickupPos) - 0.5;\n        if (chargeSphere < d) {\n          d = chargeSphere;\n          materialId = 17; // Заряд\n        }\n      }\n    }\n  }\n  \n  // === КРУГЛЫЕ СТЕНЫ (цилиндр вовнутрь) ===\n  float walls = -(length(p.xz) - ARENA_RADIUS);\n  d = min(d, walls);\n  \n  // === КУПОЛ ===\n  // Сферический купол над ареной\n  float domeRadius = ARENA_RADIUS * 1.3;\n  float dome = -(length(vec3(p.x, p.y - 3.0, p.z)) - domeRadius);\n  dome = max(dome, p.y - DOME_HEIGHT);\n  d = min(d, dome);\n  \n  // === ЦЕНТРАЛЬНАЯ КОЛОННА (фонтан) ===\n  float centerCol = sdCylinder(p - vec3(0.0, 1.5, 0.0), 1.2, 1.5);\n  d = min(d, centerCol);\n  \n  // Чаша фонтана\n  float fountain = sdTorus(p - vec3(0.0, 0.3, 0.0), vec2(1.8, 0.25));\n  d = min(d, fountain);\n  \n  // === ЦЕНТРАЛЬНЫЙ БАССЕЙН ===\n  float poolDist = distFromCenter;\n  if (poolDist < POOL_RADIUS + 1.0 && poolDist > 2.5 && p.y < 0.5) {\n    // Дно бассейна\n    float poolBottom = p.y + POOL_DEPTH;\n    \n    // Бортик бассейна\n    float rim = sdTorus(p - vec3(0.0, 0.15, 0.0), vec2(POOL_RADIUS, 0.3));\n    d = min(d, rim);\n    \n    // Не пробиваем дно если внутри бассейна\n    if (poolDist < POOL_RADIUS - 0.3) {\n      d = min(d, poolBottom);\n    }\n  }\n  \n  // === МОСТЫ ЧЕРЕЗ БАССЕЙН ===\n  // Мост по X\n  float bridgeX = sdBox(p - vec3(0.0, 0.2, 0.0), vec3(POOL_RADIUS + 1.0, 0.2, BRIDGE_WIDTH * 0.5));\n  // Вырезаем центр для колонны\n  bridgeX = max(bridgeX, -sdCylinder(p, 2.0, 1.0));\n  d = min(d, bridgeX);\n  \n  // Мост по Z\n  float bridgeZ = sdBox(p - vec3(0.0, 0.2, 0.0), vec3(BRIDGE_WIDTH * 0.5, 0.2, POOL_RADIUS + 1.0));\n  bridgeZ = max(bridgeZ, -sdCylinder(p, 2.0, 1.0));\n  d = min(d, bridgeZ);\n  \n  // === ПЛАТФОРМЫ С ЛЕСТНИЦАМИ ===\n  // Левая платформа (X от -17 до -23)\n  float leftPlat = sdBox(p - vec3(-20.0, PLATFORM_HEIGHT * 0.5, 0.0), \n                         vec3(3.0, PLATFORM_HEIGHT * 0.5, 5.0));\n  d = min(d, leftPlat);\n  \n  // Лестница к левой платформе (X от -16 до -17, Z в центре)\n  float stairsL = sdBox(p - vec3(-16.5, PLATFORM_HEIGHT * 0.25, 0.0), \n                        vec3(0.5, PLATFORM_HEIGHT * 0.25 + 0.1, 2.5));\n  // Рампа вместо ступенек для простоты\n  d = min(d, stairsL);\n  \n  // Правая платформа (X от 17 до 23)\n  float rightPlat = sdBox(p - vec3(20.0, PLATFORM_HEIGHT * 0.5, 0.0), \n                          vec3(3.0, PLATFORM_HEIGHT * 0.5, 5.0));\n  d = min(d, rightPlat);\n  \n  // Лестница к правой платформе (X от 16 до 17)\n  float stairsR = sdBox(p - vec3(16.5, PLATFORM_HEIGHT * 0.25, 0.0), \n                        vec3(0.5, PLATFORM_HEIGHT * 0.25 + 0.1, 2.5));\n  d = min(d, stairsR);\n  \n  // Перила платформ\n  float railL = sdBox(p - vec3(-17.2, PLATFORM_HEIGHT + 0.5, 0.0), vec3(0.1, 0.5, 5.0));\n  float railR = sdBox(p - vec3(17.2, PLATFORM_HEIGHT + 0.5, 0.0), vec3(0.1, 0.5, 5.0));\n  d = min(d, min(railL, railR));\n  \n  // === КОЛОННЫ (только 2 у платформ) ===\n  float colD = sdCylinder(p - vec3(22.0, 4.0, 0.0), 0.5, 4.0);\n  colD = min(colD, sdCylinder(p - vec3(-22.0, 4.0, 0.0), 0.5, 4.0));\n  d = min(d, colD);\n  \n  // === КРУГЛЫЕ ПЛАТФОРМЫ ДЛЯ ПАРКУРА (спираль по кругу) ===\n  // 6 платформ по кругу с радиусом 10м, парящие вверх-вниз\n  float bob1 = sin(u_time * 1.5 + 0.0) * 0.3;\n  float bob2 = sin(u_time * 1.5 + 0.8) * 0.3;\n  float bob3 = sin(u_time * 1.5 + 1.6) * 0.3;\n  float bob4 = sin(u_time * 1.5 + 2.4) * 0.3;\n  float bob5 = sin(u_time * 1.5 + 3.2) * 0.3;\n  float bob6 = sin(u_time * 1.5 + 4.0) * 0.3;\n  \n  float jp1 = sdCylinder(p - vec3(10.0, 1.8 + bob1, 0.0), 1.5, 0.25);\n  float jp2 = sdCylinder(p - vec3(5.0, 3.0 + bob2, 8.66), 1.4, 0.25);\n  float jp3 = sdCylinder(p - vec3(-5.0, 4.2 + bob3, 8.66), 1.4, 0.25);\n  float jp4 = sdCylinder(p - vec3(-10.0, 5.4 + bob4, 0.0), 1.3, 0.25);\n  float jp5 = sdCylinder(p - vec3(-5.0, 6.6 + bob5, -8.66), 1.3, 0.25);\n  float jp6 = sdCylinder(p - vec3(5.0, 7.8 + bob6, -8.66), 1.2, 0.25);\n  \n  float jumpPlats = min(jp1, min(jp2, min(jp3, min(jp4, min(jp5, jp6)))));\n  if (jumpPlats < d) {\n    d = jumpPlats;\n    materialId = 16;\n  }\n  \n  // Верхняя платформа с бафом (в центре над фонтаном), парит медленнее\n  float topBob = sin(u_time * 1.0) * 0.2;\n  float topPlat = sdCylinder(p - vec3(0.0, 9.5 + topBob, 0.0), 2.5, 0.35);\n  if (topPlat < d) {\n    d = topPlat;\n    materialId = 16;\n  }\n  \n  // Свечение под верхней платформой\n  float glowRing = sdTorus(p - vec3(0.0, 9.0, 0.0), vec2(2.0, 0.12));\n  if (glowRing < d) {\n    d = glowRing;\n    materialId = 17;\n  }\n\n  // === КРИСТАЛЛЫ СИЛЫ (только на волне 10) ===\n  if (u_wave == 10) {\n    for (int i = 0; i < 6; i++) {\n      if (u_crystals[i].w > 0.5) { // active\n        float cx = u_crystals[i].x;\n        float cz = u_crystals[i].y;\n        float ch = u_crystals[i].z;\n        \n        // Кристалл парит и вращается\n        float bobOffset = sin(u_time * 2.0 + float(i)) * 0.15;\n        float rotation = u_time * 1.5 + float(i) * 1.047; // Вращение\n        \n        vec3 crystalPos = vec3(cx, ch + bobOffset, cz);\n        vec3 lp = p - crystalPos;\n        \n        // Вращаем вокруг Y\n        float cosR = cos(rotation);\n        float sinR = sin(rotation);\n        lp.xz = mat2(cosR, -sinR, sinR, cosR) * lp.xz;\n        \n        // Октаэдр (кристалл)\n        float crystal = sdOctahedron(lp, 0.5);\n        \n        if (crystal < d) {\n          d = crystal;\n          materialId = 18; // Чёрный кристалл\n        }\n      }\n    }\n  }\n  \n  // === ВОДА ===\n  // Центральный бассейн (только визуально, не пройти - коллизия блокирует)\n  if (distFromCenter > 2.5 && distFromCenter < POOL_RADIUS - 0.3) {\n    // Проверяем что не на мосту\n    bool onBridge = (abs(p.z) < BRIDGE_WIDTH * 0.5) || (abs(p.x) < BRIDGE_WIDTH * 0.5);\n    if (!onBridge) {\n      float waterY = 0.0 + waterWaves(p.xz, u_time) * 0.05;\n      float waterPlane = p.y - waterY;\n      if (waterPlane < d && waterPlane > -0.3) {\n        d = max(waterPlane, 0.001);\n        materialId = 1;\n      }\n    }\n  }\n  \n  // Фонтан в центре (декоративная вода)\n  float fountainWater = length(p.xz);\n  if (fountainWater < 1.8 && fountainWater > 1.3) {\n    float waterY = 0.4 + waterWaves(p.xz * 3.0, u_time * 2.0) * 0.02;\n    float waterPlane = p.y - waterY;\n    if (waterPlane < d && waterPlane > -0.1) {\n      d = max(waterPlane, 0.001);\n      materialId = 1;\n    }\n  }\n  \n  // === ВРАГИ ===\n  // w: 0=неактивен, 1-2=бейнлинг, 3-4=фантом, 5-6=runner, 7-8=hopper\n  // 11-12=boss_green, 13-14=boss_black, 15-16=boss_blue\n  for (int i = 0; i < u_targetCount; i++) {\n    if (i >= 16) break;\n    vec4 target = u_targets[i];\n    if (target.w > 0.5) {\n      vec3 tp = p - target.xyz;\n      int enemyType = int(target.w / 2.0); // 0=baneling, 1=phantom, 2=runner, 3=hopper, 5=boss_green, 6=boss_black, 7=boss_blue\n      \n      float targetD;\n      int matId;\n      \n      if (enemyType == 5) {\n        // === ЗЕЛЁНЫЙ БОСС (огромная зелёная жижа) ===\n        float wobble = sin(u_time * 2.0 + tp.x * 1.5) * 0.3\n                     + sin(u_time * 1.5 + tp.y * 2.0) * 0.25\n                     + sin(u_time * 2.5 + tp.z * 1.0) * 0.2;\n        float radius = 2.5 + wobble;\n        targetD = sdSphere(tp, radius);\n        \n        // Пузырящаяся поверхность\n        float bubbles = sin(tp.x * 4.0 + u_time * 3.0) \n                      * sin(tp.y * 4.0 + u_time * 2.5) \n                      * sin(tp.z * 4.0 + u_time * 3.5) * 0.2;\n        targetD += bubbles;\n        \n        // Щупальца\n        for (int t = 0; t < 4; t++) {\n          float angle = float(t) * 1.57 + u_time * 0.5;\n          vec3 tentacle = tp - vec3(cos(angle) * 1.5, -1.0, sin(angle) * 1.5);\n          targetD = smin(targetD, sdCylinder(tentacle, 0.3, 1.5), 0.3);\n        }\n        matId = 10; // Зелёный босс\n        \n      } else if (enemyType == 6) {\n        // === ЧЁРНЫЙ БОСС (искривляет пространство) ===\n        // Искажённое пространство вокруг\n        vec3 distorted = tp;\n        float distortAmount = sin(u_time * 3.0) * 0.3;\n        distorted.x += sin(tp.y * 3.0 + u_time * 2.0) * distortAmount;\n        distorted.z += cos(tp.y * 3.0 + u_time * 2.0) * distortAmount;\n        \n        float radius = 2.0;\n        targetD = sdSphere(distorted, radius);\n        \n        // Кольца тёмной энергии\n        float ring1 = abs(sdTorus(tp, vec2(3.0, 0.1))) - 0.05;\n        float ring2 = abs(sdTorus(tp * vec3(1.0, 0.7, 1.0), vec2(3.5, 0.08))) - 0.03;\n        targetD = min(targetD, ring1);\n        targetD = min(targetD, ring2);\n        matId = 11; // Чёрный босс\n        \n      } else if (enemyType == 7) {\n        // === СИНИЙ БОСС (телепортирующийся) ===\n        // Мерцающая форма\n        float flicker = abs(sin(u_time * 20.0)) * 0.3 + 0.7;\n        float radius = 1.8 * flicker;\n        targetD = sdSphere(tp, radius);\n        \n        // Электрические разряды\n        float sparks = sin(tp.x * 15.0 + u_time * 30.0) \n                     * sin(tp.y * 15.0 + u_time * 25.0) * 0.1;\n        targetD += sparks;\n        \n        // Призрачные копии\n        vec3 ghost1 = tp - vec3(sin(u_time * 5.0) * 2.0, 0.0, cos(u_time * 5.0) * 2.0);\n        vec3 ghost2 = tp + vec3(cos(u_time * 4.0) * 2.0, 0.0, sin(u_time * 4.0) * 2.0);\n        targetD = min(targetD, sdSphere(ghost1, 0.5) - 0.1);\n        targetD = min(targetD, sdSphere(ghost2, 0.5) - 0.1);\n        matId = 12; // Синий босс\n        \n      } else if (enemyType == 1) {\n        // === ФАНТОМ (чёрный шар) ===\n        float distort = sin(u_time * 8.0 + tp.x * 5.0) * 0.08\n                      + sin(u_time * 7.0 + tp.z * 6.0) * 0.06;\n        float radius = 0.55 + distort;\n        targetD = sdSphere(tp, radius);\n        \n        vec3 trail = tp + vec3(0.0, 0.0, 0.3);\n        float trailD = sdSphere(trail, 0.3) - 0.1;\n        targetD = min(targetD, trailD);\n        matId = 5;\n        \n      } else if (enemyType == 2) {\n        // === RUNNER (оранжевый, вытянутый) ===\n        vec3 stretched = tp;\n        stretched.x *= 0.6;\n        float radius = 0.35;\n        targetD = sdSphere(stretched, radius);\n        \n        float speedTrail = sdSphere(tp + vec3(0.3, 0.0, 0.0), 0.2);\n        speedTrail = min(speedTrail, sdSphere(tp + vec3(0.5, 0.0, 0.0), 0.12));\n        targetD = min(targetD, speedTrail);\n        matId = 6;\n        \n      } else if (enemyType == 3) {\n        // === HOPPER (синий, пружинистый) ===\n        float squeeze = 1.0 + sin(u_time * 12.0) * 0.15;\n        vec3 squashed = tp;\n        squashed.y *= squeeze;\n        float radius = 0.45;\n        targetD = sdSphere(squashed, radius);\n        \n        vec3 ear1 = tp - vec3(0.2, 0.4, 0.0);\n        vec3 ear2 = tp - vec3(-0.2, 0.4, 0.0);\n        float ears = min(sdSphere(ear1, 0.12), sdSphere(ear2, 0.12));\n        targetD = min(targetD, ears);\n        matId = 7;\n        \n      } else {\n        // === БЕЙНЛИНГ (зелёная жижа) ===\n        float wobble = sin(u_time * 4.0 + tp.x * 3.0) * 0.1\n                     + sin(u_time * 3.0 + tp.y * 4.0) * 0.1\n                     + sin(u_time * 5.0 + tp.z * 2.0) * 0.08;\n        float radius = 0.7 + wobble;\n        targetD = sdSphere(tp, radius);\n        \n        float bubbles = sin(tp.x * 8.0 + u_time * 2.0) \n                      * sin(tp.y * 8.0 + u_time * 1.5) \n                      * sin(tp.z * 8.0 + u_time * 2.5) * 0.05;\n        targetD += bubbles;\n        matId = 4;\n      }\n      \n      if (targetD < d) {\n        d = targetD;\n        materialId = matId;\n      }\n    }\n  }\n  \n  return d;\n}\n\n// === RAY MARCHING ===\nfloat rayMarch(vec3 ro, vec3 rd) {\n  float d = 0.0;\n  for (int i = 0; i < MAX_STEPS; i++) {\n    vec3 p = ro + rd * d;\n    float dist = map(p);\n    d += dist * 0.9; // Небольшой overrelaxation для скорости\n    if (dist < SURF_DIST || d > MAX_DIST) break;\n  }\n  return d;\n}\n\nvec3 getNormal(vec3 p) {\n  vec2 e = vec2(0.02, 0.0); // Грубее но быстрее\n  return normalize(vec3(\n    map(p + e.xyy) - map(p - e.xyy),\n    map(p + e.yxy) - map(p - e.yxy),\n    map(p + e.yyx) - map(p - e.yyx)\n  ));\n}\n\n// === КАУСТИКИ ===\nfloat caustics(vec2 p, float t) {\n  float c = 0.0;\n  for (float i = 1.0; i <= 3.0; i++) {\n    vec2 uv = p * (1.0 + i * 0.3);\n    uv += vec2(sin(t * 0.3 + i), cos(t * 0.4 + i * 1.1)) * 0.5;\n    c += pow(0.5 + 0.5 * sin(noise(uv) * 6.0), 4.0);\n  }\n  return c / 3.0;\n}\n\n// === ЗВЁЗДНОЕ НЕБО (через купол) ===\nvec3 renderSky(vec3 rd) {\n  vec3 color = vec3(0.02, 0.03, 0.08);\n  \n  // Звёзды\n  vec2 skyUV = rd.xz / (rd.y + 0.5);\n  for (float i = 0.0; i < 50.0; i++) {\n    vec2 starPos = vec2(hash(vec2(i, 0.0)), hash(vec2(i, 1.0))) * 4.0 - 2.0;\n    float star = 0.002 / (length(skyUV - starPos) + 0.002);\n    star *= step(0.7, hash(vec2(i, 2.0)));\n    color += vec3(1.0, 0.95, 0.9) * star * 0.3;\n  }\n  \n  // Луна\n  vec3 moonDir = normalize(vec3(0.5, 0.8, -0.3));\n  float moon = smoothstep(0.98, 0.99, dot(rd, moonDir));\n  color += vec3(1.0, 0.98, 0.95) * moon * 2.0;\n  \n  // Свечение вокруг луны\n  float moonGlow = pow(max(0.0, dot(rd, moonDir)), 32.0);\n  color += vec3(0.3, 0.35, 0.5) * moonGlow * 0.5;\n  \n  return color;\n}\n\n// === ЭФФЕКТ ДОЖДЯ И МОЛНИЙ ===\n\n// Функция для вертикальных линий дождя\nfloat rainStreak(vec2 uv, float speed, float density, float seed) {\n  vec2 st = uv * vec2(density, 1.0);\n  st.y = st.y * 0.1 - u_time * speed;\n  \n  float id = floor(st.x);\n  float x = fract(st.x);\n  float y = fract(st.y + fract(sin(id * seed) * 1000.0));\n  \n  // Тонкая вертикальная линия\n  float streak = smoothstep(0.45, 0.5, x) * smoothstep(0.55, 0.5, x);\n  // Ограничиваем длину капли\n  streak *= smoothstep(0.0, 0.02, y) * smoothstep(0.15, 0.08, y);\n  // Случайность появления\n  streak *= step(0.7, fract(sin(id * 127.1 + seed) * 43758.5453));\n  \n  return streak;\n}\n\n// Функция молнии\nfloat lightning(vec2 uv, float time, float seed) {\n  // Позиция молнии по X (меняется каждые несколько секунд)\n  float strikeTime = floor(time * 0.3 + seed);\n  float strikeX = fract(sin(strikeTime * 127.1 + seed) * 43758.5453) * 2.0 - 1.0;\n  \n  // Фаза молнии (0-1 в пределах удара)\n  float phase = fract(time * 0.3 + seed);\n  \n  // Молния видна только короткое время\n  float visible = smoothstep(0.7, 0.75, phase) * smoothstep(0.95, 0.85, phase);\n  \n  // Основной канал молнии с зигзагами\n  float bolt = 0.0;\n  float x = strikeX;\n  float segments = 8.0;\n  \n  for (float i = 0.0; i < segments; i++) {\n    float segY = 1.0 - i / segments;\n    float nextY = 1.0 - (i + 1.0) / segments;\n    \n    // Случайное смещение для зигзага\n    float nextX = x + (fract(sin((strikeTime + i) * 73.7) * 43758.5453) - 0.5) * 0.3;\n    \n    // Проверяем попадает ли пиксель в сегмент\n    if (uv.y < segY && uv.y > nextY) {\n      float t = (segY - uv.y) / (segY - nextY);\n      float lineX = mix(x, nextX, t);\n      float dist = abs(uv.x - lineX);\n      \n      // Яркое ядро + свечение\n      bolt += smoothstep(0.02, 0.0, dist) * 2.0;\n      bolt += smoothstep(0.08, 0.0, dist) * 0.5;\n    }\n    x = nextX;\n  }\n  \n  return bolt * visible;\n}\n\n// Предупреждающее свечение перед молнией\nfloat lightningWarning(vec2 uv, float time, float seed) {\n  float strikeTime = floor(time * 0.3 + seed);\n  float strikeX = fract(sin(strikeTime * 127.1 + seed) * 43758.5453) * 2.0 - 1.0;\n  float phase = fract(time * 0.3 + seed);\n  \n  // Свечение появляется перед ударом (фаза 0.5-0.7)\n  float warning = smoothstep(0.5, 0.6, phase) * smoothstep(0.75, 0.65, phase);\n  \n  // Пульсация\n  warning *= 0.5 + 0.5 * sin(time * 20.0);\n  \n  // Область свечения сверху\n  float glow = smoothstep(0.3, 1.0, uv.y);\n  glow *= smoothstep(0.5, 0.0, abs(uv.x - strikeX));\n  \n  return glow * warning;\n}\n\n// Кислотный дождь - ОПТИМИЗИРОВАНО\nvec3 renderAcidRain(vec2 uv, vec3 color, float time, vec3 camPos) {\n  if (u_acidRainZoneCount == 0) return color;\n  \n  vec3 result = color;\n  float totalIntensity = 0.0;\n  \n  // Проверяем только ближайшую активную зону\n  for (int i = 0; i < u_acidRainZoneCount; i++) {\n    if (i >= 4) break;\n    vec4 zone = u_acidRainZones[i];\n    if (zone.w >= 1.0) {\n      float dist = length(camPos.xz - zone.xy);\n      float intensity = 1.0 - smoothstep(0.0, zone.z * 2.0, dist);\n      totalIntensity = max(totalIntensity, intensity);\n    }\n  }\n  \n  if (totalIntensity > 0.01) {\n    // Простые быстрые капли (один расчёт)\n    float dropY1 = fract(uv.y * 6.0 - time * 30.0);\n    float dropX1 = fract(uv.x * 6.0);\n    float streak1 = step(0.1, dropY1) * step(dropY1, 0.5) * step(0.45, dropX1) * step(dropX1, 0.55);\n    \n    float dropY2 = fract(uv.y * 10.0 - time * 25.0 + 0.3);\n    float dropX2 = fract(uv.x * 10.0 + 0.1);\n    float streak2 = step(0.15, dropY2) * step(dropY2, 0.4) * step(0.47, dropX2) * step(dropX2, 0.53);\n    \n    float drops = (streak1 + streak2 * 0.6) * totalIntensity;\n    \n    // Зелёное свечение\n    result += vec3(0.2, 1.0, 0.3) * drops * 2.0;\n    result = mix(result, result * vec3(0.7, 1.2, 0.8), totalIntensity * 0.3);\n  }\n  \n  return result;\n}\n\nvec3 renderRain(vec2 uv, vec3 color, float time) {\n  // Нормализуем UV для эффектов\n  vec2 screenUV = uv;\n  \n  // === ДОЖДЬ ===\n  float rain = 0.0;\n  \n  // Слой 1 - крупные яркие капли (передний план)\n  rain += rainStreak(screenUV, 3.0, 80.0, 1.0) * 0.8;\n  rain += rainStreak(screenUV + vec2(0.1, 0.0), 3.5, 90.0, 2.0) * 0.7;\n  \n  // Слой 2 - средние капли\n  rain += rainStreak(screenUV, 2.5, 120.0, 3.0) * 0.5;\n  rain += rainStreak(screenUV + vec2(0.05, 0.0), 2.8, 140.0, 4.0) * 0.4;\n  \n  // Слой 3 - мелкие капли (задний план)\n  rain += rainStreak(screenUV, 2.0, 200.0, 5.0) * 0.3;\n  \n  // Цвет дождя - яркий голубой\n  vec3 rainColor = vec3(0.6, 0.8, 1.0);\n  color += rainColor * rain;\n  \n  // === МОЛНИИ ===\n  // Несколько независимых молний с разным таймингом\n  float bolt1 = lightning(screenUV, time, 0.0);\n  float bolt2 = lightning(screenUV, time, 3.7);\n  float bolt3 = lightning(screenUV, time, 7.3);\n  \n  float totalBolt = bolt1 + bolt2 + bolt3;\n  \n  // Цвет молнии - яркий бело-голубой\n  vec3 boltColor = vec3(0.8, 0.9, 1.0);\n  color += boltColor * totalBolt;\n  \n  // Вспышка освещения при ударе молнии\n  float flash = max(bolt1, max(bolt2, bolt3));\n  color = mix(color, vec3(0.9, 0.95, 1.0), flash * 0.3);\n  \n  // === ПРЕДУПРЕЖДАЮЩЕЕ СВЕЧЕНИЕ ===\n  float warn1 = lightningWarning(screenUV, time, 0.0);\n  float warn2 = lightningWarning(screenUV, time, 3.7);\n  float warn3 = lightningWarning(screenUV, time, 7.3);\n  \n  float totalWarning = warn1 + warn2 + warn3;\n  \n  // Жёлто-белое свечение предупреждения\n  vec3 warningColor = vec3(1.0, 0.95, 0.7);\n  color += warningColor * totalWarning * 0.4;\n  \n  // === АТМОСФЕРА ШТОРМА ===\n  // Тёмное грозовое небо\n  color = mix(color, vec3(0.08, 0.1, 0.15), 0.2);\n  \n  return color;\n}\n\n// === ГЛАВНАЯ ===\nvoid main() {\n  vec2 uv = (v_uv - 0.5) * 2.0;\n  uv.x *= u_resolution.x / u_resolution.y;\n  \n  vec3 ro = u_cameraPos;\n  \n  float cy = cos(u_cameraYaw);\n  float sy = sin(u_cameraYaw);\n  float cp = cos(u_cameraPitch);\n  float sp = sin(u_cameraPitch);\n  \n  vec3 forward = vec3(sy * cp, sp, -cy * cp);\n  vec3 right = vec3(cy, 0.0, sy);\n  vec3 up = cross(right, forward);\n  \n  vec3 rd = normalize(forward + uv.x * right + uv.y * up);\n  \n  float d = rayMarch(ro, rd);\n  \n  // Фоновый цвет (небо через купол)\n  vec3 color = renderSky(rd) * 0.3;\n  \n  if (d < MAX_DIST) {\n    vec3 p = ro + rd * d;\n    vec3 n = getNormal(p);\n    \n    map(p);\n    int mat = materialId;\n    \n    // === ОСВЕЩЕНИЕ ПО ЭПОХАМ ===\n    vec3 ambient;\n    vec3 mainLight;\n    vec3 accentColor;\n    vec3 fogColor;\n    \n    if (u_era == 1) {\n      // ЭПОХА 1: Кислотная (зелёная токсичная)\n      ambient = vec3(0.08, 0.15, 0.08);\n      mainLight = vec3(0.3, 0.8, 0.3); // Зелёный свет\n      accentColor = vec3(0.5, 1.0, 0.3); // Кислотный\n      fogColor = vec3(0.02, 0.08, 0.02);\n    } else if (u_era == 2) {\n      // ЭПОХА 2: Чёрная дыра (тёмно-фиолетовая)\n      ambient = vec3(0.06, 0.04, 0.12);\n      mainLight = vec3(0.5, 0.3, 0.8); // Фиолетовый\n      accentColor = vec3(0.8, 0.2, 1.0); // Пурпурный\n      fogColor = vec3(0.03, 0.01, 0.06);\n    } else {\n      // ЭПОХА 3: Космическая (синяя технологичная)\n      ambient = vec3(0.08, 0.12, 0.18);\n      mainLight = vec3(0.4, 0.7, 1.0); // Синий\n      accentColor = vec3(0.2, 0.8, 1.0); // Циан\n      fogColor = vec3(0.01, 0.03, 0.08);\n    }\n    \n    // Основной свет сверху\n    float mainDot = max(dot(n, vec3(0.3, 0.9, -0.2)), 0.0);\n    \n    // Один тёплый источник (факел) - цвет меняется по эпохе\n    vec3 torchPos = vec3(0.0, 8.0, 0.0);\n    vec3 toTorch = torchPos - p;\n    float torchDist = length(toTorch);\n    float atten = 25.0 / (1.0 + torchDist * 0.05 + torchDist * torchDist * 0.008);\n    vec3 torchLight = accentColor * max(dot(n, normalize(toTorch)), 0.0) * atten;\n    \n    // Подсветка бассейна - цвет по эпохе\n    float distFromCenter = length(p.xz);\n    float poolInfluence = 1.0 - smoothstep(0.0, 15.0, distFromCenter);\n    vec3 poolLight = accentColor * poolInfluence * 2.0;\n    \n    // === МАТЕРИАЛЫ (упрощённые) ===\n    if (mat == 1) {\n      // === ВОДА (простая) ===\n      vec3 waterColor = vec3(0.2, 0.55, 0.7);\n      waterColor += poolLight;\n      float fresnel = pow(1.0 - max(0.0, dot(-rd, n)), 2.0);\n      color = mix(waterColor, vec3(0.5, 0.8, 0.9), fresnel * 0.3);\n      \n    } else if (mat == 4) {\n      // === БЕЙНЛИНГИ (зелёная кислотная жижа) ===\n      vec3 acidGreen = vec3(0.2, 0.9, 0.1);\n      vec3 darkGreen = vec3(0.0, 0.4, 0.0);\n      \n      float pulse = 0.7 + 0.3 * sin(u_time * 4.0 + p.x * 2.0);\n      float pulse2 = 0.8 + 0.2 * sin(u_time * 6.0 + p.z * 3.0);\n      float glow = 0.5 + 0.5 * sin(u_time * 3.0);\n      \n      color = mix(darkGreen, acidGreen, pulse * pulse2);\n      color += vec3(0.3, 1.0, 0.2) * glow * 0.5;\n      color *= 1.5;\n      \n      float fresnel = pow(1.0 - max(0.0, dot(-rd, n)), 3.0);\n      color = mix(color, vec3(0.5, 1.0, 0.3), fresnel * 0.4);\n      \n    } else if (mat == 5) {\n      // === ФАНТОМ (чёрный шар с тёмной энергией) ===\n      vec3 voidBlack = vec3(0.02, 0.02, 0.05);\n      vec3 darkPurple = vec3(0.1, 0.0, 0.15);\n      \n      float flicker = 0.6 + 0.4 * sin(u_time * 12.0 + p.x * 5.0);\n      float flicker2 = 0.7 + 0.3 * sin(u_time * 15.0 + p.z * 4.0);\n      \n      color = mix(voidBlack, darkPurple, flicker * flicker2 * 0.3);\n      \n      float fresnel = pow(1.0 - max(0.0, dot(-rd, n)), 2.0);\n      vec3 edgeGlow = vec3(0.3, 0.0, 0.5) * fresnel * 0.8;\n      color += edgeGlow;\n      \n      float spark = sin(u_time * 20.0 + p.y * 10.0) * sin(u_time * 18.0 + p.x * 8.0);\n      if (spark > 0.9) {\n        color += vec3(0.5, 0.2, 0.8) * 0.5;\n      }\n      color *= 0.6;\n      \n    } else if (mat == 6) {\n      // === RUNNER (оранжевый, огненный) ===\n      vec3 orange = vec3(1.0, 0.5, 0.0);\n      vec3 yellow = vec3(1.0, 0.9, 0.2);\n      vec3 red = vec3(1.0, 0.2, 0.0);\n      \n      // Быстрое мерцание как пламя\n      float flame = 0.5 + 0.5 * sin(u_time * 20.0 + p.x * 8.0);\n      float flame2 = 0.6 + 0.4 * sin(u_time * 25.0 + p.z * 10.0);\n      \n      color = mix(red, orange, flame);\n      color = mix(color, yellow, flame2 * 0.4);\n      color *= 1.8; // Яркий!\n      \n      // Свечение по краям\n      float fresnel = pow(1.0 - max(0.0, dot(-rd, n)), 2.0);\n      color += vec3(1.0, 0.8, 0.3) * fresnel * 0.6;\n      \n    } else if (mat == 7) {\n      // === HOPPER (синий, электрический) ===\n      vec3 cyan = vec3(0.0, 0.8, 1.0);\n      vec3 blue = vec3(0.1, 0.3, 1.0);\n      vec3 white = vec3(0.9, 0.95, 1.0);\n      \n      // Электрические разряды\n      float spark1 = sin(u_time * 30.0 + p.y * 15.0);\n      float spark2 = sin(u_time * 35.0 + p.x * 12.0);\n      float electric = spark1 * spark2;\n      \n      color = mix(blue, cyan, 0.5 + 0.5 * sin(u_time * 8.0));\n      \n      // Яркие вспышки\n      if (electric > 0.8) {\n        color = mix(color, white, 0.7);\n      }\n      color *= 1.5;\n      \n      // Свечение\n      float fresnel = pow(1.0 - max(0.0, dot(-rd, n)), 2.5);\n      color += vec3(0.3, 0.6, 1.0) * fresnel * 0.8;\n      \n    } else if (mat == 10) {\n      // === ЗЕЛЁНЫЙ БОСС (огромная токсичная жижа) ===\n      vec3 toxicGreen = vec3(0.1, 0.9, 0.2);\n      vec3 darkGreen = vec3(0.0, 0.4, 0.1);\n      vec3 yellow = vec3(0.8, 1.0, 0.0);\n      \n      // Пульсирующее ядовитое свечение\n      float pulse = 0.6 + 0.4 * sin(u_time * 3.0);\n      color = mix(darkGreen, toxicGreen, pulse);\n      \n      // Пузыри на поверхности\n      float bubbles = sin(p.x * 6.0 + u_time * 4.0) * sin(p.z * 6.0 + u_time * 3.0);\n      if (bubbles > 0.7) {\n        color = mix(color, yellow, 0.5);\n      }\n      \n      // Яркое свечение\n      float fresnel = pow(1.0 - max(0.0, dot(-rd, n)), 2.0);\n      color += toxicGreen * fresnel * 1.5;\n      color *= 2.0; // Очень яркий!\n      \n    } else if (mat == 11) {\n      // === ЧЁРНЫЙ БОСС (искривляет пространство) ===\n      vec3 voidBlack = vec3(0.02, 0.0, 0.05);\n      vec3 purple = vec3(0.4, 0.0, 0.6);\n      vec3 darkPurple = vec3(0.15, 0.0, 0.25);\n      \n      // Почти чёрный с пурпурным мерцанием\n      float darkPulse = sin(u_time * 2.0 + p.y * 3.0) * 0.5 + 0.5;\n      color = mix(voidBlack, darkPurple, darkPulse * 0.3);\n      \n      // Искривление видно как переливы\n      float distortion = sin(u_time * 5.0 + p.x * 8.0) * sin(u_time * 4.0 + p.z * 8.0);\n      if (distortion > 0.6) {\n        color += purple * 0.3;\n      }\n      \n      // Жуткое свечение по краям\n      float fresnel = pow(1.0 - max(0.0, dot(-rd, n)), 4.0);\n      color += purple * fresnel * 2.0;\n      \n      // Звёзды внутри (как чёрная дыра)\n      float stars = sin(p.x * 30.0) * sin(p.y * 30.0) * sin(p.z * 30.0);\n      if (stars > 0.95) {\n        color += vec3(1.0, 1.0, 1.0) * 0.5;\n      }\n      \n    } else if (mat == 12) {\n      // === СИНИЙ БОСС (телепортирующийся) ===\n      vec3 electricBlue = vec3(0.0, 0.5, 1.0);\n      vec3 cyan = vec3(0.0, 1.0, 1.0);\n      vec3 white = vec3(1.0, 1.0, 1.0);\n      \n      // Мерцание (телепорт эффект)\n      float flicker = abs(sin(u_time * 25.0));\n      color = mix(electricBlue, cyan, flicker);\n      \n      // Разряды\n      float spark = sin(u_time * 50.0 + p.x * 20.0) * sin(u_time * 45.0 + p.y * 20.0);\n      if (spark > 0.85) {\n        color = white;\n      }\n      \n      // Призрачность\n      float ghost = sin(u_time * 8.0) * 0.3 + 0.7;\n      color *= ghost;\n      \n      // Яркое свечение\n      float fresnel = pow(1.0 - max(0.0, dot(-rd, n)), 2.0);\n      color += cyan * fresnel * 1.5;\n      color *= 1.8;\n      \n    } else if (mat == 13) {\n      // === ТОКСИЧНАЯ ЛУЖА ===\n      vec3 toxicGreen = vec3(0.2, 1.0, 0.3);\n      vec3 darkGreen = vec3(0.0, 0.3, 0.1);\n      \n      // Пульсирующий эффект\n      float pulse = 0.5 + 0.5 * sin(u_time * 4.0 + p.x * 2.0 + p.z * 2.0);\n      color = mix(darkGreen, toxicGreen, pulse);\n      \n      // Пузыри\n      float bubbles = sin(p.x * 10.0 + u_time * 5.0) * sin(p.z * 10.0 + u_time * 4.0);\n      if (bubbles > 0.7) {\n        color += vec3(0.3, 0.5, 0.1);\n      }\n      \n      // Яркое свечение\n      color *= 2.0;\n      \n    } else if (mat == 14) {\n      // === АПТЕЧКА ===\n      // Красный крест с белым свечением\n      vec3 healthRed = vec3(1.0, 0.2, 0.2);\n      vec3 healthWhite = vec3(1.0, 0.9, 0.9);\n      \n      // Пульсация\n      float pulse = 0.7 + 0.3 * sin(u_time * 5.0);\n      color = mix(healthRed, healthWhite, pulse * 0.3);\n      \n      // Яркое свечение\n      color *= 2.5;\n      \n    } else if (mat == 15) {\n      // === СТИМПАК ===\n      // Жёлто-оранжевый энергетический шар\n      vec3 stimYellow = vec3(1.0, 0.8, 0.2);\n      vec3 stimOrange = vec3(1.0, 0.5, 0.1);\n      \n      // Быстрая пульсация\n      float pulse = 0.5 + 0.5 * sin(u_time * 8.0);\n      color = mix(stimOrange, stimYellow, pulse);\n      \n      // Электрические искры\n      float spark = fract(sin(dot(p.xz + u_time * 10.0, vec2(12.9898, 78.233))) * 43758.5453);\n      if (spark > 0.95) {\n        color += vec3(1.0, 1.0, 0.5);\n      }\n      \n      // Яркое свечение\n      color *= 2.5;\n      \n    } else if (mat == 16) {\n      // === БАЛКОН ===\n      vec3 balconyColor = vec3(0.3, 0.25, 0.4); // Тёмно-фиолетовый\n      \n      // Светящиеся линии\n      float gridX = step(0.9, fract(p.x * 2.0));\n      float gridZ = step(0.9, fract(p.z * 2.0));\n      float grid = max(gridX, gridZ);\n      \n      color = mix(balconyColor, accentColor, grid * 0.5);\n      color += accentColor * 0.1; // Лёгкое свечение\n      \n    } else if (mat == 17) {\n      // === ЗАРЯД КАТАНЫ (энергетическая сфера) ===\n      vec3 chargeColor1 = vec3(0.0, 0.8, 1.0); // Бирюзовый\n      vec3 chargeColor2 = vec3(0.0, 1.0, 1.0); // Циан\n      vec3 chargeColor3 = vec3(0.5, 0.8, 1.0); // Светло-голубой\n      \n      // Интенсивная пульсация\n      float pulse = 0.5 + 0.5 * sin(u_time * 6.0);\n      float pulse2 = 0.5 + 0.5 * sin(u_time * 8.0 + 1.0);\n      color = mix(chargeColor1, chargeColor2, pulse);\n      color = mix(color, chargeColor3, pulse2 * 0.3);\n      \n      // Электрические разряды\n      float spark = fract(sin(dot(p.xy + u_time * 10.0, vec2(12.9898, 78.233))) * 43758.5453);\n      if (spark > 0.85) {\n        color += vec3(1.0, 1.0, 1.0); // Белые искры\n      }\n      \n      // Вращающиеся кольца энергии\n      float ring = sin(atan(p.y, p.x) * 3.0 + u_time * 5.0);\n      color += chargeColor2 * max(0.0, ring) * 0.3;\n      \n      // Очень яркое свечение\n      color *= 4.0;\n      \n    } else if (mat == 18) {\n      // === ЧЁРНЫЙ КРИСТАЛЛ СИЛЫ ===\n      vec3 crystalBase = vec3(0.05, 0.02, 0.1); // Очень тёмный фиолетовый\n      vec3 crystalGlow = vec3(0.3, 0.0, 0.5); // Фиолетовое свечение\n      vec3 crystalEdge = vec3(0.8, 0.2, 1.0); // Яркие края\n      \n      // Пульсация\n      float pulse = 0.5 + 0.5 * sin(u_time * 3.0);\n      \n      // Эффект внутреннего свечения\n      float fresnel = pow(1.0 - abs(dot(n, -rd)), 3.0);\n      \n      // Энергетические линии на гранях\n      float edge = fract(p.x * 5.0 + p.y * 5.0 + u_time * 2.0);\n      edge = smoothstep(0.8, 1.0, edge);\n      \n      color = crystalBase;\n      color += crystalGlow * fresnel * 2.0;\n      color += crystalEdge * edge * 0.5;\n      color += crystalGlow * pulse * 0.3;\n      \n      // Искры внутри\n      float spark = fract(sin(dot(p.xyz + u_time * 5.0, vec3(12.9898, 78.233, 45.164))) * 43758.5453);\n      if (spark > 0.95) {\n        color += vec3(1.0, 0.5, 1.0); // Розовые искры\n      }\n      \n      // Общее свечение\n      color *= 2.5;\n      \n    } else if (mat == 19) {\n      // === СНАРЯД КИСЛОТЫ ===\n      vec3 acidCore = vec3(0.2, 1.0, 0.3);\n      vec3 acidGlow = vec3(0.5, 1.0, 0.2);\n      vec3 acidDark = vec3(0.1, 0.4, 0.1);\n      \n      float bubble = sin(p.x * 20.0 + u_time * 15.0) * \n                    sin(p.y * 20.0 + u_time * 12.0) * \n                    sin(p.z * 20.0 + u_time * 18.0);\n      bubble = bubble * 0.5 + 0.5;\n      \n      float veins = sin(p.x * 10.0 + p.y * 15.0 + u_time * 5.0);\n      veins = smoothstep(0.7, 1.0, veins);\n      \n      float fresnel = pow(1.0 - abs(dot(n, -rd)), 2.0);\n      \n      color = mix(acidDark, acidCore, bubble);\n      color += acidGlow * veins * 0.5;\n      color += acidGlow * fresnel * 2.0;\n      \n      float drip = sin(u_time * 8.0 + p.y * 10.0);\n      color *= 0.8 + 0.2 * drip;\n      color *= 3.0;\n      \n    } else if (mat == 20) {\n      // === МЕТКА ДОЖДЯ (оптимизировано) ===\n      float pulse = sin(u_time * 10.0) * 0.5 + 0.5;\n      color = mix(vec3(1.0, 0.2, 0.0), vec3(0.3, 1.0, 0.2), pulse);\n      color *= 4.0;\n      \n    } else {\n      // === ПОЛ / СТЕНЫ ===\n      vec3 baseColor = vec3(0.15, 0.14, 0.12);\n      \n      // Простая плитка\n      if (abs(n.y) > 0.9) {\n        vec2 tile = fract(p.xz * 0.25);\n        float tileEdge = step(0.04, min(min(tile.x, tile.y), min(1.0 - tile.x, 1.0 - tile.y)));\n        baseColor *= 0.8 + 0.2 * tileEdge;\n      }\n      \n      color = baseColor * ambient * 2.0;\n      color += baseColor * mainLight * mainDot * 0.5;\n      color += baseColor * torchLight * 1.2;\n      color += baseColor * poolLight * 1.0;\n    }\n    \n    // Вспышка от выстрела\n    if (u_muzzleFlash > 0.0) {\n      color += vec3(1.0, 0.7, 0.4) * u_muzzleFlash * 0.4;\n    }\n    \n    // Туман по эпохе\n    float fog = 1.0 - exp(-d * 0.02);\n    color = mix(color, fogColor, fog * 0.5);\n  }\n  \n  // Кислотный дождь от зелёного босса (всегда когда есть зоны)\n  if (u_acidRainZoneCount > 0) {\n    color = renderAcidRain(v_uv, color, u_time, u_cameraPos);\n  }\n  \n  // Эффект дождя на волне 15+\n  if (u_wave >= 15) {\n    color = renderRain(v_uv, color, u_time);\n  }\n  \n  // Тонмаппинг\n  color = color / (color + vec3(1.0));\n  color = pow(color, vec3(0.9));\n  \n  // Цветокоррекция - добавляем голубой оттенок для ночной атмосферы\n  color = mix(color, color * vec3(0.9, 0.95, 1.1), 0.25);\n  \n  // Небольшое насыщение\n  float gray = dot(color, vec3(0.299, 0.587, 0.114));\n  color = mix(vec3(gray), color, 1.15);\n  \n  // Виньетка\n  float vig = 1.0 - length(v_uv - 0.5) * 0.4;\n  color *= vig;\n  \n  fragColor = vec4(color, 1.0);\n}\n`;\n","import { VERTEX_SHADER, FRAGMENT_SHADER } from './Shaders';\nimport type { ShaderUniforms, Vec3 } from '@/types';\n\n/**\n * WebGL2 рендерер\n * Ray marching через фрагментный шейдер\n */\nexport class WebGLRenderer {\n  private gl: WebGL2RenderingContext;\n  private program: WebGLProgram | null = null;\n  private uniforms: ShaderUniforms;\n  private vao: WebGLVertexArrayObject | null = null;\n\n  /** Масштаб рендеринга (0-1) */\n  public renderScale = 0.75;\n\n  constructor(private canvas: HTMLCanvasElement) {\n    const gl = canvas.getContext('webgl2');\n    if (!gl) {\n      throw new Error('WebGL2 не поддерживается');\n    }\n    this.gl = gl;\n\n    this.uniforms = {\n      resolution: null,\n      time: null,\n      cameraPos: null,\n      cameraDir: null,\n      cameraYaw: null,\n      cameraPitch: null,\n      targets: null,\n      targetCount: null,\n      muzzleFlash: null,\n      pools: null,\n      poolCount: null,\n      acidProjectiles: null,\n      acidProjectileCount: null,\n      acidRainZones: null,\n      acidRainZoneCount: null,\n      era: null,\n      wave: null,\n      pickups: null,\n      pickupCount: null,\n      crystals: null,\n      crystalCount: null,\n    };\n\n    this.init();\n  }\n\n  /** Инициализация WebGL */\n  private init(): void {\n    const gl = this.gl;\n\n    // Компилируем шейдеры\n    const vertShader = this.compileShader(gl.VERTEX_SHADER, VERTEX_SHADER);\n    const fragShader = this.compileShader(gl.FRAGMENT_SHADER, FRAGMENT_SHADER);\n\n    if (!vertShader || !fragShader) {\n      throw new Error('Ошибка компиляции шейдеров');\n    }\n\n    // Создаём программу\n    this.program = gl.createProgram()!;\n    gl.attachShader(this.program, vertShader);\n    gl.attachShader(this.program, fragShader);\n    gl.linkProgram(this.program);\n\n    if (!gl.getProgramParameter(this.program, gl.LINK_STATUS)) {\n      throw new Error('Ошибка линковки: ' + gl.getProgramInfoLog(this.program));\n    }\n\n    // Получаем uniform locations\n    this.uniforms.resolution = gl.getUniformLocation(this.program, 'u_resolution');\n    this.uniforms.time = gl.getUniformLocation(this.program, 'u_time');\n    this.uniforms.cameraPos = gl.getUniformLocation(this.program, 'u_cameraPos');\n    this.uniforms.cameraYaw = gl.getUniformLocation(this.program, 'u_cameraYaw');\n    this.uniforms.cameraPitch = gl.getUniformLocation(this.program, 'u_cameraPitch');\n    this.uniforms.targets = gl.getUniformLocation(this.program, 'u_targets');\n    this.uniforms.targetCount = gl.getUniformLocation(this.program, 'u_targetCount');\n    this.uniforms.muzzleFlash = gl.getUniformLocation(this.program, 'u_muzzleFlash');\n    this.uniforms.pools = gl.getUniformLocation(this.program, 'u_pools');\n    this.uniforms.poolCount = gl.getUniformLocation(this.program, 'u_poolCount');\n    this.uniforms.acidProjectiles = gl.getUniformLocation(this.program, 'u_acidProjectiles');\n    this.uniforms.acidProjectileCount = gl.getUniformLocation(this.program, 'u_acidProjectileCount');\n    this.uniforms.acidRainZones = gl.getUniformLocation(this.program, 'u_acidRainZones');\n    this.uniforms.acidRainZoneCount = gl.getUniformLocation(this.program, 'u_acidRainZoneCount');\n    this.uniforms.era = gl.getUniformLocation(this.program, 'u_era');\n    this.uniforms.wave = gl.getUniformLocation(this.program, 'u_wave');\n    this.uniforms.pickups = gl.getUniformLocation(this.program, 'u_pickups');\n    this.uniforms.pickupCount = gl.getUniformLocation(this.program, 'u_pickupCount');\n    this.uniforms.crystals = gl.getUniformLocation(this.program, 'u_crystals');\n\n    // Создаём fullscreen quad\n    this.createQuad();\n  }\n\n  /** Компиляция шейдера */\n  private compileShader(type: number, source: string): WebGLShader | null {\n    const gl = this.gl;\n    const shader = gl.createShader(type);\n    if (!shader) return null;\n\n    gl.shaderSource(shader, source);\n    gl.compileShader(shader);\n\n    if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n      console.error('Ошибка шейдера:', gl.getShaderInfoLog(shader));\n      gl.deleteShader(shader);\n      return null;\n    }\n\n    return shader;\n  }\n\n  /** Создание fullscreen quad */\n  private createQuad(): void {\n    const gl = this.gl;\n\n    // Вершины квада (-1 до 1)\n    const vertices = new Float32Array([\n      -1, -1,\n       1, -1,\n      -1,  1,\n       1,  1,\n    ]);\n\n    // VAO\n    this.vao = gl.createVertexArray();\n    gl.bindVertexArray(this.vao);\n\n    // VBO\n    const vbo = gl.createBuffer();\n    gl.bindBuffer(gl.ARRAY_BUFFER, vbo);\n    gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);\n\n    // Атрибут позиции\n    const posLoc = gl.getAttribLocation(this.program!, 'a_position');\n    gl.enableVertexAttribArray(posLoc);\n    gl.vertexAttribPointer(posLoc, 2, gl.FLOAT, false, 0, 0);\n\n    gl.bindVertexArray(null);\n  }\n\n  /** Обновить размер canvas */\n  public resize(): void {\n    const dpr = window.devicePixelRatio || 1;\n    const width = Math.floor(this.canvas.clientWidth * dpr * this.renderScale);\n    const height = Math.floor(this.canvas.clientHeight * dpr * this.renderScale);\n\n    if (this.canvas.width !== width || this.canvas.height !== height) {\n      this.canvas.width = width;\n      this.canvas.height = height;\n      this.gl.viewport(0, 0, width, height);\n    }\n  }\n\n  /** Рендеринг кадра */\n  public render(\n    time: number,\n    cameraPos: Vec3,\n    cameraYaw: number,\n    cameraPitch: number,\n    targetsData: Float32Array,\n    targetCount: number,\n    muzzleFlash: number,\n    poolsData?: Float32Array,\n    poolCount?: number,\n    era?: number,\n    wave?: number,\n    pickupsData?: Float32Array,\n    pickupCount?: number,\n    crystalsData?: Float32Array,\n    acidProjectilesData?: Float32Array,\n    acidProjectileCount?: number,\n    acidRainZonesData?: Float32Array,\n    acidRainZoneCount?: number\n  ): void {\n    const gl = this.gl;\n\n    this.resize();\n\n    gl.useProgram(this.program);\n    gl.bindVertexArray(this.vao);\n\n    // Устанавливаем uniforms\n    gl.uniform2f(this.uniforms.resolution, this.canvas.width, this.canvas.height);\n    gl.uniform1f(this.uniforms.time, time);\n    gl.uniform3f(this.uniforms.cameraPos, cameraPos.x, cameraPos.y, cameraPos.z);\n    gl.uniform1f(this.uniforms.cameraYaw, cameraYaw);\n    gl.uniform1f(this.uniforms.cameraPitch, cameraPitch);\n    gl.uniform4fv(this.uniforms.targets, targetsData);\n    gl.uniform1i(this.uniforms.targetCount, targetCount);\n    gl.uniform1f(this.uniforms.muzzleFlash, muzzleFlash);\n    \n    // Лужи\n    if (poolsData && poolCount !== undefined) {\n      gl.uniform4fv(this.uniforms.pools, poolsData);\n      gl.uniform1i(this.uniforms.poolCount, poolCount);\n    } else {\n      gl.uniform1i(this.uniforms.poolCount, 0);\n    }\n\n    // Снаряды кислоты\n    if (acidProjectilesData && acidProjectileCount !== undefined && acidProjectileCount > 0) {\n      gl.uniform4fv(this.uniforms.acidProjectiles, acidProjectilesData);\n      gl.uniform1i(this.uniforms.acidProjectileCount, acidProjectileCount);\n    } else {\n      gl.uniform1i(this.uniforms.acidProjectileCount, 0);\n    }\n\n    // Зоны кислотного дождя\n    if (acidRainZonesData && acidRainZoneCount !== undefined && acidRainZoneCount > 0) {\n      gl.uniform4fv(this.uniforms.acidRainZones, acidRainZonesData);\n      gl.uniform1i(this.uniforms.acidRainZoneCount, acidRainZoneCount);\n    } else {\n      gl.uniform1i(this.uniforms.acidRainZoneCount, 0);\n    }\n    \n    // Эпоха (1-3)\n    gl.uniform1i(this.uniforms.era, era || 1);\n    \n    // Волна (для дождя на 15+)\n    gl.uniform1i(this.uniforms.wave, wave || 1);\n    \n    // Пикапы\n    if (pickupsData && pickupCount !== undefined) {\n      gl.uniform4fv(this.uniforms.pickups, pickupsData);\n      gl.uniform1i(this.uniforms.pickupCount, pickupCount);\n    } else {\n      gl.uniform1i(this.uniforms.pickupCount, 0);\n    }\n\n    // Кристаллы силы\n    if (crystalsData) {\n      gl.uniform4fv(this.uniforms.crystals, crystalsData);\n    }\n\n    // Рисуем\n    gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n  }\n\n  /** Уничтожить рендерер */\n  public destroy(): void {\n    if (this.program) {\n      this.gl.deleteProgram(this.program);\n    }\n  }\n}\n\n","/**\n * HUD для Samurai Pool Arena\n * Здоровье, волна, счёт, эффекты\n */\nexport class HUD {\n  private healthEl: HTMLElement | null;\n  private ammoEl: HTMLElement | null;\n  private fragsEl: HTMLElement | null;\n  private crosshairEl: HTMLElement | null;\n  private hitmarkerEl: HTMLElement | null;\n  private reloadEl: HTMLElement | null;\n  private waveEl: HTMLElement | null;\n  private messageEl: HTMLElement | null;\n  private damageOverlay: HTMLElement | null;\n  private weaponEl: HTMLElement | null;\n\n  constructor() {\n    this.healthEl = document.getElementById('health-value');\n    this.ammoEl = document.getElementById('ammo-value');\n    this.fragsEl = document.getElementById('frags-value');\n    this.crosshairEl = document.getElementById('crosshair');\n    this.hitmarkerEl = document.getElementById('hitmarker');\n    this.reloadEl = document.getElementById('reload-indicator');\n    \n    // Скрываем перезарядку - катане не нужна\n    if (this.reloadEl) {\n      this.reloadEl.style.display = 'none';\n    }\n    \n    // Создаём элементы для волн\n    this.waveEl = this.createWaveElement();\n    this.messageEl = this.createMessageElement();\n    this.damageOverlay = this.createDamageOverlay();\n    this.weaponEl = this.createWeaponElement();\n  }\n\n  /** Создать элемент волны */\n  private createWaveElement(): HTMLElement {\n    let el = document.getElementById('wave-indicator');\n    if (!el) {\n      el = document.createElement('div');\n      el.id = 'wave-indicator';\n      el.style.cssText = `\n        position: fixed;\n        top: 15%;\n        left: 50%;\n        transform: translateX(-50%) scale(0.9);\n        font-family: 'Orbitron', sans-serif;\n        font-size: 28px;\n        font-weight: 700;\n        color: #00ffff;\n        text-shadow: \n          0 0 10px #00ffff,\n          0 0 20px rgba(0, 255, 255, 0.5);\n        opacity: 0;\n        padding: 12px 30px;\n        border: 2px solid rgba(255, 0, 255, 0.6);\n        border-radius: 4px;\n        box-shadow: \n          0 0 15px rgba(255, 0, 255, 0.3),\n          inset 0 0 20px rgba(0, 255, 255, 0.05);\n        background: linear-gradient(180deg, \n          rgba(0, 0, 20, 0.85) 0%,\n          rgba(10, 0, 30, 0.9) 100%\n        );\n        backdrop-filter: blur(5px);\n        transition: opacity 0.2s, transform 0.2s;\n        pointer-events: none;\n        z-index: 1000;\n        letter-spacing: 4px;\n      `;\n      \n      // Тонкие угловые акценты\n      const corners = ['top-left', 'top-right', 'bottom-left', 'bottom-right'];\n      corners.forEach(corner => {\n        const cornerEl = document.createElement('div');\n        const [v, h] = corner.split('-');\n        cornerEl.style.cssText = `\n          position: absolute;\n          ${v}: -2px;\n          ${h}: -2px;\n          width: 12px;\n          height: 12px;\n          border-${v}: 2px solid #00ffff;\n          border-${h}: 2px solid #00ffff;\n        `;\n        el!.appendChild(cornerEl);\n      });\n      \n      document.body.appendChild(el);\n    }\n    return el;\n  }\n\n  /** Создать элемент сообщений */\n  private createMessageElement(): HTMLElement {\n    let el = document.getElementById('game-message');\n    if (!el) {\n      el = document.createElement('div');\n      el.id = 'game-message';\n      el.style.cssText = `\n        position: fixed;\n        top: 50%;\n        left: 50%;\n        transform: translate(-50%, -50%);\n        font-family: 'Orbitron', sans-serif;\n        font-size: 36px;\n        font-weight: 700;\n        color: #ff0044;\n        text-shadow: \n          0 0 15px #ff0044,\n          0 0 30px rgba(255, 0, 68, 0.4);\n        opacity: 0;\n        padding: 25px 50px;\n        border: 2px solid rgba(255, 0, 68, 0.7);\n        border-radius: 4px;\n        box-shadow: \n          0 0 20px rgba(255, 0, 68, 0.4),\n          inset 0 0 30px rgba(255, 0, 68, 0.05);\n        background: linear-gradient(180deg, \n          rgba(20, 0, 5, 0.9) 0%,\n          rgba(30, 0, 10, 0.95) 100%\n        );\n        backdrop-filter: blur(5px);\n        transition: opacity 0.4s;\n        pointer-events: none;\n        text-align: center;\n        z-index: 1000;\n        letter-spacing: 4px;\n      `;\n      \n      // Угловые декорации\n      const corners = ['top-left', 'top-right', 'bottom-left', 'bottom-right'];\n      corners.forEach(corner => {\n        const cornerEl = document.createElement('div');\n        const [v, h] = corner.split('-');\n        cornerEl.style.cssText = `\n          position: absolute;\n          ${v}: -2px;\n          ${h}: -2px;\n          width: 15px;\n          height: 15px;\n          border-${v}: 2px solid #ff0044;\n          border-${h}: 2px solid #ff0044;\n        `;\n        el!.appendChild(cornerEl);\n      });\n      \n      document.body.appendChild(el);\n    }\n    return el;\n  }\n\n  /** Создать оверлей урона */\n  private createDamageOverlay(): HTMLElement {\n    let el = document.getElementById('damage-overlay');\n    if (!el) {\n      el = document.createElement('div');\n      el.id = 'damage-overlay';\n      el.style.cssText = `\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: radial-gradient(circle, \n          rgba(0, 255, 0, 0.3) 0%,\n          rgba(50, 255, 50, 0.4) 30%,\n          rgba(0, 150, 0, 0.5) 70%,\n          rgba(0, 100, 0, 0.6) 100%\n        );\n        opacity: 0;\n        transition: opacity 0.15s;\n        pointer-events: none;\n        z-index: 999;\n      `;\n      document.body.appendChild(el);\n    }\n    return el;\n  }\n\n  /** Создать элемент оружия */\n  private createWeaponElement(): HTMLElement {\n    let el = document.getElementById('weapon-indicator');\n    if (!el) {\n      el = document.createElement('div');\n      el.id = 'weapon-indicator';\n      el.style.cssText = `\n        position: fixed;\n        bottom: 90px;\n        right: 20px;\n        font-family: 'Orbitron', sans-serif;\n        font-size: 16px;\n        font-weight: 700;\n        color: #00ffff;\n        text-shadow: 0 0 10px currentColor;\n        padding: 8px 15px;\n        border: 1px solid rgba(0, 255, 255, 0.5);\n        border-radius: 4px;\n        background: rgba(0, 0, 0, 0.6);\n        z-index: 100;\n      `;\n      el.textContent = '⚔️ КАТАНА';\n      document.body.appendChild(el);\n    }\n    return el;\n  }\n\n  /** Обновить индикатор оружия */\n  public updateWeapon(weapon: 'katana' | 'axe', charges?: number): void {\n    if (this.weaponEl) {\n      if (weapon === 'katana') {\n        this.weaponEl.textContent = '⚔️ КАТАНА';\n        this.weaponEl.style.color = '#00ffff';\n        this.weaponEl.style.borderColor = 'rgba(0, 255, 255, 0.5)';\n      } else {\n        this.weaponEl.textContent = `🪓 ТОПОР (${charges})`;\n        this.weaponEl.style.color = '#ff8800';\n        this.weaponEl.style.borderColor = 'rgba(255, 136, 0, 0.5)';\n        \n        // Мигание при малом количестве зарядов\n        if (charges !== undefined && charges <= 2) {\n          this.weaponEl.style.animation = 'pulse 0.5s infinite';\n        } else {\n          this.weaponEl.style.animation = 'none';\n        }\n      }\n    }\n  }\n\n  /** Оверлей замедления */\n  private slowOverlay: HTMLElement | null = null;\n\n  /** Показать урон с определённым цветом */\n  public showDamage(color: 'green' | 'purple' = 'green'): void {\n    if (this.damageOverlay) {\n      if (color === 'purple') {\n        // Фиолетовый для фантома + ЗАМЕДЛЕНИЕ\n        this.damageOverlay.style.background = `radial-gradient(circle, \n          rgba(100, 0, 150, 0.3) 0%,\n          rgba(80, 0, 120, 0.4) 30%,\n          rgba(50, 0, 80, 0.5) 70%,\n          rgba(30, 0, 50, 0.6) 100%\n        )`;\n        // Показываем оверлей замедления\n        this.showSlowdown(2.0);\n      } else {\n        // Зелёный для бейнлинга\n        this.damageOverlay.style.background = `radial-gradient(circle, \n          rgba(0, 255, 0, 0.3) 0%,\n          rgba(50, 255, 50, 0.4) 30%,\n          rgba(0, 150, 0, 0.5) 70%,\n          rgba(0, 100, 0, 0.6) 100%\n        )`;\n      }\n      this.damageOverlay.style.opacity = '1';\n      setTimeout(() => {\n        if (this.damageOverlay) this.damageOverlay.style.opacity = '0';\n      }, 150);\n    }\n  }\n\n  /** Показать эффект замедления */\n  public showSlowdown(duration: number): void {\n    if (!this.slowOverlay) {\n      this.slowOverlay = document.createElement('div');\n      this.slowOverlay.id = 'slow-overlay';\n      this.slowOverlay.style.cssText = `\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: radial-gradient(circle,\n          transparent 0%,\n          rgba(50, 0, 80, 0.2) 50%,\n          rgba(30, 0, 60, 0.4) 100%\n        );\n        pointer-events: none;\n        z-index: 998;\n        opacity: 0;\n        transition: opacity 0.3s;\n      `;\n      document.body.appendChild(this.slowOverlay);\n    }\n\n    this.slowOverlay.style.opacity = '1';\n    \n    // Эффект пульсации\n    this.slowOverlay.animate([\n      { filter: 'hue-rotate(0deg) brightness(1)' },\n      { filter: 'hue-rotate(20deg) brightness(1.1)' },\n      { filter: 'hue-rotate(0deg) brightness(1)' }\n    ], {\n      duration: 500,\n      iterations: Math.ceil(duration * 2)\n    });\n\n    setTimeout(() => {\n      if (this.slowOverlay) {\n        this.slowOverlay.style.opacity = '0';\n      }\n    }, duration * 1000);\n  }\n\n  /** Обновить здоровье */\n  public updateHealth(health: number, maxHealth: number): void {\n    if (this.healthEl) {\n      this.healthEl.textContent = Math.floor(health).toString();\n      \n      const ratio = health / maxHealth;\n      if (ratio > 0.5) {\n        this.healthEl.style.color = '#00ffaa';\n      } else if (ratio > 0.25) {\n        this.healthEl.style.color = '#ffaa00';\n      } else {\n        this.healthEl.style.color = '#ff4444';\n      }\n    }\n  }\n\n  /** Обновить заряды сплеш-волны */\n  public updateSplashCharges(charges: number): void {\n    if (!this.splashChargesEl) {\n      this.createSplashChargesElement();\n    }\n    \n    if (this.splashChargesEl) {\n      if (charges > 0) {\n        this.splashChargesEl.style.display = 'block';\n        this.splashChargesEl.innerHTML = `⚡ ВОЛНА: ${'●'.repeat(charges)}${'○'.repeat(3 - charges)}`;\n        this.splashChargesEl.style.color = '#00ffff';\n        this.splashChargesEl.style.textShadow = '0 0 10px #00ffff, 0 0 20px #00ffff';\n      } else {\n        this.splashChargesEl.style.display = 'none';\n      }\n    }\n  }\n\n  /** Создать элемент зарядов */\n  private splashChargesEl: HTMLElement | null = null;\n  \n  /** Элемент кулдауна двойного прыжка */\n  private doubleJumpEl: HTMLElement | null = null;\n  \n  private createSplashChargesElement(): void {\n    this.splashChargesEl = document.createElement('div');\n    this.splashChargesEl.style.cssText = `\n      position: fixed;\n      bottom: 80px;\n      right: 20px;\n      font-family: 'Orbitron', 'Audiowide', monospace;\n      font-size: 18px;\n      color: #00ffff;\n      text-shadow: 0 0 10px #00ffff;\n      letter-spacing: 2px;\n      display: none;\n      z-index: 1000;\n    `;\n    document.body.appendChild(this.splashChargesEl);\n  }\n\n  /** Обновить индикатор двойного прыжка */\n  public updateDoubleJump(cooldown: number, isReady: boolean): void {\n    if (!this.doubleJumpEl) {\n      this.createDoubleJumpElement();\n    }\n    \n    if (this.doubleJumpEl) {\n      if (isReady) {\n        this.doubleJumpEl.innerHTML = '⬆️⬆️ ГОТОВ';\n        this.doubleJumpEl.style.color = '#00ff88';\n        this.doubleJumpEl.style.textShadow = '0 0 10px #00ff88';\n      } else {\n        const cd = Math.ceil(cooldown * 10) / 10;\n        this.doubleJumpEl.innerHTML = `⬆️⬆️ ${cd.toFixed(1)}s`;\n        this.doubleJumpEl.style.color = '#ff8800';\n        this.doubleJumpEl.style.textShadow = '0 0 10px #ff8800';\n      }\n    }\n  }\n\n  private createDoubleJumpElement(): void {\n    this.doubleJumpEl = document.createElement('div');\n    this.doubleJumpEl.style.cssText = `\n      position: fixed;\n      bottom: 120px;\n      left: 20px;\n      font-family: 'Orbitron', 'Audiowide', monospace;\n      font-size: 16px;\n      color: #00ff88;\n      text-shadow: 0 0 10px #00ff88;\n      letter-spacing: 2px;\n      z-index: 1000;\n    `;\n    document.body.appendChild(this.doubleJumpEl);\n  }\n\n  /** Обновить врагов */\n  public updateAmmo(_wave: number, enemiesLeft: number): void {\n    if (this.ammoEl) {\n      this.ammoEl.textContent = `⚔️ ${enemiesLeft}`;\n      this.ammoEl.style.color = enemiesLeft > 0 ? '#00ffff' : '#00ff00';\n    }\n  }\n\n  /** Обновить счёт */\n  public updateFrags(frags: number): void {\n    if (this.fragsEl) {\n      this.fragsEl.textContent = frags.toString();\n    }\n  }\n\n  /** Показать волну */\n  public showWave(wave: number): void {\n    if (this.waveEl) {\n      this.waveEl.textContent = `ВОЛНА ${wave}`;\n      this.waveEl.style.opacity = '1';\n      this.waveEl.style.transform = 'translateX(-50%) scale(1)';\n      this.waveEl.style.color = '#00ffff';\n      this.waveEl.style.borderColor = 'rgba(255, 0, 255, 0.6)';\n      \n      // Плавное появление сверху\n      this.waveEl.animate([\n        { transform: 'translateX(-50%) translateY(-20px) scale(0.9)', opacity: 0 },\n        { transform: 'translateX(-50%) translateY(0) scale(1)', opacity: 1 }\n      ], { duration: 300, easing: 'ease-out' });\n      \n      setTimeout(() => {\n        if (this.waveEl) {\n          this.waveEl.animate([\n            { opacity: 1 },\n            { opacity: 0 }\n          ], { duration: 250, easing: 'ease-in' });\n          setTimeout(() => {\n            if (this.waveEl) this.waveEl.style.opacity = '0';\n          }, 230);\n        }\n      }, 1500);\n    }\n  }\n\n  /** Показать завершение волны */\n  public showWaveComplete(wave: number): void {\n    if (this.waveEl) {\n      this.waveEl.textContent = `✓ ВОЛНА ${wave}`;\n      this.waveEl.style.color = '#00ff88';\n      this.waveEl.style.borderColor = 'rgba(0, 255, 136, 0.6)';\n      this.waveEl.style.opacity = '1';\n      this.waveEl.style.transform = 'translateX(-50%) scale(1)';\n      \n      // Мягкая победная анимация\n      this.waveEl.animate([\n        { transform: 'translateX(-50%) scale(0.95)', opacity: 0 },\n        { transform: 'translateX(-50%) scale(1.02)', opacity: 1 },\n        { transform: 'translateX(-50%) scale(1)', opacity: 1 }\n      ], { duration: 350, easing: 'ease-out' });\n      \n      // Показать \"пройдена\" потом \"готовься\"\n      setTimeout(() => {\n        if (this.waveEl) {\n          this.waveEl.textContent = `ГОТОВЬСЯ...`;\n          this.waveEl.style.color = '#ffaa00';\n          this.waveEl.style.borderColor = 'rgba(255, 170, 0, 0.5)';\n        }\n      }, 1200);\n      \n      setTimeout(() => {\n        if (this.waveEl) {\n          this.waveEl.style.opacity = '0';\n          this.waveEl.style.color = '#00ffff';\n          this.waveEl.style.borderColor = 'rgba(255, 0, 255, 0.6)';\n        }\n      }, 3500);\n    }\n  }\n\n  /** Показать Game Over */\n  public showGameOver(score: number, wave: number): void {\n    if (this.messageEl) {\n      this.messageEl.innerHTML = `\n        ☠ GAME OVER ☠<br>\n        <div style=\"\n          font-size: 24px; \n          color: #00ffff; \n          margin-top: 20px;\n          text-shadow: 0 0 10px #00ffff;\n          letter-spacing: 3px;\n        \">\n          СЧЁТ: <span style=\"color: #ff00ff;\">${score}</span><br>\n          ВОЛНА: <span style=\"color: #ff00ff;\">${wave}</span>\n        </div>\n      `;\n      this.messageEl.style.opacity = '1';\n      \n      // Драматичная анимация\n      this.messageEl.animate([\n        { transform: 'translate(-50%, -50%) scale(0.5)', opacity: 0 },\n        { transform: 'translate(-50%, -50%) scale(1.2)', opacity: 1 },\n        { transform: 'translate(-50%, -50%) scale(1)', opacity: 1 }\n      ], { duration: 600, easing: 'cubic-bezier(0.34, 1.56, 0.64, 1)' });\n      \n      setTimeout(() => {\n        if (this.messageEl) {\n          this.messageEl.animate([\n            { opacity: 1 },\n            { opacity: 0 }\n          ], { duration: 400 });\n          setTimeout(() => {\n            if (this.messageEl) this.messageEl.style.opacity = '0';\n          }, 380);\n        }\n      }, 2500);\n    }\n  }\n\n  /** Показать индикатор перезарядки - не используется для катаны */\n  public showReloading(_show: boolean): void {\n    // Катане не нужна перезарядка\n  }\n\n  /** Расширить прицел */\n  public expandCrosshair(): void {\n    if (this.crosshairEl) {\n      this.crosshairEl.classList.add('shooting');\n      setTimeout(() => {\n        this.crosshairEl?.classList.remove('shooting');\n      }, 100);\n    }\n  }\n\n  /** Показать хитмаркер */\n  public showHitmarker(isKill: boolean = false): void {\n    if (this.hitmarkerEl) {\n      this.hitmarkerEl.className = 'hitmarker active';\n      if (isKill) {\n        this.hitmarkerEl.classList.add('kill');\n      }\n      \n      setTimeout(() => {\n        this.hitmarkerEl?.classList.remove('active', 'kill');\n      }, 150);\n    }\n  }\n\n  /** Эффект урона (алиас) */\n  public showDamageEffect(): void {\n    this.showDamage('green');\n  }\n\n  /** Показать сообщение */\n  public showMessage(text: string, color: string = 'white'): void {\n    const msg = document.createElement('div');\n    msg.style.cssText = `\n      position: fixed;\n      top: 30%;\n      left: 50%;\n      transform: translateX(-50%);\n      font-family: 'Orbitron', sans-serif;\n      font-size: 24px;\n      color: ${color};\n      text-shadow: 0 0 10px ${color}, 0 0 20px ${color};\n      pointer-events: none;\n      z-index: 1100;\n      opacity: 1;\n      animation: messageFloat 1s ease-out forwards;\n    `;\n    msg.textContent = text;\n    document.body.appendChild(msg);\n\n    // Добавляем стиль анимации если его нет\n    if (!document.getElementById('message-anim-style')) {\n      const style = document.createElement('style');\n      style.id = 'message-anim-style';\n      style.textContent = `\n        @keyframes messageFloat {\n          0% { opacity: 1; transform: translateX(-50%) translateY(0); }\n          100% { opacity: 0; transform: translateX(-50%) translateY(-50px); }\n        }\n      `;\n      document.head.appendChild(style);\n    }\n\n    setTimeout(() => msg.remove(), 1000);\n  }\n\n  /** Показать оверлей буйства */\n  private rageOverlay: HTMLElement | null = null;\n\n  /** HP бар босса */\n  private bossHealthBar: HTMLElement | null = null;\n  private bossHealthFill: HTMLElement | null = null;\n  private bossNameEl: HTMLElement | null = null;\n\n  public showRageOverlay(duration: number): void {\n    if (!this.rageOverlay) {\n      this.rageOverlay = document.createElement('div');\n      this.rageOverlay.id = 'rage-overlay';\n      this.rageOverlay.style.cssText = `\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: radial-gradient(circle,\n          transparent 0%,\n          rgba(255, 50, 0, 0.15) 50%,\n          rgba(255, 0, 0, 0.3) 100%\n        );\n        pointer-events: none;\n        z-index: 997;\n        opacity: 0;\n        transition: opacity 0.3s;\n      `;\n      document.body.appendChild(this.rageOverlay);\n    }\n\n    this.rageOverlay.style.opacity = '1';\n    \n    this.rageOverlay.animate([\n      { filter: 'hue-rotate(0deg) brightness(1)' },\n      { filter: 'hue-rotate(-20deg) brightness(1.2)' },\n      { filter: 'hue-rotate(0deg) brightness(1)' }\n    ], {\n      duration: 300,\n      iterations: Math.ceil(duration * 3)\n    });\n\n    setTimeout(() => {\n      if (this.rageOverlay) {\n        this.rageOverlay.style.opacity = '0';\n      }\n    }, duration * 1000);\n  }\n\n  /** Показать HP босса */\n  public showBossHealth(hp: number, maxHp: number, bossType: string): void {\n    if (!this.bossHealthBar) {\n      // Создаём контейнер\n      this.bossHealthBar = document.createElement('div');\n      this.bossHealthBar.style.cssText = `\n        position: fixed;\n        top: 50px;\n        left: 50%;\n        transform: translateX(-50%);\n        width: 400px;\n        padding: 10px;\n        background: rgba(0, 0, 0, 0.7);\n        border: 2px solid #ff0000;\n        border-radius: 8px;\n        z-index: 1100;\n        text-align: center;\n        font-family: 'Orbitron', sans-serif;\n        box-shadow: 0 0 20px rgba(255, 0, 0, 0.5);\n      `;\n      \n      // Имя босса\n      this.bossNameEl = document.createElement('div');\n      this.bossNameEl.style.cssText = `\n        color: #ff4444;\n        font-size: 16px;\n        text-shadow: 0 0 10px #ff0000;\n        margin-bottom: 8px;\n        text-transform: uppercase;\n        letter-spacing: 3px;\n      `;\n      this.bossHealthBar.appendChild(this.bossNameEl);\n      \n      // Полоска HP\n      const barContainer = document.createElement('div');\n      barContainer.style.cssText = `\n        width: 100%;\n        height: 20px;\n        background: #333;\n        border-radius: 10px;\n        overflow: hidden;\n        border: 1px solid #666;\n      `;\n      \n      this.bossHealthFill = document.createElement('div');\n      this.bossHealthFill.style.cssText = `\n        height: 100%;\n        transition: width 0.3s ease-out;\n        border-radius: 10px;\n      `;\n      barContainer.appendChild(this.bossHealthFill);\n      this.bossHealthBar.appendChild(barContainer);\n      \n      document.body.appendChild(this.bossHealthBar);\n    }\n\n    // Имя и цвет\n    let bossName = 'БОСС';\n    let barColor = '#ff0000';\n    \n    if (bossType === 'boss_green') {\n      bossName = '☠️ ТОКСИЧНЫЙ ГИГАНТ ☠️';\n      barColor = 'linear-gradient(90deg, #00ff00, #88ff00)';\n      this.bossHealthBar.style.borderColor = '#00ff00';\n      this.bossHealthBar.style.boxShadow = '0 0 20px rgba(0, 255, 0, 0.5)';\n    } else if (bossType === 'boss_black') {\n      bossName = '🌀 ВЛАДЫКА ПУСТОТЫ 🌀';\n      barColor = 'linear-gradient(90deg, #4400aa, #8800ff)';\n      this.bossHealthBar.style.borderColor = '#8800ff';\n      this.bossHealthBar.style.boxShadow = '0 0 20px rgba(136, 0, 255, 0.5)';\n    } else if (bossType === 'boss_blue') {\n      bossName = '⚡ ФАНТОМ ХАОСА ⚡';\n      barColor = 'linear-gradient(90deg, #0088ff, #00ffff)';\n      this.bossHealthBar.style.borderColor = '#00ffff';\n      this.bossHealthBar.style.boxShadow = '0 0 20px rgba(0, 255, 255, 0.5)';\n    }\n    \n    if (this.bossNameEl) {\n      this.bossNameEl.textContent = bossName;\n    }\n    \n    if (this.bossHealthFill) {\n      const percent = (hp / maxHp) * 100;\n      this.bossHealthFill.style.width = percent + '%';\n      this.bossHealthFill.style.background = barColor;\n    }\n    \n    this.bossHealthBar.style.display = 'block';\n  }\n\n  /** Скрыть HP босса */\n  public hideBossHealth(): void {\n    if (this.bossHealthBar) {\n      this.bossHealthBar.style.display = 'none';\n    }\n  }\n\n  /** Эпичная заставка босса */\n  public showBossIntro(bossType: string, onComplete?: () => void): void {\n    // Определяем имя и стиль босса\n    let bossName = 'БОСС';\n    let bossSubtitle = '';\n    let color = '#ff0044';\n    let glowColor = 'rgba(255, 0, 68, 0.5)';\n    let icon = '💀';\n    \n    if (bossType === 'boss_green') {\n      bossName = 'ЯДОВИТЫЕ БЛИЗНЕЦЫ';\n      bossSubtitle = 'Охотник & Загонщик';\n      color = '#00ff44';\n      glowColor = 'rgba(0, 255, 68, 0.5)';\n      icon = '☣️';\n    } else if (bossType === 'boss_black') {\n      bossName = 'ВЛАДЫКА ПУСТОТЫ';\n      bossSubtitle = 'Повелитель Тьмы';\n      color = '#8800ff';\n      glowColor = 'rgba(136, 0, 255, 0.5)';\n      icon = '🌀';\n    } else if (bossType === 'boss_blue') {\n      bossName = 'ФАНТОМ ХАОСА';\n      bossSubtitle = 'Владыка Молний';\n      color = '#00ffff';\n      glowColor = 'rgba(0, 255, 255, 0.5)';\n      icon = '⚡';\n    }\n\n    // Создаём оверлей заставки\n    const overlay = document.createElement('div');\n    overlay.id = 'boss-intro-overlay';\n    overlay.style.cssText = `\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      background: rgba(0, 0, 0, 0);\n      display: flex;\n      flex-direction: column;\n      justify-content: center;\n      align-items: center;\n      z-index: 9999;\n      pointer-events: none;\n    `;\n\n    // Иконка босса\n    const iconEl = document.createElement('div');\n    iconEl.style.cssText = `\n      font-size: 120px;\n      opacity: 0;\n      transform: scale(3);\n      filter: drop-shadow(0 0 30px ${glowColor});\n    `;\n    iconEl.textContent = icon;\n\n    // Имя босса\n    const nameEl = document.createElement('div');\n    nameEl.style.cssText = `\n      font-family: 'Orbitron', sans-serif;\n      font-size: 72px;\n      font-weight: 900;\n      color: ${color};\n      text-shadow: \n        0 0 20px ${color},\n        0 0 40px ${glowColor},\n        0 0 60px ${glowColor};\n      opacity: 0;\n      transform: translateY(50px);\n      letter-spacing: 8px;\n      margin-top: 20px;\n    `;\n    nameEl.textContent = bossName;\n\n    // Подзаголовок\n    const subtitleEl = document.createElement('div');\n    subtitleEl.style.cssText = `\n      font-family: 'Orbitron', sans-serif;\n      font-size: 24px;\n      color: ${color};\n      text-shadow: 0 0 10px ${glowColor};\n      opacity: 0;\n      margin-top: 10px;\n      letter-spacing: 4px;\n    `;\n    subtitleEl.textContent = bossSubtitle;\n\n    // Линии по бокам\n    const lineLeft = document.createElement('div');\n    const lineRight = document.createElement('div');\n    const lineStyle = `\n      position: absolute;\n      top: 50%;\n      width: 0;\n      height: 3px;\n      background: linear-gradient(90deg, transparent, ${color});\n    `;\n    lineLeft.style.cssText = lineStyle + 'left: 0; transform: translateY(-50%);';\n    lineRight.style.cssText = lineStyle + 'right: 0; transform: translateY(-50%) scaleX(-1);';\n\n    overlay.appendChild(lineLeft);\n    overlay.appendChild(lineRight);\n    overlay.appendChild(iconEl);\n    overlay.appendChild(nameEl);\n    overlay.appendChild(subtitleEl);\n    document.body.appendChild(overlay);\n\n    // Анимация появления\n    overlay.animate([\n      { background: 'rgba(0, 0, 0, 0)' },\n      { background: 'rgba(0, 0, 0, 0.8)' }\n    ], { duration: 300, fill: 'forwards' });\n\n    iconEl.animate([\n      { opacity: 0, transform: 'scale(3)' },\n      { opacity: 1, transform: 'scale(1)' }\n    ], { duration: 500, delay: 200, fill: 'forwards', easing: 'ease-out' });\n\n    nameEl.animate([\n      { opacity: 0, transform: 'translateY(50px)' },\n      { opacity: 1, transform: 'translateY(0)' }\n    ], { duration: 500, delay: 400, fill: 'forwards', easing: 'ease-out' });\n\n    subtitleEl.animate([\n      { opacity: 0 },\n      { opacity: 0.8 }\n    ], { duration: 400, delay: 600, fill: 'forwards' });\n\n    lineLeft.animate([\n      { width: '0%' },\n      { width: '35%' }\n    ], { duration: 600, delay: 300, fill: 'forwards', easing: 'ease-out' });\n\n    lineRight.animate([\n      { width: '0%' },\n      { width: '35%' }\n    ], { duration: 600, delay: 300, fill: 'forwards', easing: 'ease-out' });\n\n    // Анимация исчезновения и удаление\n    setTimeout(() => {\n      overlay.animate([\n        { opacity: 1 },\n        { opacity: 0 }\n      ], { duration: 500, fill: 'forwards' });\n      \n      setTimeout(() => {\n        overlay.remove();\n        onComplete?.();\n      }, 500);\n    }, 2500);\n  }\n}\n","import type { Vec3, ICollisionSystem } from '@/types';\n\n/**\n * Система коллизий для круглой арены с бассейнами\n * Круглые платформы по центру для паркура с двойным прыжком\n */\nexport class CollisionSystem implements ICollisionSystem {\n  /** Радиус игрока */\n  private playerRadius = 0.4;\n\n  // Размеры круглой арены\n  private arenaRadius = 28.0;\n  \n  // Центральный бассейн\n  private poolRadius = 8.0;\n  \n  // Боковые платформы (левая и правая)\n  private platformHeight = 2.0;\n  private platformX = 20.0;\n  \n  // Мосты\n  private bridgeWidth = 3.5;\n  \n  // === КРУГЛЫЕ ПЛАТФОРМЫ ДЛЯ ПАРКУРА (спираль по кругу) ===\n  // 6 платформ по кругу с радиусом 10м, высота растёт по спирали\n  // Базовые высоты (без анимации)\n  private baseHeights = [1.8, 3.0, 4.2, 5.4, 6.6, 7.8];\n  private topBaseHeight = 9.5;\n  \n  private jumpPlatforms = [\n    { x: 10.0, z: 0.0, height: 1.8, radius: 1.5 },   // 1 - старт (0°)\n    { x: 5.0, z: 8.66, height: 3.0, radius: 1.4 },   // 2 - (60°)\n    { x: -5.0, z: 8.66, height: 4.2, radius: 1.4 },  // 3 - (120°)\n    { x: -10.0, z: 0.0, height: 5.4, radius: 1.3 },  // 4 - (180°)\n    { x: -5.0, z: -8.66, height: 6.6, radius: 1.3 }, // 5 - (240°)\n    { x: 5.0, z: -8.66, height: 7.8, radius: 1.2 },  // 6 - (300°)\n  ];\n  // Верхняя платформа с бафом - в центре над фонтаном\n  private topPlatform = { x: 0, z: 0, height: 9.5, radius: 2.5 };\n\n  /** Обновить высоту платформ (анимация парения) */\n  public updatePlatforms(time: number): void {\n    // Каждая платформа парит с разной фазой\n    for (let i = 0; i < this.jumpPlatforms.length; i++) {\n      const phase = i * 0.8; // Разная фаза для каждой платформы\n      const bobAmount = Math.sin(time * 1.5 + phase) * 0.3; // ±0.3м\n      this.jumpPlatforms[i].height = this.baseHeights[i] + bobAmount;\n    }\n    // Верхняя платформа тоже парит, но медленнее\n    this.topPlatform.height = this.topBaseHeight + Math.sin(time * 1.0) * 0.2;\n  }\n\n  /** Получить данные платформ для шейдера */\n  public getPlatformData(): Float32Array {\n    // 7 платформ * 4 компонента (x, z, height, radius)\n    const data = new Float32Array(28);\n    for (let i = 0; i < this.jumpPlatforms.length; i++) {\n      const p = this.jumpPlatforms[i];\n      data[i * 4 + 0] = p.x;\n      data[i * 4 + 1] = p.z;\n      data[i * 4 + 2] = p.height;\n      data[i * 4 + 3] = p.radius;\n    }\n    // Верхняя платформа\n    data[24] = this.topPlatform.x;\n    data[25] = this.topPlatform.z;\n    data[26] = this.topPlatform.height;\n    data[27] = this.topPlatform.radius;\n    return data;\n  }\n\n  /** Проверить коллизию в точке */\n  public checkCollision(pos: Vec3): boolean {\n    const r = this.playerRadius;\n\n    // Круглые стены арены\n    const distFromCenter = Math.sqrt(pos.x * pos.x + pos.z * pos.z);\n    if (distFromCenter > this.arenaRadius - r) return true;\n\n    // Центральная колонна (фонтан) - блокирует только внизу, не на верхней платформе\n    // Фонтан высотой ~8м, верхняя платформа на 9.5м\n    if (distFromCenter < 2.0 + r && pos.y < 10.0) return true;\n\n    // Колонны по периметру (4 основные)\n    const columnPositions = [\n      { x: 22, z: 0 },\n      { x: -22, z: 0 },\n      { x: 0, z: 22 },\n      { x: 0, z: -22 },\n    ];\n    \n    for (const col of columnPositions) {\n      const dx = pos.x - col.x;\n      const dz = pos.z - col.z;\n      if (Math.sqrt(dx * dx + dz * dz) < 0.7 + r) return true;\n    }\n\n    // Бассейн теперь проходим - можно ходить по воде\n\n    // Коллизия с круглыми платформами (сбоку) - только на уровне платформы\n    const allPlatforms = [...this.jumpPlatforms, this.topPlatform];\n    for (const plat of allPlatforms) {\n      const dx = pos.x - plat.x;\n      const dz = pos.z - plat.z;\n      const dist = Math.sqrt(dx * dx + dz * dz);\n      const feetY = pos.y - 1.7;\n      \n      // Блокируем только если ноги близко к уровню платформы (в пределах 1м ниже)\n      // Это позволяет ходить под платформами на земле\n      if (dist < plat.radius + r && feetY < plat.height - 0.1 && feetY > plat.height - 1.5) {\n        return true;\n      }\n    }\n\n    // Края платформ (перила)\n    // Левая платформа\n    if (pos.x < -this.platformX + 3.5 && pos.x > -this.platformX - 3.5 &&\n        Math.abs(pos.z) < 6.5 && pos.y > this.platformHeight - 0.5) {\n      // Перила на краю\n      if (pos.x > -this.platformX + 2.8 && Math.abs(pos.z) < 6.0) {\n        return true;\n      }\n    }\n    \n    // Правая платформа\n    if (pos.x > this.platformX - 3.5 && pos.x < this.platformX + 3.5 &&\n        Math.abs(pos.z) < 6.5 && pos.y > this.platformHeight - 0.5) {\n      if (pos.x < this.platformX - 2.8 && Math.abs(pos.z) < 6.0) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  /** Проверить, находится ли точка над круглой платформой */\n  private isOverCirclePlatform(pos: Vec3, plat: { x: number; z: number; height: number; radius: number }): boolean {\n    const dx = pos.x - plat.x;\n    const dz = pos.z - plat.z;\n    const dist = Math.sqrt(dx * dx + dz * dz);\n    // Игрок должен быть СТРОГО выше платформы (минимум на уровне верха) и в радиусе\n    // pos.y - это позиция глаз, eyeHeight = 1.7, значит ноги на pos.y - 1.7\n    // Ноги должны быть выше или на уровне платформы\n    const feetY = pos.y - 1.7;\n    return dist < plat.radius && feetY >= plat.height - 0.1;\n  }\n\n  /** Получить высоту пола в точке */\n  public getFloorHeight(pos: Vec3): number {\n    const distFromCenter = Math.sqrt(pos.x * pos.x + pos.z * pos.z);\n\n    // === МОСТЫ (приоритет - они над бассейном) ===\n    const onBridgeX = Math.abs(pos.z) < this.bridgeWidth / 2 && \n                      Math.abs(pos.x) < this.poolRadius + 1;\n    const onBridgeZ = Math.abs(pos.x) < this.bridgeWidth / 2 && \n                      Math.abs(pos.z) < this.poolRadius + 1;\n    \n    if ((onBridgeX || onBridgeZ) && distFromCenter > 2.0) {\n      return 0.3; // Высота моста\n    }\n\n    // === ЛЕВАЯ ПЛАТФОРМА И ЛЕСТНИЦА ===\n    const leftStairStartX = -16.0;\n    const leftStairEndX = -17.0;\n    const leftPlatformEnd = -23.0;\n    \n    if (Math.abs(pos.z) < 3.0) {\n      if (pos.x >= leftStairEndX && pos.x <= leftStairStartX) {\n        const progress = (leftStairStartX - pos.x) / (leftStairStartX - leftStairEndX);\n        return progress * this.platformHeight;\n      }\n      if (pos.x < leftStairEndX && pos.x > leftPlatformEnd) {\n        return this.platformHeight;\n      }\n    }\n\n    // === ПРАВАЯ ПЛАТФОРМА И ЛЕСТНИЦА ===\n    const rightStairStartX = 16.0;\n    const rightStairEndX = 17.0;\n    const rightPlatformEnd = 23.0;\n    \n    if (Math.abs(pos.z) < 3.0) {\n      if (pos.x >= rightStairStartX && pos.x <= rightStairEndX) {\n        const progress = (pos.x - rightStairStartX) / (rightStairEndX - rightStairStartX);\n        return progress * this.platformHeight;\n      }\n      if (pos.x > rightStairEndX && pos.x < rightPlatformEnd) {\n        return this.platformHeight;\n      }\n    }\n\n    // === КРУГЛЫЕ ПЛАТФОРМЫ ДЛЯ ПАРКУРА (спираль) ===\n    // Верхняя платформа с бафом\n    if (this.isOverCirclePlatform(pos, this.topPlatform)) {\n      return this.topPlatform.height;\n    }\n    \n    // 6 платформ по кругу (проверяем сверху вниз)\n    for (let i = this.jumpPlatforms.length - 1; i >= 0; i--) {\n      if (this.isOverCirclePlatform(pos, this.jumpPlatforms[i])) {\n        return this.jumpPlatforms[i].height;\n      }\n    }\n\n    // Основной пол\n    return 0.0;\n  }\n\n  /** Получить высоту потолка */\n  public getCeilingHeight(pos: Vec3): number {\n    // Проверяем все платформы - потолок только если близко снизу\n    const allPlatforms = [...this.jumpPlatforms, this.topPlatform];\n    \n    for (const plat of allPlatforms) {\n      const dx = pos.x - plat.x;\n      const dz = pos.z - plat.z;\n      const dist = Math.sqrt(dx * dx + dz * dz);\n      \n      // Потолок только если игрок прямо под платформой и близко к ней (в пределах 3м)\n      if (dist < plat.radius - 0.3 && pos.y < plat.height - 0.5 && pos.y > plat.height - 4.0) {\n        return plat.height - 0.3;\n      }\n    }\n    \n    return 18.0;\n  }\n\n  /** Проверить коллизию для врага (упрощённая версия без перил) */\n  public checkEnemyCollision(pos: Vec3, radius: number): boolean {\n    // Круглые стены арены\n    const distFromCenter = Math.sqrt(pos.x * pos.x + pos.z * pos.z);\n    if (distFromCenter > this.arenaRadius - radius) return true;\n\n    // Центральная колонна (фонтан)\n    if (distFromCenter < 2.0 + radius) return true;\n\n    // Колонны по периметру\n    const columnPositions = [\n      { x: 22, z: 0 },\n      { x: -22, z: 0 },\n      { x: 0, z: 22 },\n      { x: 0, z: -22 },\n    ];\n    \n    for (const col of columnPositions) {\n      const dx = pos.x - col.x;\n      const dz = pos.z - col.z;\n      if (Math.sqrt(dx * dx + dz * dz) < 0.7 + radius) return true;\n    }\n\n    // Все платформы - блокируем только если враг рядом по высоте\n    const allPlatforms = [...this.jumpPlatforms, this.topPlatform];\n    for (const plat of allPlatforms) {\n      const dx = pos.x - plat.x;\n      const dz = pos.z - plat.z;\n      const dist = Math.sqrt(dx * dx + dz * dz);\n      \n      // Блокируем только если враг в пределах 1.5м от уровня платформы\n      // (как для игрока в checkCollision)\n      if (dist < plat.radius + radius && pos.y < plat.height + 1.5 && pos.y > plat.height - 1.5) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  /** Получить высоту препятствия перед врагом (для прыжков) */\n  public getObstacleHeight(pos: Vec3, dirX: number, dirZ: number, checkDist: number = 1.5): number {\n    const checkX = pos.x + dirX * checkDist;\n    const checkZ = pos.z + dirZ * checkDist;\n    \n    const allPlatforms = [...this.jumpPlatforms, this.topPlatform];\n    for (const plat of allPlatforms) {\n      const dx = checkX - plat.x;\n      const dz = checkZ - plat.z;\n      const dist = Math.sqrt(dx * dx + dz * dz);\n      \n      if (dist < plat.radius && pos.y < plat.height) {\n        return plat.height;\n      }\n    }\n    \n    return 0;\n  }\n}\n","import type { GameState, GameConfig, Vec3 } from '@/types';\nimport { GameLoop } from './GameLoop';\nimport { Input } from './Input';\nimport { Player } from '@/player/Player';\nimport { Weapon } from '@/weapon/Weapon';\nimport { WeaponRenderer } from '@/weapon/WeaponRenderer';\nimport { TargetManager } from '@/enemies/Target';\nimport { PickupManager } from '@/items/Pickup';\nimport { AudioManager } from '@/audio/AudioManager';\nimport { WebGLRenderer } from '@/render/WebGLRenderer';\nimport { HUD } from '@/render/HUD';\nimport { CollisionSystem } from '@/world/Collision';\nimport { vec3 } from '@/utils/math';\n\n/** Конфигурация по умолчанию */\nconst DEFAULT_CONFIG: GameConfig = {\n  width: 1280,\n  height: 720,\n  renderScale: 0.4,\n  movement: {\n    walkSpeed: 9.0,\n    runSpeed: 16.0,\n    jumpForce: 12.0,\n    gravity: 25.0,\n    groundFriction: 12.0,\n    airControl: 0.85,\n    mouseSensitivity: 0.002,\n  },\n  weapon: {\n    name: 'Katana',\n    damage: 100,\n    fireRate: 2.5,\n    magazineSize: 999,\n    reloadTime: 0,\n    spread: 0,\n    automatic: false,\n  },\n};\n\n/**\n * Samurai Pool Arena\n * Руби врагов катаной пока они не долетели до тебя!\n */\nexport class Game {\n  // === СОСТОЯНИЕ ===\n  public state: GameState = {\n    isRunning: false,\n    isPaused: false,\n    frags: 0,\n    gameTime: 0,\n    soundEnabled: true,\n  };\n\n  // === КОНФИГУРАЦИЯ ===\n  public config: GameConfig;\n\n  // === СИСТЕМЫ ===\n  private gameLoop: GameLoop;\n  private input: Input;\n  private player: Player;\n  private weapon: Weapon;\n  private weaponRenderer: WeaponRenderer;\n  private targetManager: TargetManager;\n  private pickupManager: PickupManager;\n  private audio: AudioManager;\n  private renderer: WebGLRenderer;\n  private hud: HUD;\n  private collision: CollisionSystem;\n\n  // === CANVAS ===\n  private weaponCanvas: HTMLCanvasElement;\n\n  // === UI ===\n  private startScreen: HTMLElement | null;\n\n  // === ВРЕМЯ ===\n  private gameTime = 0;\n\n  // === СОСТОЯНИЕ ===\n  private isPaused = false;\n  private footstepTimer = 0;\n  private wasGrounded = true;\n  private screenShake = 0;\n  private lastSliceTime = 0;\n  private wasJumpPressed = false;\n  \n  /** Текущая эпоха (1-3) для атмосферы */\n  private currentEra = 1;\n\n  /** Система комбо-убийств для адреналина */\n  private killTimes: number[] = [];\n  private readonly COMBO_WINDOW = 9.0; // 9 секунд\n  private readonly COMBO_KILLS_NEEDED = 3; // 3 убийства для адреналина\n\n  constructor(\n    canvas: HTMLCanvasElement,\n    weaponCanvas: HTMLCanvasElement,\n    config: Partial<GameConfig> = {}\n  ) {\n    this.weaponCanvas = weaponCanvas;\n    this.config = { ...DEFAULT_CONFIG, ...config };\n\n    // Инициализируем системы\n    this.collision = new CollisionSystem();\n    this.input = new Input(canvas);\n    this.audio = new AudioManager();\n    this.hud = new HUD();\n\n    // Игрок на мосту (безопасная позиция)\n    this.player = new Player(\n      vec3(0, 1.7, 12),\n      this.config.movement,\n      this.collision\n    );\n\n    // Катана\n    this.weapon = new Weapon();\n    this.weapon.onSlice = () => this.onKatanaSlice();\n\n    // Рендереры\n    this.renderer = new WebGLRenderer(canvas);\n    this.renderer.renderScale = this.config.renderScale;\n    this.weaponRenderer = new WeaponRenderer(weaponCanvas);\n\n    // Враги (передаём систему коллизий для обхода препятствий)\n    this.targetManager = new TargetManager(this.collision);\n    this.setupTargetCallbacks();\n\n    // Предметы\n    this.pickupManager = new PickupManager();\n\n    // Игровой цикл\n    this.gameLoop = new GameLoop(\n      (dt) => this.update(dt),\n      () => this.render()\n    );\n\n    // UI\n    this.startScreen = document.getElementById('click-to-start');\n\n    // Обработчики\n    this.setupEventHandlers();\n  }\n\n  /** Настройка callbacks для врагов */\n  private setupTargetCallbacks(): void {\n    this.targetManager.onTargetDestroyed = (target) => {\n      this.state.frags++;\n      this.audio.playSFX('kill');\n      this.hud.showHitmarker(true);\n      \n      // Шанс выпадения предмета\n      this.pickupManager.spawnAfterKill(target.position);\n      \n      // === СИСТЕМА КОМБО ДЛЯ АДРЕНАЛИНА ===\n      // Добавляем время убийства\n      this.killTimes.push(this.gameTime);\n      \n      // Удаляем старые убийства (старше 9 секунд)\n      this.killTimes = this.killTimes.filter(t => this.gameTime - t < this.COMBO_WINDOW);\n      \n      // Проверяем комбо (3 убийства за 9 секунд)\n      if (this.killTimes.length >= this.COMBO_KILLS_NEEDED && !this.player.rageMode) {\n        this.activateComboAdrenaline();\n      }\n      \n      // Показываем прогресс комбо\n      if (this.killTimes.length > 0 && this.killTimes.length < this.COMBO_KILLS_NEEDED) {\n        this.hud.showMessage(`🔥 КОМБО ${this.killTimes.length}/${this.COMBO_KILLS_NEEDED}`, 'orange');\n      }\n      \n      // Сообщение при убийстве босса\n      if (target.isBoss) {\n        this.hud.showMessage('💀 БОСС ПОВЕРЖЕН! 💀', 'gold');\n        // Босс роняет много аптечек\n        for (let i = 0; i < 3; i++) {\n          this.pickupManager.spawnAfterKill(target.position);\n        }\n        // Респавн заряда катаны после босса\n        this.pickupManager.respawnChargeAfterBoss();\n        \n        // После первого босса (волна 5) - разблокируем тройной прыжок!\n        if (this.targetManager.wave === 5 && this.player.maxAirJumps < 2) {\n          this.player.unlockTripleJump();\n          this.hud.showMessage('🦘 ТРОЙНОЙ ПРЫЖОК РАЗБЛОКИРОВАН! 🦘', 'cyan');\n        }\n      }\n    };\n\n    this.targetManager.onPlayerHit = (target) => {\n      // Урон игроку (зависит от типа врага)\n      this.player.takeDamage(target.damage);\n      \n      // Разные эффекты для разных врагов\n      switch (target.enemyType) {\n        case 'phantom':\n          this.audio.playSFX('phantom_pass');\n          this.screenShake = 0.3;\n          this.hud.showDamage('purple');\n          this.slowdownFactor = 0.3;\n          this.slowdownTimer = 2.0;\n          break;\n        case 'runner':\n          this.audio.playSFX('runner_hit');\n          this.screenShake = 0.4;\n          this.hud.showDamage('green');\n          break;\n        case 'hopper':\n          this.audio.playSFX('hopper_hit');\n          this.screenShake = 0.6;\n          this.hud.showDamage('green');\n          break;\n        case 'boss_green':\n          this.audio.playSFX('kill');\n          this.screenShake = 1.0; // Очень сильная тряска\n          this.hud.showDamage('green');\n          this.hud.showMessage('💀 ТОКСИЧНЫЙ УДАР!', 'lime');\n          break;\n        case 'boss_black':\n          this.audio.playSFX('phantom_pass');\n          this.screenShake = 0.8;\n          this.hud.showDamage('purple');\n          this.slowdownFactor = 0.2; // Сильное замедление!\n          this.slowdownTimer = 3.0;\n          this.hud.showMessage('🌀 ИСКРИВЛЕНИЕ!', 'purple');\n          break;\n        case 'boss_blue':\n          this.audio.playSFX('hopper_hit');\n          this.screenShake = 0.7;\n          this.hud.showDamage('purple');\n          this.hud.showMessage('⚡ ТЕЛЕПОРТ УДАР!', 'cyan');\n          break;\n        default:\n          this.audio.playSFX('hit');\n          this.screenShake = 0.5;\n          this.hud.showDamage('green');\n      }\n    };\n\n    this.targetManager.onWaveStart = (wave) => {\n      this.hud.showWave(wave);\n      \n      // Обновляем эпоху для музыки и атмосферы\n      this.audio.setEra(wave);\n      this.currentEra = wave > 10 ? 3 : wave > 5 ? 2 : 1;\n      \n      // Эпичные заставки боссов!\n      if (wave === 5) {\n        this.isPaused = true; // Пауза на время заставки\n        this.audio.playBossWarning();\n        this.hud.showBossIntro('boss_green', () => {\n          this.isPaused = false;\n          this.audio.setBossMusic('boss_green');\n        });\n      } else if (wave === 10) {\n        this.isPaused = true;\n        this.audio.playBossWarning();\n        this.hud.showBossIntro('boss_black', () => {\n          this.isPaused = false;\n          this.audio.setBossMusic('boss_black');\n        });\n      } else if (wave === 15) {\n        this.isPaused = true;\n        this.audio.playBossWarning();\n        this.hud.showBossIntro('boss_blue', () => {\n          this.isPaused = false;\n          this.audio.setBossMusic('boss_blue');\n        });\n      }\n      \n      // Сообщения о смене эпохи\n      if (wave === 6) {\n        setTimeout(() => this.hud.showMessage('🌀 ЗОНА ЧЁРНОЙ ДЫРЫ 🌀', 'purple'), 1000);\n      } else if (wave === 11) {\n        setTimeout(() => this.hud.showMessage('🚀 КОСМИЧЕСКАЯ ЗОНА 🚀', 'cyan'), 1000);\n      }\n    };\n\n    this.targetManager.onWaveComplete = (wave) => {\n      this.hud.showWaveComplete(wave);\n      \n      // Возврат к обычной музыке после босса\n      if (wave === 5 || wave === 10 || wave === 15) {\n        this.audio.setBossMusic(null);\n        // Обновляем эпоху после босса\n        this.audio.setEra(wave + 1);\n      }\n    };\n\n    // Урон от токсичных луж\n    this.targetManager.onPoolDamage = (damage) => {\n      this.player.takeDamage(damage);\n      this.hud.showDamage('green');\n      this.screenShake = 0.2;\n    };\n\n    // Смена фазы босса\n    this.targetManager.onBossPhaseChange = (bossType, phase) => {\n      if (bossType === 'boss_green' && phase === 2) {\n        // Зелёный босс перешёл во вторую фазу!\n        this.audio.setBossGreenPhase2();\n        this.hud.showMessage('☣️ ФАЗА 2: ЯРОСТЬ! ☣️', 'lime');\n        this.screenShake = 1.5; // Сильная тряска\n      }\n    };\n\n    // Вихрь чёрного босса\n    this.targetManager.onBossVortexWarning = () => {\n      this.audio.playVortexRiser();\n      this.hud.showMessage('⚠️ ВИХРЬ ПРИБЛИЖАЕТСЯ! ⚠️', 'yellow');\n    };\n\n    this.targetManager.onBossVortexStart = () => {\n      this.audio.playVortexSound(true);\n      this.hud.showMessage('🌀 ВИХРЬ! БЕГИ! 🌀', 'purple');\n      this.screenShake = 1.0;\n    };\n\n    this.targetManager.onBossVortexEnd = () => {\n      this.audio.playVortexSound(false);\n    };\n\n    // Звук плевка кислотой\n    this.targetManager.onAcidSpit = () => {\n      this.audio.playSFX('acid_spit');\n    };\n\n    // Кислотный дождь приземлился\n    this.targetManager.onAcidRain = (_pos) => {\n      this.audio.playAcidSplash();\n      this.screenShake = 0.3;\n    };\n\n    // Звук установки метки для кислотного дождя\n    this.targetManager.onAcidRainMarkSound = () => {\n      this.audio.playAcidRainMark();\n      this.hud.showMessage('☢️ КИСЛОТНЫЙ ДОЖДЬ! УКРОЙСЯ! ☢️', 'lime');\n    };\n\n    // Кислотный дождь начался\n    this.targetManager.onAcidRainStart = (_pos) => {\n      this.audio.playAcidRainStart();\n      this.screenShake = 0.5;\n    };\n  }\n\n  /** Замедление от фантомов */\n  private slowdownFactor = 1.0;\n  private slowdownTimer = 0;\n\n  /** Настройка обработчиков событий */\n  private setupEventHandlers(): void {\n    // Обработчики слайдеров\n    const volumeSlider = document.getElementById('volume-slider') as HTMLInputElement;\n    const volumeValue = document.getElementById('volume-value');\n    const sensSlider = document.getElementById('sens-slider') as HTMLInputElement;\n    const sensValue = document.getElementById('sens-value');\n\n    volumeSlider?.addEventListener('input', (e) => {\n      e.stopPropagation(); // Не запускаем игру при клике на слайдер\n      const value = parseInt(volumeSlider.value);\n      if (volumeValue) volumeValue.textContent = `${value}%`;\n      this.audio.setVolume(value / 100);\n    });\n\n    sensSlider?.addEventListener('input', (e) => {\n      e.stopPropagation();\n      const value = parseInt(sensSlider.value);\n      if (sensValue) sensValue.textContent = `${value}%`;\n      // Чувствительность от 0.001 до 0.01\n      this.input.setSensitivity(0.001 + (value / 100) * 0.009);\n    });\n\n    // Предотвращаем запуск игры при клике на слайдеры и кнопки\n    document.getElementById('settings')?.addEventListener('click', (e) => {\n      e.stopPropagation();\n    });\n    document.getElementById('start-buttons')?.addEventListener('click', (e) => {\n      e.stopPropagation();\n    });\n\n    // Кнопка НАЧАТЬ\n    document.getElementById('btn-start')?.addEventListener('click', () => this.start());\n    \n    // Кнопки боссов\n    document.getElementById('btn-boss5')?.addEventListener('click', () => this.startFromWave(5));\n    document.getElementById('btn-boss10')?.addEventListener('click', () => this.startFromWave(10));\n    document.getElementById('btn-boss15')?.addEventListener('click', () => this.startFromWave(15));\n\n    // Клик по экрану тоже запускает\n    this.startScreen?.addEventListener('click', () => this.start());\n\n    document.addEventListener('keydown', (e) => {\n      if (e.code === 'KeyM') {\n        this.audio.toggleMute();\n      }\n      if (e.code === 'KeyF') {\n        this.toggleFullscreen();\n      }\n    });\n\n    window.addEventListener('resize', () => this.handleResize());\n  }\n\n  /** Запуск игры */\n  public start(): void {\n    this.startFromWave(1);\n  }\n\n  /** Запуск с определённой волны (для боссов) */\n  public startFromWave(wave: number): void {\n    if (this.state.isRunning) return;\n\n    // Читаем настройки\n    const volumeSlider = document.getElementById('volume-slider') as HTMLInputElement;\n    const sensSlider = document.getElementById('sens-slider') as HTMLInputElement;\n    \n    if (volumeSlider) {\n      this.audio.setVolume(parseInt(volumeSlider.value) / 100);\n    }\n    if (sensSlider) {\n      this.input.setSensitivity(0.001 + (parseInt(sensSlider.value) / 100) * 0.009);\n    }\n\n    if (this.startScreen) {\n      this.startScreen.style.display = 'none';\n    }\n\n    this.input.requestPointerLock();\n    this.audio.start();\n    this.gameLoop.start();\n    this.state.isRunning = true;\n\n    // Начинаем с указанной волны\n    this.targetManager.startGame(wave);\n    \n    // Сообщение о боссе\n    if (wave === 5) {\n      this.hud.showMessage('⚠️ ЗЕЛЁНЫЙ БОСС! ⚠️', 'lime');\n    } else if (wave === 10) {\n      this.hud.showMessage('☠️ ЧЁРНЫЙ БОСС! ☠️', 'purple');\n    } else if (wave === 15) {\n      this.hud.showMessage('⚡ СИНИЙ БОСС! ⚡', 'cyan');\n    }\n\n    this.handleResize();\n  }\n\n  /** Остановка игры */\n  public stop(): void {\n    this.gameLoop.stop();\n    this.state.isRunning = false;\n    this.input.exitPointerLock();\n  }\n\n  /** Обновление игры */\n  private update(dt: number): void {\n    if (this.state.isPaused || this.isPaused) return;\n\n    this.gameTime += dt;\n\n    // Обновляем анимацию платформ (парение)\n    this.collision.updatePlatforms(this.gameTime);\n\n    // Обновляем таймер замедления\n    if (this.slowdownTimer > 0) {\n      this.slowdownTimer -= dt;\n      if (this.slowdownTimer <= 0) {\n        this.slowdownFactor = 1.0;\n      }\n    }\n\n    // Обновляем игрока с учётом замедления\n    const effectiveDt = dt * this.slowdownFactor;\n    this.player.update(effectiveDt, this.input.state, {\n      x: this.input.mouseDelta.x * this.slowdownFactor,\n      y: this.input.mouseDelta.y * this.slowdownFactor\n    });\n    this.input.resetMouseDelta();\n\n    // Притяжение вихря чёрного босса\n    const vortexPull = this.targetManager.getVortexPull(this.player.state.position);\n    if (vortexPull.x !== 0 || vortexPull.z !== 0) {\n      this.player.state.position.x += vortexPull.x * dt;\n      this.player.state.position.z += vortexPull.z * dt;\n      // Тряска экрана во время вихря\n      this.screenShake = Math.max(this.screenShake, 0.3);\n    }\n\n    // Звуки движения\n    this.updateMovementSounds(dt);\n\n    // Обычная атака катаной (ЛКМ)\n    if (this.input.state.fire) {\n      if (this.weapon.tryAttack()) {\n        this.audio.playSFX('katana_swing');\n        this.checkNormalAttack();\n      }\n    }\n\n    // Сплеш-атака (ПКМ) - если есть заряды\n    if (this.input.state.altFire) {\n      if (this.weapon.trySplashAttack()) {\n        this.audio.playSFX('splash_wave');\n        this.checkSplashAttack();\n      }\n    }\n\n    // Обновляем катану\n    const isMoving = this.input.state.forward || this.input.state.backward ||\n                     this.input.state.left || this.input.state.right;\n    this.weapon.update(dt, isMoving, this.input.state.run);\n\n    // Синхронизируем анимацию с рендерером\n    this.weaponRenderer.isAttacking = this.weapon.isAttacking;\n    this.weaponRenderer.attackProgress = this.weapon.attackProgress;\n    this.weaponRenderer.isSplashAttack = this.weapon.isSplashAttack;\n    this.weaponRenderer.splashCharges = this.weapon.splashCharges;\n\n    // Обновляем врагов\n    const playerPos = this.player.getEyePosition();\n    this.targetManager.update(dt, playerPos, this.gameTime);\n\n    // Звуки приближения врагов\n    this.updateEnemyProximitySounds(playerPos);\n\n    // Проверяем прицепившихся раннеров\n    this.checkAttachedRunners();\n\n    // Отслеживаем отпускание Space для двойного прыжка\n    if (!this.input.state.jump && this.wasJumpPressed) {\n      this.player.onJumpReleased();\n    }\n    this.wasJumpPressed = this.input.state.jump;\n\n    // Двойной прыжок для скидывания раннера\n    if (this.input.state.jump && !this.player.state.grounded) {\n      if (this.player.tryDoubleJump()) {\n        // Пробуем скинуть раннеров\n        this.detachRunners();\n        this.audio.playSFX('jump');\n      }\n    }\n\n    // Обновляем предметы\n    const pickedUp = this.pickupManager.update(dt, this.gameTime, playerPos);\n    if (pickedUp) {\n      this.onPickup(pickedUp);\n    }\n\n    // Звук приближения ближайшего врага\n    const closestDist = this.targetManager.getClosestEnemyDistance(playerPos);\n    if (closestDist < 15) {\n      const proximity = Math.max(0, 1 - closestDist / 15);\n      this.audio.updateProximitySound(proximity);\n    } else {\n      this.audio.updateProximitySound(0);\n    }\n\n    // Тряска экрана\n    if (this.screenShake > 0) {\n      this.screenShake -= dt * 2;\n    }\n\n    // Проверка смерти\n    if (this.player.isDead()) {\n      this.gameOver();\n    }\n\n    // Обновляем HUD\n    this.hud.updateHealth(this.player.state.health, this.player.state.maxHealth);\n    this.hud.updateAmmo(this.targetManager.wave, this.targetManager.getActiveCount());\n    this.hud.updateFrags(this.state.frags);\n    this.hud.updateSplashCharges(this.weapon.splashCharges);\n    this.hud.updateDoubleJump(this.player.getDoubleJumpCooldown(), this.player.isDoubleJumpReady());\n    \n    // Проверка низкого HP для тревожной музыки (меньше 30%)\n    const hpPercent = this.player.state.health / this.player.state.maxHealth;\n    this.audio.setLowHpMode(hpPercent < 0.3 && hpPercent > 0);\n    \n    // Показываем HP босса если есть\n    const boss = this.targetManager.getActiveBoss();\n    if (boss) {\n      this.hud.showBossHealth(boss.hp, boss.maxHp, boss.enemyType);\n    } else {\n      this.hud.hideBossHealth();\n    }\n  }\n\n  /** Звуки движения */\n  private updateMovementSounds(dt: number): void {\n    const isMoving = this.input.state.forward || this.input.state.backward ||\n                     this.input.state.left || this.input.state.right;\n\n    if (isMoving && this.player.state.grounded) {\n      this.footstepTimer -= dt;\n      if (this.footstepTimer <= 0) {\n        this.audio.playSFX('footstep');\n        this.footstepTimer = this.input.state.run ? 0.25 : 0.4;\n      }\n    }\n\n    if (this.player.state.grounded && !this.wasGrounded) {\n      this.audio.playSFX('land');\n    }\n    this.wasGrounded = this.player.state.grounded;\n  }\n\n  /** Callback при взмахе катаной */\n  private onKatanaSlice(): void {\n    this.audio.playSFX('katana_swing');\n  }\n\n  /** Game Over */\n  private gameOver(): void {\n    this.state.isPaused = true;\n    this.hud.showGameOver(this.state.frags, this.targetManager.wave);\n    \n    // Перезапуск через 3 секунды\n    setTimeout(() => {\n      this.restart();\n    }, 3000);\n  }\n\n  /** Перезапуск */\n  private restart(): void {\n    this.player.reset(vec3(0, 1.7, 12));\n    this.player.state.health = 100;\n    this.state.frags = 0;\n    this.state.isPaused = false;\n    this.targetManager.startGame();\n    this.pickupManager.pickups = [];\n  }\n\n  /** Проверка прицепившихся раннеров */\n  private checkAttachedRunners(): void {\n    for (const target of this.targetManager.targets) {\n      if (target.enemyType === 'runner' && target.isAttached) {\n        // Раннер прицепился - урон когда время выйдет\n        if (target.attachTimer <= 0 && target.active === false) {\n          this.player.takeDamage(target.damage);\n          this.audio.playSFX('runner_hit');\n          this.screenShake = 0.6;\n          this.hud.showDamage('green');\n          this.hud.showMessage('⚠️ РАННЕР УКУСИЛ!', 'orange');\n        }\n      }\n    }\n  }\n\n  /** Звуки приближения врагов */\n  private updateEnemyProximitySounds(playerPos: Vec3): void {\n    for (const target of this.targetManager.targets) {\n      if (!target.active) continue;\n\n      const dx = target.position.x - playerPos.x;\n      const dy = target.position.y - playerPos.y;\n      const dz = target.position.z - playerPos.z;\n      const dist = Math.sqrt(dx * dx + dy * dy + dz * dz);\n\n      // Звук при приближении\n      this.audio.playEnemyProximitySound(target.enemyType, dist);\n    }\n  }\n\n  /** Скинуть раннеров двойным прыжком */\n  private detachRunners(): void {\n    let detached = false;\n    for (const target of this.targetManager.targets) {\n      if (target.enemyType === 'runner' && target.isAttached) {\n        target.detachRunner();\n        detached = true;\n      }\n    }\n    if (detached) {\n      this.hud.showMessage('✓ РАННЕР СБРОШЕН!', 'cyan');\n    }\n  }\n\n  /** Подбор предмета */\n  private onPickup(type: string): void {\n    if (type === 'health') {\n      // Аптечка - восстанавливает HP\n      const heal = 30;\n      this.player.state.health = Math.min(\n        this.player.state.maxHealth,\n        this.player.state.health + heal\n      );\n      this.audio.playSFX('jump'); // Временный звук\n      this.hud.showMessage('+' + heal + ' HP', 'lime');\n      this.hud.updateHealth(this.player.state.health, this.player.state.maxHealth);\n      \n    } else if (type === 'stimpack') {\n      // Стимпак - буйство!\n      this.player.activateStimpack();\n      this.audio.playSFX('kill'); // Временный звук\n      this.hud.showMessage('🔥 БУЙСТВО! 🔥', 'red');\n      this.hud.showRageOverlay(8.0);\n      \n    } else if (type === 'charge') {\n      // Заряд катаны - 3 сплеш-удара!\n      this.weapon.chargeKatana();\n      this.audio.playSFX('charge_pickup');\n      this.hud.showMessage('⚡ КАТАНА ЗАРЯЖЕНА! (ПКМ x3) ⚡', 'cyan');\n      this.hud.updateSplashCharges(3);\n      this.screenShake = 0.5;\n    }\n  }\n\n  /** Проверка обычной атаки */\n  private checkNormalAttack(): void {\n    const playerPos = this.player.getEyePosition();\n    const hit = this.targetManager.trySlice(\n      playerPos,\n      this.player.state.yaw,\n      this.weapon.attackRange,\n      this.weapon.attackAngle\n    );\n    \n    if (hit) {\n      this.lastSliceTime = this.gameTime;\n      this.weaponRenderer.showHitEffect();\n      this.audio.playSFX('kill');\n    }\n\n    // Проверяем попадание по кристаллам (только на волне 10)\n    if (this.targetManager.wave === 10) {\n      const crystalHit = this.targetManager.trySliceCrystal(\n        playerPos,\n        this.player.state.yaw,\n        this.weapon.attackRange\n      );\n      \n      if (crystalHit) {\n        this.weaponRenderer.showHitEffect();\n        this.audio.playSFX('kill');\n        const remaining = this.targetManager.powerCrystals.filter(c => c.active).length;\n        \n        if (remaining === 0) {\n          this.hud.showMessage('💀 КРИСТАЛЛЫ УНИЧТОЖЕНЫ! БОСС ОСЛАБЛЕН! 💀', 'purple');\n          this.screenShake = 2.0;\n        } else {\n          this.hud.showMessage(`🔮 КРИСТАЛЛ РАЗБИТ! (${remaining}/6)`, 'cyan');\n        }\n      }\n    }\n  }\n\n  /** Проверка сплеш-атаки - горизонтальная волна */\n  private checkSplashAttack(): void {\n    const playerPos = this.player.getEyePosition();\n    \n    // Сплеш бьёт всех врагов в радиусе\n    const hits = this.targetManager.trySplashWave(\n      playerPos,\n      this.player.state.yaw,\n      this.weapon.splashRadius\n    );\n    \n    if (hits > 0) {\n      this.lastSliceTime = this.gameTime;\n      this.weaponRenderer.showSplashWave(this.player.state.yaw);\n      this.screenShake = 0.4;\n      this.audio.playSFX('kill');\n      \n      // Показываем сколько убито\n      this.hud.showMessage(`🌊 ВОЛНА x${hits}! 🌊`, 'cyan');\n    }\n    \n    // Обновляем HUD с зарядами\n    this.hud.updateSplashCharges(this.weapon.splashCharges);\n  }\n\n  /** Активация адреналина за комбо-убийства */\n  private activateComboAdrenaline(): void {\n    // Сбрасываем счётчик комбо\n    this.killTimes = [];\n    \n    // Активируем буйство\n    this.player.activateStimpack();\n    this.audio.playSFX('kill');\n    this.hud.showMessage('🔥🔥🔥 КОМБО АДРЕНАЛИН! 🔥🔥🔥', 'red');\n    this.hud.showRageOverlay(8.0);\n    this.screenShake = 0.5;\n  }\n\n  /** Рендеринг */\n  private render(): void {\n    // Данные врагов для шейдера\n    const targetsData = this.targetManager.getShaderData();\n    const targetCount = this.targetManager.targets.length;\n\n    // Данные луж для шейдера\n    const poolsData = this.targetManager.getPoolsShaderData();\n    const poolCount = this.targetManager.toxicPools.length;\n\n    // Данные пикапов для шейдера\n    const pickupsData = this.pickupManager.getShaderData();\n    const pickupCount = this.pickupManager.pickups.length;\n\n    // Тряска камеры\n    let yaw = this.player.state.yaw;\n    let pitch = this.player.state.pitch;\n    \n    if (this.screenShake > 0) {\n      yaw += (Math.random() - 0.5) * this.screenShake * 0.1;\n      pitch += (Math.random() - 0.5) * this.screenShake * 0.1;\n    }\n\n    // Вспышка при ударе\n    const sliceFlash = Math.max(0, 0.3 - (this.gameTime - this.lastSliceTime)) * 3;\n\n    // Данные кристаллов (для волны 10)\n    const crystalsData = this.targetManager.getCrystalsData();\n\n    // Данные летящих снарядов кислоты\n    const acidProjectilesData = this.targetManager.getAcidProjectilesData();\n    const acidProjectileCount = this.targetManager.acidProjectiles.length;\n\n    // Данные зон кислотного дождя\n    const acidRainZonesData = this.targetManager.getAcidRainZonesData();\n    const acidRainZoneCount = this.targetManager.acidRainZones.length;\n\n    // Рендерим сцену\n    this.renderer.render(\n      this.gameTime,\n      this.player.getEyePosition(),\n      yaw,\n      pitch,\n      targetsData,\n      targetCount,\n      sliceFlash,\n      poolsData,\n      poolCount,\n      this.currentEra,\n      this.targetManager.wave,\n      pickupsData,\n      pickupCount,\n      crystalsData,\n      acidProjectilesData,\n      acidProjectileCount,\n      acidRainZonesData,\n      acidRainZoneCount\n    );\n\n    // Рендерим оружие\n    this.weaponRenderer.render(this.weapon.state, this.gameTime);\n  }\n\n  /** Обработка resize */\n  private handleResize(): void {\n    const dpr = window.devicePixelRatio || 1;\n\n    this.weaponCanvas.width = window.innerWidth * dpr;\n    this.weaponCanvas.height = window.innerHeight * dpr;\n    this.weaponCanvas.style.width = window.innerWidth + 'px';\n    this.weaponCanvas.style.height = window.innerHeight + 'px';\n\n    this.weaponRenderer.resize(this.weaponCanvas.width, this.weaponCanvas.height);\n  }\n\n  /** Полноэкранный режим */\n  private toggleFullscreen(): void {\n    if (!document.fullscreenElement) {\n      document.documentElement.requestFullscreen();\n    } else {\n      document.exitFullscreen();\n    }\n  }\n\n  /** Уничтожить игру */\n  public destroy(): void {\n    this.stop();\n    this.input.destroy();\n    this.audio.stop();\n    this.renderer.destroy();\n  }\n}\n","import { Game } from '@/core/Game';\nimport './styles.css';\n\n/**\n * Точка входа приложения\n * Dungeon Synth Shooter\n */\nfunction main(): void {\n  // Получаем canvas элементы\n  const canvas = document.getElementById('game-canvas') as HTMLCanvasElement;\n  const weaponCanvas = document.getElementById('weapon-canvas') as HTMLCanvasElement;\n\n  if (!canvas || !weaponCanvas) {\n    console.error('Canvas элементы не найдены!');\n    return;\n  }\n\n  // Создаём игру\n  const game = new Game(canvas, weaponCanvas);\n\n  // Делаем доступной глобально для отладки\n  (window as any).game = game;\n\n  console.log('🎮 Dungeon Synth Shooter загружен');\n  console.log('📖 Управление: WASD, SHIFT (бег), SPACE (прыжок), LMB (стрельба), R (перезарядка)');\n  console.log('🔊 M - mute, F - fullscreen');\n}\n\n// Запускаем после загрузки DOM\nif (document.readyState === 'loading') {\n  document.addEventListener('DOMContentLoaded', main);\n} else {\n  main();\n}\n\n\n"],"names":["GameLoop","updateFn","renderFn","currentTime","deltaTime","interpolation","Input","value","canvas","e","onLockChange","code","pressed","dx","dy","vec3","x","y","z","subVec3","a","b","lengthVec3","v","normalizeVec3","len","distanceVec3","clamp","min","max","DEFAULT_CONFIG","Player","startPosition","config","collision","dt","input","mouseDelta","state","moveX","moveZ","moveLen","sin","cos","worldMoveX","worldMoveZ","speed","targetVx","targetVz","targetY","friction","heightDiff","airFriction","newPosX","newPosY","newPosZ","testPosX","testPosZ","minY","testPosY","ceilingHeight","yaw","pitch","amount","position","Weapon","isMoving","isRunning","bobSpeed","isSplash","playerPos","playerYaw","targetPos","dz","dist","angleDiff","bobX","bobY","attackOffsetX","attackOffsetY","t","_playerPos","_playerDir","WeaponRenderer","width","height","centerX","centerY","colors","i","angle","heightLimit","writeIndex","p","ctx","alpha","time","scale","baseX","baseY","rotation","easeOut","moveMultiplier","pulse","maxRadius","currentRadius","r","sparkCount","sparkR","size","progress","cyanGrad","offset","_state","tsukaGrad","glow","bladeGrad","wave","color","sparkColor","charges","intensity","weaponType","gradient","Target","id","type","dirX","dirY","dirZ","aggression","currentSpeed","offsetX","offsetY","offsetZ","perpX","perpZ","newX","newZ","wobble","orbitRadius","orbitHeight","obstacleHeight","testPos","dodgedDirX","dodgedDirZ","zigzag","force","baseRadius","spitCooldownActual","rainTarget","spitTarget","spitStart","extra","speedMult","spawnAngle","spawnDist","spawnPos","orbitSpeed","targetX","targetZ","toOrbitX","toOrbitZ","pullStrength","_time","distXZ","gravity","jumpForce","jumpSpeed","f","sliceDirection","numFragments","upAngle","vx","vy","vz","w","data","TargetManager","startWave","baseSpeed","bossConfigs","boss","pos","startPos","phase","platformPositions","banelingCount","phantomCount","runnerCount","hopperCount","totalCount","idx","cd","target","proj","pool","zone","range","effectiveRange","killed","sliceDir","knockbackForce","radius","killCount","effectiveRadius","typeIntensity","allFragments","lifetimeNorm","bossPos","baneling","phantom","crystal","remaining","c","minDist","_count","_position","_damage","Pickup","PickupManager","pickup","platform","AudioManager","distortion","samples","curve","deg","duration","convolver","rate","length","impulse","channel","decay","mod","proximity","freq","volume","filterFreq","vibrato","enemyType","distance","now","lastPlayed","cooldown","ctxNow","vol","osc","gain","filter","osc1","osc2","bufferSize","buffer","noise","growl","growlGain","warp","warpGain","zap","zapGain","boom","boomGain","acidNoise","acidGain","acidFilter","acidFilter2","delay","bubble","bubbleGain","hiss","hissGain","hissFilter","swoosh","swooshGain","swooshFilter","dark","darkGain","whisper","whisperGain","whisperFilter","crackle","crackleGain","impact","impactGain","zapFilter","thud","thudGain","sparks","sparksGain","sparksFilter","kick","kickGain","noiseGain","noiseFilter","synth","synth2","synthGain","synthFilter","glitch","glitchGain","source","whoosh","whooshGain","whooshFilter","metal","metalGain","waveGain","waveFilter","noiseSource","resonance","resonanceGain","subBass","subGain","charge","charge2","chargeGain","chargeFilter","shimmer","shimmerGain","noiseSource2","noiseGain2","noiseFilter2","spit","spitGain","splash","splashGain","splashFilter","warn","warnGain","warnFilter","beep","beepGain","rain","rainGain","rainFilter","rumble","rumbleGain","gong","gongGain","gong2","gong2Gain","newEra","interval","sampleRate","sample","lowpass","highpass","playThunder","thunderGain","noiseBuffer","noiseData","crackOsc","crackGain","crackFilter","bassNotes","noteIndex","playBass","arpNotes","arpIndex","playArp","playKick","playDrone","lfo","lfoGain","beat","playBeat","playEerie","playGravity","delayGain","playPad","chord","playZap","enabled","playHeartbeat","playSpark","j","playWarning","notes","note","playStatic","bossType","playHeavyKick","playAlarm","start","oscGain","playRiser","playSubDrop","playNoiseSweep","playFastHihat","acidPattern","slidePattern","step","playAcidBass","isSlide","filterStart","filterPeak","accent","click","clickGain","hihatStep","playHihat","isOffbeat","playAcidScream","bassIndex","playDubBass","echo","echoOsc","echoFilter","echoGain","echoTime","echoVol","breakPattern","breakIndex","playBreakHit","hit","playDubChord","playSubDrone","playFx","oscFilter","playRiserHit","hitOsc","hitGain","playBassNote","playArpNote","padChords","chordIndex","playPadChord","snare","snareGain","snareFilter","snareTone","snareToneGain","hihat","hihatGain","hihatFilter","VERTEX_SHADER","FRAGMENT_SHADER","WebGLRenderer","gl","vertShader","fragShader","shader","vertices","vbo","posLoc","dpr","cameraPos","cameraYaw","cameraPitch","targetsData","targetCount","muzzleFlash","poolsData","poolCount","era","pickupsData","pickupCount","crystalsData","acidProjectilesData","acidProjectileCount","acidRainZonesData","acidRainZoneCount","HUD","el","corner","cornerEl","h","weapon","health","maxHealth","ratio","isReady","_wave","enemiesLeft","frags","score","_show","isKill","text","msg","style","hp","maxHp","barContainer","bossName","barColor","percent","onComplete","bossSubtitle","glowColor","icon","overlay","iconEl","nameEl","subtitleEl","lineLeft","lineRight","lineStyle","CollisionSystem","bobAmount","distFromCenter","columnPositions","col","allPlatforms","plat","feetY","onBridgeX","onBridgeZ","leftStairStartX","leftStairEndX","leftPlatformEnd","rightStairStartX","rightStairEndX","rightPlatformEnd","checkDist","checkX","checkZ","Game","weaponCanvas","damage","_pos","volumeSlider","volumeValue","sensSlider","sensValue","effectiveDt","vortexPull","pickedUp","closestDist","hpPercent","detached","hits","sliceFlash","main","game"],"mappings":"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AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;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"}