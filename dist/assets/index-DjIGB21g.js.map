{"version":3,"file":"index-DjIGB21g.js","sources":["../../src/core/GameLoop.ts","../../src/core/Input.ts","../../src/utils/math.ts","../../src/player/Player.ts","../../src/weapon/Weapon.ts","../../src/weapon/WeaponRenderer.ts","../../src/enemies/Target.ts","../../src/items/Pickup.ts","../../src/audio/AudioManager.ts","../../src/render/Shaders.ts","../../src/render/WebGLRenderer.ts","../../src/render/HUD.ts","../../src/world/Collision.ts","../../src/core/Game.ts","../../src/main.ts"],"sourcesContent":["/**\n * Игровой цикл с фиксированным временным шагом\n */\nexport class GameLoop {\n  /** Функция обновления логики */\n  private updateFn: (dt: number) => void;\n\n  /** Функция рендеринга */\n  private renderFn: (interpolation: number) => void;\n\n  /** Время последнего кадра */\n  private lastTime = 0;\n\n  /** Накопленное время */\n  private accumulator = 0;\n\n  /** Фиксированный временной шаг (60 FPS) */\n  public readonly fixedDeltaTime = 1 / 60;\n\n  /** ID запроса анимации */\n  private animationFrameId: number | null = null;\n\n  /** Цикл запущен */\n  public isRunning = false;\n\n  /** Текущий FPS */\n  public fps = 0;\n\n  /** Счётчик кадров для FPS */\n  private frameCount = 0;\n\n  /** Время последнего замера FPS */\n  private fpsTime = 0;\n\n  constructor(\n    updateFn: (dt: number) => void,\n    renderFn: (interpolation: number) => void\n  ) {\n    this.updateFn = updateFn;\n    this.renderFn = renderFn;\n  }\n\n  /** Запустить цикл */\n  public start(): void {\n    if (this.isRunning) return;\n\n    this.isRunning = true;\n    this.lastTime = performance.now();\n    this.fpsTime = this.lastTime;\n    this.frameCount = 0;\n    this.animationFrameId = requestAnimationFrame(this.tick.bind(this));\n  }\n\n  /** Остановить цикл */\n  public stop(): void {\n    if (!this.isRunning) return;\n\n    this.isRunning = false;\n    if (this.animationFrameId !== null) {\n      cancelAnimationFrame(this.animationFrameId);\n      this.animationFrameId = null;\n    }\n  }\n\n  /** Один тик игрового цикла */\n  private tick(currentTime: number): void {\n    if (!this.isRunning) return;\n\n    // Вычисляем дельту времени\n    const deltaTime = Math.min((currentTime - this.lastTime) / 1000, 0.1);\n    this.lastTime = currentTime;\n\n    // Обновляем FPS\n    this.frameCount++;\n    if (currentTime - this.fpsTime >= 1000) {\n      this.fps = this.frameCount;\n      this.frameCount = 0;\n      this.fpsTime = currentTime;\n    }\n\n    // Накапливаем время для фиксированного шага\n    this.accumulator += deltaTime;\n\n    // Выполняем обновления с фиксированным шагом\n    while (this.accumulator >= this.fixedDeltaTime) {\n      this.updateFn(this.fixedDeltaTime);\n      this.accumulator -= this.fixedDeltaTime;\n    }\n\n    // Рендерим с интерполяцией\n    const interpolation = this.accumulator / this.fixedDeltaTime;\n    this.renderFn(interpolation);\n\n    // Следующий кадр\n    this.animationFrameId = requestAnimationFrame(this.tick.bind(this));\n  }\n}\n\n\n\n\n\n\n\n\n\n","import type { InputState } from '@/types';\n\n/**\n * Менеджер ввода\n * Обрабатывает клавиатуру и мышь\n */\nexport class Input {\n  /** Текущее состояние ввода */\n  public state: InputState = {\n    forward: false,\n    backward: false,\n    left: false,\n    right: false,\n    run: false,\n    jump: false,\n    fire: false,\n    altFire: false, // ПКМ для сплеш-атаки\n    reload: false,\n    throwGrenade: false, // Колёсико для гранаты\n  };\n\n  /** Движение мыши за кадр */\n  public mouseDelta = { x: 0, y: 0 };\n\n  /** Pointer Lock активен */\n  public isPointerLocked = false;\n\n  /** Чувствительность мыши (выше = быстрее) */\n  public sensitivity = 0.005;\n\n  /** Установить чувствительность */\n  public setSensitivity(value: number): void {\n    this.sensitivity = Math.max(0.001, Math.min(0.015, value));\n  }\n\n  /** Инвертировать ось X */\n  public invertX = true;\n\n  /** Инвертировать ось Y */\n  public invertY = true;\n\n  private canvas: HTMLCanvasElement;\n  private onPointerLockChange?: () => void;\n\n  constructor(canvas: HTMLCanvasElement) {\n    this.canvas = canvas;\n    this.setupListeners();\n  }\n\n  /** Настройка обработчиков событий */\n  private setupListeners(): void {\n    // Клавиатура\n    document.addEventListener('keydown', this.handleKeyDown.bind(this));\n    document.addEventListener('keyup', this.handleKeyUp.bind(this));\n\n    // Мышь\n    document.addEventListener('mousemove', this.handleMouseMove.bind(this));\n    document.addEventListener('mousedown', this.handleMouseDown.bind(this));\n    document.addEventListener('mouseup', this.handleMouseUp.bind(this));\n    document.addEventListener('wheel', this.handleWheel.bind(this));\n\n    // Отключаем контекстное меню для ПКМ\n    this.canvas.addEventListener('contextmenu', (e) => e.preventDefault());\n\n    // Pointer Lock\n    document.addEventListener('pointerlockchange', this.handlePointerLockChange.bind(this));\n  }\n\n  /** Запросить Pointer Lock */\n  public requestPointerLock(onLockChange?: () => void): void {\n    this.onPointerLockChange = onLockChange;\n    this.canvas.requestPointerLock();\n  }\n\n  /** Выйти из Pointer Lock */\n  public exitPointerLock(): void {\n    document.exitPointerLock();\n  }\n\n  /** Сбросить дельту мыши (вызывать в конце кадра) */\n  public resetMouseDelta(): void {\n    this.mouseDelta.x = 0;\n    this.mouseDelta.y = 0;\n  }\n\n  /** Обработка нажатия клавиши */\n  private handleKeyDown(e: KeyboardEvent): void {\n    this.updateKeyState(e.code, true);\n  }\n\n  /** Обработка отпускания клавиши */\n  private handleKeyUp(e: KeyboardEvent): void {\n    this.updateKeyState(e.code, false);\n  }\n\n  /** Обновление состояния клавиши */\n  private updateKeyState(code: string, pressed: boolean): void {\n    switch (code) {\n      case 'KeyW':\n        this.state.forward = pressed;\n        break;\n      case 'KeyS':\n        this.state.backward = pressed;\n        break;\n      case 'KeyA':\n        this.state.left = pressed;\n        break;\n      case 'KeyD':\n        this.state.right = pressed;\n        break;\n      case 'ShiftLeft':\n      case 'ShiftRight':\n        this.state.run = pressed;\n        break;\n      case 'Space':\n        this.state.jump = pressed;\n        break;\n      case 'KeyR':\n        this.state.reload = pressed;\n        break;\n    }\n  }\n\n  /** Обработка движения мыши */\n  private handleMouseMove(e: MouseEvent): void {\n    if (!this.isPointerLocked) return;\n\n    // Инверсия осей как в оригинале\n    const dx = this.invertX ? -e.movementX : e.movementX;\n    const dy = this.invertY ? -e.movementY : e.movementY;\n\n    this.mouseDelta.x += dx * this.sensitivity;\n    this.mouseDelta.y += dy * this.sensitivity;\n  }\n\n  /** Обработка нажатия кнопки мыши */\n  private handleMouseDown(e: MouseEvent): void {\n    if (e.button === 0) {\n      this.state.fire = true;\n    } else if (e.button === 1) {\n      // Средняя кнопка (нажатие на колёсико) - граната\n      e.preventDefault();\n      this.state.throwGrenade = true;\n    } else if (e.button === 2) {\n      e.preventDefault();\n      this.state.altFire = true;\n    }\n  }\n\n  /** Обработка отпускания кнопки мыши */\n  private handleMouseUp(e: MouseEvent): void {\n    if (e.button === 0) {\n      this.state.fire = false;\n    } else if (e.button === 2) {\n      this.state.altFire = false;\n    }\n  }\n\n  /** Обработка колёсика мыши (бросок гранаты) */\n  private handleWheel(e: WheelEvent): void {\n    if (!this.isPointerLocked) return;\n    e.preventDefault();\n    // Любое движение колёсика - бросок гранаты\n    this.state.throwGrenade = true;\n  }\n\n  /** Обработка изменения Pointer Lock */\n  private handlePointerLockChange(): void {\n    this.isPointerLocked = document.pointerLockElement === this.canvas;\n    this.onPointerLockChange?.();\n  }\n\n  /** Удалить обработчики */\n  public destroy(): void {\n    document.removeEventListener('keydown', this.handleKeyDown.bind(this));\n    document.removeEventListener('keyup', this.handleKeyUp.bind(this));\n    document.removeEventListener('mousemove', this.handleMouseMove.bind(this));\n    document.removeEventListener('mousedown', this.handleMouseDown.bind(this));\n    document.removeEventListener('mouseup', this.handleMouseUp.bind(this));\n    document.removeEventListener('pointerlockchange', this.handlePointerLockChange.bind(this));\n  }\n}\n\n","import type { Vec3, Vec2 } from '@/types';\n\n// ========== СОЗДАНИЕ ВЕКТОРОВ ==========\n\n/** Создать Vec3 */\nexport function vec3(x: number = 0, y: number = 0, z: number = 0): Vec3 {\n  return { x, y, z };\n}\n\n/** Создать Vec2 */\nexport function vec2(x: number = 0, y: number = 0): Vec2 {\n  return { x, y };\n}\n\n// ========== ОПЕРАЦИИ С VEC3 ==========\n\n/** Сложение векторов */\nexport function addVec3(a: Vec3, b: Vec3): Vec3 {\n  return { x: a.x + b.x, y: a.y + b.y, z: a.z + b.z };\n}\n\n/** Вычитание векторов */\nexport function subVec3(a: Vec3, b: Vec3): Vec3 {\n  return { x: a.x - b.x, y: a.y - b.y, z: a.z - b.z };\n}\n\n/** Умножение на скаляр */\nexport function mulVec3(v: Vec3, s: number): Vec3 {\n  return { x: v.x * s, y: v.y * s, z: v.z * s };\n}\n\n/** Длина вектора */\nexport function lengthVec3(v: Vec3): number {\n  return Math.sqrt(v.x * v.x + v.y * v.y + v.z * v.z);\n}\n\n/** Длина XZ компоненты */\nexport function lengthXZ(v: Vec3): number {\n  return Math.sqrt(v.x * v.x + v.z * v.z);\n}\n\n/** Нормализация вектора */\nexport function normalizeVec3(v: Vec3): Vec3 {\n  const len = lengthVec3(v);\n  if (len === 0) return { x: 0, y: 0, z: 0 };\n  return { x: v.x / len, y: v.y / len, z: v.z / len };\n}\n\n/** Скалярное произведение */\nexport function dotVec3(a: Vec3, b: Vec3): number {\n  return a.x * b.x + a.y * b.y + a.z * b.z;\n}\n\n/** Векторное произведение */\nexport function crossVec3(a: Vec3, b: Vec3): Vec3 {\n  return {\n    x: a.y * b.z - a.z * b.y,\n    y: a.z * b.x - a.x * b.z,\n    z: a.x * b.y - a.y * b.x,\n  };\n}\n\n/** Линейная интерполяция */\nexport function lerpVec3(a: Vec3, b: Vec3, t: number): Vec3 {\n  return {\n    x: a.x + (b.x - a.x) * t,\n    y: a.y + (b.y - a.y) * t,\n    z: a.z + (b.z - a.z) * t,\n  };\n}\n\n/** Расстояние между точками */\nexport function distanceVec3(a: Vec3, b: Vec3): number {\n  return lengthVec3(subVec3(a, b));\n}\n\n// ========== УТИЛИТЫ ==========\n\n/** Ограничить значение */\nexport function clamp(value: number, min: number, max: number): number {\n  return Math.max(min, Math.min(max, value));\n}\n\n/** Линейная интерполяция чисел */\nexport function lerp(a: number, b: number, t: number): number {\n  return a + (b - a) * t;\n}\n\n/** Плавный переход (smoothstep) */\nexport function smoothstep(edge0: number, edge1: number, x: number): number {\n  const t = clamp((x - edge0) / (edge1 - edge0), 0, 1);\n  return t * t * (3 - 2 * t);\n}\n\n/** Градусы в радианы */\nexport function degToRad(deg: number): number {\n  return deg * (Math.PI / 180);\n}\n\n/** Радианы в градусы */\nexport function radToDeg(rad: number): number {\n  return rad * (180 / Math.PI);\n}\n\n/** Случайное число в диапазоне */\nexport function randomRange(min: number, max: number): number {\n  return min + Math.random() * (max - min);\n}\n\n/** Случайный Vec3 в сфере */\nexport function randomInSphere(radius: number): Vec3 {\n  const theta = Math.random() * Math.PI * 2;\n  const phi = Math.acos(2 * Math.random() - 1);\n  const r = radius * Math.cbrt(Math.random());\n  return {\n    x: r * Math.sin(phi) * Math.cos(theta),\n    y: r * Math.sin(phi) * Math.sin(theta),\n    z: r * Math.cos(phi),\n  };\n}\n\n","import type { PlayerState, MovementConfig, InputState, Vec3, ICollisionSystem } from '@/types';\nimport { vec3, clamp } from '@/utils/math';\n\n/** Конфигурация по умолчанию */\nconst DEFAULT_CONFIG: MovementConfig = {\n  walkSpeed: 8.0,\n  runSpeed: 20.0,\n  jumpForce: 12.0,\n  gravity: 25.0,\n  groundFriction: 12.0,\n  airControl: 0.85,\n  mouseSensitivity: 0.002, // Высокая чувствительность\n};\n\n/**\n * Игрок\n * Управление позицией, движением и камерой\n * Поддержка лестниц через getFloorHeight\n */\nexport class Player {\n  /** Состояние игрока */\n  public state: PlayerState;\n\n  /** Конфигурация движения */\n  public config: MovementConfig;\n\n  /** Система коллизий */\n  private collision: ICollisionSystem;\n\n  /** В режиме войда - отключаем collision */\n  public isInVoid = false;\n\n  /** Скорость подъёма/спуска по лестницам */\n  private stepSpeed = 12.0;\n\n  /** Максимальная высота автоматического подъёма */\n  private maxStepHeight = 0.5;\n\n  /** Целевые значения камеры */\n  private targetYaw = 0;\n  private targetPitch = -0.05;\n\n  /** Кулдаун воздушных прыжков (секунды) */\n  private airJumpCooldown = 0;\n  \n  /** Время кулдауна воздушных прыжков */\n  private readonly AIR_JUMP_COOLDOWN = 2.0;\n\n  /** Сколько воздушных прыжков осталось */\n  private airJumpsLeft = 0;\n  \n  /** Максимум воздушных прыжков (1 = двойной, 2 = тройной) */\n  public maxAirJumps = 1;\n\n  /** Можно ли делать воздушный прыжок (отпустили ли Space) */\n  private canAirJump = false;\n\n  /** Режим буйства */\n  public rageMode = false;\n  public rageModeTimer = 0;\n\n  /** Модификатор скорости (стимпак) */\n  public speedBoost = 1.0;\n  public speedBoostTimer = 0;\n  \n  /** Замедление в воде */\n  public inWater = false;\n  private readonly WATER_SLOW_FACTOR = 0.5; // 50% скорости в воде\n\n  constructor(\n    startPosition: Vec3 = vec3(0, 1.7, 5),\n    config: Partial<MovementConfig> = {},\n    collision: ICollisionSystem\n  ) {\n    this.config = { ...DEFAULT_CONFIG, ...config };\n    this.collision = collision;\n\n    this.state = {\n      position: { ...startPosition },\n      velocity: vec3(),\n      yaw: 0, // Смотрим вперёд\n      pitch: -0.05, // Слегка вниз\n      grounded: true,\n      eyeHeight: 1.7, // Высота глаз над полом\n      health: 100,\n      maxHealth: 100,\n    };\n  }\n\n  /** Обновление игрока */\n  public update(dt: number, input: InputState, mouseDelta: { x: number; y: number }): void {\n    // Обновляем таймеры буйства и скорости\n    if (this.rageModeTimer > 0) {\n      this.rageModeTimer -= dt;\n      if (this.rageModeTimer <= 0) {\n        this.rageMode = false;\n      }\n    }\n    if (this.speedBoostTimer > 0) {\n      this.speedBoostTimer -= dt;\n      if (this.speedBoostTimer <= 0) {\n        this.speedBoost = 1.0;\n      }\n    }\n    \n    // Обновляем кулдаун воздушных прыжков\n    if (this.airJumpCooldown > 0) {\n      this.airJumpCooldown -= dt;\n    }\n\n    // Обновляем камеру\n    this.updateCamera(mouseDelta);\n\n    // Обновляем движение\n    this.updateMovement(dt, input);\n  }\n\n  /** Активировать стимпак */\n  public activateStimpack(): void {\n    this.rageMode = true;\n    this.rageModeTimer = 8.0; // 8 секунд буйства\n    this.speedBoost = 1.8; // +80% скорости\n    this.speedBoostTimer = 8.0;\n  }\n\n  /** Попытка воздушного прыжка - возвращает true если выполнен */\n  public tryDoubleJump(): boolean {\n    // Нужно отпустить Space после предыдущего прыжка\n    if (!this.canAirJump) return false;\n    \n    // Проверяем есть ли воздушные прыжки\n    if (this.airJumpsLeft <= 0) return false;\n    \n    // В режиме буйства - без кулдауна!\n    if (this.rageMode) {\n      this.state.velocity.y = this.config.jumpForce * 0.9;\n      this.airJumpsLeft--;\n      this.canAirJump = false;\n      return true;\n    }\n    \n    // Обычный воздушный прыжок с кулдауном\n    if (this.airJumpCooldown <= 0) {\n      this.airJumpCooldown = this.AIR_JUMP_COOLDOWN;\n      this.state.velocity.y = this.config.jumpForce;\n      this.airJumpsLeft--;\n      this.canAirJump = false;\n      return true;\n    }\n    \n    return false;\n  }\n\n  /** Сообщить что Space отпущен - можно делать воздушный прыжок */\n  public onJumpReleased(): void {\n    if (!this.state.grounded) {\n      this.canAirJump = true;\n    }\n  }\n\n  /** Получить оставшийся кулдаун воздушного прыжка */\n  public getDoubleJumpCooldown(): number {\n    return Math.max(0, this.airJumpCooldown);\n  }\n\n  /** Готов ли воздушный прыжок */\n  public isDoubleJumpReady(): boolean {\n    return (this.airJumpCooldown <= 0 && this.airJumpsLeft > 0) || this.rageMode;\n  }\n\n  /** Разблокировать тройной прыжок */\n  public unlockTripleJump(): void {\n    this.maxAirJumps = 2;\n  }\n\n  /** Получить количество оставшихся воздушных прыжков */\n  public getAirJumpsLeft(): number {\n    return this.airJumpsLeft;\n  }\n\n  /** Обновление камеры - быстрое и лёгкое */\n  private updateCamera(mouseDelta: { x: number; y: number }): void {\n    // Прямое применение движения мыши к целевым углам\n    this.targetYaw -= mouseDelta.x;\n    this.targetPitch += mouseDelta.y;\n\n    // Ограничиваем pitch\n    this.targetPitch = clamp(this.targetPitch, -Math.PI / 2 + 0.01, Math.PI / 2 - 0.01);\n\n    // Быстрая интерполяция (0.7 = почти мгновенно, но чуть сглажено)\n    this.state.yaw += (this.targetYaw - this.state.yaw) * 0.7;\n    this.state.pitch += (this.targetPitch - this.state.pitch) * 0.7;\n  }\n\n  /** Обновление движения с поддержкой лестниц */\n  private updateMovement(dt: number, input: InputState): void {\n    const { state, config } = this;\n\n    // Направление движения от ввода\n    let moveX = 0;\n    let moveZ = 0;\n\n    if (input.forward) moveZ -= 1;\n    if (input.backward) moveZ += 1;\n    if (input.left) moveX -= 1;\n    if (input.right) moveX += 1;\n\n    // Нормализуем если движемся по диагонали\n    const moveLen = Math.sqrt(moveX * moveX + moveZ * moveZ);\n    if (moveLen > 0) {\n      moveX /= moveLen;\n      moveZ /= moveLen;\n    }\n\n    // Поворачиваем направление по yaw\n    const sin = Math.sin(state.yaw);\n    const cos = Math.cos(state.yaw);\n    const worldMoveX = moveX * cos - moveZ * sin;\n    const worldMoveZ = moveX * sin + moveZ * cos;\n\n    // Проверяем, находится ли игрок в воде (центральный бассейн)\n    const distFromCenter = Math.sqrt(state.position.x ** 2 + state.position.z ** 2);\n    const onBridge = Math.abs(state.position.z) < 2.5 || Math.abs(state.position.x) < 2.5;\n    this.inWater = distFromCenter > 2.5 && distFromCenter < 7.7 && !onBridge && state.position.y < 1.5;\n    \n    // Скорость (бег или ходьба) с учётом буста и воды\n    const baseSpeed = input.run ? config.runSpeed : config.walkSpeed;\n    const waterFactor = this.inWater ? this.WATER_SLOW_FACTOR : 1.0;\n    const speed = baseSpeed * this.speedBoost * waterFactor;\n\n    // Целевая скорость\n    const targetVx = worldMoveX * speed;\n    const targetVz = worldMoveZ * speed;\n\n    // Получаем высоту пола в текущей позиции\n    // В войде пол управляется из Game.updateVoidMode - не трогаем здесь\n    const currentFloorHeight = this.isInVoid ? (state.position.y - state.eyeHeight) : this.collision.getFloorHeight(state.position);\n    const targetY = currentFloorHeight + state.eyeHeight;\n\n    if (state.grounded) {\n      // На земле — полный контроль и трение\n      const friction = config.groundFriction * dt;\n      state.velocity.x += (targetVx - state.velocity.x) * Math.min(friction, 1);\n      state.velocity.z += (targetVz - state.velocity.z) * Math.min(friction, 1);\n\n      // Прыжок\n      if (input.jump) {\n        state.velocity.y = config.jumpForce;\n        state.grounded = false;\n        this.airJumpsLeft = this.maxAirJumps; // Даём воздушные прыжки\n        this.canAirJump = false; // Нужно отпустить Space\n      } else {\n        // Плавное следование за полом (лестницы)\n        const heightDiff = targetY - state.position.y;\n        \n        if (Math.abs(heightDiff) < 0.01) {\n          // Почти на уровне - просто выравниваем\n          state.position.y = targetY;\n          state.velocity.y = 0;\n        } else if (heightDiff > 0 && heightDiff < this.maxStepHeight) {\n          // Подъём по лестнице - плавно поднимаемся\n          state.velocity.y = this.stepSpeed;\n        } else if (heightDiff < 0 && heightDiff > -this.maxStepHeight) {\n          // Спуск по лестнице - плавно опускаемся\n          state.velocity.y = -this.stepSpeed * 0.8;\n        } else if (heightDiff < -this.maxStepHeight) {\n          // Большой спуск - начинаем падать\n          state.grounded = false;\n          state.velocity.y = 0;\n        }\n      }\n    } else {\n      // В воздухе — почти полный контроль (сохраняем скорость)\n      // Быстро приближаемся к целевой скорости\n      const airFriction = 8.0 * dt;\n      state.velocity.x += (targetVx - state.velocity.x) * Math.min(airFriction, 1);\n      state.velocity.z += (targetVz - state.velocity.z) * Math.min(airFriction, 1);\n\n      // Гравитация\n      state.velocity.y -= config.gravity * dt;\n    }\n\n    // Применяем скорость к позиции\n    const newPosX = state.position.x + state.velocity.x * dt;\n    const newPosY = state.position.y + state.velocity.y * dt;\n    const newPosZ = state.position.z + state.velocity.z * dt;\n\n    // Проверяем коллизии по осям отдельно\n    // X\n    const testPosX = { x: newPosX, y: state.position.y, z: state.position.z };\n    if (this.isInVoid || !this.collision.checkCollision(testPosX)) {\n      state.position.x = newPosX;\n    } else {\n      state.velocity.x = 0;\n    }\n\n    // Z\n    const testPosZ = { x: state.position.x, y: state.position.y, z: newPosZ };\n    if (this.isInVoid || !this.collision.checkCollision(testPosZ)) {\n      state.position.z = newPosZ;\n    } else {\n      state.velocity.z = 0;\n    }\n\n    // Y (вертикаль) - с учётом пола\n    // В войде логика пола управляется из Game.updateVoidMode!\n    if (this.isInVoid) {\n      // В войде - просто применяем Y без проверки пола\n      // Гравитация и коллизия с платформами в Game.updateVoidMode\n      state.position.y = newPosY;\n    } else {\n      const newFloorHeight = this.collision.getFloorHeight(state.position);\n      const minY = newFloorHeight + state.eyeHeight;\n\n      if (!state.grounded) {\n        // В воздухе - проверяем приземление\n        if (newPosY <= minY) {\n          // Приземлились\n          state.position.y = minY;\n          state.velocity.y = 0;\n          state.grounded = true;\n          this.canAirJump = false;\n          this.airJumpsLeft = 0; // Сброс воздушных прыжков\n        } else {\n          // Ещё летим\n          const testPosY = { x: state.position.x, y: newPosY, z: state.position.z };\n          const ceilingHeight = this.collision.getCeilingHeight(state.position);\n          \n          if (newPosY < ceilingHeight - 0.3 && !this.collision.checkCollision(testPosY)) {\n            state.position.y = newPosY;\n          } else {\n            // Упёрлись в потолок\n            state.velocity.y = Math.min(state.velocity.y, 0);\n          }\n        }\n      } else {\n        // На земле - плавно следуем за полом\n        state.position.y += state.velocity.y * dt;\n        \n        // Не проваливаемся ниже пола\n        if (state.position.y < minY) {\n          state.position.y = minY;\n          state.velocity.y = 0;\n        }\n      }\n    }\n  }\n\n  /** Получить позицию глаз */\n  public getEyePosition(): Vec3 {\n    return {\n      x: this.state.position.x,\n      y: this.state.position.y,\n      z: this.state.position.z,\n    };\n  }\n\n  /** Получить направление взгляда */\n  public getLookDirection(): Vec3 {\n    const { yaw, pitch } = this.state;\n    return {\n      x: Math.sin(yaw) * Math.cos(pitch),\n      y: Math.sin(pitch),\n      z: -Math.cos(yaw) * Math.cos(pitch),\n    };\n  }\n\n  /** Нанести урон */\n  public takeDamage(amount: number): void {\n    this.state.health = Math.max(0, this.state.health - amount);\n  }\n\n  /** Вылечить */\n  public heal(amount: number): void {\n    this.state.health = Math.min(this.state.maxHealth, this.state.health + amount);\n  }\n\n  /** Игрок мёртв? */\n  public isDead(): boolean {\n    return this.state.health <= 0;\n  }\n\n  /** Сброс позиции */\n  public reset(position: Vec3): void {\n    this.state.position = { ...position };\n    this.state.velocity = vec3();\n    this.state.health = this.state.maxHealth;\n    this.state.grounded = true;\n  }\n}\n","import type { WeaponState, Vec3 } from '@/types';\n\n/** Тип оружия */\nexport type WeaponType = 'katana' | 'charged';\n\n/**\n * Катана - оружие ближнего боя\n * ЛКМ = обычный взмах\n * ПКМ = сплеш-волна (если заряжена)\n */\nexport class Weapon {\n  /** Состояние оружия */\n  public state: WeaponState;\n\n  /** Текущий тип оружия */\n  public currentWeapon: WeaponType = 'katana';\n\n  /** Заряды сплеш-атаки */\n  public splashCharges = 0;\n\n  /** Время до следующего удара */\n  private attackCooldown = 0;\n\n  /** Время атаки */\n  private attackDuration = 0.25; // Быстрее!\n\n  /** Перезарядка между ударами */\n  private attackCooldownTime = 0.2; // Можно бить быстрее!\n  \n  /** Тип удара: 0 = справа сверху, 1 = слева локтевой */\n  public attackType = 0;\n  \n  /** Следующий тип удара (чередуются) */\n  private nextAttackType = 0;\n\n  /** Дальность удара */\n  public attackRange = 4.0;\n\n  /** Угол атаки (радианы) */\n  public attackAngle = Math.PI * 0.6; // 108 градусов\n\n  /** Урон */\n  public damage = 100;\n\n  /** Сейчас атакуем? */\n  public isAttacking = false;\n\n  /** Прогресс атаки (0-1) */\n  public attackProgress = 0;\n\n  /** Callback при ударе */\n  public onSlice?: () => void;\n\n  /** Callback при сплеш-атаке */\n  public onSplash?: () => void;\n\n  /** Это сплеш-атака? */\n  public isSplashAttack = false;\n\n  /** Радиус сплеш-волны */\n  public splashRadius = 10.0;\n\n  constructor() {\n    this.state = {\n      ammo: 999,\n      reserveAmmo: 999,\n      magazineSize: 999,\n      isReloading: false,\n      reloadTimeLeft: 0,\n      recoilX: 0,\n      recoilY: 0,\n      recoilBack: 0,\n      muzzleFlash: 0,\n      bobPhase: 0,\n    };\n  }\n\n  /** Обновление оружия */\n  public update(dt: number, isMoving: boolean, isRunning: boolean): void {\n    // Кулдаун атаки\n    if (this.attackCooldown > 0) {\n      this.attackCooldown -= dt;\n    }\n\n    // Прогресс анимации атаки\n    if (this.isAttacking) {\n      this.attackProgress += dt / this.attackDuration;\n      if (this.attackProgress >= 1) {\n        this.isAttacking = false;\n        this.attackProgress = 0;\n      }\n    }\n\n    // Покачивание при ходьбе\n    if (isMoving) {\n      const bobSpeed = isRunning ? 14 : 10;\n      this.state.bobPhase += dt * bobSpeed;\n    } else {\n      this.state.bobPhase *= 0.95;\n    }\n\n    // Затухание эффектов\n    this.state.recoilX *= 0.85;\n    this.state.recoilY *= 0.85;\n    this.state.muzzleFlash *= 0.8;\n  }\n\n  /** Попытка обычного удара (ЛКМ) */\n  public tryAttack(): boolean {\n    if (this.attackCooldown > 0) return false;\n    if (this.isAttacking) return false;\n\n    this.attack(false);\n    return true;\n  }\n\n  /** Попытка сплеш-атаки (ПКМ) */\n  public trySplashAttack(): boolean {\n    if (this.attackCooldown > 0) return false;\n    if (this.isAttacking) return false;\n    if (this.splashCharges <= 0) return false;\n\n    this.attack(true);\n    return true;\n  }\n\n  /** Удар катаной */\n  private attack(isSplash: boolean): void {\n    this.isAttacking = true;\n    this.attackProgress = 0;\n    this.attackCooldown = isSplash ? 0.5 : this.attackCooldownTime;\n    this.isSplashAttack = isSplash;\n    \n    // Тип удара устанавливается извне (в Game.ts по позиции врага)\n    // Для сплеша - особый тип\n    if (isSplash) {\n      this.attackType = 2;\n    }\n    // attackType для обычной атаки устанавливается в Game.ts\n    \n    if (isSplash) {\n      // Сплеш-волна\n      this.splashCharges--;\n      this.state.recoilX = 0.6;\n      this.state.muzzleFlash = 2.0;\n      \n      // Если закончились заряды - возвращаемся к обычной катане\n      if (this.splashCharges <= 0) {\n        this.currentWeapon = 'katana';\n      }\n      \n      this.onSplash?.();\n    } else {\n      // Обычный удар\n      this.state.recoilX = 0.3;\n      this.state.muzzleFlash = 1.0;\n      this.onSlice?.();\n    }\n  }\n\n  /** Зарядить катану (подбор на балконе) */\n  public chargeKatana(): void {\n    this.currentWeapon = 'charged';\n    this.splashCharges = 3; // 3 сплеш-удара\n  }\n\n  /** Проверить заряжена ли */\n  public isCharged(): boolean {\n    return this.splashCharges > 0;\n  }\n\n  /** Проверка попадания по врагу */\n  public checkHit(playerPos: Vec3, playerYaw: number, targetPos: Vec3): boolean {\n    if (!this.isAttacking) return false;\n    // Попадаем только в середине анимации\n    if (this.attackProgress < 0.2 || this.attackProgress > 0.6) return false;\n\n    // Вектор к цели\n    const dx = targetPos.x - playerPos.x;\n    const dz = targetPos.z - playerPos.z;\n    const dist = Math.sqrt(dx * dx + dz * dz);\n\n    // Сплеш-атака топором - бьёт всех в радиусе!\n    if (this.isSplashAttack) {\n      return dist <= this.splashRadius;\n    }\n\n    // Обычная атака катаной - проверка дистанции\n    if (dist > this.attackRange) return false;\n\n    // Проверка угла\n    const angleToTarget = Math.atan2(dx, -dz);\n    let angleDiff = angleToTarget - playerYaw;\n    \n    // Нормализуем угол\n    while (angleDiff > Math.PI) angleDiff -= Math.PI * 2;\n    while (angleDiff < -Math.PI) angleDiff += Math.PI * 2;\n\n    return Math.abs(angleDiff) < this.attackAngle / 2;\n  }\n\n  /** Получить смещение от покачивания */\n  public getWeaponOffset(): { x: number; y: number; z: number } {\n    const bobX = Math.sin(this.state.bobPhase) * 0.02;\n    const bobY = Math.abs(Math.sin(this.state.bobPhase * 2)) * 0.015;\n\n    // Анимация атаки\n    let attackOffsetX = 0;\n    let attackOffsetY = 0;\n\n    if (this.isAttacking) {\n      // Взмах справа налево\n      const t = this.attackProgress;\n      attackOffsetX = Math.sin(t * Math.PI) * 0.3;\n      attackOffsetY = -Math.sin(t * Math.PI * 2) * 0.1;\n    }\n\n    return {\n      x: bobX + this.state.recoilX + attackOffsetX,\n      y: bobY - this.state.recoilY + attackOffsetY,\n      z: 0,\n    };\n  }\n\n  // Заглушки для совместимости\n  public tryShoot(_playerPos: Vec3, _playerDir: Vec3): boolean {\n    return this.tryAttack();\n  }\n  \n  public startReload(): boolean {\n    return false;\n  }\n  \n  public projectiles: never[] = [];\n}\n","import type { WeaponState } from '@/types';\nimport type { WeaponType } from './Weapon';\n\n/** 2D частица для эффектов */\ninterface Particle {\n  x: number;\n  y: number;\n  vx: number;\n  vy: number;\n  size: number;\n  color: string;\n  life: number;\n  maxLife: number;\n  type: 'fragment' | 'spark' | 'trail';\n}\n\n/** Параметры освещения сцены */\ninterface SceneLighting {\n  ambient: [number, number, number];  // RGB 0-1\n  accentColor: [number, number, number];\n  brightness: number;  // 0-1\n}\n\n/**\n * Рендерер катаны в стиле Retrowave\n * Неоновые эффекты при взмахе + частицы осколков\n */\nexport class WeaponRenderer {\n  private ctx: CanvasRenderingContext2D;\n  private width: number;\n  private height: number;\n\n  /** Прогресс атаки (0-1) */\n  public attackProgress = 0;\n\n  /** Сейчас атакуем? */\n  public isAttacking = false;\n\n  /** Это сплеш-атака? */\n  public isSplashAttack = false;\n\n  /** Заряды сплеша */\n  public splashCharges = 0;\n\n  /** Вспышка попадания */\n  private hitFlash = 0;\n\n  /** Частицы */\n  private particles: Particle[] = [];\n\n  /** Максимум частиц для производительности */\n  private static readonly MAX_PARTICLES = 50;\n\n  /** Активна сплеш-волна */\n  private splashWaveActive = false;\n  \n  /** Прогресс волны (0-1) */\n  private splashWaveProgress = 0;\n  \n  /** Направление волны (yaw) */\n  private splashWaveYaw = 0;\n\n  /** Текущее освещение сцены */\n  private sceneLighting: SceneLighting = {\n    ambient: [0.12, 0.15, 0.2],\n    accentColor: [0.15, 0.7, 1.0],\n    brightness: 0.7\n  };\n\n  constructor(canvas: HTMLCanvasElement) {\n    this.ctx = canvas.getContext('2d')!;\n    this.width = canvas.width;\n    this.height = canvas.height;\n  }\n\n  public resize(width: number, height: number): void {\n    this.width = width;\n    this.height = height;\n  }\n\n  /** Установить освещение сцены для тонирования катаны */\n  public setSceneLighting(era: number): void {\n    // Параметры освещения по эпохам (соответствуют шейдеру)\n    if (era === 1) {\n      // Кислотная\n      this.sceneLighting = {\n        ambient: [0.08, 0.12, 0.08],\n        accentColor: [0.4, 1.0, 0.2],\n        brightness: 0.75\n      };\n    } else if (era === 2) {\n      // Чёрная дыра\n      this.sceneLighting = {\n        ambient: [0.07, 0.05, 0.12],\n        accentColor: [0.7, 0.15, 1.0],\n        brightness: 0.7\n      };\n    } else {\n      // Космическая (по умолчанию)\n      this.sceneLighting = {\n        ambient: [0.08, 0.1, 0.14],\n        accentColor: [0.15, 0.7, 1.0],\n        brightness: 0.75\n      };\n    }\n  }\n\n  /** Применить тонирование цвета под освещение сцены */\n  private tintColor(color: string, intensity: number = 1.0): string {\n    // Парсим цвет\n    const match = color.match(/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i);\n    if (!match) return color;\n\n    let r = parseInt(match[1], 16) / 255;\n    let g = parseInt(match[2], 16) / 255;\n    let b = parseInt(match[3], 16) / 255;\n\n    const [ar, ag, ab] = this.sceneLighting.ambient;\n    const brightness = this.sceneLighting.brightness;\n\n    // Применяем тонирование: смешиваем с ambient и применяем яркость\n    r = r * brightness * (0.6 + ar * 2) * intensity;\n    g = g * brightness * (0.6 + ag * 2) * intensity;\n    b = b * brightness * (0.6 + ab * 2) * intensity;\n\n    // Clamp\n    r = Math.min(1, Math.max(0, r));\n    g = Math.min(1, Math.max(0, g));\n    b = Math.min(1, Math.max(0, b));\n\n    return `rgb(${Math.floor(r * 255)}, ${Math.floor(g * 255)}, ${Math.floor(b * 255)})`;\n  }\n\n  /** Показать эффект попадания */\n  public showHitEffect(): void {\n    // 2D частицы отключены - всё в 3D шейдере\n    this.hitFlash = 0.5;\n  }\n\n  /** Показать эффект сплеш-атаки */\n  public showSplashEffect(): void {\n    // 2D частицы отключены\n    this.hitFlash = 0.6;\n  }\n\n  /** Показать сплеш-волну */\n  public showSplashWave(yaw: number): void {\n    // 2D частицы отключены\n    this.splashWaveYaw = yaw;\n    this.hitFlash = 0.5;\n  }\n\n  /** Создать частицы волны (оптимизировано) */\n  private spawnWaveParticles(): void {\n    if (this.particles.length > WeaponRenderer.MAX_PARTICLES) return;\n\n    const centerX = this.width / 2;\n    const centerY = this.height / 2;\n    const colors = ['#00ffff', '#00e5ff', '#00bfff', '#40e0d0'];\n\n    // Частицы расходятся горизонтально (уменьшено с 30 до 12)\n    for (let i = 0; i < 12; i++) {\n      const angle = (i / 12) * Math.PI - Math.PI / 2;\n      const speed = 600 + Math.random() * 300;\n      this.particles.push({\n        x: centerX,\n        y: centerY,\n        vx: Math.cos(angle) * speed,\n        vy: Math.sin(angle) * speed * 0.3,\n        size: 5 + Math.random() * 6,\n        color: colors[i % colors.length],\n        life: 0.4 + Math.random() * 0.3,\n        maxLife: 0.4 + Math.random() * 0.3,\n        type: 'spark',\n      });\n    }\n\n    // Большие капли энергии (уменьшено с 15 до 6)\n    for (let i = 0; i < 6; i++) {\n      const angle = (Math.random() - 0.5) * Math.PI * 0.8;\n      const speed = 600 + Math.random() * 300;\n      this.particles.push({\n        x: centerX + (Math.random() - 0.5) * 100,\n        y: centerY + (Math.random() - 0.5) * 50,\n        vx: Math.cos(angle) * speed,\n        vy: Math.sin(angle) * speed * 0.2,\n        size: 12 + Math.random() * 18,\n        color: colors[Math.floor(Math.random() * colors.length)],\n        life: 0.8 + Math.random() * 0.4,\n        maxLife: 0.8 + Math.random() * 0.4,\n        type: 'fragment',\n      });\n    }\n  }\n\n  /** Создать осколки врага (оптимизировано!) */\n  private spawnFragments(): void {\n    // Ограничиваем количество частиц\n    if (this.particles.length > WeaponRenderer.MAX_PARTICLES) return;\n\n    const centerX = this.width / 2;\n    const centerY = this.height / 2;\n    const colors = ['#00ff00', '#33ff00', '#66ff33', '#00ff66'];\n\n    // Крупные осколки (уменьшено с 12 до 6)\n    for (let i = 0; i < 6; i++) {\n      const angle = (i / 6) * Math.PI * 2 + Math.random() * 0.5;\n      const speed = 400 + Math.random() * 400;\n      this.particles.push({\n        x: centerX + (Math.random() - 0.5) * 40,\n        y: centerY + (Math.random() - 0.5) * 40,\n        vx: Math.cos(angle) * speed,\n        vy: Math.sin(angle) * speed - 150,\n        size: 6 + Math.random() * 8,\n        color: colors[i % colors.length],\n        life: 0.5 + Math.random() * 0.3,\n        maxLife: 0.5 + Math.random() * 0.3,\n        type: 'fragment',\n      });\n    }\n\n    // Искры (уменьшено с 25 до 10)\n    for (let i = 0; i < 10; i++) {\n      const angle = Math.random() * Math.PI * 2;\n      const speed = 200 + Math.random() * 300;\n      this.particles.push({\n        x: centerX + (Math.random() - 0.5) * 20,\n        y: centerY + (Math.random() - 0.5) * 20,\n        vx: Math.cos(angle) * speed,\n        vy: Math.sin(angle) * speed - 80,\n        size: 2 + Math.random() * 3,\n        color: colors[i % colors.length],\n        life: 0.3 + Math.random() * 0.2,\n        maxLife: 0.3 + Math.random() * 0.2,\n        type: 'spark',\n      });\n    }\n  }\n\n  /** Обновить частицы (оптимизировано) */\n  private updateParticles(dt: number): void {\n    const gravity = 800;\n    const heightLimit = this.height + 50;\n    let writeIndex = 0;\n\n    // Обновляем и фильтруем за один проход (без splice)\n    for (let i = 0; i < this.particles.length; i++) {\n      const p = this.particles[i];\n\n      // Физика\n      p.x += p.vx * dt;\n      p.y += p.vy * dt;\n      p.vy += gravity * dt;\n      p.vx *= 0.98;\n      p.life -= dt;\n\n      // Сохраняем живые частицы\n      if (p.life > 0 && p.y < heightLimit) {\n        this.particles[writeIndex++] = p;\n      }\n    }\n\n    // Обрезаем массив\n    this.particles.length = writeIndex;\n  }\n\n  /** Рендер частиц (оптимизировано - без градиентов и теней!) */\n  private renderParticles(ctx: CanvasRenderingContext2D): void {\n    // Отключаем тени для производительности\n    ctx.shadowBlur = 0;\n\n    for (const p of this.particles) {\n      const alpha = Math.min(1, p.life / p.maxLife * 2);\n\n      ctx.globalAlpha = alpha;\n      ctx.fillStyle = p.color;\n\n      if (p.type === 'fragment') {\n        // Простой круг вместо сложной формы\n        ctx.beginPath();\n        ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);\n        ctx.fill();\n\n        // Яркий центр\n        ctx.globalAlpha = alpha * 0.8;\n        ctx.fillStyle = '#ffffff';\n        ctx.beginPath();\n        ctx.arc(p.x, p.y, p.size * 0.4, 0, Math.PI * 2);\n        ctx.fill();\n\n      } else {\n        // Искра - простой круг\n        ctx.beginPath();\n        ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);\n        ctx.fill();\n\n        // Короткий хвост\n        ctx.globalAlpha = alpha * 0.5;\n        ctx.strokeStyle = p.color;\n        ctx.lineWidth = p.size * 0.5;\n        ctx.beginPath();\n        ctx.moveTo(p.x, p.y);\n        ctx.lineTo(p.x - p.vx * 0.02, p.y - p.vy * 0.02);\n        ctx.stroke();\n      }\n    }\n\n    // Восстанавливаем альфу\n    ctx.globalAlpha = 1;\n  }\n\n  public render(state: WeaponState, time: number): void {\n    const ctx = this.ctx;\n    ctx.clearRect(0, 0, this.width, this.height);\n\n    // 2D частицы и волны отключены - всё в 3D шейдере\n\n    const scale = Math.min(this.width, this.height) / 600;\n\n    // Покачивание\n    const bobX = Math.sin(state.bobPhase) * 8 * scale;\n    const bobY = Math.abs(Math.sin(state.bobPhase * 2)) * 6 * scale;\n\n    // Затухание вспышки попадания\n    if (this.hitFlash > 0) {\n      this.hitFlash -= 0.04;\n    }\n\n    // 2D сплеш-волна отключена - всё в 3D шейдере\n\n    ctx.save();\n\n    // Позиция оружия\n    let baseX = this.width * 0.65;\n    let baseY = this.height * 0.8;\n    let rotation = -0.4;\n\n    // Анимация атаки - мощный взмах\n    if (this.isAttacking) {\n      const t = this.attackProgress;\n      // Быстрый взмах с замедлением в конце\n      const easeOut = 1 - Math.pow(1 - t, 3);\n      // Сплеш-атака - более мощный горизонтальный взмах\n      const swingAngle = Math.sin(easeOut * Math.PI) * (this.isSplashAttack ? 3.2 : 2.5);\n      rotation = -0.4 - swingAngle;\n\n      // Движение к центру и вверх (сплеш движется сильнее)\n      const moveMultiplier = this.isSplashAttack ? 1.5 : 1.0;\n      baseX -= Math.sin(t * Math.PI) * this.width * 0.3 * moveMultiplier;\n      baseY -= Math.sin(t * Math.PI) * this.height * 0.15 * moveMultiplier;\n    }\n\n    ctx.translate(baseX + bobX, baseY + bobY);\n    ctx.rotate(rotation);\n    ctx.scale(scale, scale);\n\n    // Катана теперь в 3D шейдере!\n    // 2D эффекты взмаха отключены - всё в 3D\n    \n    ctx.restore();\n\n    // 2D частицы отключены - всё в 3D шейдере\n\n    // Полноэкранная вспышка при попадании\n    if (this.hitFlash > 0.5) {\n      this.drawScreenFlash(ctx, this.isSplashAttack ? 'charged' : 'katana');\n    }\n  }\n\n  /** Применить тонирование под освещение сцены */\n  private applySceneLighting(ctx: CanvasRenderingContext2D): void {\n    const [ar, ag, ab] = this.sceneLighting.ambient;\n    const brightness = this.sceneLighting.brightness;\n    \n    // Сначала затемняем (multiply) - только поверх катаны\n    ctx.save();\n    ctx.globalCompositeOperation = 'source-atop';\n    \n    // Тёмный слой для затемнения\n    const darkFactor = brightness * 0.6; // Затемняем до 60% от яркости сцены\n    ctx.fillStyle = `rgba(0, 0, 0, ${1 - darkFactor})`;\n    ctx.fillRect(0, 0, this.width, this.height);\n    ctx.restore();\n    \n    // Добавляем цветовой оттенок сцены\n    ctx.save();\n    ctx.globalCompositeOperation = 'source-atop';\n    \n    // Цвет ambient сцены\n    const tintR = Math.floor(ar * 255 * 2);\n    const tintG = Math.floor(ag * 255 * 2);\n    const tintB = Math.floor(ab * 255 * 2);\n    \n    ctx.fillStyle = `rgba(${tintR}, ${tintG}, ${tintB}, 0.25)`;\n    ctx.fillRect(0, 0, this.width, this.height);\n    ctx.restore();\n  }\n\n  /** Рисуем индикатор заряда */\n  private drawChargeIndicator(ctx: CanvasRenderingContext2D, time: number): void {\n    // 3 точки энергии вдоль лезвия\n    ctx.save();\n    ctx.shadowColor = '#00ffff';\n    ctx.shadowBlur = 15;\n    \n    for (let i = 0; i < 3; i++) {\n      const y = -50 - i * 60;\n      const pulse = 0.7 + 0.3 * Math.sin(time * 5 + i);\n      \n      if (this.splashCharges > i) {\n        ctx.fillStyle = `rgba(0, 255, 255, ${pulse})`;\n        ctx.beginPath();\n        ctx.arc(0, y, 8, 0, Math.PI * 2);\n        ctx.fill();\n        \n        // Внешнее кольцо\n        ctx.strokeStyle = `rgba(0, 255, 255, ${pulse * 0.5})`;\n        ctx.lineWidth = 2;\n        ctx.beginPath();\n        ctx.arc(0, y, 12 + Math.sin(time * 8 + i) * 3, 0, Math.PI * 2);\n        ctx.stroke();\n      } else {\n        ctx.fillStyle = 'rgba(100, 100, 100, 0.3)';\n        ctx.beginPath();\n        ctx.arc(0, y, 6, 0, Math.PI * 2);\n        ctx.fill();\n      }\n    }\n    \n    ctx.restore();\n  }\n\n  /** Эффект сплеш-волны на экране */\n  private drawSplashWaveEffect(ctx: CanvasRenderingContext2D, time: number): void {\n    const centerX = this.width / 2;\n    const centerY = this.height / 2;\n    const maxRadius = Math.max(this.width, this.height) * 0.8;\n    const currentRadius = this.splashWaveProgress * maxRadius;\n    \n    ctx.save();\n    \n    // Несколько концентрических волн\n    for (let i = 0; i < 3; i++) {\n      const r = currentRadius - i * 30;\n      if (r > 0) {\n        const alpha = (1 - this.splashWaveProgress) * (0.5 - i * 0.1);\n        \n        // Основная волна\n        ctx.strokeStyle = `rgba(0, 255, 255, ${alpha})`;\n        ctx.lineWidth = 8 - i * 2;\n        ctx.shadowColor = '#00ffff';\n        ctx.shadowBlur = 20;\n        \n        ctx.beginPath();\n        // Рисуем полукруг вперёд (горизонтальная волна)\n        ctx.ellipse(centerX, centerY + 100, r, r * 0.3, 0, Math.PI, 0);\n        ctx.stroke();\n        \n        // Искрящаяся линия\n        if (i === 0) {\n          ctx.strokeStyle = `rgba(255, 255, 255, ${alpha * 0.8})`;\n          ctx.lineWidth = 2;\n          ctx.beginPath();\n          ctx.ellipse(centerX, centerY + 100, r - 5, (r - 5) * 0.3, 0, Math.PI, 0);\n          ctx.stroke();\n        }\n      }\n    }\n    \n    // Добавляем искры на волне\n    const sparkCount = Math.floor((1 - this.splashWaveProgress) * 20);\n    ctx.fillStyle = '#ffffff';\n    for (let i = 0; i < sparkCount; i++) {\n      const angle = Math.PI + Math.random() * Math.PI;\n      const sparkR = currentRadius + (Math.random() - 0.5) * 20;\n      const x = centerX + Math.cos(angle) * sparkR;\n      const y = centerY + 100 + Math.sin(angle) * sparkR * 0.3;\n      const size = 2 + Math.random() * 4;\n      \n      ctx.beginPath();\n      ctx.arc(x, y, size, 0, Math.PI * 2);\n      ctx.fill();\n    }\n    \n    ctx.restore();\n  }\n\n  /** След сплеш-атаки (более широкий и яркий) */\n  private drawSplashSlash(ctx: CanvasRenderingContext2D, progress: number, time: number): void {\n    ctx.save();\n    ctx.globalCompositeOperation = 'lighter';\n\n    // Основной широкий след - бирюзовый\n    const cyanGrad = ctx.createLinearGradient(-200, -350, 50, 0);\n    cyanGrad.addColorStop(0, 'rgba(0, 255, 255, 0)');\n    cyanGrad.addColorStop(0.3, 'rgba(0, 255, 255, 0.8)');\n    cyanGrad.addColorStop(0.6, 'rgba(0, 255, 255, 1)');\n    cyanGrad.addColorStop(1, 'rgba(0, 255, 255, 0)');\n\n    ctx.strokeStyle = cyanGrad;\n    ctx.lineWidth = 30 + Math.sin(progress * Math.PI) * 20; // Шире!\n    ctx.lineCap = 'round';\n    ctx.shadowColor = '#00ffff';\n    ctx.shadowBlur = 40;\n\n    ctx.beginPath();\n    ctx.moveTo(-200, -350);\n    ctx.quadraticCurveTo(\n      -100 + Math.sin(time * 30) * 20,\n      -200,\n      50, 0\n    );\n    ctx.stroke();\n\n    // Внутреннее ядро - белое\n    ctx.strokeStyle = 'rgba(255, 255, 255, 0.9)';\n    ctx.lineWidth = 6;\n    ctx.shadowBlur = 20;\n    ctx.stroke();\n\n    // Дополнительные волны\n    for (let i = 0; i < 3; i++) {\n      const offset = i * 15;\n      ctx.strokeStyle = `rgba(0, 200, 255, ${0.4 - i * 0.1})`;\n      ctx.lineWidth = 4 - i;\n      ctx.beginPath();\n      ctx.moveTo(-200 - offset, -350 + offset);\n      ctx.quadraticCurveTo(\n        -100 - offset + Math.sin(time * 30 + i) * 15,\n        -200 + offset,\n        50 - offset, 0 + offset\n      );\n      ctx.stroke();\n    }\n\n    ctx.restore();\n  }\n\n  private drawKatana(ctx: CanvasRenderingContext2D, _state: WeaponState, time: number): void {\n    // === РУКА ===\n    ctx.fillStyle = '#8a7a6a';\n    ctx.beginPath();\n    ctx.ellipse(0, 80, 40, 50, 0.2, 0, Math.PI * 2);\n    ctx.fill();\n\n    // === ЦУКА (рукоять) ===\n    const tsukaGrad = ctx.createLinearGradient(0, 40, 0, 160);\n    tsukaGrad.addColorStop(0, '#2a1a1a');\n    tsukaGrad.addColorStop(0.5, '#1a0a0a');\n    tsukaGrad.addColorStop(1, '#2a1a1a');\n\n    ctx.fillStyle = tsukaGrad;\n    ctx.beginPath();\n    ctx.moveTo(-14, 40);\n    ctx.lineTo(14, 40);\n    ctx.lineTo(12, 160);\n    ctx.lineTo(-12, 160);\n    ctx.closePath();\n    ctx.fill();\n\n    // Обмотка с неоном\n    ctx.strokeStyle = '#ff00ff';\n    ctx.shadowColor = '#ff00ff';\n    ctx.shadowBlur = 10;\n    ctx.lineWidth = 2;\n    for (let i = 0; i < 10; i++) {\n      const y = 50 + i * 11;\n      const glow = 0.5 + 0.5 * Math.sin(time * 3 + i * 0.5);\n      ctx.strokeStyle = `rgba(255, 0, 255, ${glow})`;\n      ctx.beginPath();\n      ctx.moveTo(-12, y);\n      ctx.lineTo(0, y + 5);\n      ctx.lineTo(12, y);\n      ctx.stroke();\n    }\n    ctx.shadowBlur = 0;\n\n    // === ЦУБА (гарда) - неоновая ===\n    ctx.fillStyle = '#1a1a2a';\n    ctx.beginPath();\n    ctx.ellipse(0, 35, 35, 12, 0, 0, Math.PI * 2);\n    ctx.fill();\n\n    // Неоновый контур гарды\n    ctx.strokeStyle = '#00ffff';\n    ctx.shadowColor = '#00ffff';\n    ctx.shadowBlur = 15;\n    ctx.lineWidth = 2;\n    ctx.beginPath();\n    ctx.ellipse(0, 35, 32, 10, 0, 0, Math.PI * 2);\n    ctx.stroke();\n    ctx.shadowBlur = 0;\n\n    // === КЛИНОК ===\n    // Основа\n    const bladeGrad = ctx.createLinearGradient(-10, 0, 10, 0);\n    bladeGrad.addColorStop(0, '#8080a0');\n    bladeGrad.addColorStop(0.3, '#c0c0e0');\n    bladeGrad.addColorStop(0.5, '#ffffff');\n    bladeGrad.addColorStop(0.7, '#c0c0e0');\n    bladeGrad.addColorStop(1, '#6060a0');\n\n    ctx.fillStyle = bladeGrad;\n    ctx.beginPath();\n    ctx.moveTo(-10, 30);\n    ctx.lineTo(10, 30);\n    ctx.lineTo(7, -280);\n    ctx.lineTo(0, -320);\n    ctx.lineTo(-5, -280);\n    ctx.closePath();\n    ctx.fill();\n\n    // Неоновая кромка\n    ctx.strokeStyle = '#00ffff';\n    ctx.shadowColor = '#00ffff';\n    ctx.shadowBlur = 8;\n    ctx.lineWidth = 2;\n    ctx.beginPath();\n    ctx.moveTo(9, 30);\n    ctx.lineTo(6, -280);\n    ctx.lineTo(0, -320);\n    ctx.stroke();\n\n    // Пульсирующий хамон\n    ctx.strokeStyle = `rgba(255, 0, 255, ${0.5 + 0.3 * Math.sin(time * 4)})`;\n    ctx.shadowColor = '#ff00ff';\n    ctx.shadowBlur = 5;\n    ctx.lineWidth = 1.5;\n    ctx.beginPath();\n    ctx.moveTo(-4, 30);\n    for (let i = 0; i < 25; i++) {\n      const y = 30 - i * 13;\n      const wave = Math.sin(i * 0.7 + time * 2) * 4;\n      ctx.lineTo(-4 + wave, y);\n    }\n    ctx.stroke();\n    ctx.shadowBlur = 0;\n\n    // Блик\n    ctx.fillStyle = 'rgba(255, 255, 255, 0.4)';\n    ctx.beginPath();\n    ctx.moveTo(3, 25);\n    ctx.lineTo(5, 25);\n    ctx.lineTo(3, -270);\n    ctx.lineTo(1, -270);\n    ctx.closePath();\n    ctx.fill();\n  }\n\n  private drawRetrowaveSlash(ctx: CanvasRenderingContext2D, progress: number, time: number): void {\n    ctx.save();\n    ctx.translate(0, -150);\n\n    const alpha = Math.sin(progress * Math.PI);\n\n    // Множественные неоновые дуги\n    const colors = [\n      { color: '#ff00ff', offset: 0 },\n      { color: '#00ffff', offset: 15 },\n      { color: '#ff0080', offset: 30 },\n      { color: '#8000ff', offset: 45 },\n    ];\n\n    for (const { color, offset } of colors) {\n      ctx.strokeStyle = color;\n      ctx.shadowColor = color;\n      ctx.shadowBlur = 25;\n      ctx.lineWidth = 10 - offset * 0.15;\n      ctx.lineCap = 'round';\n\n      ctx.beginPath();\n      ctx.arc(0, 100, 200 + offset, -Math.PI * 0.7, Math.PI * 0.15);\n      ctx.globalAlpha = alpha * (1 - offset * 0.015);\n      ctx.stroke();\n    }\n\n    // Искры\n    ctx.globalAlpha = alpha;\n    for (let i = 0; i < 15; i++) {\n      const angle = -Math.PI * 0.7 + (Math.PI * 0.85) * (i / 15) + Math.sin(time * 10 + i) * 0.1;\n      const dist = 200 + Math.random() * 50;\n      const x = Math.cos(angle) * dist;\n      const y = 100 + Math.sin(angle) * dist;\n\n      const sparkColor = i % 2 === 0 ? '#ff00ff' : '#00ffff';\n      ctx.fillStyle = sparkColor;\n      ctx.shadowColor = sparkColor;\n      ctx.shadowBlur = 15;\n      ctx.beginPath();\n      ctx.arc(x, y, 4 + Math.random() * 4, 0, Math.PI * 2);\n      ctx.fill();\n    }\n\n    ctx.globalAlpha = 1;\n    ctx.shadowBlur = 0;\n    ctx.restore();\n  }\n\n  /** Рисуем ТОПОР ХАОСА - как катана, но с широким лезвием! */\n  private drawAxe(ctx: CanvasRenderingContext2D, _state: WeaponState, time: number, charges: number): void {\n    // === РУКА ===\n    ctx.fillStyle = '#8a7a6a';\n    ctx.beginPath();\n    ctx.ellipse(0, 80, 40, 50, 0.2, 0, Math.PI * 2);\n    ctx.fill();\n\n    // === РУКОЯТЬ (как у катаны) ===\n    const tsukaGrad = ctx.createLinearGradient(0, 40, 0, 160);\n    tsukaGrad.addColorStop(0, '#3a2010');\n    tsukaGrad.addColorStop(0.5, '#2a1005');\n    tsukaGrad.addColorStop(1, '#3a2010');\n\n    ctx.fillStyle = tsukaGrad;\n    ctx.beginPath();\n    ctx.moveTo(-14, 40);\n    ctx.lineTo(14, 40);\n    ctx.lineTo(12, 160);\n    ctx.lineTo(-12, 160);\n    ctx.closePath();\n    ctx.fill();\n\n    // Обмотка - огненная (как у катаны но оранжевая)\n    ctx.strokeStyle = '#ff6600';\n    ctx.shadowColor = '#ff6600';\n    ctx.shadowBlur = 10;\n    ctx.lineWidth = 2;\n    for (let i = 0; i < 10; i++) {\n      const y = 50 + i * 11;\n      const glow = 0.5 + 0.5 * Math.sin(time * 4 + i * 0.5);\n      ctx.strokeStyle = `rgba(255, 100, 0, ${glow})`;\n      ctx.beginPath();\n      ctx.moveTo(-12, y);\n      ctx.lineTo(0, y + 5);\n      ctx.lineTo(12, y);\n      ctx.stroke();\n    }\n    ctx.shadowBlur = 0;\n\n    // === ГАРДА (как цуба но квадратная) ===\n    ctx.fillStyle = '#2a2020';\n    ctx.beginPath();\n    ctx.rect(-30, 25, 60, 20);\n    ctx.fill();\n\n    // Огненный контур гарды\n    ctx.strokeStyle = '#ff6600';\n    ctx.shadowColor = '#ff6600';\n    ctx.shadowBlur = 15;\n    ctx.lineWidth = 2;\n    ctx.strokeRect(-28, 27, 56, 16);\n    ctx.shadowBlur = 0;\n\n    // === ЛЕЗВИЕ ТОПОРА (широкое, как секира) ===\n    // Основа - широкий клинок\n    const bladeGrad = ctx.createLinearGradient(-40, 0, 40, 0);\n    bladeGrad.addColorStop(0, '#6060a0');\n    bladeGrad.addColorStop(0.2, '#8080b0');\n    bladeGrad.addColorStop(0.4, '#b0b0d0');\n    bladeGrad.addColorStop(0.5, '#e0e0f0');\n    bladeGrad.addColorStop(0.6, '#b0b0d0');\n    bladeGrad.addColorStop(0.8, '#8080b0');\n    bladeGrad.addColorStop(1, '#6060a0');\n\n    ctx.fillStyle = bladeGrad;\n    ctx.beginPath();\n    // Широкое лезвие секиры\n    ctx.moveTo(-12, 20);\n    ctx.lineTo(12, 20);\n    ctx.lineTo(15, -50);\n    // Расширение к голове\n    ctx.lineTo(50, -180);\n    ctx.lineTo(55, -220);\n    // Острие\n    ctx.lineTo(0, -300);\n    // Обратная сторона\n    ctx.lineTo(-55, -220);\n    ctx.lineTo(-50, -180);\n    ctx.lineTo(-15, -50);\n    ctx.closePath();\n    ctx.fill();\n\n    // Огненная кромка (как неоновая у катаны но оранжевая)\n    ctx.strokeStyle = '#ff6600';\n    ctx.shadowColor = '#ff6600';\n    ctx.shadowBlur = 12;\n    ctx.lineWidth = 3;\n    ctx.beginPath();\n    ctx.moveTo(14, 20);\n    ctx.lineTo(52, -180);\n    ctx.lineTo(57, -220);\n    ctx.lineTo(0, -305);\n    ctx.stroke();\n\n    // Вторая кромка\n    ctx.beginPath();\n    ctx.moveTo(-14, 20);\n    ctx.lineTo(-52, -180);\n    ctx.lineTo(-57, -220);\n    ctx.lineTo(0, -305);\n    ctx.stroke();\n\n    // Пульсирующая линия по центру (как хамон)\n    ctx.strokeStyle = `rgba(255, 150, 0, ${0.5 + 0.3 * Math.sin(time * 5)})`;\n    ctx.shadowColor = '#ff9900';\n    ctx.shadowBlur = 8;\n    ctx.lineWidth = 2;\n    ctx.beginPath();\n    ctx.moveTo(0, 15);\n    for (let i = 0; i < 20; i++) {\n      const y = 15 - i * 15;\n      const wave = Math.sin(i * 0.8 + time * 3) * (3 + i * 0.3);\n      ctx.lineTo(wave, y);\n    }\n    ctx.stroke();\n    ctx.shadowBlur = 0;\n\n    // Индикатор зарядов - огненные точки вдоль лезвия\n    for (let i = 0; i < 5; i++) {\n      const y = -50 - i * 45;\n      \n      if (i < charges) {\n        ctx.fillStyle = '#ff8800';\n        ctx.shadowColor = '#ff8800';\n        ctx.shadowBlur = 15;\n      } else {\n        ctx.fillStyle = '#333333';\n        ctx.shadowColor = 'transparent';\n        ctx.shadowBlur = 0;\n      }\n      \n      ctx.beginPath();\n      ctx.arc(0, y, 4, 0, Math.PI * 2);\n      ctx.fill();\n    }\n    ctx.shadowBlur = 0;\n\n    // Блик\n    ctx.fillStyle = 'rgba(255, 255, 255, 0.4)';\n    ctx.beginPath();\n    ctx.moveTo(5, 15);\n    ctx.lineTo(8, 15);\n    ctx.lineTo(40, -170);\n    ctx.lineTo(37, -170);\n    ctx.closePath();\n    ctx.fill();\n  }\n\n  /** След от топора - как у катаны но с разлётом! */\n  private drawAxeSlash(ctx: CanvasRenderingContext2D, progress: number, time: number): void {\n    ctx.save();\n    ctx.translate(0, -150);\n\n    const alpha = Math.sin(progress * Math.PI);\n\n    // Огненные дуги (как у катаны)\n    const colors = [\n      { color: '#ff6600', offset: 0 },\n      { color: '#ff9900', offset: 15 },\n      { color: '#ff3300', offset: 30 },\n      { color: '#ffcc00', offset: 45 },\n    ];\n\n    for (const { color, offset } of colors) {\n      ctx.strokeStyle = color;\n      ctx.shadowColor = color;\n      ctx.shadowBlur = 25;\n      ctx.lineWidth = 12 - offset * 0.15;\n      ctx.lineCap = 'round';\n\n      ctx.beginPath();\n      ctx.arc(0, 100, 200 + offset, -Math.PI * 0.7, Math.PI * 0.15);\n      ctx.globalAlpha = alpha * (1 - offset * 0.015);\n      ctx.stroke();\n    }\n\n    // Искры разлетаются!\n    ctx.globalAlpha = alpha;\n    for (let i = 0; i < 15; i++) {\n      const angle = -Math.PI * 0.7 + (Math.PI * 0.85) * (i / 15) + Math.sin(time * 10 + i) * 0.1;\n      const dist = 200 + Math.random() * 50;\n      const x = Math.cos(angle) * dist;\n      const y = 100 + Math.sin(angle) * dist;\n\n      const sparkColor = i % 2 === 0 ? '#ff6600' : '#ffaa00';\n      ctx.fillStyle = sparkColor;\n      ctx.shadowColor = sparkColor;\n      ctx.shadowBlur = 15;\n      ctx.beginPath();\n      ctx.arc(x, y, 4 + Math.random() * 4, 0, Math.PI * 2);\n      ctx.fill();\n    }\n\n    ctx.globalAlpha = 1;\n    ctx.shadowBlur = 0;\n    ctx.restore();\n  }\n\n  /** Создать огненные осколки при сплеше топора (оптимизировано) */\n  public spawnAxeSplash(): void {\n    if (this.particles.length > WeaponRenderer.MAX_PARTICLES) return;\n\n    const centerX = this.width / 2;\n    const centerY = this.height / 2;\n    const colors = ['#ff6600', '#ff9900', '#ff3300', '#ffcc00'];\n\n    // Крупные огненные осколки (уменьшено с 20 до 8)\n    for (let i = 0; i < 8; i++) {\n      const angle = (i / 8) * Math.PI * 2 + Math.random() * 0.3;\n      const speed = 400 + Math.random() * 500;\n      this.particles.push({\n        x: centerX + (Math.random() - 0.5) * 60,\n        y: centerY + (Math.random() - 0.5) * 60,\n        vx: Math.cos(angle) * speed,\n        vy: Math.sin(angle) * speed - 120,\n        size: 8 + Math.random() * 10,\n        color: colors[i % colors.length],\n        life: 0.5 + Math.random() * 0.3,\n        maxLife: 0.5 + Math.random() * 0.3,\n        type: 'fragment',\n      });\n    }\n\n    // Искры (уменьшено с 35 до 12)\n    for (let i = 0; i < 12; i++) {\n      const angle = Math.random() * Math.PI * 2;\n      const speed = 250 + Math.random() * 400;\n      this.particles.push({\n        x: centerX + (Math.random() - 0.5) * 30,\n        y: centerY + (Math.random() - 0.5) * 30,\n        vx: Math.cos(angle) * speed,\n        vy: Math.sin(angle) * speed - 80,\n        size: 2 + Math.random() * 4,\n        color: colors[i % colors.length],\n        life: 0.3 + Math.random() * 0.3,\n        maxLife: 0.3 + Math.random() * 0.3,\n        type: 'spark',\n      });\n    }\n  }\n\n  private drawHitGlow(ctx: CanvasRenderingContext2D, intensity: number, weaponType: WeaponType = 'katana'): void {\n    ctx.save();\n    ctx.globalAlpha = intensity;\n\n    if (weaponType === 'charged') {\n      // Электрическое свечение для заряженной катаны\n      ctx.strokeStyle = '#ffffff';\n      ctx.shadowColor = '#00ffff';\n      ctx.shadowBlur = 50 * intensity;\n      ctx.lineWidth = 10;\n\n      // Обводка всего лезвия\n      ctx.beginPath();\n      ctx.moveTo(9, 30);\n      ctx.lineTo(6, -280);\n      ctx.lineTo(0, -320);\n      ctx.stroke();\n\n      // Дополнительные волны энергии\n      ctx.strokeStyle = '#00ffff';\n      ctx.shadowColor = '#0088ff';\n      ctx.shadowBlur = 30 * intensity;\n      ctx.lineWidth = 4;\n      for (let i = 0; i < 3; i++) {\n        ctx.beginPath();\n        ctx.arc(0, -150, 50 + i * 30, 0, Math.PI * 2);\n        ctx.stroke();\n      }\n    } else {\n      // Неоновое свечение для катаны\n      ctx.strokeStyle = '#ffffff';\n      ctx.shadowColor = '#00ffff';\n      ctx.shadowBlur = 30 * intensity;\n      ctx.lineWidth = 6;\n\n      ctx.beginPath();\n      ctx.moveTo(9, 30);\n      ctx.lineTo(6, -280);\n      ctx.lineTo(0, -320);\n      ctx.stroke();\n\n      ctx.strokeStyle = '#ff00ff';\n      ctx.shadowColor = '#ff00ff';\n      ctx.shadowBlur = 20 * intensity;\n      ctx.lineWidth = 3;\n      ctx.stroke();\n    }\n\n    ctx.restore();\n  }\n\n  private drawScreenFlash(ctx: CanvasRenderingContext2D, weaponType: WeaponType = 'katana'): void {\n    ctx.save();\n    ctx.resetTransform();\n\n    const gradient = ctx.createRadialGradient(\n      this.width / 2, this.height / 2, 0,\n      this.width / 2, this.height / 2, this.width\n    );\n    \n    if (weaponType === 'charged') {\n      // Электрическая вспышка для заряженной катаны\n      gradient.addColorStop(0, `rgba(255, 255, 255, ${this.hitFlash * 0.6})`);\n      gradient.addColorStop(0.2, `rgba(0, 255, 255, ${this.hitFlash * 0.4})`);\n      gradient.addColorStop(0.5, `rgba(0, 150, 255, ${this.hitFlash * 0.2})`);\n      gradient.addColorStop(0.8, `rgba(0, 80, 255, ${this.hitFlash * 0.1})`);\n      gradient.addColorStop(1, 'rgba(0, 0, 0, 0)');\n    } else {\n      // Неоновая вспышка для катаны\n      gradient.addColorStop(0, `rgba(255, 255, 255, ${this.hitFlash * 0.4})`);\n      gradient.addColorStop(0.3, `rgba(255, 0, 255, ${this.hitFlash * 0.2})`);\n      gradient.addColorStop(0.6, `rgba(0, 255, 255, ${this.hitFlash * 0.1})`);\n      gradient.addColorStop(1, 'rgba(0, 0, 0, 0)');\n    }\n\n    ctx.fillStyle = gradient;\n    ctx.fillRect(0, 0, this.width, this.height);\n\n    ctx.restore();\n  }\n}\n","import type { Vec3, ICollisionSystem } from '@/types';\nimport { vec3, distanceVec3, normalizeVec3 } from '@/utils/math';\n\n/** Тип врага */\nexport type EnemyType = 'baneling' | 'phantom' | 'runner' | 'hopper' | 'spiker' | 'boss_green' | 'boss_black' | 'boss_blue';\n\n/** Осколок после разрубания */\nexport interface Fragment {\n  position: Vec3;\n  velocity: Vec3;\n  size: number;\n  lifetime: number;\n  rotation: number;\n  rotationSpeed: number;\n}\n\n/** Токсичная лужа (от Зелёного Босса) */\nexport interface ToxicPool {\n  position: Vec3;\n  radius: number;\n  maxRadius: number;      // Максимальный радиус после растекания\n  lifetime: number;\n  maxLifetime: number;    // Начальное время жизни\n  damage: number;\n  spreadProgress: number; // 0-1 прогресс растекания\n}\n\n/** Зона кислотного дождя (метка на земле → дождь сверху) */\nexport interface AcidRainZone {\n  position: Vec3;         // Центр зоны\n  radius: number;         // Радиус зоны\n  lifetime: number;       // Время жизни\n  markTime: number;       // Время показа метки перед дождём\n  isRaining: boolean;     // Идёт ли дождь\n  damage: number;         // Урон за тик\n}\n\n/** Снаряд кислоты (летящий плевок) */\nexport interface AcidProjectile {\n  position: Vec3;      // Текущая позиция\n  targetPos: Vec3;     // Куда летит\n  startPos: Vec3;      // Откуда летит\n  progress: number;    // 0-1 прогресс полёта\n  flightTime: number;  // Время полёта\n}\n\n/** Роль зелёного босса в паре */\nexport type GreenBossRole = 'hunter' | 'blocker';\n\n/**\n * Враг-шар который летит к игроку\n * - baneling: зелёная жижа, взрывается при столкновении\n * - phantom: чёрный шар, пронзает насквозь с инерцией\n */\nexport class Target {\n  /** Позиция */\n  public position: Vec3;\n\n  /** Скорость полёта */\n  public velocity: Vec3 = vec3();\n\n  /** Радиус */\n  public radius = 0.8;\n\n  /** Активен? */\n  public active = true;\n\n  /** Базовая скорость движения */\n  public speed = 4.0;\n\n  /** Интенсивность огня (для шейдера) */\n  public fireIntensity = 1.0;\n\n  /** Осколки после разрубания */\n  public fragments: Fragment[] = [];\n\n  /** Время до удаления */\n  public removeTimer = 0;\n\n  /** Уникальный ID для разного поведения */\n  public id: number;\n\n  /** Фаза синусоиды */\n  private phase: number;\n\n  /** Тип движения (0-3) */\n  private moveType: number;\n\n  /** Тип врага */\n  public enemyType: EnemyType = 'baneling';\n\n  /** Урон при столкновении */\n  public damage: number = 25;\n\n  /** Фантом: текущая скорость (для разгона) */\n  private currentSpeed = 0;\n\n  /** Фантом: набирает разгон? */\n  private isCharging = true;\n\n  /** Фантом: направление атаки (фиксируется при разгоне) */\n  private chargeDirection: Vec3 = vec3();\n\n  /** Фантом: время после пролёта через игрока */\n  private passedThroughTimer = 0;\n\n  /** Hopper: вертикальная скорость */\n  private verticalVelocity = 0;\n\n  /** Hopper: на земле? */\n  private onGround = true;\n\n  /** Hopper: время до следующего прыжка */\n  private hopTimer = 0;\n\n  /** Runner: угол уклонения */\n  private dodgeAngle = 0;\n\n  /** Runner: время до смены направления */\n  private dodgeTimer = 0;\n\n  /** Runner: прицепился к игроку? */\n  public isAttached = false;\n\n  /** Runner: время на прицепе (сколько осталось чтобы скинуть) */\n  public attachTimer = 0;\n\n  /** Runner: угол вращения вокруг игрока */\n  private orbitAngle = 0;\n\n  /** Босс: HP (обычные враги имеют 1) */\n  public hp = 1;\n  public maxHp = 1;\n\n  /** Босс: это босс? */\n  public isBoss = false;\n\n  /** СМЕРТЬ: враг умирает (падает/растекается) */\n  public isDying = false;\n  \n  /** СМЕРТЬ: прогресс смерти (0-1) */\n  public deathProgress = 0;\n  \n  /** СМЕРТЬ: скорость падения */\n  public deathVelocity = 0;\n  \n  /** СМЕРТЬ: высота при падении */\n  public deathY = 0;\n\n  /** Синий босс: таймер телепортации */\n  private teleportTimer = 0;\n\n  /** Чёрный босс: интенсивность искривления */\n  public distortionPower = 0;\n\n  /** Чёрный босс: таймер спавна фантома */\n  private spawnPhantomTimer = 5.0;\n\n  /** Чёрный босс: фаза вихря (всасывание) */\n  public isVortexActive = false;\n  private vortexTimer = 0;\n  private vortexCooldown = 0;\n  private vortexWarningPlayed = false;\n\n  /** Чёрный босс: колбэк спавна фантома */\n  public onSpawnPhantom?: (pos: Vec3) => void;\n\n  /** Чёрный босс: колбэк начала вихря (для звука) */\n  public onVortexStart?: () => void;\n  public onVortexEnd?: () => void;\n  /** Колбэк предупреждения о вихре (райзер) */\n  public onVortexWarning?: () => void;\n\n  /** Зелёный босс: таймер создания лужи */\n  private poolTimer = 0;\n\n  /** Зелёный босс: таймер плевка */\n  private spitTimer = 0;\n  private spitCooldown = 3.0;\n\n  /** Зелёный босс: роль (охотник/загонщик) */\n  public greenBossRole: GreenBossRole = 'hunter';\n\n  /** Зелёный босс: последняя известная скорость игрока */\n  private lastPlayerPos: Vec3 = vec3();\n  private playerVelocity: Vec3 = vec3();\n\n  /** Callback при плевке (стартовая позиция, целевая позиция) */\n  public onSpit?: (startPos: Vec3, targetPos: Vec3) => void;\n\n  /** Callback при установке метки кислотного дождя */\n  public onAcidRainMark?: (pos: Vec3) => void;\n\n  /** Зелёный босс: фаза (1 или 2) */\n  public bossPhase = 1;\n\n  /** Callback при смене фазы босса */\n  public onPhaseChange?: (phase: number) => void;\n\n  // === СПАЙКЕР (летающий стрелок) ===\n  /** Таймер атаки иголками */\n  private spikeAttackTimer = 0;\n  private spikeAttackCooldown = 2.0;\n  \n  /** Можно убить только в прыжке */\n  public requiresJumpToKill = false;\n  \n  /** Callback при атаке иголкой */\n  public onSpikeAttack?: (startPos: Vec3, targetPos: Vec3) => void;\n  \n  /** Callback при вскрике */\n  public onSpikerScream?: () => void;\n\n  /** Система коллизий */\n  private collision: ICollisionSystem | null = null;\n\n  constructor(position: Vec3, speed: number = 4.0, id: number = 0, type: EnemyType = 'baneling', collision?: ICollisionSystem) {\n    this.position = { ...position };\n    this.speed = speed;\n    this.id = id;\n    this.phase = Math.random() * Math.PI * 2;\n    this.moveType = id % 4;\n    this.enemyType = type;\n    this.collision = collision || null;\n\n    // Настройки по типу врага\n    if (type === 'phantom') {\n      this.speed = speed * 2; // В 2 раза быстрее\n      this.damage = 10; // Меньше урона\n      this.radius = 0.6;\n      this.currentSpeed = 0;\n      this.isCharging = true;\n    } else if (type === 'runner') {\n      this.speed = speed * 2.5; // Очень быстрый!\n      this.damage = 15;\n      this.radius = 0.4; // Маленький и низкий\n      this.position.y = 0.5; // Бежит по земле\n    } else if (type === 'hopper') {\n      this.speed = speed * 1.2;\n      this.damage = 20;\n      this.radius = 0.5;\n      this.verticalVelocity = 8;\n      this.onGround = false;\n    } else if (type === 'spiker') {\n      // Летающий стрелок - кидает иголки, убивается только с прыжка\n      this.speed = speed * 0.8; // Медленный\n      this.damage = 5; // Урон от столкновения маленький\n      this.radius = 0.6;\n      this.position.y = 5 + Math.random() * 3; // Летает высоко (5-8м)\n      this.spikeAttackCooldown = 2.0; // Атакует каждые 2 секунды\n      this.requiresJumpToKill = true; // Можно убить только в прыжке!\n    } else if (type === 'boss_green') {\n      // ЗЕЛЁНЫЙ БОСС - плюётся кислотой!\n      this.isBoss = true;\n      this.speed = speed * 0.6; // Медленный\n      this.damage = 40;\n      this.radius = 2.5; // ОГРОМНЫЙ!\n      this.hp = 10;      // В 2 раза меньше HP (их двое!)\n      this.maxHp = 10;\n      this.spitCooldown = 3.0; // Плюёт каждые 3 секунды\n    } else if (type === 'boss_black') {\n      // ЧЁРНЫЙ БОСС - искривляет пространство\n      // HP = 10 базовых (половина зелёного) + 60 от 6 кристаллей (по 10 каждый)\n      // Без уничтожения кристаллей его невозможно убить!\n      this.isBoss = true;\n      this.speed = speed * 0.8;\n      this.damage = 30;\n      this.radius = 2.0;\n      this.hp = 70;    // 10 базовых + 6*10 от кристаллей\n      this.maxHp = 70;\n      this.distortionPower = 1.0;\n    } else if (type === 'boss_blue') {\n      // СИНИЙ БОСС - телепортируется\n      this.isBoss = true;\n      this.speed = speed * 1.5; // Быстрый между телепортами\n      this.damage = 25;\n      this.radius = 1.8;\n      this.hp = 24;\n      this.maxHp = 24;\n      this.teleportTimer = 3.0;\n    } else {\n      this.damage = 25;\n      this.currentSpeed = speed;\n    }\n  }\n\n  /** Обновление - движение к игроку с паттерном */\n  public update(dt: number, playerPos: Vec3, time: number): void {\n    // Пульсирующий эффект\n    this.fireIntensity = 0.6 + Math.sin(time * 8 + this.id) * 0.4;\n\n    if (this.active) {\n      switch (this.enemyType) {\n        case 'phantom':\n          this.updatePhantom(dt, playerPos, time);\n          break;\n        case 'runner':\n          this.updateRunner(dt, playerPos, time);\n          break;\n        case 'hopper':\n          this.updateHopper(dt, playerPos, time);\n          break;\n        case 'spiker':\n          this.updateSpiker(dt, playerPos, time);\n          break;\n        case 'boss_green':\n          this.updateBossGreen(dt, playerPos, time);\n          break;\n        case 'boss_black':\n          this.updateBossBlack(dt, playerPos, time);\n          break;\n        case 'boss_blue':\n          this.updateBossBlue(dt, playerPos, time);\n          break;\n        default:\n          this.updateBaneling(dt, playerPos, time);\n      }\n    }\n\n    // Обновление осколков\n    this.updateFragments(dt);\n    \n    // Обновление анимации смерти (падение + растекание)\n    this.updateDeath(dt);\n\n    // Таймер удаления\n    if (!this.active && this.removeTimer > 0) {\n      this.removeTimer -= dt;\n    }\n  }\n\n  /** Обновление бейнлинга - катится по земле к игроку */\n  private updateBaneling(dt: number, playerPos: Vec3, time: number): void {\n    // Направление к игроку (только по XZ - катимся по земле!)\n    const dx = playerPos.x - this.position.x;\n    const dz = playerPos.z - this.position.z;\n    const dist = Math.sqrt(dx * dx + dz * dz);\n\n    if (dist > 0.1) {\n      const dirX = dx / dist;\n      const dirZ = dz / dist;\n\n      // Агрессия растёт при приближении\n      const aggression = 1.0 + Math.max(0, (15 - dist) / 15) * 0.8;\n      const currentSpeed = this.speed * aggression;\n\n      // Горизонтальное \"извивание\" для интересного движения\n      let offsetX = 0, offsetZ = 0;\n      const wave = time * 4 + this.phase;\n\n      switch (this.moveType) {\n        case 0:\n          offsetX = Math.cos(wave) * 2;\n          offsetZ = Math.sin(wave) * 2;\n          break;\n        case 1:\n          offsetX = Math.sin(wave * 2) * 3;\n          break;\n        case 2:\n          offsetZ = Math.sin(wave * 1.5) * 3;\n          break;\n        case 3:\n          const pulse = Math.sin(wave) > 0 ? 1.5 : 0.5;\n          offsetX = Math.cos(wave * 3) * 2 * pulse;\n          offsetZ = Math.sin(wave * 3) * 2 * pulse;\n          break;\n      }\n\n      // Перпендикуляр для бокового смещения\n      const perpX = -dirZ;\n      const perpZ = dirX;\n\n      this.velocity.x = dirX * currentSpeed + perpX * offsetX * 0.3;\n      this.velocity.z = dirZ * currentSpeed + perpZ * offsetZ * 0.3;\n\n      // Применяем движение с проверкой коллизий\n      const newX = this.position.x + this.velocity.x * dt;\n      const newZ = this.position.z + this.velocity.z * dt;\n      \n      if (!this.collision?.checkEnemyCollision || \n          !this.collision.checkEnemyCollision({ x: newX, y: this.position.y, z: newZ }, this.radius)) {\n        this.position.x = newX;\n        this.position.z = newZ;\n      }\n      \n      // Бейнлинг всегда на земле (его радиус ~0.7)\n      this.position.y = this.radius;\n    }\n  }\n\n  /** Обновление фантома - разгон и пронзание */\n  private updatePhantom(dt: number, playerPos: Vec3, time: number): void {\n    const dx = playerPos.x - this.position.x;\n    const dy = (playerPos.y - 0.3) - this.position.y;\n    const dz = playerPos.z - this.position.z;\n    const dist = Math.sqrt(dx * dx + dy * dy + dz * dz);\n\n    if (this.isCharging) {\n      // Фаза разгона - набираем скорость, направляемся к игроку\n      this.currentSpeed = Math.min(this.currentSpeed + dt * 15, this.speed);\n\n      // Обновляем направление пока разгоняемся\n      if (dist > 0.1) {\n        this.chargeDirection.x = dx / dist;\n        this.chargeDirection.y = dy / dist;\n        this.chargeDirection.z = dz / dist;\n      }\n\n      // Слегка покачиваемся пока набираем разгон\n      const wobble = Math.sin(time * 10) * 0.3;\n      \n      this.velocity.x = this.chargeDirection.x * this.currentSpeed + wobble;\n      this.velocity.y = this.chargeDirection.y * this.currentSpeed;\n      this.velocity.z = this.chargeDirection.z * this.currentSpeed;\n\n      // Когда набрали полную скорость - фиксируем направление\n      if (this.currentSpeed >= this.speed * 0.9) {\n        this.isCharging = false;\n      }\n    } else {\n      // Фаза атаки - летим по инерции в зафиксированном направлении\n      this.passedThroughTimer += dt;\n\n      // Продолжаем лететь в том же направлении\n      this.velocity.x = this.chargeDirection.x * this.speed;\n      this.velocity.y = this.chargeDirection.y * this.speed;\n      this.velocity.z = this.chargeDirection.z * this.speed;\n\n      // После пролёта через игрока (3 сек) - разворачиваемся\n      if (this.passedThroughTimer > 2.5) {\n        this.isCharging = true;\n        this.currentSpeed = this.speed * 0.3; // Частичный разгон\n        this.passedThroughTimer = 0;\n      }\n    }\n\n    // Движение\n    this.position.x += this.velocity.x * dt;\n    this.position.y += this.velocity.y * dt;\n    this.position.z += this.velocity.z * dt;\n\n    // Ограничения высоты\n    this.position.y = Math.max(0.5, Math.min(4.0, this.position.y));\n\n    // Если улетел слишком далеко - начинаем разгон заново\n    if (dist > 35) {\n      this.isCharging = true;\n      this.currentSpeed = 0;\n      this.passedThroughTimer = 0;\n    }\n  }\n\n  /** Вертикальная скорость раннера */\n  private runnerVerticalVel = 0;\n  /** Раннер на земле? */\n  private runnerOnGround = true;\n\n  /** Обновление раннера - быстрый бегун, прицепляется к игроку */\n  private updateRunner(dt: number, playerPos: Vec3, time: number): void {\n    if (this.isAttached) {\n      // === РЕЖИМ ПРИЦЕПА - летает вокруг игрока ===\n      this.attachTimer -= dt;\n      this.orbitAngle += dt * 12;\n\n      const orbitRadius = 1.2;\n      const orbitHeight = Math.sin(time * 8) * 0.3;\n      \n      this.position.x = playerPos.x + Math.cos(this.orbitAngle) * orbitRadius;\n      this.position.y = playerPos.y + orbitHeight;\n      this.position.z = playerPos.z + Math.sin(this.orbitAngle) * orbitRadius;\n\n      if (this.attachTimer <= 0) {\n        this.isAttached = false;\n        this.active = false;\n        this.removeTimer = 0.5;\n      }\n      return;\n    }\n\n    // === РЕЖИМ ПОГОНИ ===\n    const dx = playerPos.x - this.position.x;\n    const dz = playerPos.z - this.position.z;\n    const dist = Math.sqrt(dx * dx + dz * dz);\n\n    if (dist < 1.5) {\n      this.isAttached = true;\n      this.attachTimer = 3.0;\n      this.orbitAngle = Math.atan2(dz, dx);\n      return;\n    }\n\n    if (dist > 0.1) {\n      const dirX = dx / dist;\n      const dirZ = dz / dist;\n\n      // Проверяем препятствие впереди\n      if (this.collision?.getObstacleHeight && this.runnerOnGround) {\n        const obstacleHeight = this.collision.getObstacleHeight(this.position, dirX, dirZ, 1.5);\n        // Если есть препятствие - прыгаем!\n        if (obstacleHeight > this.position.y && obstacleHeight < 10) {\n          this.runnerVerticalVel = 12; // Сильный прыжок\n          this.runnerOnGround = false;\n        }\n      }\n\n      // Проверяем коллизию\n      if (this.collision?.checkEnemyCollision) {\n        const testPos = { \n          x: this.position.x + dirX * this.speed * dt, \n          y: this.position.y, \n          z: this.position.z + dirZ * this.speed * dt \n        };\n        if (this.collision.checkEnemyCollision(testPos, this.radius)) {\n          // Пытаемся обойти\n          this.dodgeAngle = (Math.random() > 0.5 ? 1 : -1) * Math.PI * 0.5;\n        }\n      }\n\n      // Таймер уклонения\n      this.dodgeTimer -= dt;\n      if (this.dodgeTimer <= 0) {\n        this.dodgeAngle = (Math.random() - 0.5) * Math.PI * 0.8;\n        this.dodgeTimer = 0.3 + Math.random() * 0.4;\n      }\n\n      const cos = Math.cos(this.dodgeAngle);\n      const sin = Math.sin(this.dodgeAngle);\n      const dodgedDirX = dirX * cos - dirZ * sin;\n      const dodgedDirZ = dirX * sin + dirZ * cos;\n\n      const aggression = 1.0 + Math.max(0, (10 - dist) / 10) * 0.5;\n      const currentSpeed = this.speed * aggression;\n      const zigzag = Math.sin(time * 15 + this.phase) * 2;\n\n      this.velocity.x = dodgedDirX * currentSpeed + zigzag * 0.3;\n      this.velocity.z = dodgedDirZ * currentSpeed;\n\n      // Применяем горизонтальное движение с проверкой коллизий\n      const newX = this.position.x + this.velocity.x * dt;\n      const newZ = this.position.z + this.velocity.z * dt;\n      \n      if (!this.collision?.checkEnemyCollision || \n          !this.collision.checkEnemyCollision({ x: newX, y: this.position.y, z: newZ }, this.radius)) {\n        this.position.x = newX;\n        this.position.z = newZ;\n      }\n\n      // Вертикальное движение (прыжки)\n      if (!this.runnerOnGround) {\n        this.runnerVerticalVel -= 25 * dt; // Гравитация\n        this.position.y += this.runnerVerticalVel * dt;\n        \n        if (this.position.y <= 0.5) {\n          this.position.y = 0.5;\n          this.runnerVerticalVel = 0;\n          this.runnerOnGround = true;\n        }\n      } else {\n        this.position.y = 0.5 + Math.abs(Math.sin(time * 20)) * 0.1;\n      }\n    }\n  }\n\n  /** Откидывание от удара (для боссов) */\n  public applyKnockback(dirX: number, dirZ: number, force: number): void {\n    // Нормализуем направление\n    const len = Math.sqrt(dirX * dirX + dirZ * dirZ);\n    if (len > 0) {\n      this.velocity.x = (dirX / len) * force;\n      this.velocity.z = (dirZ / len) * force;\n      // Немного подбрасываем\n      this.velocity.y = force * 0.3;\n    }\n    // Таймер стана - босс замирает на мгновение\n    this.knockbackTimer = 0.3;\n  }\n\n  /** Таймер отката от удара */\n  private knockbackTimer = 0;\n\n  /** Скинуть раннера (двойной прыжок) */\n  public detachRunner(): boolean {\n    if (this.isAttached && this.enemyType === 'runner') {\n      this.isAttached = false;\n      const angle = this.orbitAngle + Math.PI;\n      this.velocity.x = Math.cos(angle) * 15;\n      this.velocity.y = 8;\n      this.velocity.z = Math.sin(angle) * 15;\n      this.attachTimer = 0;\n      return true;\n    }\n    return false;\n  }\n\n  /** Callback для создания лужи */\n  public onCreatePool?: (pos: Vec3) => void;\n\n  /** Зелёный босс - работает в паре: охотник гонит, загонщик отрезает путь */\n  private updateBossGreen(dt: number, playerPos: Vec3, time: number): void {\n    // Обработка отката от удара\n    if (this.knockbackTimer > 0) {\n      this.knockbackTimer -= dt;\n      this.position.x += this.velocity.x * dt;\n      this.position.y += this.velocity.y * dt;\n      this.position.z += this.velocity.z * dt;\n      this.velocity.x *= 0.9;\n      this.velocity.y *= 0.9;\n      this.velocity.z *= 0.9;\n      this.velocity.y -= 15 * dt;\n      this.position.y = Math.max(this.radius, this.position.y);\n      return;\n    }\n\n    // Вычисляем скорость игрока (для предсказания)\n    this.playerVelocity.x = (playerPos.x - this.lastPlayerPos.x) / Math.max(dt, 0.001);\n    this.playerVelocity.z = (playerPos.z - this.lastPlayerPos.z) / Math.max(dt, 0.001);\n    this.lastPlayerPos = { ...playerPos };\n\n    const dx = playerPos.x - this.position.x;\n    const dy = playerPos.y - this.position.y;\n    const dz = playerPos.z - this.position.z;\n    const dist = Math.sqrt(dx * dx + dy * dy + dz * dz);\n\n    // Пульсирующий размер (больше во второй фазе)\n    const baseRadius = this.bossPhase === 2 ? 2.8 : 2.5;\n    this.radius = baseRadius + Math.sin(time * 3) * 0.3;\n\n    // === ПОВЕДЕНИЕ ЗАВИСИТ ОТ РОЛИ ===\n    if (this.greenBossRole === 'hunter') {\n      // ОХОТНИК: вызывает КИСЛОТНЫЙ ДОЖДЬ с неба!\n      this.spitTimer -= dt;\n      const spitCooldownActual = this.bossPhase === 2 ? 5.0 : 8.0;\n      \n      if (this.spitTimer <= 0 && dist < 25) {\n        this.spitTimer = spitCooldownActual;\n        \n        // Ставим метку на позицию игрока\n        const rainTarget = vec3(playerPos.x, 0.05, playerPos.z);\n        this.onAcidRainMark?.(rainTarget);\n        \n        // Во второй фазе - больше меток!\n        if (this.bossPhase === 2) {\n          setTimeout(() => {\n            this.onAcidRainMark?.(vec3(rainTarget.x + 6, 0.05, rainTarget.z));\n            this.onAcidRainMark?.(vec3(rainTarget.x - 6, 0.05, rainTarget.z));\n          }, 800);\n        }\n      }\n      \n      // Охотник идёт медленно, держит дистанцию\n      if (dist > 8) {\n        const dirX = dx / dist;\n        const dirZ = dz / dist;\n        this.velocity.x = dirX * this.speed * 0.5;\n        this.velocity.z = dirZ * this.speed * 0.5;\n        this.position.x += this.velocity.x * dt;\n        this.position.z += this.velocity.z * dt;\n      }\n      this.position.y = Math.max(this.radius, this.position.y);\n      \n    } else {\n      // ЗАГОНЩИК: кидает ЛУЖИ (плевки)!\n      this.spitTimer -= dt;\n      const spitCooldownActual = this.bossPhase === 2 ? 2.0 : 3.5;\n      \n      if (this.spitTimer <= 0 && dist < 20) {\n        this.spitTimer = spitCooldownActual;\n        \n        // Плюём в игрока!\n        const spitTarget = vec3(\n          playerPos.x + (Math.random() - 0.5) * 2,\n          0.05,\n          playerPos.z + (Math.random() - 0.5) * 2\n        );\n        const spitStart = vec3(this.position.x, this.position.y + 1, this.position.z);\n        this.onSpit?.(spitStart, spitTarget);\n        \n        // Во второй фазе - серия плевков!\n        if (this.bossPhase === 2) {\n          setTimeout(() => {\n            const extra = vec3(playerPos.x + 3, 0.05, playerPos.z);\n            this.onSpit?.(spitStart, extra);\n          }, 300);\n          setTimeout(() => {\n            const extra = vec3(playerPos.x - 3, 0.05, playerPos.z);\n            this.onSpit?.(spitStart, extra);\n          }, 600);\n        }\n      }\n      \n      // Загонщик быстро бежит к игроку!\n      if (dist > 0.1) {\n        const dirX = dx / dist;\n        const dirY = dy / dist;\n        const dirZ = dz / dist;\n        const wobble = Math.sin(time * 2) * 0.5;\n        \n        const speedMult = this.bossPhase === 2 ? 1.4 : 1.0;\n        this.velocity.x = dirX * this.speed * speedMult + wobble;\n        this.velocity.y = dirY * this.speed * 0.3;\n        this.velocity.z = dirZ * this.speed * speedMult;\n\n        this.position.x += this.velocity.x * dt;\n        this.position.y += this.velocity.y * dt;\n        this.position.z += this.velocity.z * dt;\n        this.position.y = Math.max(this.radius, this.position.y);\n      }\n    }\n  }\n\n  /** Чёрный босс - искривляет пространство вокруг себя */\n  private updateBossBlack(dt: number, playerPos: Vec3, time: number): void {\n    // Обработка отката от удара\n    if (this.knockbackTimer > 0) {\n      this.knockbackTimer -= dt;\n      this.position.x += this.velocity.x * dt;\n      this.position.y += this.velocity.y * dt;\n      this.position.z += this.velocity.z * dt;\n      this.velocity.x *= 0.92;\n      this.velocity.y *= 0.92;\n      this.velocity.z *= 0.92;\n      this.velocity.y -= 10 * dt;\n      this.position.y = Math.max(1.0, this.position.y);\n      return;\n    }\n\n    const dx = playerPos.x - this.position.x;\n    const dy = playerPos.y - this.position.y;\n    const dz = playerPos.z - this.position.z;\n    const dist = Math.sqrt(dx * dx + dy * dy + dz * dz);\n\n    // === СПАВН ФАНТОМОВ КАЖДЫЕ 5 СЕКУНД ===\n    this.spawnPhantomTimer -= dt;\n    if (this.spawnPhantomTimer <= 0) {\n      this.spawnPhantomTimer = 5.0;\n      // Спавним фантома рядом с боссом\n      const spawnAngle = Math.random() * Math.PI * 2;\n      const spawnDist = 3 + Math.random() * 2;\n      const spawnPos = vec3(\n        this.position.x + Math.cos(spawnAngle) * spawnDist,\n        this.position.y,\n        this.position.z + Math.sin(spawnAngle) * spawnDist\n      );\n      this.onSpawnPhantom?.(spawnPos);\n    }\n\n    // === ФАЗА ВИХРЯ (ВСАСЫВАНИЕ) ===\n    this.vortexCooldown -= dt;\n    \n    if (this.isVortexActive) {\n      // Вихрь активен - всасываем игрока\n      this.vortexTimer -= dt;\n      \n      // Босс крутится на месте\n      this.position.y = 2.0 + Math.sin(time * 10) * 0.3;\n      \n      // Интенсивное искривление\n      this.distortionPower = 1.5 + Math.sin(time * 15) * 0.5;\n      \n      if (this.vortexTimer <= 0) {\n        // Вихрь закончился\n        this.isVortexActive = false;\n        this.vortexCooldown = 12.0; // Кулдаун 12 секунд\n        this.vortexWarningPlayed = false; // Сбрасываем флаг предупреждения\n        this.onVortexEnd?.();\n      }\n      return; // Не двигаемся во время вихря\n    }\n    \n    // Предупреждение о вихре за 2 секунды (райзер)\n    if (this.vortexCooldown > 0 && this.vortexCooldown <= 2.0 && !this.vortexWarningPlayed && dist < 15) {\n      this.vortexWarningPlayed = true;\n      this.onVortexWarning?.();\n    }\n    \n    // Начинаем вихрь каждые 12 секунд (если игрок близко)\n    if (this.vortexCooldown <= 0 && dist < 15) {\n      this.isVortexActive = true;\n      this.vortexTimer = 4.0; // Вихрь длится 4 секунды\n      this.onVortexStart?.();\n    }\n\n    // === ОБЫЧНОЕ ДВИЖЕНИЕ ===\n    // Орбитальное движение вокруг центра + приближение к игроку\n    const orbitSpeed = 0.5;\n    const orbitRadius = 8 + Math.sin(time * 0.3) * 3;\n    \n    const targetX = Math.cos(time * orbitSpeed) * orbitRadius;\n    const targetZ = Math.sin(time * orbitSpeed) * orbitRadius;\n    \n    // Притяжение к орбите + направление к игроку\n    const toOrbitX = targetX - this.position.x;\n    const toOrbitZ = targetZ - this.position.z;\n    \n    this.velocity.x = toOrbitX * 0.5 + (dx / dist) * this.speed * 0.3;\n    this.velocity.y = (1.5 - this.position.y) * 2; // Держится на высоте\n    this.velocity.z = toOrbitZ * 0.5 + (dz / dist) * this.speed * 0.3;\n\n    this.position.x += this.velocity.x * dt;\n    this.position.y += this.velocity.y * dt;\n    this.position.z += this.velocity.z * dt;\n\n    // Интенсивность искривления зависит от расстояния до игрока\n    this.distortionPower = Math.max(0, 1.0 - dist / 20);\n  }\n\n  /** Получить силу притяжения вихря (для игрока) */\n  public getVortexPull(playerPos: Vec3): Vec3 {\n    if (!this.isVortexActive) return vec3(0, 0, 0);\n    \n    const dx = this.position.x - playerPos.x;\n    const dz = this.position.z - playerPos.z;\n    const dist = Math.sqrt(dx * dx + dz * dz);\n    \n    if (dist < 0.5) return vec3(0, 0, 0);\n    \n    // Сила притяжения - сильнее когда ближе (ослаблена в 2 раза)\n    const pullStrength = Math.max(0, 1 - dist / 20) * 7.5;\n    \n    return vec3(\n      (dx / dist) * pullStrength,\n      0,\n      (dz / dist) * pullStrength\n    );\n  }\n\n  /** Синий босс - телепортируется */\n  private updateBossBlue(dt: number, playerPos: Vec3, time: number): void {\n    // Обработка отката от удара - синий откидывается сильно!\n    if (this.knockbackTimer > 0) {\n      this.knockbackTimer -= dt;\n      this.position.x += this.velocity.x * dt;\n      this.position.y += this.velocity.y * dt;\n      this.position.z += this.velocity.z * dt;\n      this.velocity.x *= 0.85; // Быстрее затухает\n      this.velocity.y *= 0.85;\n      this.velocity.z *= 0.85;\n      this.velocity.y -= 20 * dt;\n      this.position.y = Math.max(0.5, this.position.y);\n      return;\n    }\n\n    this.teleportTimer -= dt;\n\n    if (this.teleportTimer <= 0) {\n      // ТЕЛЕПОРТ!\n      const angle = Math.random() * Math.PI * 2;\n      const dist = 5 + Math.random() * 10;\n      \n      this.position.x = playerPos.x + Math.cos(angle) * dist;\n      this.position.y = 1.5 + Math.random() * 2;\n      this.position.z = playerPos.z + Math.sin(angle) * dist;\n      \n      this.teleportTimer = 2.0 + Math.random() * 2.0; // 2-4 сек между телепортами\n      return;\n    }\n\n    // Между телепортами - агрессивное преследование\n    const dx = playerPos.x - this.position.x;\n    const dy = playerPos.y - this.position.y;\n    const dz = playerPos.z - this.position.z;\n    const dist = Math.sqrt(dx * dx + dy * dy + dz * dz);\n\n    if (dist > 0.1) {\n      // Зигзаг движение\n      const zigzag = Math.sin(time * 10) * 3;\n      \n      this.velocity.x = (dx / dist) * this.speed + zigzag * 0.5;\n      this.velocity.y = (dy / dist) * this.speed * 0.5;\n      this.velocity.z = (dz / dist) * this.speed;\n\n      this.position.x += this.velocity.x * dt;\n      this.position.y += this.velocity.y * dt;\n      this.position.z += this.velocity.z * dt;\n\n      this.position.y = Math.max(0.5, Math.min(4.0, this.position.y));\n    }\n  }\n\n  /** Получить урон (для боссов) */\n  public takeDamage(amount: number = 1): boolean {\n    this.hp -= amount;\n    \n    // Проверка смены фазы для Зелёного Босса\n    if (this.enemyType === 'boss_green' && this.bossPhase === 1) {\n      if (this.hp <= this.maxHp / 2) {\n        this.bossPhase = 2;\n        this.speed *= 1.3; // Быстрее во второй фазе\n        this.onPhaseChange?.(2);\n      }\n    }\n    \n    if (this.hp <= 0) {\n      this.hp = 0;\n      return true; // Убит\n    }\n    return false;\n  }\n\n  /** Обновление хоппера - прыгающий враг */\n  private updateHopper(dt: number, playerPos: Vec3, _time: number): void {\n    const dx = playerPos.x - this.position.x;\n    const dz = playerPos.z - this.position.z;\n    const distXZ = Math.sqrt(dx * dx + dz * dz);\n\n    const gravity = 18.0;\n\n    if (this.onGround) {\n      this.hopTimer -= dt;\n      \n      if (this.hopTimer <= 0) {\n        // ПРЫЖОК!\n        this.onGround = false;\n        \n        // Проверяем препятствие - прыгаем выше если нужно\n        let jumpForce = 10 + Math.random() * 4;\n        if (this.collision?.getObstacleHeight && distXZ > 0.1) {\n          const dirX = dx / distXZ;\n          const dirZ = dz / distXZ;\n          const obstacleHeight = this.collision.getObstacleHeight(this.position, dirX, dirZ, 3);\n          if (obstacleHeight > this.position.y) {\n            // Прыгаем выше чтобы перепрыгнуть\n            jumpForce = Math.max(jumpForce, (obstacleHeight - this.position.y + 2) * 3);\n          }\n        }\n        \n        this.verticalVelocity = jumpForce;\n        this.hopTimer = 0.5 + Math.random() * 0.5;\n\n        if (distXZ > 0.1) {\n          const jumpSpeed = this.speed * 1.5;\n          this.velocity.x = (dx / distXZ) * jumpSpeed;\n          this.velocity.z = (dz / distXZ) * jumpSpeed;\n        }\n      } else {\n        this.velocity.x *= 0.9;\n        this.velocity.z *= 0.9;\n      }\n    } else {\n      this.verticalVelocity -= gravity * dt;\n      \n      if (distXZ > 0.1) {\n        this.velocity.x += (dx / distXZ) * dt * 3;\n        this.velocity.z += (dz / distXZ) * dt * 3;\n      }\n    }\n\n    // Применяем движение с проверкой коллизий\n    const newX = this.position.x + this.velocity.x * dt;\n    const newZ = this.position.z + this.velocity.z * dt;\n    \n    if (!this.collision?.checkEnemyCollision || \n        !this.collision.checkEnemyCollision({ x: newX, y: this.position.y, z: newZ }, this.radius)) {\n      this.position.x = newX;\n      this.position.z = newZ;\n    } else {\n      // Отскакиваем при столкновении\n      this.velocity.x *= -0.5;\n      this.velocity.z *= -0.5;\n    }\n    \n    this.position.y += this.verticalVelocity * dt;\n\n    // Проверка земли\n    if (this.position.y <= 0.5) {\n      this.position.y = 0.5;\n      this.onGround = true;\n      this.verticalVelocity = 0;\n    }\n\n    this.position.y = Math.min(12.0, this.position.y); // Выше могут прыгать\n  }\n\n  /** Обновление спайкера - летает сверху, кидает иголки */\n  // Таймер манёвра спайкера\n  private spikerManeuverTimer = 0;\n  private spikerManeuverDir: Vec3 = { x: 0, y: 0, z: 0 };\n  private spikerDodging = false;\n  private spikerDiveTimer = 0;\n  \n  private updateSpiker(dt: number, playerPos: Vec3, time: number): void {\n    const dx = playerPos.x - this.position.x;\n    const dz = playerPos.z - this.position.z;\n    const distXZ = Math.sqrt(dx * dx + dz * dz);\n    \n    // === ПОКАЧИВАНИЕ КРЫЛЬЯМИ (быстрое!) ===\n    const wingCycle = time * 8 + this.phase; // Быстрые взмахи!\n    const wingBeat = Math.sin(wingCycle);\n    const bobAmount = wingBeat * 0.5;\n    \n    // === МАНЁВРЫ И УКЛОНЕНИЯ ===\n    this.spikerManeuverTimer -= dt;\n    this.spikerDiveTimer -= dt;\n    \n    // Случайный манёвр каждые 0.3-0.8 секунды\n    if (this.spikerManeuverTimer <= 0) {\n      this.spikerManeuverTimer = 0.3 + Math.random() * 0.5;\n      \n      // Выбираем тип манёвра\n      const maneuverType = Math.random();\n      \n      if (maneuverType < 0.3) {\n        // Резкий рывок в сторону\n        const sideAngle = Math.atan2(dz, dx) + (Math.random() > 0.5 ? Math.PI / 2 : -Math.PI / 2);\n        this.spikerManeuverDir = {\n          x: Math.cos(sideAngle) * 15,\n          y: (Math.random() - 0.3) * 8,\n          z: Math.sin(sideAngle) * 15\n        };\n        this.spikerDodging = true;\n      } else if (maneuverType < 0.5) {\n        // Пикирование к игроку\n        this.spikerDiveTimer = 0.4;\n        this.spikerManeuverDir = {\n          x: dx / distXZ * 20,\n          y: -8,\n          z: dz / distXZ * 20\n        };\n        this.spikerDodging = false;\n      } else if (maneuverType < 0.7) {\n        // Резкий подъём\n        this.spikerManeuverDir = {\n          x: (Math.random() - 0.5) * 10,\n          y: 12,\n          z: (Math.random() - 0.5) * 10\n        };\n        this.spikerDodging = false;\n      } else {\n        // Отлёт назад\n        this.spikerManeuverDir = {\n          x: -dx / distXZ * 12,\n          y: (Math.random() - 0.5) * 5,\n          z: -dz / distXZ * 12\n        };\n        this.spikerDodging = false;\n      }\n    }\n    \n    // Применяем манёвр с затуханием\n    const maneuverFade = Math.max(0, this.spikerManeuverTimer / 0.5);\n    this.position.x += this.spikerManeuverDir.x * dt * maneuverFade;\n    this.position.y += this.spikerManeuverDir.y * dt * maneuverFade;\n    this.position.z += this.spikerManeuverDir.z * dt * maneuverFade;\n    \n    // === БАЗОВОЕ КРУЖЕНИЕ (быстрое!) ===\n    if (!this.spikerDodging && this.spikerDiveTimer <= 0) {\n      const orbitRadius = 8 + Math.sin(time * 2 + this.phase) * 3; // Радиус меняется!\n      \n      if (distXZ > 0.1) {\n        const angle = Math.atan2(dz, dx);\n        const orbitSpeed = 3.5; // Быстро кружит!\n        const newAngle = angle + orbitSpeed * dt;\n        \n        // Коррекция расстояния\n        let radialSpeed = 0;\n        if (distXZ < orbitRadius - 2) {\n          radialSpeed = -8;\n        } else if (distXZ > orbitRadius + 2) {\n          radialSpeed = 8;\n        }\n        \n        const targetX = playerPos.x - Math.cos(newAngle) * (distXZ + radialSpeed * dt);\n        const targetZ = playerPos.z - Math.sin(newAngle) * (distXZ + radialSpeed * dt);\n        \n        this.position.x += (targetX - this.position.x) * dt * 5;\n        this.position.z += (targetZ - this.position.z) * dt * 5;\n      }\n    }\n    \n    // === ВЫСОТА ===\n    const baseHeight = 5.0 + Math.sin(time * 1.5 + this.phase * 2) * 2.0;\n    const targetHeight = baseHeight + bobAmount;\n    \n    // После пикирования - резкий подъём\n    if (this.spikerDiveTimer > 0 && this.position.y < 3) {\n      this.spikerManeuverDir.y = 15; // Резко вверх!\n    }\n    \n    // Плавная коррекция высоты\n    if (this.spikerDiveTimer <= 0 && !this.spikerDodging) {\n      const heightDiff = targetHeight - this.position.y;\n      this.position.y += heightDiff * dt * 3;\n    }\n    \n    // === АТАКА ИГОЛКАМИ ===\n    this.spikeAttackTimer -= dt;\n    if (this.spikeAttackTimer <= 0 && distXZ < 20) {\n      this.onSpikerScream?.();\n      \n      // Стреляем быстрее!\n      setTimeout(() => {\n        if (this.active) {\n          this.onSpikeAttack?.(\n            { ...this.position },\n            { ...playerPos }\n          );\n        }\n      }, 200);\n      \n      this.spikeAttackTimer = this.spikeAttackCooldown * 0.7 + Math.random() * 0.5;\n    }\n    \n    // === ОГРАНИЧЕНИЯ ===\n    const arenaRadius = 35;\n    const dist = Math.sqrt(this.position.x ** 2 + this.position.z ** 2);\n    if (dist > arenaRadius) {\n      this.position.x *= arenaRadius / dist;\n      this.position.z *= arenaRadius / dist;\n    }\n    this.position.y = Math.max(2.5, Math.min(12, this.position.y));\n  }\n\n  /** Обновление капель слизи */\n  private updateFragments(dt: number): void {\n    const gravity = 35.0; // Сильная гравитация - капли быстро падают\n    const airDrag = 0.96; // Сопротивление воздуха\n    const splatFriction = 0.3; // Сильное затухание при падении на пол\n\n    for (let i = this.fragments.length - 1; i >= 0; i--) {\n      const f = this.fragments[i];\n\n      // Физика движения\n      f.position.x += f.velocity.x * dt;\n      f.position.y += f.velocity.y * dt;\n      f.position.z += f.velocity.z * dt;\n\n      // Сильная гравитация - капли падают быстро\n      f.velocity.y -= gravity * dt;\n      \n      // Сопротивление воздуха\n      f.velocity.x *= airDrag;\n      f.velocity.z *= airDrag;\n\n      // Падение на пол - СПЛАТ! (не отскакивают, а расплёскиваются)\n      if (f.position.y < f.size * 0.3) {\n        f.position.y = f.size * 0.3;\n        \n        // Слизь расплющивается на полу\n        f.velocity.y = 0; // Не отскакивает\n        f.velocity.x *= splatFriction;\n        f.velocity.z *= splatFriction;\n        \n        // Капля сплющивается (уменьшаем размер быстрее)\n        f.size *= 0.95;\n        f.lifetime -= dt * 2; // Быстрее исчезает на полу\n      }\n\n      // Время жизни\n      f.lifetime -= dt;\n\n      // Удаляем когда слишком маленькие или старые\n      if (f.lifetime <= 0 || f.size < 0.03 || f.position.y < -5) {\n        this.fragments.splice(i, 1);\n      }\n    }\n  }\n\n  /** Проверка столкновения с игроком */\n  public checkPlayerCollision(playerPos: Vec3): boolean {\n    if (!this.active) return false;\n\n    const dist = distanceVec3(this.position, playerPos);\n    return dist < this.radius + 0.5; // Радиус игрока ~0.5\n  }\n\n  /** Убить врага - МГНОВЕННО падает замертво! */\n  public slice(sliceDirection: Vec3): void {\n    if (!this.active || this.isDying) return;\n\n    // Враг СРАЗУ мёртв на земле\n    this.active = false;\n    this.isDying = true;\n    this.deathProgress = 0;\n    this.deathY = 0.1; // Сразу на земле!\n    this.deathVelocity = 0;\n    this.removeTimer = 2.0; // Время пока лужа исчезнет\n    \n    // Небольшой сдвиг от удара\n    const sliceLen = Math.sqrt(sliceDirection.x ** 2 + sliceDirection.y ** 2 + sliceDirection.z ** 2) || 1;\n    this.position.x += (sliceDirection.x / sliceLen) * 0.3;\n    this.position.z += (sliceDirection.z / sliceLen) * 0.3;\n    \n    // Брызги при ударе\n    const numSplash = 4 + Math.floor(Math.random() * 4); // 4-7 брызг\n    for (let i = 0; i < numSplash; i++) {\n      const angle = Math.random() * Math.PI * 2;\n      const speed = 5 + Math.random() * 8;\n      this.fragments.push({\n        position: { \n          x: this.position.x,\n          y: 0.3,\n          z: this.position.z,\n        },\n        velocity: { \n          x: Math.cos(angle) * speed, \n          y: 3 + Math.random() * 4, \n          z: Math.sin(angle) * speed \n        },\n        size: 0.08 + Math.random() * 0.1,\n        lifetime: 0.6 + Math.random() * 0.4,\n        rotation: 0,\n        rotationSpeed: 0,\n      });\n    }\n  }\n  \n  /** Обновить анимацию смерти (быстрое растекание) */\n  public updateDeath(dt: number): void {\n    if (!this.isDying) return;\n    \n    // Быстрое растекание!\n    this.deathProgress += dt * 4.0;\n    \n    // Завершение анимации\n    if (this.deathProgress >= 1.0) {\n      this.deathProgress = 1.0;\n      this.isDying = false;\n    }\n  }\n\n  /** Можно удалить? */\n  public canRemove(): boolean {\n    return !this.active && this.removeTimer <= 0 && this.fragments.length === 0;\n  }\n\n  /** Данные для шейдера [x, y, z, type+intensity] */\n  public getShaderData(): [number, number, number, number] {\n    // w компонент: 0 = неактивен\n    // 1.0-1.9 = бейнлинг (зелёный)\n    // 3.0-3.9 = фантом (чёрный)\n    // 5.0-5.9 = runner (оранжевый)\n    // 7.0-7.9 = hopper (синий)\n    // 9.0-9.9 = spiker (красно-жёлтый, летающий)\n    // 11.0-11.9 = boss_green (огромный зелёный)\n    // 13.0-13.9 = boss_black (чёрный, искривление)\n    // 15.0-15.9 = boss_blue (синий, телепорт)\n    // +100 = умирает (добавляется к типу)\n    let w = 0;\n    \n    // Рендерим и живых и умирающих врагов\n    if (this.active || this.isDying) {\n      const intensity = this.fireIntensity * 0.5;\n      switch (this.enemyType) {\n        case 'phantom':\n          w = 3 + intensity;\n          break;\n        case 'runner':\n          w = 5 + intensity;\n          break;\n        case 'hopper':\n          w = 7 + intensity;\n          break;\n        case 'spiker':\n          w = 9 + intensity;\n          break;\n        case 'boss_green':\n          w = 11 + intensity;\n          break;\n        case 'boss_black':\n          w = 13 + intensity;\n          break;\n        case 'boss_blue':\n          w = 15 + intensity;\n          break;\n        default: // baneling\n          w = 1 + intensity;\n      }\n      \n      // Если умирает - добавляем 100 к типу + deathProgress в дробную часть\n      if (this.isDying || this.deathProgress > 0) {\n        w += 100 + this.deathProgress * 0.5; // 0-0.5 в дробной части\n      }\n    }\n    \n    // Y позиция = deathY при умирании (враг падает)\n    const y = (this.isDying || this.deathProgress > 0) ? this.deathY : this.position.y;\n    return [this.position.x, y, this.position.z, w];\n  }\n  \n  /** Данные смерти для шейдера [x, z, progress, radius] */\n  public getDeathData(): [number, number, number, number] {\n    if (!this.isDying && this.deathProgress < 1.0) {\n      return [0, 0, 0, 0];\n    }\n    return [this.position.x, this.position.z, this.deathProgress, this.radius];\n  }\n\n  /** Данные осколков для шейдера */\n  public getFragmentsData(): number[] {\n    const data: number[] = [];\n    for (const f of this.fragments) {\n      data.push(f.position.x, f.position.y, f.position.z, f.size);\n    }\n    return data;\n  }\n}\n\n/** Кристалл силы чёрного босса */\nexport interface PowerCrystal {\n  x: number;\n  z: number;\n  height: number;\n  active: boolean;\n  platformIndex: number; // На какой платформе\n}\n\n/** Элемент очереди спавна через портал */\nexport interface SpawnQueueItem {\n  type: EnemyType;\n  speed: number;\n  portalSide: 'left' | 'right'; // Через какой портал выходит\n}\n\n/** Позиции порталов */\nexport const PORTAL_POSITIONS = {\n  left: { x: -21.0, y: 1.5, z: 0 },\n  right: { x: 21.0, y: 1.5, z: 0 }\n} as const;\n\n/**\n * Менеджер врагов с системой волн\n */\nexport class TargetManager {\n  /** Все враги */\n  public targets: Target[] = [];\n\n  /** Текущая волна */\n  public wave = 0;\n\n  /** Волна активна? */\n  public waveActive = false;\n\n  /** Задержка между волнами (секунды) */\n  private waveDelay = 4.0;\n  private waveTimer = 0;\n\n  /** Счёт */\n  public score = 0;\n\n  /** Кристаллы силы для чёрного босса */\n  public powerCrystals: PowerCrystal[] = [];\n\n  /** Callback при уничтожении */\n  public onTargetDestroyed?: (target: Target) => void;\n\n  /** Callback при столкновении с игроком */\n  public onPlayerHit?: (target: Target) => void;\n\n  /** Callback при завершении волны */\n  public onWaveComplete?: (wave: number) => void;\n\n  /** Callback при старте волны */\n  public onWaveStart?: (wave: number) => void;\n\n  /** Callback при уроне от лужи */\n  public onPoolDamage?: (damage: number) => void;\n\n  /** Callback при уничтожении кристалла */\n  public onCrystalDestroyed?: (remaining: number) => void;\n\n  /** Callback при смене фазы босса */\n  public onBossPhaseChange?: (bossType: EnemyType, phase: number) => void;\n\n  /** Callback при кислотном дожде (зелёный босс плюнул) */\n  public onAcidRain?: (pos: Vec3) => void;\n\n  /** Callback при начале/конце вихря чёрного босса */\n  public onBossVortexStart?: () => void;\n  public onBossVortexEnd?: () => void;\n  public onBossVortexWarning?: () => void;\n\n  /** Токсичные лужи */\n  public toxicPools: ToxicPool[] = [];\n\n  /** Зоны кислотного дождя */\n  public acidRainZones: AcidRainZone[] = [];\n\n  /** Фаза 2 зелёного босса (один из двух убит) */\n  public greenBossPhase2 = false;\n\n  /** Летящие снаряды кислоты */\n  public acidProjectiles: AcidProjectile[] = [];\n\n  /** Таймер урона от луж и дождя */\n  private poolDamageTimer = 0;\n\n  /** Система коллизий */\n  private collision: ICollisionSystem | null = null;\n\n  // === СИСТЕМА ПОРТАЛОВ ===\n  /** Очередь спавна врагов */\n  private spawnQueue: SpawnQueueItem[] = [];\n  \n  /** Таймеры порталов (левый и правый) */\n  private portalTimers = { left: 0, right: 0 };\n  \n  /** Интервал между спавнами через один портал (сек) */\n  private readonly PORTAL_SPAWN_INTERVAL = 0.7;\n  \n  /** Callback при спавне врага через портал (для звука) */\n  public onEnemySpawn?: (type: EnemyType, portalSide: 'left' | 'right') => void;\n  \n  /** Callback при атаке иголкой спайкера */\n  public onSpikerAttack?: (startPos: Vec3, targetPos: Vec3) => void;\n  \n  /** Callback при вскрике спайкера */\n  public onSpikerScream?: () => void;\n  \n  /** Callback при попадании иголки в игрока */\n  public onSpikeHit?: () => void;\n  \n  // === СИСТЕМА ЛАЗЕРОВ СПАЙКЕРОВ ===\n  /** Активные лазеры */\n  public spikes: Array<{\n    start: Vec3;      // Начало луча (позиция спайкера)\n    end: Vec3;        // Конец луча (позиция игрока)\n    active: boolean;\n    lifetime: number; // Время существования\n    intensity: number; // Интенсивность (для затухания)\n    damageDealt: boolean; // Урон уже нанесён?\n  }> = [];\n\n  constructor(collision?: ICollisionSystem) {\n    this.collision = collision || null;\n  }\n\n  /** Проверить находится ли игрок под платформой (укрытие от дождя) */\n  private isPlayerUnderPlatform(playerPos: Vec3): boolean {\n    if (!this.collision) return false;\n    \n    // Проверяем есть ли потолок над игроком\n    const ceiling = this.collision.getCeilingHeight(playerPos);\n    // Если есть потолок ниже 15м - игрок под укрытием\n    return ceiling < 15;\n  }\n\n  /** Начать игру с указанной волны */\n  public startGame(startWave: number = 1): void {\n    this.wave = startWave - 1; // -1 потому что startNextWave сделает +1\n    this.score = 0;\n    this.targets = [];\n    this.toxicPools = [];\n    this.greenBossPhase2 = false;\n    this.spawnQueue = []; // Очищаем очередь порталов\n    this.portalTimers = { left: 0, right: 0 };\n    this.startNextWave();\n  }\n\n  /** Начать следующую волну */\n  public startNextWave(): void {\n    this.wave++;\n    this.waveActive = true;\n    \n    // Спавним N врагов (N = номер волны)\n    this.spawnEnemies(this.wave);\n    \n    this.onWaveStart?.(this.wave);\n  }\n\n  /** Счётчик для ID */\n  private enemyIdCounter = 0;\n\n  /**\n   * Спавн врагов по волнам:\n   * - Волна 5: ЗЕЛЁНЫЙ БОСС + враги\n   * - Волна 10: ЧЁРНЫЙ БОСС + враги\n   * - Волна 15: СИНИЙ БОСС + враги\n   */\n  private spawnEnemies(wave: number): void {\n    const spawnRadius = 18;\n    const baseSpeed = 3.5 + wave * 0.3;\n\n    // === БОССЫ ===\n    if (wave === 5) {\n      // ДВА ЗЕЛЁНЫХ БОССА - охотник и загонщик!\n      const bossConfigs: Array<{ pos: Vec3; role: GreenBossRole }> = [\n        { pos: vec3(-8, 3.0, -spawnRadius), role: 'hunter' },   // Охотник - гонит\n        { pos: vec3(8, 3.0, -spawnRadius), role: 'blocker' },   // Загонщик - плюёт впереди\n      ];\n      \n      for (const config of bossConfigs) {\n        const boss = new Target(config.pos, baseSpeed, this.enemyIdCounter++, 'boss_green', this.collision || undefined);\n        boss.greenBossRole = config.role;\n        \n        if (config.role === 'hunter') {\n          // ОХОТНИК: вызывает кислотный дождь с неба!\n          boss.onAcidRainMark = (pos) => {\n            this.spawnAcidRainZone(pos);\n          };\n        } else {\n          // ЗАГОНЩИК: кидает лужи (плевки)\n          boss.onSpit = (startPos, targetPos) => {\n            this.spawnAcidProjectile(startPos, targetPos);\n          };\n        }\n        \n        // Callback для смены фазы\n        boss.onPhaseChange = (phase) => {\n          this.onBossPhaseChange?.(boss.enemyType, phase);\n        };\n        \n        this.targets.push(boss);\n      }\n    } else if (wave === 10) {\n      // ЧЁРНЫЙ БОСС!\n      const pos = vec3(0, 2.5, -spawnRadius);\n      const boss = new Target(pos, baseSpeed, this.enemyIdCounter++, 'boss_black', this.collision || undefined);\n      \n      // Колбэк для спавна фантомов\n      boss.onSpawnPhantom = (spawnPos) => {\n        this.spawnPhantomFromBoss(spawnPos);\n      };\n      \n      // Колбэки для вихря (звук)\n      boss.onVortexWarning = () => {\n        this.onBossVortexWarning?.();\n      };\n      boss.onVortexStart = () => {\n        this.onBossVortexStart?.();\n      };\n      boss.onVortexEnd = () => {\n        this.onBossVortexEnd?.();\n      };\n      \n      this.targets.push(boss);\n\n      // === КРИСТАЛЛЫ СИЛЫ НА ПЛАТФОРМАХ ===\n      // 6 кристаллов на 6 платформах\n      const platformPositions = [\n        { x: 10.0, z: 0.0, height: 2.3 },     // Платформа 1\n        { x: 5.0, z: 8.66, height: 3.5 },     // Платформа 2\n        { x: -5.0, z: 8.66, height: 4.7 },    // Платформа 3\n        { x: -10.0, z: 0.0, height: 5.9 },    // Платформа 4\n        { x: -5.0, z: -8.66, height: 7.1 },   // Платформа 5\n        { x: 5.0, z: -8.66, height: 8.3 },    // Платформа 6\n      ];\n      \n      this.powerCrystals = platformPositions.map((pos, i) => ({\n        x: pos.x,\n        z: pos.z,\n        height: pos.height,\n        active: true,\n        platformIndex: i\n      }));\n    } else if (wave === 15) {\n      // СИНИЙ БОСС!\n      const pos = vec3(0, 2.0, -spawnRadius);\n      this.targets.push(new Target(pos, baseSpeed, this.enemyIdCounter++, 'boss_blue', this.collision || undefined));\n    }\n\n    // На волнах боссов - ТОЛЬКО БОСС!\n    const isBossWave = wave === 5 || wave === 10 || wave === 15;\n    if (isBossWave) return; // Не спавним обычных врагов на волнах боссов\n    \n    // === СБАЛАНСИРОВАННОЕ КОЛИЧЕСТВО ВРАГОВ ===\n    // Эпоха 1 (1-5): умеренно\n    // Эпоха 2 (6-10): сложнее, но без раннеров\n    // Эпоха 3 (11-15): максимальная сложность с раннерами\n    \n    let banelingCount: number;\n    let phantomCount: number;\n    let runnerCount: number;\n    let hopperCount: number;\n    let spikerCount: number;\n    \n    if (wave <= 5) {\n      // Эпоха 1: кислотная - простая\n      banelingCount = Math.floor(wave * 1.2);\n      phantomCount = wave >= 3 ? Math.floor((wave - 2) * 0.8) : 0;\n      runnerCount = 0; // Нет раннеров\n      hopperCount = wave >= 4 ? Math.floor((wave - 3) * 0.5) : 0;\n      spikerCount = wave >= 2 ? Math.floor((wave - 1) * 0.5) : 0; // С 2й волны\n    } else if (wave <= 10) {\n      // Эпоха 2: чёрная дыра - средняя сложность\n      banelingCount = Math.floor(wave * 0.8); // Меньше бейнлингов\n      phantomCount = Math.floor((wave - 3) * 0.6); // Меньше фантомов\n      runnerCount = 0; // Нет раннеров до 11 волны!\n      hopperCount = Math.floor((wave - 4) * 0.6); // Меньше хопперов\n      spikerCount = Math.floor((wave - 2) * 0.6); // Больше спайкеров\n    } else {\n      // Эпоха 3: космическая - с раннерами\n      banelingCount = Math.floor(wave * 0.7);\n      phantomCount = Math.floor((wave - 5) * 0.5);\n      runnerCount = Math.floor((wave - 10) * 1.5); // Раннеры с 11 волны!\n      hopperCount = Math.floor((wave - 6) * 0.5);\n      spikerCount = Math.floor((wave - 5) * 0.7); // Много спайкеров\n    }\n\n    // === ДОБАВЛЯЕМ ВРАГОВ В ОЧЕРЕДЬ ПОРТАЛОВ ===\n    // Очищаем очередь перед новой волной\n    this.spawnQueue = [];\n    \n    // Чередуем порталы для равномерного спавна\n    let useLeftPortal = true;\n    \n    // Добавляем бейнлингов (зелёные) в очередь\n    for (let i = 0; i < banelingCount; i++) {\n      const speed = baseSpeed + Math.random() * 1.5;\n      this.spawnQueue.push({\n        type: 'baneling',\n        speed,\n        portalSide: useLeftPortal ? 'left' : 'right'\n      });\n      useLeftPortal = !useLeftPortal;\n    }\n\n    // Добавляем раннеров (оранжевые)\n    for (let i = 0; i < runnerCount; i++) {\n      const speed = baseSpeed + Math.random() * 1.0;\n      this.spawnQueue.push({\n        type: 'runner',\n        speed,\n        portalSide: useLeftPortal ? 'left' : 'right'\n      });\n      useLeftPortal = !useLeftPortal;\n    }\n\n    // Добавляем хопперов (синие)\n    for (let i = 0; i < hopperCount; i++) {\n      const speed = baseSpeed + Math.random() * 1.0;\n      this.spawnQueue.push({\n        type: 'hopper',\n        speed,\n        portalSide: useLeftPortal ? 'left' : 'right'\n      });\n      useLeftPortal = !useLeftPortal;\n    }\n\n    // Добавляем фантомов (чёрные)\n    for (let i = 0; i < phantomCount; i++) {\n      const speed = baseSpeed + Math.random() * 1.0;\n      this.spawnQueue.push({\n        type: 'phantom',\n        speed,\n        portalSide: useLeftPortal ? 'left' : 'right'\n      });\n      useLeftPortal = !useLeftPortal;\n    }\n\n    // Добавляем спайкеров (летающие стрелки)\n    for (let i = 0; i < spikerCount; i++) {\n      const speed = baseSpeed * 0.6; // Медленные\n      this.spawnQueue.push({\n        type: 'spiker',\n        speed,\n        portalSide: useLeftPortal ? 'left' : 'right'\n      });\n      useLeftPortal = !useLeftPortal;\n    }\n    \n    // Перемешиваем очередь для разнообразия\n    this.shuffleSpawnQueue();\n  }\n  \n  /** Перемешать очередь спавна (Fisher-Yates) */\n  private shuffleSpawnQueue(): void {\n    for (let i = this.spawnQueue.length - 1; i > 0; i--) {\n      const j = Math.floor(Math.random() * (i + 1));\n      [this.spawnQueue[i], this.spawnQueue[j]] = [this.spawnQueue[j], this.spawnQueue[i]];\n    }\n  }\n  \n  /** Спавн врага из портала */\n  private spawnFromPortal(item: SpawnQueueItem): void {\n    const portal = PORTAL_POSITIONS[item.portalSide];\n    \n    // Позиция появления - немного перед порталом\n    const offsetX = item.portalSide === 'left' ? 1.5 : -1.5;\n    const offsetZ = (Math.random() - 0.5) * 2; // Случайный сдвиг по Z\n    \n    // Высота зависит от типа врага\n    let height: number;\n    if (item.type === 'baneling') {\n      // Бейнлинги катятся по земле (их радиус ~0.7)\n      height = 0.7;\n    } else if (item.type === 'runner') {\n      // Раннеры бегут по земле\n      height = 0.5;\n    } else if (item.type === 'hopper') {\n      // Хопперы прыгают, начинают с земли\n      height = 0.5;\n    } else if (item.type === 'phantom') {\n      // Фантомы летают\n      height = 1.5 + Math.random() * 1.5;\n    } else if (item.type === 'spiker') {\n      // Спайкеры летают высоко\n      height = 5 + Math.random() * 3;\n    } else {\n      // По умолчанию на земле\n      height = 0.7;\n    }\n    \n    const pos = vec3(\n      portal.x + offsetX,\n      height,\n      portal.z + offsetZ\n    );\n    \n    const enemy = new Target(pos, item.speed, this.enemyIdCounter++, item.type, this.collision || undefined);\n    \n    // Подключаем callbacks для спайкеров\n    if (item.type === 'spiker') {\n      enemy.onSpikeAttack = (startPos, targetPos) => {\n        this.fireSpike(startPos, targetPos);\n        this.onSpikerAttack?.(startPos, targetPos);\n      };\n      enemy.onSpikerScream = () => {\n        this.onSpikerScream?.();\n      };\n    }\n    \n    this.targets.push(enemy);\n    \n    // Callback для звука появления\n    this.onEnemySpawn?.(item.type, item.portalSide);\n  }\n  \n  /** Выстрел иголкой спайкера */\n  private fireSpike(startPos: Vec3, targetPos: Vec3): void {\n    const dist = Math.sqrt(\n      (targetPos.x - startPos.x) ** 2 +\n      (targetPos.y - startPos.y) ** 2 +\n      (targetPos.z - startPos.z) ** 2\n    );\n    \n    if (dist < 0.1) return;\n    \n    // Создаём лазер - мгновенный луч от спайкера к игроку\n    this.spikes.push({\n      start: { ...startPos },\n      end: { ...targetPos },\n      active: true,\n      lifetime: 0.4, // Лазер виден 0.4 секунды\n      intensity: 1.0,\n      damageDealt: false,\n    });\n  }\n\n  /** Кулдаун на урон от фантомов (чтобы не спамил урон) */\n  private phantomDamageCooldown: Map<number, number> = new Map();\n\n  /** Обновление */\n  public update(dt: number, playerPos: Vec3, time: number): void {\n    // Таймер между волнами\n    if (!this.waveActive && this.waveTimer > 0) {\n      this.waveTimer -= dt;\n      if (this.waveTimer <= 0) {\n        this.startNextWave();\n      }\n      return;\n    }\n\n    // === ОБРАБОТКА ОЧЕРЕДИ СПАВНА ЧЕРЕЗ ПОРТАЛЫ ===\n    // Обновляем таймеры порталов\n    if (this.portalTimers.left > 0) this.portalTimers.left -= dt;\n    if (this.portalTimers.right > 0) this.portalTimers.right -= dt;\n    \n    // Спавним врагов из очереди когда порталы готовы\n    if (this.spawnQueue.length > 0) {\n      // Ищем следующего врага для левого портала\n      if (this.portalTimers.left <= 0) {\n        const leftIdx = this.spawnQueue.findIndex(item => item.portalSide === 'left');\n        if (leftIdx !== -1) {\n          const item = this.spawnQueue.splice(leftIdx, 1)[0];\n          this.spawnFromPortal(item);\n          this.portalTimers.left = this.PORTAL_SPAWN_INTERVAL;\n        }\n      }\n      \n      // Ищем следующего врага для правого портала\n      if (this.portalTimers.right <= 0) {\n        const rightIdx = this.spawnQueue.findIndex(item => item.portalSide === 'right');\n        if (rightIdx !== -1) {\n          const item = this.spawnQueue.splice(rightIdx, 1)[0];\n          this.spawnFromPortal(item);\n          this.portalTimers.right = this.PORTAL_SPAWN_INTERVAL;\n        }\n      }\n    }\n\n    // Уменьшаем кулдауны фантомов\n    for (const [id, cd] of this.phantomDamageCooldown) {\n      if (cd > 0) {\n        this.phantomDamageCooldown.set(id, cd - dt);\n      }\n    }\n\n    // Обновляем врагов\n    for (const target of this.targets) {\n      target.update(dt, playerPos, time);\n\n      // Проверка столкновения с игроком\n      if (target.checkPlayerCollision(playerPos)) {\n        if (target.enemyType === 'phantom') {\n          // Фантом пролетает сквозь, но наносит урон с кулдауном\n          const cd = this.phantomDamageCooldown.get(target['id'] as number) || 0;\n          if (cd <= 0) {\n            this.onPlayerHit?.(target);\n            this.phantomDamageCooldown.set(target['id'] as number, 1.0); // 1 сек кулдаун\n          }\n          // НЕ деактивируем - фантом летит дальше!\n        } else if (target.isBoss) {\n          // Боссы наносят урон но НЕ умирают при столкновении!\n          const cd = this.phantomDamageCooldown.get(target['id'] as number) || 0;\n          if (cd <= 0) {\n            this.onPlayerHit?.(target);\n            this.phantomDamageCooldown.set(target['id'] as number, 1.5); // 1.5 сек кулдаун для боссов\n          }\n        } else {\n          // Обычные враги взрываются\n          this.onPlayerHit?.(target);\n          target.active = false;\n        }\n      }\n    }\n\n    // Удаляем мёртвых\n    this.targets = this.targets.filter(t => !t.canRemove());\n\n    // === ЛЕТЯЩИЕ СНАРЯДЫ КИСЛОТЫ ===\n    for (const proj of this.acidProjectiles) {\n      proj.progress += dt / proj.flightTime;\n      \n      // Параболическая траектория\n      const t = proj.progress;\n      proj.position.x = proj.startPos.x + (proj.targetPos.x - proj.startPos.x) * t;\n      proj.position.z = proj.startPos.z + (proj.targetPos.z - proj.startPos.z) * t;\n      // Дуга вверх и вниз\n      proj.position.y = proj.startPos.y + (1 - (2 * t - 1) * (2 * t - 1)) * 8; // Макс высота 8м\n      \n      // Снаряд приземлился\n      if (proj.progress >= 1) {\n        // Создаём растекающуюся лужу\n        this.toxicPools.push({\n          position: { ...proj.targetPos },\n          radius: 0.5,          // Начальный радиус маленький\n          maxRadius: 3.5,       // Растечётся до 3.5м\n          lifetime: 6.0,\n          maxLifetime: 6.0,\n          damage: 8,\n          spreadProgress: 0     // Начинает растекаться\n        });\n        this.onAcidRain?.(proj.targetPos);\n      }\n    }\n    // Удаляем приземлившиеся снаряды\n    this.acidProjectiles = this.acidProjectiles.filter(p => p.progress < 1);\n\n    // === ЛАЗЕРЫ СПАЙКЕРОВ ===\n    for (const laser of this.spikes) {\n      if (!laser.active) continue;\n      \n      // Уменьшаем время жизни\n      laser.lifetime -= dt;\n      \n      // Затухание интенсивности\n      laser.intensity = Math.max(0, laser.lifetime / 0.4);\n      \n      if (laser.lifetime <= 0) {\n        laser.active = false;\n        continue;\n      }\n      \n      // Проверка попадания - луч проходит мгновенно\n      // Урон наносится только один раз в начале\n      if (!laser.damageDealt) {\n        // Расстояние от игрока до линии лазера\n        const laserDir = {\n          x: laser.end.x - laser.start.x,\n          y: laser.end.y - laser.start.y,\n          z: laser.end.z - laser.start.z,\n        };\n        const laserLen = Math.sqrt(laserDir.x ** 2 + laserDir.y ** 2 + laserDir.z ** 2);\n        \n        if (laserLen > 0.1) {\n          // Нормализуем направление\n          laserDir.x /= laserLen;\n          laserDir.y /= laserLen;\n          laserDir.z /= laserLen;\n          \n          // Вектор от начала лазера к игроку\n          const toPlayer = {\n            x: playerPos.x - laser.start.x,\n            y: playerPos.y - laser.start.y,\n            z: playerPos.z - laser.start.z,\n          };\n          \n          // Проекция на линию лазера\n          const proj = toPlayer.x * laserDir.x + toPlayer.y * laserDir.y + toPlayer.z * laserDir.z;\n          const clampedProj = Math.max(0, Math.min(laserLen, proj));\n          \n          // Ближайшая точка на лазере\n          const closest = {\n            x: laser.start.x + laserDir.x * clampedProj,\n            y: laser.start.y + laserDir.y * clampedProj,\n            z: laser.start.z + laserDir.z * clampedProj,\n          };\n          \n          // Расстояние до игрока\n          const dist = Math.sqrt(\n            (playerPos.x - closest.x) ** 2 +\n            (playerPos.y - closest.y) ** 2 +\n            (playerPos.z - closest.z) ** 2\n          );\n          \n          // Попадание если близко к лучу\n          if (dist < 1.2) {\n            laser.damageDealt = true;\n            this.onSpikeHit?.();\n          }\n        }\n      }\n    }\n    // Удаляем неактивные лазеры\n    this.spikes = this.spikes.filter(s => s.active);\n\n    // === ТОКСИЧНЫЕ ЛУЖИ (остаются навсегда) ===\n    for (const pool of this.toxicPools) {\n      // Растекание: радиус увеличивается в первые 1.5 сек\n      if (pool.spreadProgress < 1) {\n        pool.spreadProgress = Math.min(1, pool.spreadProgress + dt / 1.5);\n        pool.radius = pool.maxRadius * (0.3 + 0.7 * pool.spreadProgress);\n      }\n      // lifetime не уменьшается - лужи остаются навсегда\n    }\n\n    // === ЗОНЫ КИСЛОТНОГО ДОЖДЯ ===\n    for (const zone of this.acidRainZones) {\n      if (!zone.isRaining) {\n        // Ещё показываем метку\n        zone.markTime -= dt;\n        if (zone.markTime <= 0) {\n          zone.isRaining = true;\n          this.onAcidRainStart?.(zone.position);\n        }\n      } else {\n        // Дождь идёт\n        zone.lifetime -= dt;\n      }\n    }\n    // Удаляем истёкшие зоны\n    this.acidRainZones = this.acidRainZones.filter(z => z.lifetime > 0 || !z.isRaining);\n\n    // Урон от луж и дождя (каждые 0.5 сек)\n    this.poolDamageTimer -= dt;\n    if (this.poolDamageTimer <= 0) {\n      this.poolDamageTimer = 0.5;\n      \n      // Урон от луж (только на земле)\n      for (const pool of this.toxicPools) {\n        const dx = playerPos.x - pool.position.x;\n        const dz = playerPos.z - pool.position.z;\n        const dist = Math.sqrt(dx * dx + dz * dz);\n        \n        // Проверяем только если игрок НА ЗЕМЛЕ (не в прыжке)\n        if (dist < pool.radius && playerPos.y < 0.8) {\n          this.onPoolDamage?.(pool.damage);\n          break;\n        }\n      }\n      \n      // Урон от мёртвых врагов (кислотная слизь на полу)\n      // Пока враг не впитался - на него нельзя наступать!\n      for (const target of this.targets) {\n        // Только мёртвые бейнлинги (растекающиеся)\n        if ((target.isDying || target.deathProgress > 0) && target.enemyType === 'baneling') {\n          const dx = playerPos.x - target.position.x;\n          const dz = playerPos.z - target.position.z;\n          const dist = Math.sqrt(dx * dx + dz * dz);\n          \n          // Радиус лужи увеличивается при растекании\n          const poolRadius = target.radius * (1.0 + target.deathProgress * 0.8);\n          \n          // Проверяем только на земле\n          if (dist < poolRadius && playerPos.y < 0.8) {\n            this.onPoolDamage?.(8); // Урон от кислотного тела\n            break;\n          }\n        }\n      }\n      \n      // Урон от кислотного дождя (если не под платформой)\n      for (const zone of this.acidRainZones) {\n        if (!zone.isRaining) continue;\n        \n        const dx = playerPos.x - zone.position.x;\n        const dz = playerPos.z - zone.position.z;\n        const dist = Math.sqrt(dx * dx + dz * dz);\n        \n        if (dist < zone.radius) {\n          // Проверяем есть ли платформа над игроком (укрытие от дождя)\n          const isUnderCover = this.isPlayerUnderPlatform(playerPos);\n          if (!isUnderCover) {\n            this.onPoolDamage?.(zone.damage);\n            break;\n          }\n        }\n      }\n    }\n\n    // Проверяем завершение волны (все враги убиты И очередь пуста)\n    if (this.waveActive && this.getActiveCount() === 0 && this.spawnQueue.length === 0) {\n      this.waveActive = false;\n      this.waveTimer = this.waveDelay;\n      this.onWaveComplete?.(this.wave);\n      // Лужи остаются навсегда - не очищаем\n    }\n  }\n\n  /** Попытка разрубить катаной */\n  public trySlice(playerPos: Vec3, playerYaw: number, range: number, angle: number, playerGrounded = true, attackType = 0): Target | null {\n    // Направление взмаха зависит от типа атаки\n    const forwardX = Math.sin(playerYaw);\n    const forwardZ = -Math.cos(playerYaw);\n    const rightX = Math.cos(playerYaw);\n    const rightZ = Math.sin(playerYaw);\n    \n    let swingDirX: number, swingDirZ: number;\n    \n    if (attackType === 0) {\n      // ТИП 0: Справа сверху - диагональный удар слева\n      swingDirX = -rightX * 0.8 + forwardX * 0.4;\n      swingDirZ = -rightZ * 0.8 + forwardZ * 0.4;\n    } else {\n      // ТИП 1: Слева локтевой - удар вправо\n      swingDirX = rightX * 0.9 + forwardX * 0.3;\n      swingDirZ = rightZ * 0.9 + forwardZ * 0.3;\n    }\n    \n    for (const target of this.targets) {\n      if (!target.active) continue;\n\n      // Спайкеры требуют удара в прыжке!\n      if (target.requiresJumpToKill && playerGrounded) {\n        continue; // Пропускаем - игрок на земле\n      }\n\n      // Расстояние (для боссов увеличиваем хитбокс, для спайкеров добавляем вертикальную проверку)\n      const dx = target.position.x - playerPos.x;\n      const dy = target.position.y - playerPos.y;\n      const dz = target.position.z - playerPos.z;\n      const distXZ = Math.sqrt(dx * dx + dz * dz);\n      const dist3D = Math.sqrt(dx * dx + dy * dy + dz * dz);\n      \n      // Для спайкеров используем 3D расстояние и увеличенную дальность в прыжке\n      const effectiveRange = target.requiresJumpToKill \n        ? range + 2.5 // Увеличенная дальность для спайкеров\n        : range + (target.isBoss ? target.radius : 0);\n      \n      const checkDist = target.requiresJumpToKill ? dist3D : distXZ;\n      if (checkDist > effectiveRange) continue;\n\n      // Угол\n      const angleToTarget = Math.atan2(dx, -dz);\n      let angleDiff = angleToTarget - playerYaw;\n      \n      while (angleDiff > Math.PI) angleDiff -= Math.PI * 2;\n      while (angleDiff < -Math.PI) angleDiff += Math.PI * 2;\n\n      if (Math.abs(angleDiff) > angle / 2) continue;\n\n      // Попали! Направление разлёта = направление ВЗМАХА + немного вперёд\n      const sliceDir: Vec3 = { \n        x: swingDirX * 0.7 + forwardX * 0.5, \n        y: 0.3, // Немного вверх\n        z: swingDirZ * 0.7 + forwardZ * 0.5 \n      };\n\n      if (target.isBoss) {\n        // Босс - уменьшаем HP\n        const killed = target.takeDamage(1);\n        \n        // Зелёный босс выпускает бейнлингов при каждом ударе!\n        if (target.enemyType === 'boss_green' && !killed) {\n          // В фазе 2 - спавним 2 бейнлинга!\n          const spawnCount = this.greenBossPhase2 ? 2 : 1;\n          for (let i = 0; i < spawnCount; i++) {\n            this.spawnBanelingFromBoss(target.position);\n          }\n        }\n        \n        if (killed) {\n          // Босс убит! Эпичный взрыв\n          target.slice(sliceDir);\n          this.score += 1000 * this.wave; // Много очков за босса!\n          this.onTargetDestroyed?.(target);\n          \n          // Зелёный босс при смерти выпускает кучу бейнлингов!\n          if (target.enemyType === 'boss_green') {\n            // Проверяем остался ли ещё один зелёный босс\n            const remainingGreenBosses = this.targets.filter(\n              t => t.active && t.enemyType === 'boss_green' && t !== target\n            ).length;\n            \n            if (remainingGreenBosses > 0 && !this.greenBossPhase2) {\n              // Входим в фазу 2 - один босс остался!\n              this.greenBossPhase2 = true;\n              this.onBossPhaseChange?.('boss_green', 2);\n            }\n            \n            for (let i = 0; i < 5; i++) {\n              this.spawnBanelingFromBoss(target.position);\n            }\n          }\n        } else {\n          // Не убит - откидываем босса назад!\n          const knockbackForce = target.enemyType === 'boss_green' ? 8 : \n                                 target.enemyType === 'boss_black' ? 5 : 12; // Синий откидывается сильнее\n          target.applyKnockback(dx, dz, knockbackForce);\n        }\n        // Возвращаем даже если не убит - чтобы был хитмаркер\n        return target;\n      } else {\n        // Обычный враг - убиваем сразу направлением ВЗМАХА!\n        target.slice(sliceDir);\n        \n        this.score += 100 * this.wave;\n        this.onTargetDestroyed?.(target);\n        \n        return target;\n      }\n    }\n\n    return null;\n  }\n\n  /** Сплеш-волна - бьёт всех врагов в радиусе горизонтально */\n  public trySplashWave(playerPos: Vec3, playerYaw: number, radius: number): number {\n    let killCount = 0;\n    \n    // Направление волны - вперёд от игрока с расширением в стороны\n    const waveForwardX = Math.sin(playerYaw);\n    const waveForwardZ = -Math.cos(playerYaw);\n    \n    for (const target of this.targets) {\n      if (!target.active) continue;\n\n      // Расстояние от игрока\n      const dx = target.position.x - playerPos.x;\n      const dz = target.position.z - playerPos.z;\n      const dist = Math.sqrt(dx * dx + dz * dz);\n      \n      // Учитываем размер врага для радиуса\n      const effectiveRadius = radius + (target.isBoss ? target.radius : target.radius);\n      if (dist > effectiveRadius) continue;\n\n      // Направление разлёта = от игрока к врагу + импульс волны\n      const toTargetLen = dist || 1;\n      const sliceDir: Vec3 = { \n        x: (dx / toTargetLen) * 0.6 + waveForwardX * 0.5, \n        y: 0.4, // Подбрасываем выше\n        z: (dz / toTargetLen) * 0.6 + waveForwardZ * 0.5 \n      };\n\n      // Попали!\n      if (target.isBoss) {\n        // Босс - уменьшаем HP (сплеш наносит 2 урона)\n        const killed = target.takeDamage(2);\n        \n        // Зелёный босс выпускает бейнлингов при каждом ударе!\n        if (target.enemyType === 'boss_green' && !killed) {\n          const spawnCount = this.greenBossPhase2 ? 2 : 1;\n          for (let i = 0; i < spawnCount; i++) {\n            this.spawnBanelingFromBoss(target.position);\n          }\n        }\n        \n        if (killed) {\n          // Босс убит!\n          target.slice(sliceDir);\n          this.score += 1000 * this.wave;\n          this.onTargetDestroyed?.(target);\n          killCount++;\n          \n          // Зелёный босс при смерти выпускает бейнлингов\n          if (target.enemyType === 'boss_green') {\n            const remainingGreenBosses = this.targets.filter(\n              t => t.active && t.enemyType === 'boss_green' && t !== target\n            ).length;\n            \n            if (remainingGreenBosses > 0 && !this.greenBossPhase2) {\n              this.greenBossPhase2 = true;\n              this.onBossPhaseChange?.('boss_green', 2);\n            }\n            \n            for (let i = 0; i < 5; i++) {\n              this.spawnBanelingFromBoss(target.position);\n            }\n          }\n        } else {\n          // Откидываем босса назад (сплеш сильнее)\n          const knockbackForce = (target.enemyType === 'boss_green' ? 12 : \n                                  target.enemyType === 'boss_black' ? 8 : 18);\n          target.applyKnockback(dx, dz, knockbackForce);\n        }\n      } else {\n        // Обычный враг - убиваем направлением волны!\n        target.slice(sliceDir);\n        \n        this.score += 100 * this.wave;\n        this.onTargetDestroyed?.(target);\n        killCount++;\n      }\n    }\n\n    return killCount;\n  }\n\n  /** Данные для шейдера (4 компонента: x, y, z, type) */\n  public getShaderData(): Float32Array {\n    const data = new Float32Array(this.targets.length * 4);\n    for (let i = 0; i < this.targets.length; i++) {\n      const [x, y, z, typeIntensity] = this.targets[i].getShaderData();\n      data[i * 4 + 0] = x;\n      data[i * 4 + 1] = y;\n      data[i * 4 + 2] = z;\n      data[i * 4 + 3] = typeIntensity;\n    }\n    return data;\n  }\n\n  /** Данные всех осколков */\n  public getAllFragmentsData(): Float32Array {\n    const allFragments: number[] = [];\n    for (const target of this.targets) {\n      allFragments.push(...target.getFragmentsData());\n    }\n    return new Float32Array(allFragments);\n  }\n\n  /** Данные луж для шейдера [x, z, radius, animData] */\n  /** Данные луж для шейдера [x, z, radius, spreadProgress] */\n  public getPoolsShaderData(): Float32Array {\n    const data = new Float32Array(this.toxicPools.length * 4);\n    for (let i = 0; i < this.toxicPools.length; i++) {\n      const pool = this.toxicPools[i];\n      data[i * 4 + 0] = pool.position.x;\n      data[i * 4 + 1] = pool.position.z;\n      data[i * 4 + 2] = pool.radius;\n      data[i * 4 + 3] = pool.spreadProgress; // 0-1 анимация растекания\n    }\n    return data;\n  }\n\n  /** Данные снарядов кислоты для шейдера [x, y, z, progress] */\n  public getAcidProjectilesData(): Float32Array {\n    const data = new Float32Array(this.acidProjectiles.length * 4);\n    for (let i = 0; i < this.acidProjectiles.length; i++) {\n      const proj = this.acidProjectiles[i];\n      data[i * 4 + 0] = proj.position.x;\n      data[i * 4 + 1] = proj.position.y;\n      data[i * 4 + 2] = proj.position.z;\n      data[i * 4 + 3] = proj.progress;\n    }\n    return data;\n  }\n\n  /** Данные иголок спайкеров для шейдера [x, y, z, lifetime] */\n  /** Данные начальных точек лазеров [startX, startY, startZ, lifetime] */\n  public getSpikesData(): Float32Array {\n    const data = new Float32Array(Math.min(this.spikes.length, 8) * 4);\n    for (let i = 0; i < Math.min(this.spikes.length, 8); i++) {\n      const laser = this.spikes[i];\n      data[i * 4 + 0] = laser.start.x;\n      data[i * 4 + 1] = laser.start.y;\n      data[i * 4 + 2] = laser.start.z;\n      data[i * 4 + 3] = laser.lifetime;\n    }\n    return data;\n  }\n\n  /** Данные конечных точек лазеров [endX, endY, endZ, intensity] */\n  public getSpikeTargetsData(): Float32Array {\n    const data = new Float32Array(Math.min(this.spikes.length, 8) * 4);\n    for (let i = 0; i < Math.min(this.spikes.length, 8); i++) {\n      const laser = this.spikes[i];\n      data[i * 4 + 0] = laser.end.x;\n      data[i * 4 + 1] = laser.end.y;\n      data[i * 4 + 2] = laser.end.z;\n      data[i * 4 + 3] = laser.intensity;\n    }\n    return data;\n  }\n\n  /** Данные зон кислотного дождя для шейдера [x, z, radius, isRaining] */\n  public getAcidRainZonesData(): Float32Array {\n    const data = new Float32Array(this.acidRainZones.length * 4);\n    for (let i = 0; i < this.acidRainZones.length; i++) {\n      const zone = this.acidRainZones[i];\n      data[i * 4 + 0] = zone.position.x;\n      data[i * 4 + 1] = zone.position.z;\n      data[i * 4 + 2] = zone.radius;\n      data[i * 4 + 3] = zone.isRaining ? 1.0 : (1.0 - zone.markTime / 1.5) * 0.5; // 0-0.5 = метка, 1 = дождь\n    }\n    return data;\n  }\n\n  /** Создать летящий снаряд кислоты */\n  private spawnAcidProjectile(startPos: Vec3, targetPos: Vec3): void {\n    this.acidProjectiles.push({\n      position: { ...startPos },\n      targetPos: { ...targetPos },\n      startPos: { ...startPos },\n      progress: 0,\n      flightTime: 1.2 // 1.2 секунды полёта\n    });\n    // Звук плевка\n    this.onAcidSpit?.();\n  }\n\n  /** Создать зону кислотного дождя (метка → дождь) */\n  private spawnAcidRainZone(pos: Vec3): void {\n    this.acidRainZones.push({\n      position: { ...pos },\n      radius: 4.0,       // Радиус зоны\n      lifetime: 5.0,     // 5 секунд дождя\n      markTime: 1.5,     // 1.5 секунды предупреждение\n      isRaining: false,\n      damage: 6\n    });\n    // Звук установки метки\n    this.onAcidRainMarkSound?.();\n  }\n\n  /** Callback при плевке (звук) */\n  public onAcidSpit?: () => void;\n\n  /** Callback при установке метки дождя (звук) */\n  public onAcidRainMarkSound?: () => void;\n\n  /** Callback когда дождь начинается */\n  public onAcidRainStart?: (pos: Vec3) => void;\n\n  /** Спавн бейнлинга из Зелёного Босса */\n  private spawnBanelingFromBoss(bossPos: Vec3): void {\n    const angle = Math.random() * Math.PI * 2;\n    const speed = 5 + Math.random() * 3;\n    \n    const pos = vec3(\n      bossPos.x + Math.cos(angle) * 2,\n      bossPos.y + Math.random() * 1.5,\n      bossPos.z + Math.sin(angle) * 2\n    );\n    \n    const baneling = new Target(pos, speed, this.enemyIdCounter++, 'baneling', this.collision || undefined);\n    \n    baneling.velocity = vec3(\n      Math.cos(angle) * 8,\n      3 + Math.random() * 3,\n      Math.sin(angle) * 8\n    );\n    \n    this.targets.push(baneling);\n  }\n\n  /** Спавн фантома из Чёрного Босса */\n  private spawnPhantomFromBoss(spawnPos: Vec3): void {\n    const speed = 8 + Math.random() * 4;\n    const phantom = new Target(spawnPos, speed, this.enemyIdCounter++, 'phantom', this.collision || undefined);\n    this.targets.push(phantom);\n  }\n\n  /** Получить силу притяжения вихря для игрока */\n  public getVortexPull(playerPos: Vec3): Vec3 {\n    for (const target of this.targets) {\n      if (target.active && target.enemyType === 'boss_black') {\n        return target.getVortexPull(playerPos);\n      }\n    }\n    return vec3(0, 0, 0);\n  }\n\n  /** Попытка разрубить кристалл */\n  public trySliceCrystal(playerPos: Vec3, playerYaw: number, range: number): boolean {\n    for (const crystal of this.powerCrystals) {\n      if (!crystal.active) continue;\n\n      const dx = crystal.x - playerPos.x;\n      const dy = crystal.height - playerPos.y;\n      const dz = crystal.z - playerPos.z;\n      const dist = Math.sqrt(dx * dx + dy * dy + dz * dz);\n\n      if (dist > range + 1.0) continue; // +1 для размера кристалла\n\n      // Угол\n      const angleToTarget = Math.atan2(dx, -dz);\n      let angleDiff = angleToTarget - playerYaw;\n      while (angleDiff > Math.PI) angleDiff -= Math.PI * 2;\n      while (angleDiff < -Math.PI) angleDiff += Math.PI * 2;\n\n      if (Math.abs(angleDiff) > Math.PI / 3) continue; // 60° угол атаки\n\n      // Попали по кристаллу!\n      crystal.active = false;\n      \n      const remaining = this.powerCrystals.filter(c => c.active).length;\n      this.onCrystalDestroyed?.(remaining);\n\n      // Спавним фантома из разбитого кристалла\n      this.spawnPhantomFromBoss(vec3(crystal.x, crystal.height, crystal.z));\n\n      // Каждый кристалл = 10 HP босса (половина HP зелёного босса)\n      // Уничтожение кристалла уменьшает maxHp босса на 10\n      for (const target of this.targets) {\n        if (target.active && target.enemyType === 'boss_black') {\n          target.maxHp -= 10; // Убираем защиту кристалла\n          // HP не может быть больше maxHp\n          if (target.hp > target.maxHp) {\n            target.hp = target.maxHp;\n          }\n        }\n      }\n\n      return true;\n    }\n    return false;\n  }\n\n  /** Данные кристаллов для шейдера */\n  public getCrystalsData(): Float32Array {\n    // 6 кристаллов * 4 компонента (x, z, height, active)\n    const data = new Float32Array(24);\n    for (let i = 0; i < 6; i++) {\n      if (i < this.powerCrystals.length) {\n        const c = this.powerCrystals[i];\n        data[i * 4 + 0] = c.x;\n        data[i * 4 + 1] = c.z;\n        data[i * 4 + 2] = c.height;\n        data[i * 4 + 3] = c.active ? 1.0 : 0.0;\n      } else {\n        data[i * 4 + 3] = 0.0; // Неактивен\n      }\n    }\n    return data;\n  }\n\n  /** Количество активных врагов */\n  public getActiveCount(): number {\n    return this.targets.filter(t => t.active).length;\n  }\n\n  /** Получить активного босса (если есть) */\n  public getActiveBoss(): Target | null {\n    return this.targets.find(t => t.active && t.isBoss) || null;\n  }\n\n  /** Расстояние до ближайшего врага */\n  public getClosestEnemyDistance(playerPos: Vec3): number {\n    let minDist = Infinity;\n    for (const target of this.targets) {\n      if (!target.active) continue;\n      const dx = target.position.x - playerPos.x;\n      const dy = target.position.y - playerPos.y;\n      const dz = target.position.z - playerPos.z;\n      const dist = Math.sqrt(dx * dx + dy * dy + dz * dz);\n      if (dist < minDist) minDist = dist;\n    }\n    return minDist;\n  }\n\n  /** Создать мишени для арены (заглушка для совместимости) */\n  public createArenaTargets(_count: number = 8): void {\n    this.startGame();\n  }\n\n  /** Проверить попадание снаряда (заглушка) */\n  public checkProjectileHit(_position: Vec3, _damage: number): Target | null {\n    return null;\n  }\n}\n","import type { Vec3 } from '@/types';\nimport { vec3, distanceVec3 } from '@/utils/math';\n\n/** Тип предмета */\nexport type PickupType = 'health' | 'health_big' | 'stimpack' | 'charge';\n\n/**\n * Предмет для подбора\n */\nexport class Pickup {\n  /** Позиция */\n  public position: Vec3;\n\n  /** Тип предмета */\n  public type: PickupType;\n\n  /** Радиус подбора */\n  public radius = 1.0;\n\n  /** Активен? */\n  public active = true;\n\n  /** Время жизни */\n  public lifetime: number;\n\n  /** Фаза анимации */\n  private phase: number;\n\n  /** Базовая высота */\n  private baseY: number;\n\n  constructor(position: Vec3, type: PickupType) {\n    this.position = { ...position };\n    this.type = type;\n    this.phase = Math.random() * Math.PI * 2;\n    this.baseY = position.y;\n    this.lifetime = 30; // 30 секунд жизни\n  }\n\n  /** Обновление */\n  public update(dt: number, time: number): void {\n    if (!this.active) return;\n\n    // Парящий эффект\n    this.position.y = this.baseY + Math.sin(time * 3 + this.phase) * 0.2;\n\n    // Уменьшение времени жизни\n    this.lifetime -= dt;\n    if (this.lifetime <= 0) {\n      this.active = false;\n    }\n  }\n\n  /** Проверка подбора */\n  public checkPickup(playerPos: Vec3): boolean {\n    if (!this.active) return false;\n\n    const dist = distanceVec3(this.position, playerPos);\n    if (dist < this.radius + 0.5) {\n      this.active = false;\n      return true;\n    }\n    return false;\n  }\n\n  /** Данные для шейдера [x, y, z, type] */\n  public getShaderData(): [number, number, number, number] {\n    // type: 0 = неактивен, 9 = health, 10 = stimpack, 11 = charge, 12 = health_big\n    let w = 0;\n    if (this.active) {\n      if (this.type === 'health') w = 9;\n      else if (this.type === 'stimpack') w = 10;\n      else if (this.type === 'charge') w = 11;\n      else if (this.type === 'health_big') w = 12;\n    }\n    return [this.position.x, this.position.y, this.position.z, w];\n  }\n}\n\n/**\n * Менеджер предметов\n */\nexport class PickupManager {\n  /** Все предметы */\n  public pickups: Pickup[] = [];\n\n  /** Время между спавнами */\n  private spawnTimer = 10;\n\n  /** 2 позиции рядом с алтарями (большие аптечки) */\n  private edgePositions = [\n    { x: 5, y: 1.0, z: 28 },   // Рядом с северным алтарём\n    { x: -5, y: 1.0, z: -28 }, // Рядом с южным алтарём\n  ];\n  \n  /** Таймер спавна на краях */\n  private edgeSpawnTimer = 30;\n\n  /** Максимум предметов на карте */\n  private maxPickups = 5;\n\n  /** Заряд катаны на балконе */\n  private chargeOnBalcony: Pickup | null = null;\n  \n  /** Таймер респавна заряда */\n  private chargeRespawnTimer = 0;\n\n  constructor() {\n    // Спавним заряд на балконе сразу\n    this.spawnChargeOnBalcony();\n  }\n\n  /** Обновление */\n  public update(dt: number, time: number, playerPos: Vec3): PickupType | null {\n    // Обновляем существующие\n    for (const pickup of this.pickups) {\n      pickup.update(dt, time);\n    }\n\n    // Удаляем неактивные\n    this.pickups = this.pickups.filter(p => p.active);\n\n    // Спавн БОЛЬШИХ аптечек чаще (вместо маленьких в воде)\n    this.spawnTimer -= dt;\n    if (this.spawnTimer <= 0 && this.pickups.length < this.maxPickups) {\n      this.spawnOnEdges();\n      this.spawnTimer = 15 + Math.random() * 10; // 15-25 сек между спавнами\n    }\n    \n    // Спавн БОЛЬШИХ аптечек на дальних краях каждые 30 секунд\n    this.edgeSpawnTimer -= dt;\n    if (this.edgeSpawnTimer <= 0) {\n      this.spawnOnEdges();\n      this.edgeSpawnTimer = 30;\n    }\n\n    // Обновляем респавн заряда\n    this.updateChargeRespawn(dt);\n\n    // Проверяем подбор заряда (только на балконе)\n    if (this.checkChargePickup(playerPos)) {\n      return 'charge';\n    }\n\n    // Проверяем подбор обычных предметов\n    for (const pickup of this.pickups) {\n      // Пропускаем заряд, он уже проверен выше\n      if (pickup.type === 'charge') continue;\n      \n      if (pickup.checkPickup(playerPos)) {\n        return pickup.type;\n      }\n    }\n\n    return null;\n  }\n\n  /** Спавн БОЛЬШИХ аптечек на краях карты */\n  private spawnOnEdges(): void {\n    // Спавним на обоих краях\n    for (const spot of this.edgePositions) {\n      const pos = vec3(spot.x, spot.y, spot.z);\n      \n      // Проверяем что там ещё нет аптечки\n      const existing = this.pickups.find(p => \n        p.active && \n        (p.type === 'health' || p.type === 'health_big') && \n        Math.abs(p.position.x - pos.x) < 3 && \n        Math.abs(p.position.z - pos.z) < 3\n      );\n      \n      if (!existing) {\n        this.pickups.push(new Pickup(pos, 'health_big')); // Большая на краю!\n      }\n    }\n  }\n\n  /** Принудительный спавн после убийства - не используется */\n  public spawnAfterKill(_position: Vec3): void {\n    // Убрано - розовые аптечки в воде удалены\n  }\n\n  /** Спавн заряда катаны на верхней платформе */\n  private spawnChargeOnBalcony(): void {\n    // Позиция на верхней круглой платформе (центр, высота 9.5)\n    const pos = vec3(0, 10.3, 0);\n    this.chargeOnBalcony = new Pickup(pos, 'charge');\n    this.chargeOnBalcony.lifetime = 999999; // Не исчезает\n    this.pickups.push(this.chargeOnBalcony);\n  }\n\n  /** Проверка подбора заряда (только на верхней платформе!) */\n  public checkChargePickup(playerPos: Vec3): boolean {\n    if (!this.chargeOnBalcony || !this.chargeOnBalcony.active) return false;\n    \n    // Заряд можно подобрать только если игрок на верхней платформе (высота 9.5 + eyeHeight 1.7 ≈ 11+)\n    if (playerPos.y < 10.5) return false;\n    \n    if (this.chargeOnBalcony.checkPickup(playerPos)) {\n      this.chargeOnBalcony = null;\n      this.chargeRespawnTimer = 60; // Респавн через 60 секунд\n      return true;\n    }\n    return false;\n  }\n\n  /** Респавн заряда после убийства босса */\n  public respawnChargeAfterBoss(): void {\n    // Если заряда нет - спавним сразу\n    if (!this.chargeOnBalcony || !this.chargeOnBalcony.active) {\n      // Удаляем старый из списка если есть\n      this.pickups = this.pickups.filter(p => p !== this.chargeOnBalcony);\n      this.chargeOnBalcony = null;\n      this.chargeRespawnTimer = 0;\n      this.spawnChargeOnBalcony();\n    }\n  }\n\n  /** Обновление респавна заряда */\n  public updateChargeRespawn(dt: number): void {\n    if (this.chargeOnBalcony === null && this.chargeRespawnTimer > 0) {\n      this.chargeRespawnTimer -= dt;\n      if (this.chargeRespawnTimer <= 0) {\n        this.spawnChargeOnBalcony();\n      }\n    }\n  }\n\n  /** Данные для шейдера */\n  public getShaderData(): Float32Array {\n    const data = new Float32Array(this.pickups.length * 4);\n    for (let i = 0; i < this.pickups.length; i++) {\n      const [x, y, z, w] = this.pickups[i].getShaderData();\n      data[i * 4 + 0] = x;\n      data[i * 4 + 1] = y;\n      data[i * 4 + 2] = z;\n      data[i * 4 + 3] = w;\n    }\n    return data;\n  }\n}\n\n","import type { SFXType } from '@/types';\n\n/**\n * Менеджер аудио - SYNTHWAVE/RETROWAVE стиль\n * Дисторшн, глитчи, реверб, энергия!\n */\nexport class AudioManager {\n  private ctx: AudioContext | null = null;\n  private masterGain: GainNode | null = null;\n  private musicGain: GainNode | null = null;\n  private sfxGain: GainNode | null = null;\n\n  // Эффекты\n  private reverb: ConvolverNode | null = null;\n  private distortion: WaveShaperNode | null = null;\n  private compressor: DynamicsCompressorNode | null = null;\n  \n  // Войд фильтр (low pass + pitch shift)\n  private voidFilter: BiquadFilterNode | null = null;\n  private isInVoidMode = false;\n\n  /** Аудио запущено */\n  public isStarted = false;\n\n  /** Звук включён */\n  public isMuted = false;\n\n  /** Запустить аудио */\n  public start(): void {\n    if (this.isStarted) return;\n\n    this.ctx = new (window.AudioContext || (window as any).webkitAudioContext)();\n\n    // Компрессор для панча\n    this.compressor = this.ctx.createDynamicsCompressor();\n    this.compressor.threshold.value = -24;\n    this.compressor.knee.value = 30;\n    this.compressor.ratio.value = 12;\n    this.compressor.attack.value = 0.003;\n    this.compressor.release.value = 0.25;\n    this.compressor.connect(this.ctx.destination);\n\n    // Мастер громкость (уменьшена в 2 раза)\n    this.masterGain = this.ctx.createGain();\n    this.masterGain.gain.value = 0.4;\n    this.masterGain.connect(this.compressor);\n\n    // Дисторшн\n    this.distortion = this.createDistortion(20);\n    this.distortion.connect(this.masterGain);\n\n    // Реверб\n    this.reverb = this.createReverb(2.5);\n    this.reverb.connect(this.masterGain);\n\n    // Музыка\n    this.musicGain = this.ctx.createGain();\n    this.musicGain.gain.value = 0.12;\n    this.musicGain.connect(this.masterGain);\n\n    // Звуковые эффекты\n    this.sfxGain = this.ctx.createGain();\n    this.sfxGain.gain.value = 0.3;\n    this.sfxGain.connect(this.distortion);\n    \n    // Войд фильтр (low pass для приглушённого звука)\n    this.voidFilter = this.ctx.createBiquadFilter();\n    this.voidFilter.type = 'lowpass';\n    this.voidFilter.frequency.value = 20000; // Выключен по умолчанию (полный диапазон)\n    this.voidFilter.Q.value = 1.0;\n    \n    // Вставляем фильтр перед мастером\n    this.musicGain.disconnect();\n    this.sfxGain.disconnect();\n    this.musicGain.connect(this.voidFilter);\n    this.sfxGain.connect(this.voidFilter);\n    this.voidFilter.connect(this.distortion);\n\n    this.isStarted = true;\n\n    // Запускаем музыку\n    this.startSynthwaveMusic();\n  }\n\n  /** Создать дисторшн */\n  private createDistortion(amount: number): WaveShaperNode {\n    const distortion = this.ctx!.createWaveShaper();\n    const samples = 44100;\n    const curve = new Float32Array(samples);\n    const deg = Math.PI / 180;\n\n    for (let i = 0; i < samples; i++) {\n      const x = (i * 2) / samples - 1;\n      curve[i] = ((3 + amount) * x * 20 * deg) / (Math.PI + amount * Math.abs(x));\n    }\n\n    distortion.curve = curve;\n    distortion.oversample = '4x';\n    return distortion;\n  }\n\n  /** Создать реверб */\n  private createReverb(duration: number): ConvolverNode {\n    const convolver = this.ctx!.createConvolver();\n    const rate = this.ctx!.sampleRate;\n    const length = rate * duration;\n    const impulse = this.ctx!.createBuffer(2, length, rate);\n\n    for (let channel = 0; channel < 2; channel++) {\n      const data = impulse.getChannelData(channel);\n      for (let i = 0; i < length; i++) {\n        // Экспоненциальное затухание с модуляцией\n        const decay = Math.exp(-3 * i / length);\n        const mod = Math.sin(i * 0.001) * 0.3 + 0.7;\n        data[i] = (Math.random() * 2 - 1) * decay * mod;\n      }\n    }\n\n    convolver.buffer = impulse;\n    return convolver;\n  }\n\n  /** Переключить звук */\n  public toggleMute(): void {\n    this.isMuted = !this.isMuted;\n    if (this.masterGain) {\n      this.masterGain.gain.value = this.isMuted ? 0 : this.volume;\n    }\n  }\n\n  /** Громкость (0-1) */\n  private volume = 0.5;\n\n  /** Установить громкость */\n  public setVolume(value: number): void {\n    this.volume = Math.max(0, Math.min(1, value));\n    if (this.masterGain && !this.isMuted) {\n      this.masterGain.gain.value = this.volume;\n    }\n  }\n\n  /** Войти в войд режим - глубокий low pass фильтр */\n  public enterVoidAudio(): void {\n    if (!this.ctx || !this.voidFilter || this.isInVoidMode) return;\n    \n    this.isInVoidMode = true;\n    const now = this.ctx.currentTime;\n    \n    // Плавно опускаем частоту фильтра для \"подводного\" эффекта\n    this.voidFilter.frequency.cancelScheduledValues(now);\n    this.voidFilter.frequency.setValueAtTime(this.voidFilter.frequency.value, now);\n    this.voidFilter.frequency.exponentialRampToValueAtTime(400, now + 0.5); // Низкий cutoff\n    \n    // Увеличиваем резонанс для глубины\n    this.voidFilter.Q.cancelScheduledValues(now);\n    this.voidFilter.Q.setValueAtTime(this.voidFilter.Q.value, now);\n    this.voidFilter.Q.linearRampToValueAtTime(4.0, now + 0.5);\n    \n    // Понижаем громкость музыки\n    if (this.musicGain) {\n      this.musicGain.gain.cancelScheduledValues(now);\n      this.musicGain.gain.setValueAtTime(this.musicGain.gain.value, now);\n      this.musicGain.gain.linearRampToValueAtTime(0.05, now + 0.5);\n    }\n  }\n\n  /** Выйти из войд режима - убираем фильтр */\n  public exitVoidAudio(): void {\n    if (!this.ctx || !this.voidFilter || !this.isInVoidMode) return;\n    \n    this.isInVoidMode = false;\n    const now = this.ctx.currentTime;\n    \n    // Возвращаем фильтр в норму\n    this.voidFilter.frequency.cancelScheduledValues(now);\n    this.voidFilter.frequency.setValueAtTime(this.voidFilter.frequency.value, now);\n    this.voidFilter.frequency.exponentialRampToValueAtTime(20000, now + 0.3);\n    \n    this.voidFilter.Q.cancelScheduledValues(now);\n    this.voidFilter.Q.setValueAtTime(this.voidFilter.Q.value, now);\n    this.voidFilter.Q.linearRampToValueAtTime(1.0, now + 0.3);\n    \n    // Возвращаем громкость музыки\n    if (this.musicGain) {\n      this.musicGain.gain.cancelScheduledValues(now);\n      this.musicGain.gain.setValueAtTime(this.musicGain.gain.value, now);\n      this.musicGain.gain.linearRampToValueAtTime(0.12, now + 0.3);\n    }\n  }\n\n  // Звук приближения врага\n  private proximityOsc: OscillatorNode | null = null;\n  private proximityGain: GainNode | null = null;\n  private proximityFilter: BiquadFilterNode | null = null;\n\n  /** Воспроизвести звуковой эффект */\n  public playSFX(type: SFXType): void {\n    if (!this.ctx || !this.sfxGain || this.isMuted) return;\n\n    switch (type) {\n      case 'gunshot':\n        this.playKatanaSwing();\n        break;\n      case 'reload':\n        this.playGlitch();\n        break;\n      case 'footstep':\n        this.playFootstep();\n        break;\n      case 'jump':\n        this.playJump();\n        break;\n      case 'land':\n        this.playLand();\n        break;\n      case 'hit':\n        this.playBanelingExplosion(); // Взрыв бейнлинга!\n        break;\n      case 'phantom_pass':\n        this.playPhantomPass();\n        break;\n      case 'runner_hit':\n        this.playRunnerHit();\n        break;\n      case 'hopper_hit':\n        this.playHopperHit();\n        break;\n      case 'kill':\n        this.playKill();\n        break;\n      case 'katana_swing':\n        this.playKatanaSwing();\n        break;\n      case 'splash_wave':\n        this.playSplashWave();\n        break;\n      case 'charge_pickup':\n        this.playChargePickup();\n        break;\n      case 'acid_spit':\n        this.playAcidSpit();\n        break;\n      case 'void_whistle':\n        this.playVoidWhistle();\n        break;\n      case 'phantom_hit':\n        this.playPhantomHit();\n        break;\n      case 'player_hurt':\n        this.playPlayerHurt();\n        break;\n      case 'spiker_scream':\n        this.playSpikerScream();\n        break;\n      case 'spiker_shoot':\n        this.playSpikerShoot();\n        break;\n      case 'explosion':\n        this.playExplosion();\n        break;\n    }\n  }\n\n  /** Обновить звук приближения врага (0-1, где 1 = очень близко) */\n  public updateProximitySound(proximity: number): void {\n    if (!this.ctx || !this.sfxGain || this.isMuted) return;\n\n    // Создаём осциллятор если нет\n    if (!this.proximityOsc) {\n      this.proximityOsc = this.ctx.createOscillator();\n      this.proximityGain = this.ctx.createGain();\n      this.proximityFilter = this.ctx.createBiquadFilter();\n\n      this.proximityOsc.type = 'sawtooth';\n      this.proximityFilter!.type = 'lowpass';\n      this.proximityFilter!.Q.value = 5;\n\n      this.proximityOsc.connect(this.proximityFilter!);\n      this.proximityFilter!.connect(this.proximityGain!);\n      this.proximityGain!.connect(this.sfxGain);\n\n      this.proximityOsc.start();\n    }\n\n    // Частота и громкость зависят от близости\n    const freq = 80 + proximity * 200; // 80-280 Hz\n    const volume = proximity * 0.25; // 0-0.25\n    const filterFreq = 200 + proximity * 1500; // 200-1700 Hz\n\n    this.proximityOsc.frequency.setTargetAtTime(freq, this.ctx.currentTime, 0.1);\n    this.proximityGain!.gain.setTargetAtTime(volume, this.ctx.currentTime, 0.1);\n    this.proximityFilter!.frequency.setTargetAtTime(filterFreq, this.ctx.currentTime, 0.1);\n\n    // Добавляем вибрато при высокой близости\n    if (proximity > 0.6) {\n      const vibrato = Math.sin(this.ctx.currentTime * 20) * 20 * proximity;\n      this.proximityOsc.frequency.setTargetAtTime(freq + vibrato, this.ctx.currentTime, 0.02);\n    }\n  }\n\n  /** Таймеры для звуков приближения каждого типа врага */\n  private enemySoundCooldowns: Map<string, number> = new Map();\n\n  /** Звук приближения врага определённого типа */\n  public playEnemyProximitySound(enemyType: string, distance: number): void {\n    if (!this.ctx || !this.sfxGain || this.isMuted) return;\n    if (distance > 15) return; // Дистанция 15 - слышно издалека\n\n    // Кулдаун для каждого типа врага\n    const now = Date.now();\n    const lastPlayed = this.enemySoundCooldowns.get(enemyType) || 0;\n    const cooldown = enemyType.startsWith('boss') ? 800 : 500; // Реже чтобы не спамить\n    if (now - lastPlayed < cooldown) return;\n    this.enemySoundCooldowns.set(enemyType, now);\n\n    const volume = Math.max(0.2, (15 - distance) / 15) * 0.8; // Громче!\n    const ctxNow = this.ctx.currentTime;\n\n    switch (enemyType) {\n      case 'baneling':\n        this.playBanelingProximity(volume, ctxNow);\n        break;\n      case 'phantom':\n        this.playPhantomProximity(volume, ctxNow);\n        break;\n      case 'runner':\n        this.playRunnerProximity(volume, ctxNow);\n        break;\n      case 'hopper':\n        this.playHopperProximity(volume, ctxNow);\n        break;\n      case 'boss_green':\n        this.playBossGreenProximity(volume, ctxNow);\n        break;\n      case 'boss_black':\n        this.playBossBlackProximity(volume, ctxNow);\n        break;\n      case 'boss_blue':\n        this.playBossBlueProximity(volume, ctxNow);\n        break;\n    }\n  }\n\n  /** Baneling - булькающий кислотный звук */\n  private playBanelingProximity(vol: number, now: number): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    // Булькание\n    const osc = this.ctx.createOscillator();\n    const gain = this.ctx.createGain();\n    const filter = this.ctx.createBiquadFilter();\n\n    osc.type = 'sine';\n    // Случайные \"буль-буль\"\n    osc.frequency.setValueAtTime(150 + Math.random() * 50, now);\n    osc.frequency.setValueAtTime(100 + Math.random() * 30, now + 0.05);\n    osc.frequency.setValueAtTime(180 + Math.random() * 40, now + 0.1);\n\n    filter.type = 'lowpass';\n    filter.frequency.value = 400;\n    filter.Q.value = 8;\n\n    gain.gain.setValueAtTime(vol * 0.5, now);\n    gain.gain.exponentialRampToValueAtTime(0.01, now + 0.15);\n\n    osc.connect(filter);\n    filter.connect(gain);\n    gain.connect(this.sfxGain);\n\n    osc.start(now);\n    osc.stop(now + 0.2);\n  }\n\n  /** Phantom - жуткий шёпот/завывание */\n  private playPhantomProximity(vol: number, now: number): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    // Жуткий шёпот\n    const osc1 = this.ctx.createOscillator();\n    const osc2 = this.ctx.createOscillator();\n    const gain = this.ctx.createGain();\n    const filter = this.ctx.createBiquadFilter();\n\n    osc1.type = 'sine';\n    osc1.frequency.setValueAtTime(200, now);\n    osc1.frequency.linearRampToValueAtTime(150, now + 0.3);\n\n    osc2.type = 'sine';\n    osc2.frequency.setValueAtTime(203, now); // Лёгкая расстройка = биение\n    osc2.frequency.linearRampToValueAtTime(148, now + 0.3);\n\n    filter.type = 'bandpass';\n    filter.frequency.value = 300;\n    filter.Q.value = 5;\n\n    gain.gain.setValueAtTime(0, now);\n    gain.gain.linearRampToValueAtTime(vol * 0.4, now + 0.1);\n    gain.gain.linearRampToValueAtTime(0, now + 0.35);\n\n    osc1.connect(filter);\n    osc2.connect(filter);\n    filter.connect(gain);\n    gain.connect(this.sfxGain);\n\n    osc1.start(now);\n    osc1.stop(now + 0.4);\n    osc2.start(now);\n    osc2.stop(now + 0.4);\n  }\n\n  /** Runner - быстрое шуршание/топот */\n  private playRunnerProximity(vol: number, now: number): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    // Быстрый топот\n    for (let i = 0; i < 3; i++) {\n      const osc = this.ctx.createOscillator();\n      const gain = this.ctx.createGain();\n      const time = now + i * 0.06;\n\n      osc.type = 'triangle';\n      osc.frequency.setValueAtTime(80 + Math.random() * 40, time);\n      osc.frequency.exponentialRampToValueAtTime(40, time + 0.03);\n\n      gain.gain.setValueAtTime(vol * 0.3, time);\n      gain.gain.exponentialRampToValueAtTime(0.01, time + 0.04);\n\n      osc.connect(gain);\n      gain.connect(this.sfxGain);\n\n      osc.start(time);\n      osc.stop(time + 0.05);\n    }\n  }\n\n  /** Hopper - пружинистый звук прыжка */\n  private playHopperProximity(vol: number, now: number): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    const osc = this.ctx.createOscillator();\n    const gain = this.ctx.createGain();\n\n    osc.type = 'sine';\n    // Пружина вверх\n    osc.frequency.setValueAtTime(100, now);\n    osc.frequency.exponentialRampToValueAtTime(400, now + 0.1);\n    osc.frequency.exponentialRampToValueAtTime(150, now + 0.2);\n\n    gain.gain.setValueAtTime(vol * 0.4, now);\n    gain.gain.exponentialRampToValueAtTime(0.01, now + 0.25);\n\n    osc.connect(gain);\n    gain.connect(this.sfxGain);\n\n    osc.start(now);\n    osc.stop(now + 0.3);\n  }\n\n  /** Boss Green - зловещий шёпот */\n  private playBossGreenProximity(vol: number, now: number): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    // === ЗЛОВЕЩИЙ ШЁПОТ ===\n    // Основа - фильтрованный шум (шипящие согласные)\n    const bufferSize = this.ctx.sampleRate * 0.5;\n    const buffer = this.ctx.createBuffer(1, bufferSize, this.ctx.sampleRate);\n    const data = buffer.getChannelData(0);\n    \n    // Модуляция амплитуды для имитации слогов шёпота\n    for (let i = 0; i < bufferSize; i++) {\n      const t = i / this.ctx.sampleRate;\n      // \"Слоги\" шёпота - прерывистость\n      const syllable = Math.sin(t * 12) * 0.5 + 0.5;\n      const envelope = Math.sin(t * Math.PI / 0.5) * syllable;\n      data[i] = (Math.random() * 2 - 1) * envelope * 0.8;\n    }\n\n    const noise = this.ctx.createBufferSource();\n    noise.buffer = buffer;\n\n    // Фильтр для \"шипящего\" шёпота (2-6 кГц)\n    const filter = this.ctx.createBiquadFilter();\n    filter.type = 'bandpass';\n    filter.frequency.value = 3500;\n    filter.Q.value = 1.5;\n\n    // Второй фильтр - убираем низы\n    const hipass = this.ctx.createBiquadFilter();\n    hipass.type = 'highpass';\n    hipass.frequency.value = 800;\n\n    const gain = this.ctx.createGain();\n    gain.gain.setValueAtTime(0, now);\n    gain.gain.linearRampToValueAtTime(vol * 0.6, now + 0.05);\n    gain.gain.setValueAtTime(vol * 0.6, now + 0.35);\n    gain.gain.exponentialRampToValueAtTime(0.01, now + 0.5);\n\n    noise.connect(filter);\n    filter.connect(hipass);\n    hipass.connect(gain);\n    gain.connect(this.sfxGain);\n\n    noise.start(now);\n    noise.stop(now + 0.55);\n\n    // Низкий \"потусторонний\" тон под шёпотом\n    const tone = this.ctx.createOscillator();\n    const tone2 = this.ctx.createOscillator();\n    const toneGain = this.ctx.createGain();\n    const toneFilter = this.ctx.createBiquadFilter();\n\n    // Два слегка расстроенных тона для \"биения\"\n    tone.type = 'sine';\n    tone.frequency.value = 85;\n    tone2.type = 'sine';\n    tone2.frequency.value = 87; // Лёгкая расстройка = жуткое биение\n\n    toneFilter.type = 'lowpass';\n    toneFilter.frequency.value = 150;\n\n    toneGain.gain.setValueAtTime(vol * 0.15, now);\n    toneGain.gain.exponentialRampToValueAtTime(0.01, now + 0.5);\n\n    tone.connect(toneFilter);\n    tone2.connect(toneFilter);\n    toneFilter.connect(toneGain);\n    toneGain.connect(this.sfxGain);\n\n    tone.start(now);\n    tone2.start(now);\n    tone.stop(now + 0.55);\n    tone2.stop(now + 0.55);\n\n    // Случайный \"вздох\" (скользящий тон)\n    if (Math.random() > 0.5) {\n      const sigh = this.ctx.createOscillator();\n      const sighGain = this.ctx.createGain();\n      \n      sigh.type = 'sine';\n      sigh.frequency.setValueAtTime(300, now + 0.1);\n      sigh.frequency.exponentialRampToValueAtTime(150, now + 0.4);\n      \n      sighGain.gain.setValueAtTime(vol * 0.08, now + 0.1);\n      sighGain.gain.exponentialRampToValueAtTime(0.01, now + 0.4);\n      \n      sigh.connect(sighGain);\n      sighGain.connect(this.sfxGain);\n      \n      sigh.start(now + 0.1);\n      sigh.stop(now + 0.45);\n    }\n  }\n\n  /** Boss Black - гулкий низкий гул искривления */\n  private playBossBlackProximity(vol: number, now: number): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    // Гулкий гул\n    const osc1 = this.ctx.createOscillator();\n    const osc2 = this.ctx.createOscillator();\n    const gain = this.ctx.createGain();\n    const filter = this.ctx.createBiquadFilter();\n\n    osc1.type = 'sine';\n    osc1.frequency.setValueAtTime(40, now);\n\n    osc2.type = 'sine';\n    osc2.frequency.setValueAtTime(42, now); // Биение\n\n    filter.type = 'lowpass';\n    filter.frequency.value = 100;\n    filter.Q.value = 10;\n\n    gain.gain.setValueAtTime(0, now);\n    gain.gain.linearRampToValueAtTime(vol * 0.6, now + 0.15);\n    gain.gain.linearRampToValueAtTime(0, now + 0.4);\n\n    osc1.connect(filter);\n    osc2.connect(filter);\n    filter.connect(gain);\n    gain.connect(this.sfxGain);\n\n    osc1.start(now);\n    osc1.stop(now + 0.45);\n    osc2.start(now);\n    osc2.stop(now + 0.45);\n\n    // Искажение пространства\n    const warp = this.ctx.createOscillator();\n    const warpGain = this.ctx.createGain();\n\n    warp.type = 'sawtooth';\n    warp.frequency.setValueAtTime(80, now);\n    warp.frequency.exponentialRampToValueAtTime(30, now + 0.3);\n\n    warpGain.gain.setValueAtTime(vol * 0.2, now);\n    warpGain.gain.exponentialRampToValueAtTime(0.01, now + 0.35);\n\n    warp.connect(warpGain);\n    warpGain.connect(this.sfxGain);\n\n    warp.start(now);\n    warp.stop(now + 0.4);\n  }\n\n  /** Boss Blue - электрический разряд/телепорт */\n  private playBossBlueProximity(vol: number, now: number): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    // Электрический треск\n    const bufferSize = this.ctx.sampleRate * 0.15;\n    const buffer = this.ctx.createBuffer(1, bufferSize, this.ctx.sampleRate);\n    const data = buffer.getChannelData(0);\n    for (let i = 0; i < bufferSize; i++) {\n      // Случайные щелчки\n      data[i] = Math.random() > 0.95 ? (Math.random() * 2 - 1) : 0;\n    }\n\n    const noise = this.ctx.createBufferSource();\n    noise.buffer = buffer;\n\n    const filter = this.ctx.createBiquadFilter();\n    filter.type = 'highpass';\n    filter.frequency.value = 3000;\n\n    const gain = this.ctx.createGain();\n    gain.gain.setValueAtTime(vol * 0.4, now);\n    gain.gain.exponentialRampToValueAtTime(0.01, now + 0.15);\n\n    noise.connect(filter);\n    filter.connect(gain);\n    gain.connect(this.sfxGain);\n\n    noise.start(now);\n    noise.stop(now + 0.18);\n\n    // Высокий писк энергии\n    const zap = this.ctx.createOscillator();\n    const zapGain = this.ctx.createGain();\n\n    zap.type = 'sine';\n    zap.frequency.setValueAtTime(2000 + Math.random() * 500, now);\n    zap.frequency.exponentialRampToValueAtTime(500, now + 0.1);\n\n    zapGain.gain.setValueAtTime(vol * 0.25, now);\n    zapGain.gain.exponentialRampToValueAtTime(0.01, now + 0.12);\n\n    zap.connect(zapGain);\n    zapGain.connect(this.sfxGain);\n\n    zap.start(now);\n    zap.stop(now + 0.15);\n  }\n\n  /** Взрыв бейнлинга! */\n  private playBanelingExplosion(): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    const now = this.ctx.currentTime;\n\n    // Мощный низкочастотный взрыв\n    const boom = this.ctx.createOscillator();\n    const boomGain = this.ctx.createGain();\n\n    boom.type = 'sine';\n    boom.frequency.setValueAtTime(100, now);\n    boom.frequency.exponentialRampToValueAtTime(20, now + 0.3);\n\n    boomGain.gain.setValueAtTime(0.7, now);\n    boomGain.gain.exponentialRampToValueAtTime(0.01, now + 0.4);\n\n    boom.connect(boomGain);\n    boomGain.connect(this.sfxGain);\n    boomGain.connect(this.reverb!);\n\n    boom.start(now);\n    boom.stop(now + 0.5);\n\n    // Звук разбрызгивания кислоты\n    const acidNoise = this.createNoise(0.4);\n    const acidGain = this.ctx.createGain();\n    const acidFilter = this.ctx.createBiquadFilter();\n    const acidFilter2 = this.ctx.createBiquadFilter();\n\n    acidFilter.type = 'bandpass';\n    acidFilter.frequency.setValueAtTime(3000, now);\n    acidFilter.frequency.exponentialRampToValueAtTime(500, now + 0.3);\n    acidFilter.Q.value = 3;\n\n    acidFilter2.type = 'highpass';\n    acidFilter2.frequency.value = 1000;\n\n    acidGain.gain.setValueAtTime(0.5, now);\n    acidGain.gain.exponentialRampToValueAtTime(0.01, now + 0.35);\n\n    acidNoise.connect(acidFilter);\n    acidFilter.connect(acidFilter2);\n    acidFilter2.connect(acidGain);\n    acidGain.connect(this.sfxGain);\n\n    // Булькающий звук\n    for (let i = 0; i < 5; i++) {\n      const delay = i * 0.04;\n      const bubble = this.ctx.createOscillator();\n      const bubbleGain = this.ctx.createGain();\n\n      bubble.type = 'sine';\n      bubble.frequency.setValueAtTime(400 + Math.random() * 600, now + delay);\n      bubble.frequency.exponentialRampToValueAtTime(100 + Math.random() * 100, now + delay + 0.08);\n\n      bubbleGain.gain.setValueAtTime(0.15, now + delay);\n      bubbleGain.gain.exponentialRampToValueAtTime(0.01, now + delay + 0.1);\n\n      bubble.connect(bubbleGain);\n      bubbleGain.connect(this.sfxGain);\n\n      bubble.start(now + delay);\n      bubble.stop(now + delay + 0.15);\n    }\n\n    // Шипение кислоты (затухающее)\n    const hiss = this.createNoise(0.8);\n    const hissGain = this.ctx.createGain();\n    const hissFilter = this.ctx.createBiquadFilter();\n\n    hissFilter.type = 'highpass';\n    hissFilter.frequency.value = 4000;\n\n    hissGain.gain.setValueAtTime(0.2, now + 0.1);\n    hissGain.gain.exponentialRampToValueAtTime(0.01, now + 0.7);\n\n    hiss.connect(hissFilter);\n    hissFilter.connect(hissGain);\n    hissGain.connect(this.sfxGain);\n  }\n\n  /** Фантом пролетает сквозь игрока */\n  /** Свист фантома в войде - нарастающий зловещий звук */\n  private playVoidWhistle(): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    const now = this.ctx.currentTime;\n\n    // Нарастающий высокий свист\n    const whistle = this.ctx.createOscillator();\n    const whistleGain = this.ctx.createGain();\n    const whistleFilter = this.ctx.createBiquadFilter();\n\n    whistle.type = 'sine';\n    // Частота нарастает - приближается!\n    whistle.frequency.setValueAtTime(600, now);\n    whistle.frequency.exponentialRampToValueAtTime(1200, now + 0.8);\n    whistle.frequency.exponentialRampToValueAtTime(800, now + 1.2);\n\n    whistleFilter.type = 'bandpass';\n    whistleFilter.frequency.setValueAtTime(800, now);\n    whistleFilter.frequency.linearRampToValueAtTime(1500, now + 0.8);\n    whistleFilter.Q.value = 8;\n\n    // Громкость нарастает потом спадает\n    whistleGain.gain.setValueAtTime(0.0, now);\n    whistleGain.gain.linearRampToValueAtTime(0.25, now + 0.3);\n    whistleGain.gain.setValueAtTime(0.25, now + 0.8);\n    whistleGain.gain.exponentialRampToValueAtTime(0.01, now + 1.3);\n\n    whistle.connect(whistleFilter);\n    whistleFilter.connect(whistleGain);\n    whistleGain.connect(this.sfxGain);\n    whistleGain.connect(this.reverb!);\n\n    whistle.start(now);\n    whistle.stop(now + 1.4);\n\n    // Второй слой - низкий гул для атмосферы\n    const hum = this.ctx.createOscillator();\n    const humGain = this.ctx.createGain();\n\n    hum.type = 'triangle';\n    hum.frequency.setValueAtTime(150, now);\n    hum.frequency.linearRampToValueAtTime(200, now + 1.0);\n\n    humGain.gain.setValueAtTime(0.0, now);\n    humGain.gain.linearRampToValueAtTime(0.1, now + 0.2);\n    humGain.gain.setValueAtTime(0.1, now + 0.8);\n    humGain.gain.exponentialRampToValueAtTime(0.01, now + 1.2);\n\n    hum.connect(humGain);\n    humGain.connect(this.sfxGain);\n\n    hum.start(now);\n    hum.stop(now + 1.3);\n  }\n\n  /** Удар фантома по игроку - жёсткий удар с искажением */\n  private playPhantomHit(): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    const now = this.ctx.currentTime;\n\n    // Резкий удар\n    const impact = this.ctx.createOscillator();\n    const impactGain = this.ctx.createGain();\n    const impactFilter = this.ctx.createBiquadFilter();\n\n    impact.type = 'sawtooth';\n    impact.frequency.setValueAtTime(80, now);\n    impact.frequency.exponentialRampToValueAtTime(30, now + 0.2);\n\n    impactFilter.type = 'lowpass';\n    impactFilter.frequency.setValueAtTime(500, now);\n    impactFilter.frequency.exponentialRampToValueAtTime(100, now + 0.15);\n    impactFilter.Q.value = 3;\n\n    impactGain.gain.setValueAtTime(0.5, now);\n    impactGain.gain.exponentialRampToValueAtTime(0.01, now + 0.25);\n\n    impact.connect(impactFilter);\n    impactFilter.connect(impactGain);\n    impactGain.connect(this.sfxGain);\n\n    impact.start(now);\n    impact.stop(now + 0.3);\n\n    // Шум удара\n    const noiseBuffer = this.ctx.createBuffer(1, this.ctx.sampleRate * 0.15, this.ctx.sampleRate);\n    const noiseData = noiseBuffer.getChannelData(0);\n    for (let i = 0; i < noiseData.length; i++) {\n      noiseData[i] = (Math.random() * 2 - 1) * Math.exp(-i / (noiseData.length * 0.3));\n    }\n    \n    const noise = this.ctx.createBufferSource();\n    noise.buffer = noiseBuffer;\n    \n    const noiseGain = this.ctx.createGain();\n    const noiseFilter = this.ctx.createBiquadFilter();\n    \n    noiseFilter.type = 'lowpass';\n    noiseFilter.frequency.value = 400;\n    \n    noiseGain.gain.setValueAtTime(0.4, now);\n    noiseGain.gain.exponentialRampToValueAtTime(0.01, now + 0.15);\n    \n    noise.connect(noiseFilter);\n    noiseFilter.connect(noiseGain);\n    noiseGain.connect(this.sfxGain);\n    \n    noise.start(now);\n  }\n\n  /** Вскрик героя при получении урона - стон боли */\n  private playPlayerHurt(): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    const now = this.ctx.currentTime;\n\n    // === СТОН БОЛИ \"УХХ!\" ===\n    // Основной голос - низкий стон\n    const voice = this.ctx.createOscillator();\n    const voiceGain = this.ctx.createGain();\n    const voiceFilter = this.ctx.createBiquadFilter();\n    \n    voice.type = 'sawtooth';\n    // Резкий старт, потом падение\n    voice.frequency.setValueAtTime(180 + Math.random() * 40, now);\n    voice.frequency.exponentialRampToValueAtTime(120, now + 0.08);\n    voice.frequency.exponentialRampToValueAtTime(80, now + 0.25);\n\n    voiceFilter.type = 'lowpass';\n    voiceFilter.frequency.value = 600;\n    voiceFilter.Q.value = 2;\n\n    // Громкий стон\n    voiceGain.gain.setValueAtTime(0.25, now);\n    voiceGain.gain.linearRampToValueAtTime(0.18, now + 0.05);\n    voiceGain.gain.exponentialRampToValueAtTime(0.01, now + 0.3);\n\n    voice.connect(voiceFilter);\n    voiceFilter.connect(voiceGain);\n    voiceGain.connect(this.sfxGain);\n\n    voice.start(now);\n    voice.stop(now + 0.35);\n\n    // Второй тон для глубины\n    const voice2 = this.ctx.createOscillator();\n    const voice2Gain = this.ctx.createGain();\n    \n    voice2.type = 'triangle';\n    voice2.frequency.setValueAtTime(100, now);\n    voice2.frequency.exponentialRampToValueAtTime(60, now + 0.2);\n\n    voice2Gain.gain.setValueAtTime(0.12, now);\n    voice2Gain.gain.exponentialRampToValueAtTime(0.01, now + 0.2);\n\n    voice2.connect(voice2Gain);\n    voice2Gain.connect(this.sfxGain);\n\n    voice2.start(now);\n    voice2.stop(now + 0.25);\n\n    // === РЕЗКИЙ ВЫДОХ ===\n    const breathNoise = this.createNoise(0.2);\n    const breathGain = this.ctx.createGain();\n    const breathFilter = this.ctx.createBiquadFilter();\n\n    breathFilter.type = 'bandpass';\n    breathFilter.frequency.setValueAtTime(800, now);\n    breathFilter.frequency.exponentialRampToValueAtTime(300, now + 0.15);\n    breathFilter.Q.value = 0.8;\n\n    breathGain.gain.setValueAtTime(0.2, now);\n    breathGain.gain.exponentialRampToValueAtTime(0.01, now + 0.18);\n\n    breathNoise.connect(breathFilter);\n    breathFilter.connect(breathGain);\n    breathGain.connect(this.sfxGain);\n  }\n\n  // === ЗВУКИ ПОЯВЛЕНИЯ ВРАГОВ ИЗ ПОРТАЛОВ ===\n  \n  /** Звук появления бейнлинга - хлюпающий слизистый звук */\n  public playBanelingSpawn(): void {\n    if (!this.ctx || !this.sfxGain) return;\n    \n    const now = this.ctx.currentTime;\n    \n    // Хлюпающий звук - несколько пузырей\n    for (let i = 0; i < 4; i++) {\n      const delay = i * 0.05 + Math.random() * 0.02;\n      const bubble = this.ctx.createOscillator();\n      const bubbleGain = this.ctx.createGain();\n      const bubbleFilter = this.ctx.createBiquadFilter();\n      \n      bubble.type = 'sine';\n      const baseFreq = 200 + Math.random() * 300;\n      bubble.frequency.setValueAtTime(baseFreq, now + delay);\n      bubble.frequency.exponentialRampToValueAtTime(baseFreq * 0.4, now + delay + 0.12);\n      \n      bubbleFilter.type = 'lowpass';\n      bubbleFilter.frequency.value = 800;\n      bubbleFilter.Q.value = 4;\n      \n      bubbleGain.gain.setValueAtTime(0.2, now + delay);\n      bubbleGain.gain.exponentialRampToValueAtTime(0.01, now + delay + 0.15);\n      \n      bubble.connect(bubbleFilter);\n      bubbleFilter.connect(bubbleGain);\n      bubbleGain.connect(this.sfxGain);\n      \n      bubble.start(now + delay);\n      bubble.stop(now + delay + 0.2);\n    }\n    \n    // Влажный шум\n    const noiseLen = Math.floor(this.ctx.sampleRate * 0.2);\n    const noiseBuffer = this.ctx.createBuffer(1, noiseLen, this.ctx.sampleRate);\n    const noiseData = noiseBuffer.getChannelData(0);\n    for (let i = 0; i < noiseLen; i++) {\n      noiseData[i] = (Math.random() * 2 - 1) * Math.exp(-i / (noiseLen * 0.3)) * 0.3;\n    }\n    \n    const noise = this.ctx.createBufferSource();\n    noise.buffer = noiseBuffer;\n    const noiseGain = this.ctx.createGain();\n    const noiseFilter = this.ctx.createBiquadFilter();\n    \n    noiseFilter.type = 'lowpass';\n    noiseFilter.frequency.value = 600;\n    \n    noiseGain.gain.setValueAtTime(0.25, now);\n    noiseGain.gain.exponentialRampToValueAtTime(0.01, now + 0.2);\n    \n    noise.connect(noiseFilter);\n    noiseFilter.connect(noiseGain);\n    noiseGain.connect(this.sfxGain);\n    \n    noise.start(now);\n  }\n  \n  /** Звук появления фантома - зловещий свист из портала */\n  public playPhantomSpawn(): void {\n    if (!this.ctx || !this.sfxGain) return;\n    \n    const now = this.ctx.currentTime;\n    \n    // Зловещий свист - появление из тьмы\n    const whistle = this.ctx.createOscillator();\n    const whistleGain = this.ctx.createGain();\n    const whistleFilter = this.ctx.createBiquadFilter();\n    \n    whistle.type = 'triangle';\n    // Частота растёт от низкой к высокой\n    whistle.frequency.setValueAtTime(150, now);\n    whistle.frequency.exponentialRampToValueAtTime(600, now + 0.3);\n    whistle.frequency.setValueAtTime(500, now + 0.35);\n    \n    whistleFilter.type = 'bandpass';\n    whistleFilter.frequency.setValueAtTime(300, now);\n    whistleFilter.frequency.linearRampToValueAtTime(800, now + 0.3);\n    whistleFilter.Q.value = 6;\n    \n    whistleGain.gain.setValueAtTime(0.0, now);\n    whistleGain.gain.linearRampToValueAtTime(0.2, now + 0.1);\n    whistleGain.gain.setValueAtTime(0.2, now + 0.25);\n    whistleGain.gain.exponentialRampToValueAtTime(0.01, now + 0.5);\n    \n    whistle.connect(whistleFilter);\n    whistleFilter.connect(whistleGain);\n    whistleGain.connect(this.sfxGain);\n    whistleGain.connect(this.reverb!);\n    \n    whistle.start(now);\n    whistle.stop(now + 0.55);\n    \n    // Низкий гул для атмосферы\n    const hum = this.ctx.createOscillator();\n    const humGain = this.ctx.createGain();\n    \n    hum.type = 'sine';\n    hum.frequency.setValueAtTime(80, now);\n    hum.frequency.linearRampToValueAtTime(120, now + 0.3);\n    \n    humGain.gain.setValueAtTime(0.0, now);\n    humGain.gain.linearRampToValueAtTime(0.15, now + 0.1);\n    humGain.gain.exponentialRampToValueAtTime(0.01, now + 0.4);\n    \n    hum.connect(humGain);\n    humGain.connect(this.sfxGain);\n    \n    hum.start(now);\n    hum.stop(now + 0.45);\n  }\n  \n  /** Звук появления раннера - быстрый шорох/скрежет */\n  public playRunnerSpawn(): void {\n    if (!this.ctx || !this.sfxGain) return;\n    \n    const now = this.ctx.currentTime;\n    \n    // Быстрый скрежет когтей\n    const scrape = this.ctx.createOscillator();\n    const scrapeGain = this.ctx.createGain();\n    const scrapeFilter = this.ctx.createBiquadFilter();\n    \n    scrape.type = 'sawtooth';\n    // Быстрое вибрато для эффекта бега\n    scrape.frequency.setValueAtTime(200, now);\n    scrape.frequency.linearRampToValueAtTime(400, now + 0.05);\n    scrape.frequency.linearRampToValueAtTime(250, now + 0.1);\n    scrape.frequency.linearRampToValueAtTime(350, now + 0.15);\n    scrape.frequency.linearRampToValueAtTime(200, now + 0.2);\n    \n    scrapeFilter.type = 'highpass';\n    scrapeFilter.frequency.value = 1000;\n    scrapeFilter.Q.value = 2;\n    \n    scrapeGain.gain.setValueAtTime(0.15, now);\n    scrapeGain.gain.exponentialRampToValueAtTime(0.01, now + 0.25);\n    \n    scrape.connect(scrapeFilter);\n    scrapeFilter.connect(scrapeGain);\n    scrapeGain.connect(this.sfxGain);\n    \n    scrape.start(now);\n    scrape.stop(now + 0.3);\n    \n    // Шум шагов\n    const noiseLen = Math.floor(this.ctx.sampleRate * 0.15);\n    const noiseBuffer = this.ctx.createBuffer(1, noiseLen, this.ctx.sampleRate);\n    const noiseData = noiseBuffer.getChannelData(0);\n    for (let i = 0; i < noiseLen; i++) {\n      // Пульсирующий шум для эффекта шагов\n      const pulse = Math.sin(i / this.ctx.sampleRate * 60 * Math.PI * 2) * 0.5 + 0.5;\n      noiseData[i] = (Math.random() * 2 - 1) * pulse * Math.exp(-i / (noiseLen * 0.5));\n    }\n    \n    const noise = this.ctx.createBufferSource();\n    noise.buffer = noiseBuffer;\n    const noiseGain = this.ctx.createGain();\n    const noiseFilter = this.ctx.createBiquadFilter();\n    \n    noiseFilter.type = 'highpass';\n    noiseFilter.frequency.value = 2000;\n    \n    noiseGain.gain.setValueAtTime(0.2, now);\n    noiseGain.gain.exponentialRampToValueAtTime(0.01, now + 0.15);\n    \n    noise.connect(noiseFilter);\n    noiseFilter.connect(noiseGain);\n    noiseGain.connect(this.sfxGain);\n    \n    noise.start(now);\n  }\n  \n  /** Звук появления хоппера - пружинистый прыжковый звук */\n  public playHopperSpawn(): void {\n    if (!this.ctx || !this.sfxGain) return;\n    \n    const now = this.ctx.currentTime;\n    \n    // Пружинистый звук - \"бойнг\"\n    const boing = this.ctx.createOscillator();\n    const boingGain = this.ctx.createGain();\n    \n    boing.type = 'sine';\n    // Частота прыгает вверх-вниз\n    boing.frequency.setValueAtTime(150, now);\n    boing.frequency.exponentialRampToValueAtTime(400, now + 0.08);\n    boing.frequency.exponentialRampToValueAtTime(200, now + 0.2);\n    boing.frequency.exponentialRampToValueAtTime(300, now + 0.25);\n    \n    boingGain.gain.setValueAtTime(0.3, now);\n    boingGain.gain.exponentialRampToValueAtTime(0.01, now + 0.35);\n    \n    boing.connect(boingGain);\n    boingGain.connect(this.sfxGain);\n    \n    boing.start(now);\n    boing.stop(now + 0.4);\n    \n    // Электрический \"чирик\" (хоппер синий/электрический)\n    const zap = this.ctx.createOscillator();\n    const zapGain = this.ctx.createGain();\n    const zapFilter = this.ctx.createBiquadFilter();\n    \n    zap.type = 'square';\n    zap.frequency.setValueAtTime(800, now + 0.05);\n    zap.frequency.linearRampToValueAtTime(1200, now + 0.1);\n    zap.frequency.linearRampToValueAtTime(600, now + 0.15);\n    \n    zapFilter.type = 'bandpass';\n    zapFilter.frequency.value = 1000;\n    zapFilter.Q.value = 5;\n    \n    zapGain.gain.setValueAtTime(0.0, now + 0.05);\n    zapGain.gain.linearRampToValueAtTime(0.15, now + 0.08);\n    zapGain.gain.exponentialRampToValueAtTime(0.01, now + 0.2);\n    \n    zap.connect(zapFilter);\n    zapFilter.connect(zapGain);\n    zapGain.connect(this.sfxGain);\n    \n    zap.start(now + 0.05);\n    zap.stop(now + 0.25);\n  }\n  \n  /** Звук появления босса - мощный рёв из портала */\n  public playBossSpawn(): void {\n    if (!this.ctx || !this.sfxGain) return;\n    \n    const now = this.ctx.currentTime;\n    \n    // Мощный низкий рёв\n    const roar = this.ctx.createOscillator();\n    const roarGain = this.ctx.createGain();\n    const roarFilter = this.ctx.createBiquadFilter();\n    \n    roar.type = 'sawtooth';\n    roar.frequency.setValueAtTime(60, now);\n    roar.frequency.linearRampToValueAtTime(100, now + 0.3);\n    roar.frequency.exponentialRampToValueAtTime(40, now + 0.8);\n    \n    roarFilter.type = 'lowpass';\n    roarFilter.frequency.setValueAtTime(300, now);\n    roarFilter.frequency.linearRampToValueAtTime(500, now + 0.3);\n    roarFilter.frequency.exponentialRampToValueAtTime(200, now + 0.8);\n    roarFilter.Q.value = 2;\n    \n    roarGain.gain.setValueAtTime(0.0, now);\n    roarGain.gain.linearRampToValueAtTime(0.5, now + 0.1);\n    roarGain.gain.setValueAtTime(0.5, now + 0.4);\n    roarGain.gain.exponentialRampToValueAtTime(0.01, now + 1.0);\n    \n    roar.connect(roarFilter);\n    roarFilter.connect(roarGain);\n    roarGain.connect(this.sfxGain);\n    roarGain.connect(this.reverb!);\n    \n    roar.start(now);\n    roar.stop(now + 1.1);\n    \n    // Второй слой - более высокий для глубины\n    const roar2 = this.ctx.createOscillator();\n    const roar2Gain = this.ctx.createGain();\n    \n    roar2.type = 'triangle';\n    roar2.frequency.setValueAtTime(120, now);\n    roar2.frequency.linearRampToValueAtTime(180, now + 0.3);\n    roar2.frequency.exponentialRampToValueAtTime(80, now + 0.8);\n    \n    roar2Gain.gain.setValueAtTime(0.0, now);\n    roar2Gain.gain.linearRampToValueAtTime(0.3, now + 0.1);\n    roar2Gain.gain.exponentialRampToValueAtTime(0.01, now + 0.9);\n    \n    roar2.connect(roar2Gain);\n    roar2Gain.connect(this.sfxGain);\n    \n    roar2.start(now);\n    roar2.stop(now + 1.0);\n    \n    // Шум для грубости\n    const noiseLen = Math.floor(this.ctx.sampleRate * 0.8);\n    const noiseBuffer = this.ctx.createBuffer(1, noiseLen, this.ctx.sampleRate);\n    const noiseData = noiseBuffer.getChannelData(0);\n    for (let i = 0; i < noiseLen; i++) {\n      const env = Math.sin(i / noiseLen * Math.PI);\n      noiseData[i] = (Math.random() * 2 - 1) * env * 0.3;\n    }\n    \n    const noise = this.ctx.createBufferSource();\n    noise.buffer = noiseBuffer;\n    const noiseGain = this.ctx.createGain();\n    const noiseFilter = this.ctx.createBiquadFilter();\n    \n    noiseFilter.type = 'lowpass';\n    noiseFilter.frequency.value = 400;\n    \n    noiseGain.gain.setValueAtTime(0.0, now);\n    noiseGain.gain.linearRampToValueAtTime(0.25, now + 0.1);\n    noiseGain.gain.exponentialRampToValueAtTime(0.01, now + 0.8);\n    \n    noise.connect(noiseFilter);\n    noiseFilter.connect(noiseGain);\n    noiseGain.connect(this.sfxGain);\n    noiseGain.connect(this.reverb!);\n    \n    noise.start(now);\n  }\n  \n  /** Звук активации портала - пространственное гудение */\n  public playPortalActivate(): void {\n    if (!this.ctx || !this.sfxGain) return;\n    \n    const now = this.ctx.currentTime;\n    \n    // Пространственный гул\n    const hum = this.ctx.createOscillator();\n    const humGain = this.ctx.createGain();\n    \n    hum.type = 'sine';\n    hum.frequency.setValueAtTime(100, now);\n    // Вибрато\n    const lfo = this.ctx.createOscillator();\n    const lfoGain = this.ctx.createGain();\n    lfo.frequency.value = 5;\n    lfoGain.gain.value = 15;\n    lfo.connect(lfoGain);\n    lfoGain.connect(hum.frequency);\n    \n    humGain.gain.setValueAtTime(0.2, now);\n    humGain.gain.exponentialRampToValueAtTime(0.01, now + 0.5);\n    \n    hum.connect(humGain);\n    humGain.connect(this.sfxGain);\n    humGain.connect(this.reverb!);\n    \n    lfo.start(now);\n    hum.start(now);\n    hum.stop(now + 0.6);\n    lfo.stop(now + 0.6);\n  }\n\n  /** Вскрик спайкера перед атакой - пронзительный крик */\n  private playSpikerScream(): void {\n    if (!this.ctx || !this.sfxGain) return;\n    \n    const now = this.ctx.currentTime;\n    \n    // Пронзительный крик - высокочастотный визг\n    const scream = this.ctx.createOscillator();\n    const screamGain = this.ctx.createGain();\n    const screamFilter = this.ctx.createBiquadFilter();\n    \n    scream.type = 'sawtooth';\n    // Резкий подъём частоты\n    scream.frequency.setValueAtTime(800, now);\n    scream.frequency.exponentialRampToValueAtTime(2000, now + 0.1);\n    scream.frequency.exponentialRampToValueAtTime(1500, now + 0.2);\n    \n    screamFilter.type = 'bandpass';\n    screamFilter.frequency.value = 1500;\n    screamFilter.Q.value = 3;\n    \n    screamGain.gain.setValueAtTime(0.3, now);\n    screamGain.gain.exponentialRampToValueAtTime(0.01, now + 0.25);\n    \n    scream.connect(screamFilter);\n    screamFilter.connect(screamGain);\n    screamGain.connect(this.sfxGain);\n    \n    scream.start(now);\n    scream.stop(now + 0.3);\n    \n    // Вибрирующий компонент - дрожь в голосе\n    const vibrato = this.ctx.createOscillator();\n    const vibratoGain = this.ctx.createGain();\n    \n    vibrato.type = 'sine';\n    vibrato.frequency.setValueAtTime(1200, now);\n    \n    // LFO для вибрато\n    const lfo = this.ctx.createOscillator();\n    const lfoGain = this.ctx.createGain();\n    lfo.frequency.value = 25; // Быстрое дрожание\n    lfoGain.gain.value = 100;\n    lfo.connect(lfoGain);\n    lfoGain.connect(vibrato.frequency);\n    \n    vibratoGain.gain.setValueAtTime(0.15, now);\n    vibratoGain.gain.exponentialRampToValueAtTime(0.01, now + 0.2);\n    \n    vibrato.connect(vibratoGain);\n    vibratoGain.connect(this.sfxGain);\n    \n    lfo.start(now);\n    vibrato.start(now);\n    vibrato.stop(now + 0.25);\n    lfo.stop(now + 0.25);\n  }\n  \n  /** Звук выстрела иголкой спайкера */\n  private playSpikerShoot(): void {\n    if (!this.ctx || !this.sfxGain) return;\n    \n    const now = this.ctx.currentTime;\n    \n    // Свист иглы - быстрый \"фьюить\"\n    const whistle = this.ctx.createOscillator();\n    const whistleGain = this.ctx.createGain();\n    const whistleFilter = this.ctx.createBiquadFilter();\n    \n    whistle.type = 'sine';\n    // Падающая частота - игла летит\n    whistle.frequency.setValueAtTime(3000, now);\n    whistle.frequency.exponentialRampToValueAtTime(800, now + 0.15);\n    \n    whistleFilter.type = 'highpass';\n    whistleFilter.frequency.value = 1000;\n    \n    whistleGain.gain.setValueAtTime(0.2, now);\n    whistleGain.gain.exponentialRampToValueAtTime(0.01, now + 0.15);\n    \n    whistle.connect(whistleFilter);\n    whistleFilter.connect(whistleGain);\n    whistleGain.connect(this.sfxGain);\n    \n    whistle.start(now);\n    whistle.stop(now + 0.2);\n    \n    // Щелчок выстрела\n    const click = this.ctx.createOscillator();\n    const clickGain = this.ctx.createGain();\n    \n    click.type = 'square';\n    click.frequency.setValueAtTime(600, now);\n    click.frequency.exponentialRampToValueAtTime(200, now + 0.03);\n    \n    clickGain.gain.setValueAtTime(0.25, now);\n    clickGain.gain.exponentialRampToValueAtTime(0.01, now + 0.05);\n    \n    click.connect(clickGain);\n    clickGain.connect(this.sfxGain);\n    \n    click.start(now);\n    click.stop(now + 0.08);\n  }\n  \n  /** Звук взрыва гранаты - глитч эффект */\n  private playExplosion(): void {\n    if (!this.ctx || !this.sfxGain) return;\n    \n    const now = this.ctx.currentTime;\n    \n    // Глитч-взрыв - резкий цифровой шум\n    const noiseBuffer = this.ctx.createBuffer(1, this.ctx.sampleRate * 0.5, this.ctx.sampleRate);\n    const noiseData = noiseBuffer.getChannelData(0);\n    for (let i = 0; i < noiseData.length; i++) {\n      // Битовый шум - резкий цифровой звук\n      noiseData[i] = Math.random() > 0.5 ? 1 : -1;\n      // Добавляем глитч-паттерн\n      if (i % 100 < 30) noiseData[i] *= 0.3;\n    }\n    \n    const noise = this.ctx.createBufferSource();\n    noise.buffer = noiseBuffer;\n    \n    const noiseGain = this.ctx.createGain();\n    const noiseFilter = this.ctx.createBiquadFilter();\n    \n    noiseFilter.type = 'bandpass';\n    noiseFilter.frequency.setValueAtTime(2000, now);\n    noiseFilter.frequency.exponentialRampToValueAtTime(100, now + 0.3);\n    noiseFilter.Q.value = 3;\n    \n    noiseGain.gain.setValueAtTime(0.8, now);\n    noiseGain.gain.exponentialRampToValueAtTime(0.01, now + 0.4);\n    \n    noise.connect(noiseFilter);\n    noiseFilter.connect(noiseGain);\n    noiseGain.connect(this.sfxGain);\n    \n    noise.start(now);\n    noise.stop(now + 0.5);\n    \n    // Низкий удар\n    const boom = this.ctx.createOscillator();\n    const boomGain = this.ctx.createGain();\n    \n    boom.type = 'sine';\n    boom.frequency.setValueAtTime(80, now);\n    boom.frequency.exponentialRampToValueAtTime(20, now + 0.3);\n    \n    boomGain.gain.setValueAtTime(0.9, now);\n    boomGain.gain.exponentialRampToValueAtTime(0.01, now + 0.4);\n    \n    boom.connect(boomGain);\n    boomGain.connect(this.sfxGain);\n    \n    boom.start(now);\n    boom.stop(now + 0.4);\n    \n    // Высокочастотный писк (глитч)\n    const glitch = this.ctx.createOscillator();\n    const glitchGain = this.ctx.createGain();\n    \n    glitch.type = 'square';\n    glitch.frequency.setValueAtTime(4000, now);\n    glitch.frequency.setValueAtTime(100, now + 0.05);\n    glitch.frequency.setValueAtTime(3000, now + 0.1);\n    glitch.frequency.setValueAtTime(50, now + 0.15);\n    \n    glitchGain.gain.setValueAtTime(0.3, now);\n    glitchGain.gain.setValueAtTime(0.5, now + 0.05);\n    glitchGain.gain.setValueAtTime(0.2, now + 0.1);\n    glitchGain.gain.exponentialRampToValueAtTime(0.01, now + 0.25);\n    \n    glitch.connect(glitchGain);\n    glitchGain.connect(this.sfxGain);\n    \n    glitch.start(now);\n    glitch.stop(now + 0.3);\n  }\n\n  private playPhantomPass(): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    const now = this.ctx.currentTime;\n\n    // Жуткий низкий свист (доплер эффект)\n    const swoosh = this.ctx.createOscillator();\n    const swooshGain = this.ctx.createGain();\n    const swooshFilter = this.ctx.createBiquadFilter();\n\n    swoosh.type = 'sawtooth';\n    // Частота падает как будто пролетает мимо\n    swoosh.frequency.setValueAtTime(400, now);\n    swoosh.frequency.exponentialRampToValueAtTime(100, now + 0.3);\n\n    swooshFilter.type = 'lowpass';\n    swooshFilter.frequency.setValueAtTime(2000, now);\n    swooshFilter.frequency.exponentialRampToValueAtTime(300, now + 0.3);\n    swooshFilter.Q.value = 2;\n\n    swooshGain.gain.setValueAtTime(0.3, now);\n    swooshGain.gain.exponentialRampToValueAtTime(0.01, now + 0.4);\n\n    swoosh.connect(swooshFilter);\n    swooshFilter.connect(swooshGain);\n    swooshGain.connect(this.sfxGain);\n    swooshGain.connect(this.reverb!);\n\n    swoosh.start(now);\n    swoosh.stop(now + 0.5);\n\n    // Тёмный резонанс\n    const dark = this.ctx.createOscillator();\n    const darkGain = this.ctx.createGain();\n\n    dark.type = 'sine';\n    dark.frequency.setValueAtTime(60, now);\n    dark.frequency.exponentialRampToValueAtTime(30, now + 0.5);\n\n    darkGain.gain.setValueAtTime(0.4, now);\n    darkGain.gain.exponentialRampToValueAtTime(0.01, now + 0.6);\n\n    dark.connect(darkGain);\n    darkGain.connect(this.sfxGain);\n\n    dark.start(now);\n    dark.stop(now + 0.7);\n\n    // Шёпот/шорох (высокочастотный шум)\n    const whisper = this.createNoise(0.3);\n    const whisperGain = this.ctx.createGain();\n    const whisperFilter = this.ctx.createBiquadFilter();\n\n    whisperFilter.type = 'bandpass';\n    whisperFilter.frequency.value = 3000;\n    whisperFilter.Q.value = 5;\n\n    whisperGain.gain.setValueAtTime(0.15, now);\n    whisperGain.gain.exponentialRampToValueAtTime(0.01, now + 0.25);\n\n    whisper.connect(whisperFilter);\n    whisperFilter.connect(whisperGain);\n    whisperGain.connect(this.sfxGain);\n  }\n\n  /** Runner врезался - быстрый огненный удар */\n  private playRunnerHit(): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    const now = this.ctx.currentTime;\n\n    // Быстрый свист\n    const swoosh = this.ctx.createOscillator();\n    const swooshGain = this.ctx.createGain();\n\n    swoosh.type = 'sawtooth';\n    swoosh.frequency.setValueAtTime(800, now);\n    swoosh.frequency.exponentialRampToValueAtTime(200, now + 0.15);\n\n    swooshGain.gain.setValueAtTime(0.3, now);\n    swooshGain.gain.exponentialRampToValueAtTime(0.01, now + 0.2);\n\n    swoosh.connect(swooshGain);\n    swooshGain.connect(this.sfxGain);\n\n    swoosh.start(now);\n    swoosh.stop(now + 0.25);\n\n    // Огненный треск\n    for (let i = 0; i < 4; i++) {\n      const crackle = this.ctx.createOscillator();\n      const crackleGain = this.ctx.createGain();\n\n      crackle.type = 'square';\n      crackle.frequency.value = 1000 + Math.random() * 2000;\n\n      const t = now + i * 0.03;\n      crackleGain.gain.setValueAtTime(0.15, t);\n      crackleGain.gain.setValueAtTime(0, t + 0.02);\n\n      crackle.connect(crackleGain);\n      crackleGain.connect(this.sfxGain);\n\n      crackle.start(t);\n      crackle.stop(t + 0.03);\n    }\n\n    // Низкий удар\n    const impact = this.ctx.createOscillator();\n    const impactGain = this.ctx.createGain();\n\n    impact.type = 'sine';\n    impact.frequency.setValueAtTime(120, now);\n    impact.frequency.exponentialRampToValueAtTime(40, now + 0.15);\n\n    impactGain.gain.setValueAtTime(0.4, now);\n    impactGain.gain.exponentialRampToValueAtTime(0.01, now + 0.2);\n\n    impact.connect(impactGain);\n    impactGain.connect(this.sfxGain);\n\n    impact.start(now);\n    impact.stop(now + 0.25);\n  }\n\n  /** Hopper приземлился на игрока - электрический удар сверху */\n  private playHopperHit(): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    const now = this.ctx.currentTime;\n\n    // Электрический разряд (высокий → низкий)\n    const zap = this.ctx.createOscillator();\n    const zapGain = this.ctx.createGain();\n    const zapFilter = this.ctx.createBiquadFilter();\n\n    zap.type = 'sawtooth';\n    zap.frequency.setValueAtTime(2000, now);\n    zap.frequency.exponentialRampToValueAtTime(100, now + 0.2);\n\n    zapFilter.type = 'bandpass';\n    zapFilter.frequency.value = 1500;\n    zapFilter.Q.value = 3;\n\n    zapGain.gain.setValueAtTime(0.35, now);\n    zapGain.gain.exponentialRampToValueAtTime(0.01, now + 0.25);\n\n    zap.connect(zapFilter);\n    zapFilter.connect(zapGain);\n    zapGain.connect(this.sfxGain);\n    zapGain.connect(this.reverb!);\n\n    zap.start(now);\n    zap.stop(now + 0.3);\n\n    // Тяжёлый удар сверху\n    const thud = this.ctx.createOscillator();\n    const thudGain = this.ctx.createGain();\n\n    thud.type = 'sine';\n    thud.frequency.setValueAtTime(80, now + 0.05);\n    thud.frequency.exponentialRampToValueAtTime(25, now + 0.3);\n\n    thudGain.gain.setValueAtTime(0.5, now + 0.05);\n    thudGain.gain.exponentialRampToValueAtTime(0.01, now + 0.35);\n\n    thud.connect(thudGain);\n    thudGain.connect(this.sfxGain);\n\n    thud.start(now + 0.05);\n    thud.stop(now + 0.4);\n\n    // Искры (шум)\n    const sparks = this.createNoise(0.25);\n    const sparksGain = this.ctx.createGain();\n    const sparksFilter = this.ctx.createBiquadFilter();\n\n    sparksFilter.type = 'highpass';\n    sparksFilter.frequency.value = 3000;\n\n    sparksGain.gain.setValueAtTime(0.2, now);\n    sparksGain.gain.exponentialRampToValueAtTime(0.01, now + 0.15);\n\n    sparks.connect(sparksFilter);\n    sparksFilter.connect(sparksGain);\n    sparksGain.connect(this.sfxGain);\n  }\n\n  /** Глитч эффект */\n  private playGlitch(): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    const now = this.ctx.currentTime;\n\n    // Случайные частоты и длительности\n    for (let i = 0; i < 5; i++) {\n      const delay = i * 0.03 + Math.random() * 0.02;\n      const osc = this.ctx.createOscillator();\n      const gain = this.ctx.createGain();\n      const filter = this.ctx.createBiquadFilter();\n\n      osc.type = Math.random() > 0.5 ? 'square' : 'sawtooth';\n      osc.frequency.value = 100 + Math.random() * 2000;\n\n      filter.type = 'bandpass';\n      filter.frequency.value = 500 + Math.random() * 3000;\n      filter.Q.value = 5 + Math.random() * 10;\n\n      gain.gain.setValueAtTime(0.15, now + delay);\n      gain.gain.setValueAtTime(0, now + delay + 0.02 + Math.random() * 0.03);\n\n      osc.connect(filter);\n      filter.connect(gain);\n      gain.connect(this.sfxGain);\n      gain.connect(this.reverb!);\n\n      osc.start(now + delay);\n      osc.stop(now + delay + 0.1);\n    }\n  }\n\n  /** Счётчик шагов для дыхания */\n  private footstepCount = 0;\n\n  /** Шаг с дыханием при беге */\n  private playFootstep(): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    const now = this.ctx.currentTime;\n    this.footstepCount++;\n\n    // Низкий мягкий удар (не громкий)\n    const kick = this.ctx.createOscillator();\n    const kickGain = this.ctx.createGain();\n\n    kick.type = 'sine';\n    kick.frequency.setValueAtTime(60, now);\n    kick.frequency.exponentialRampToValueAtTime(25, now + 0.06);\n\n    kickGain.gain.setValueAtTime(0.12, now);\n    kickGain.gain.exponentialRampToValueAtTime(0.01, now + 0.08);\n\n    kick.connect(kickGain);\n    kickGain.connect(this.sfxGain);\n\n    kick.start(now);\n    kick.stop(now + 0.1);\n\n    // Шум поверхности (тише)\n    const noise = this.createNoise(0.05);\n    const noiseGain = this.ctx.createGain();\n    const noiseFilter = this.ctx.createBiquadFilter();\n\n    noiseFilter.type = 'lowpass';\n    noiseFilter.frequency.value = 250 + Math.random() * 150;\n\n    noiseGain.gain.setValueAtTime(0.06, now);\n    noiseGain.gain.exponentialRampToValueAtTime(0.01, now + 0.04);\n\n    noise.connect(noiseFilter);\n    noiseFilter.connect(noiseGain);\n    noiseGain.connect(this.sfxGain);\n\n    // === ДЫХАНИЕ ПРИ БЕГЕ (каждые 4 шага) ===\n    if (this.footstepCount % 4 === 0) {\n      this.playRunningBreath();\n    }\n  }\n\n  /** Дыхание при беге */\n  private playRunningBreath(): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    const now = this.ctx.currentTime;\n    const isInhale = Math.random() > 0.5; // Вдох или выдох\n\n    // Шумовое дыхание\n    const breathNoise = this.createNoise(isInhale ? 0.15 : 0.2);\n    const breathGain = this.ctx.createGain();\n    const breathFilter = this.ctx.createBiquadFilter();\n\n    breathFilter.type = 'bandpass';\n    breathFilter.frequency.value = isInhale ? 700 : 400; // Вдох выше, выдох ниже\n    breathFilter.Q.value = 0.6;\n\n    // Плавное нарастание и спад\n    breathGain.gain.setValueAtTime(0.01, now);\n    breathGain.gain.linearRampToValueAtTime(0.08, now + 0.05);\n    breathGain.gain.exponentialRampToValueAtTime(0.01, now + (isInhale ? 0.12 : 0.18));\n\n    breathNoise.connect(breathFilter);\n    breathFilter.connect(breathGain);\n    breathGain.connect(this.sfxGain);\n\n    // Лёгкий голосовой тон (очень тихий)\n    if (!isInhale) {\n      const voice = this.ctx.createOscillator();\n      const voiceGain = this.ctx.createGain();\n\n      voice.type = 'sine';\n      voice.frequency.value = 100 + Math.random() * 30;\n\n      voiceGain.gain.setValueAtTime(0.03, now);\n      voiceGain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);\n\n      voice.connect(voiceGain);\n      voiceGain.connect(this.sfxGain);\n\n      voice.start(now);\n      voice.stop(now + 0.12);\n    }\n  }\n\n  /** Прыжок - вздох + толчок */\n  private playJump(): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    const now = this.ctx.currentTime;\n\n    // === ВЗДОХ ПРИ ПРЫЖКЕ \"ХУХ!\" ===\n    const voice = this.ctx.createOscillator();\n    const voiceGain = this.ctx.createGain();\n    const voiceFilter = this.ctx.createBiquadFilter();\n\n    voice.type = 'sawtooth';\n    voice.frequency.setValueAtTime(140, now);\n    voice.frequency.exponentialRampToValueAtTime(180, now + 0.05); // Вверх\n    voice.frequency.exponentialRampToValueAtTime(100, now + 0.12);\n\n    voiceFilter.type = 'lowpass';\n    voiceFilter.frequency.value = 500;\n    voiceFilter.Q.value = 1.5;\n\n    voiceGain.gain.setValueAtTime(0.18, now);\n    voiceGain.gain.exponentialRampToValueAtTime(0.01, now + 0.12);\n\n    voice.connect(voiceFilter);\n    voiceFilter.connect(voiceGain);\n    voiceGain.connect(this.sfxGain);\n\n    voice.start(now);\n    voice.stop(now + 0.15);\n\n    // Шумовой выдох\n    const breathNoise = this.createNoise(0.1);\n    const breathGain = this.ctx.createGain();\n    const breathFilter = this.ctx.createBiquadFilter();\n\n    breathFilter.type = 'bandpass';\n    breathFilter.frequency.value = 500;\n    breathFilter.Q.value = 0.7;\n\n    breathGain.gain.setValueAtTime(0.1, now);\n    breathGain.gain.exponentialRampToValueAtTime(0.01, now + 0.08);\n\n    breathNoise.connect(breathFilter);\n    breathFilter.connect(breathGain);\n    breathGain.connect(this.sfxGain);\n\n    // Мягкий толчок (не писк!)\n    const thud = this.ctx.createOscillator();\n    const thudGain = this.ctx.createGain();\n\n    thud.type = 'sine';\n    thud.frequency.setValueAtTime(60, now);\n    thud.frequency.exponentialRampToValueAtTime(40, now + 0.08);\n\n    thudGain.gain.setValueAtTime(0.15, now);\n    thudGain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);\n\n    thud.connect(thudGain);\n    thudGain.connect(this.sfxGain);\n\n    thud.start(now);\n    thud.stop(now + 0.12);\n  }\n\n  /** Приземление - удар + реверб */\n  private playLand(): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    const now = this.ctx.currentTime;\n\n    // Тяжёлый удар\n    const kick = this.ctx.createOscillator();\n    const kickGain = this.ctx.createGain();\n\n    kick.type = 'sine';\n    kick.frequency.setValueAtTime(100, now);\n    kick.frequency.exponentialRampToValueAtTime(20, now + 0.15);\n\n    kickGain.gain.setValueAtTime(0.5, now);\n    kickGain.gain.exponentialRampToValueAtTime(0.01, now + 0.2);\n\n    kick.connect(kickGain);\n    kickGain.connect(this.sfxGain);\n    kickGain.connect(this.reverb!);\n\n    kick.start(now);\n    kick.stop(now + 0.25);\n\n    // Шум удара\n    const noise = this.createNoise(0.15);\n    const noiseGain = this.ctx.createGain();\n    const noiseFilter = this.ctx.createBiquadFilter();\n\n    noiseFilter.type = 'lowpass';\n    noiseFilter.frequency.value = 400;\n\n    noiseGain.gain.setValueAtTime(0.3, now);\n    noiseGain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);\n\n    noise.connect(noiseFilter);\n    noiseFilter.connect(noiseGain);\n    noiseGain.connect(this.sfxGain);\n  }\n\n  /** Убийство врага - ШЛЁП! Слизь падает и растекается */\n  private playKill(): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    const now = this.ctx.currentTime;\n\n    // Глухой удар (падение на пол)\n    const thud = this.ctx.createOscillator();\n    const thudGain = this.ctx.createGain();\n\n    thud.type = 'sine';\n    thud.frequency.setValueAtTime(80, now);\n    thud.frequency.exponentialRampToValueAtTime(30, now + 0.15);\n\n    thudGain.gain.setValueAtTime(0.5, now);\n    thudGain.gain.exponentialRampToValueAtTime(0.01, now + 0.2);\n\n    thud.connect(thudGain);\n    thudGain.connect(this.sfxGain);\n    thudGain.connect(this.reverb!);\n\n    thud.start(now);\n    thud.stop(now + 0.25);\n\n    // Мокрый шлёп (шум с фильтром)\n    const splat = this.createNoise(0.2);\n    const splatGain = this.ctx.createGain();\n    const splatFilter = this.ctx.createBiquadFilter();\n\n    splatFilter.type = 'lowpass';\n    splatFilter.frequency.setValueAtTime(800, now);\n    splatFilter.frequency.exponentialRampToValueAtTime(200, now + 0.15);\n    splatFilter.Q.value = 2;\n\n    splatGain.gain.setValueAtTime(0.35, now);\n    splatGain.gain.exponentialRampToValueAtTime(0.01, now + 0.18);\n\n    splat.connect(splatFilter);\n    splatFilter.connect(splatGain);\n    splatGain.connect(this.sfxGain);\n    splatGain.connect(this.reverb!);\n\n    // Пузырящееся растекание (короткие тоны)\n    for (let i = 0; i < 3; i++) {\n      const delay = 0.05 + i * 0.04;\n      const bubble = this.ctx.createOscillator();\n      const bubbleGain = this.ctx.createGain();\n\n      bubble.type = 'sine';\n      bubble.frequency.setValueAtTime(150 + Math.random() * 100, now + delay);\n      bubble.frequency.exponentialRampToValueAtTime(50, now + delay + 0.08);\n\n      bubbleGain.gain.setValueAtTime(0.12, now + delay);\n      bubbleGain.gain.exponentialRampToValueAtTime(0.01, now + delay + 0.1);\n\n      bubble.connect(bubbleGain);\n      bubbleGain.connect(this.sfxGain);\n\n      bubble.start(now + delay);\n      bubble.stop(now + delay + 0.12);\n    }\n  }\n\n  /** Создать источник шума */\n  private createNoise(duration: number): AudioBufferSourceNode {\n    if (!this.ctx) throw new Error('AudioContext not initialized');\n\n    const bufferSize = this.ctx.sampleRate * duration;\n    const buffer = this.ctx.createBuffer(1, bufferSize, this.ctx.sampleRate);\n    const data = buffer.getChannelData(0);\n\n    for (let i = 0; i < bufferSize; i++) {\n      data[i] = Math.random() * 2 - 1;\n    }\n\n    const source = this.ctx.createBufferSource();\n    source.buffer = buffer;\n    source.start();\n\n    return source;\n  }\n\n  /** Взмах катаной - резкий свист рассекаемого воздуха */\n  private playKatanaSwing(): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    const now = this.ctx.currentTime;\n\n    // === РЕЗКИЙ СВИСТ ЛЕЗВИЯ (высокочастотный) ===\n    const whooshNoise = this.createNoise(0.22);\n    const whooshGain = this.ctx.createGain();\n    const whooshFilter = this.ctx.createBiquadFilter();\n    const whooshFilter2 = this.ctx.createBiquadFilter();\n\n    // Высокий свист - от высокого к среднему\n    whooshFilter.type = 'bandpass';\n    whooshFilter.frequency.setValueAtTime(2500, now);\n    whooshFilter.frequency.exponentialRampToValueAtTime(800, now + 0.18);\n    whooshFilter.Q.value = 2.5;\n\n    // Второй фильтр для резкости\n    whooshFilter2.type = 'highpass';\n    whooshFilter2.frequency.value = 400;\n\n    // Громкость - резкий старт\n    whooshGain.gain.setValueAtTime(0.0, now);\n    whooshGain.gain.linearRampToValueAtTime(0.3, now + 0.02);\n    whooshGain.gain.exponentialRampToValueAtTime(0.01, now + 0.2);\n\n    whooshNoise.connect(whooshFilter);\n    whooshFilter.connect(whooshFilter2);\n    whooshFilter2.connect(whooshGain);\n    whooshGain.connect(this.sfxGain);\n\n    // === ТОНКИЙ МЕТАЛЛИЧЕСКИЙ ПРИЗВУК ===\n    const metal = this.ctx.createOscillator();\n    const metalGain = this.ctx.createGain();\n\n    metal.type = 'sine';\n    metal.frequency.setValueAtTime(3500, now);\n    metal.frequency.exponentialRampToValueAtTime(1500, now + 0.08);\n\n    metalGain.gain.setValueAtTime(0.04, now);\n    metalGain.gain.exponentialRampToValueAtTime(0.01, now + 0.06);\n\n    metal.connect(metalGain);\n    metalGain.connect(this.sfxGain);\n\n    metal.start(now);\n    metal.stop(now + 0.1);\n\n    // === НИЗКИЙ \"ВЖУХ\" (движение воздуха) ===\n    const lowWhoosh = this.createNoise(0.15);\n    const lowGain = this.ctx.createGain();\n    const lowFilter = this.ctx.createBiquadFilter();\n\n    lowFilter.type = 'lowpass';\n    lowFilter.frequency.setValueAtTime(300, now);\n    lowFilter.frequency.exponentialRampToValueAtTime(100, now + 0.12);\n\n    lowGain.gain.setValueAtTime(0.15, now + 0.02);\n    lowGain.gain.exponentialRampToValueAtTime(0.01, now + 0.15);\n\n    lowWhoosh.connect(lowFilter);\n    lowFilter.connect(lowGain);\n    lowGain.connect(this.sfxGain);\n  }\n\n  /** Сплеш-волна энергии - МОЩНАЯ! */\n  private playSplashWave(): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    const now = this.ctx.currentTime;\n\n    // Волна энергии - нарастает и расходится\n    const wave = this.ctx.createOscillator();\n    const waveGain = this.ctx.createGain();\n    const waveFilter = this.ctx.createBiquadFilter();\n\n    wave.type = 'sawtooth';\n    wave.frequency.setValueAtTime(200, now);\n    wave.frequency.exponentialRampToValueAtTime(80, now + 0.4);\n\n    waveFilter.type = 'lowpass';\n    waveFilter.frequency.setValueAtTime(2000, now);\n    waveFilter.frequency.exponentialRampToValueAtTime(400, now + 0.4);\n    waveFilter.Q.value = 10;\n\n    waveGain.gain.setValueAtTime(0.5, now);\n    waveGain.gain.exponentialRampToValueAtTime(0.01, now + 0.5);\n\n    wave.connect(waveFilter);\n    waveFilter.connect(waveGain);\n    waveGain.connect(this.sfxGain);\n    waveGain.connect(this.reverb!);\n\n    wave.start(now);\n    wave.stop(now + 0.5);\n\n    // Электрический треск\n    const noiseSource = this.createNoise(0.3);\n    const noiseGain = this.ctx.createGain();\n    const noiseFilter = this.ctx.createBiquadFilter();\n\n    noiseFilter.type = 'bandpass';\n    noiseFilter.frequency.value = 3000;\n    noiseFilter.Q.value = 5;\n\n    noiseGain.gain.setValueAtTime(0.2, now);\n    noiseGain.gain.exponentialRampToValueAtTime(0.01, now + 0.25);\n\n    noiseSource.connect(noiseFilter);\n    noiseFilter.connect(noiseGain);\n    noiseGain.connect(this.sfxGain);\n\n    // Высокий тон резонанса\n    const resonance = this.ctx.createOscillator();\n    const resonanceGain = this.ctx.createGain();\n\n    resonance.type = 'sine';\n    resonance.frequency.setValueAtTime(800, now);\n    resonance.frequency.exponentialRampToValueAtTime(400, now + 0.3);\n\n    resonanceGain.gain.setValueAtTime(0.15, now);\n    resonanceGain.gain.exponentialRampToValueAtTime(0.01, now + 0.35);\n\n    resonance.connect(resonanceGain);\n    resonanceGain.connect(this.sfxGain);\n\n    resonance.start(now);\n    resonance.stop(now + 0.4);\n\n    // Суб-бас удар\n    const subBass = this.ctx.createOscillator();\n    const subGain = this.ctx.createGain();\n\n    subBass.type = 'sine';\n    subBass.frequency.setValueAtTime(60, now);\n    subBass.frequency.exponentialRampToValueAtTime(30, now + 0.3);\n\n    subGain.gain.setValueAtTime(0.6, now);\n    subGain.gain.exponentialRampToValueAtTime(0.01, now + 0.4);\n\n    subBass.connect(subGain);\n    subGain.connect(this.sfxGain);\n\n    subBass.start(now);\n    subBass.stop(now + 0.45);\n  }\n\n  /** Подбор заряда катаны - электрический эффект */\n  private playChargePickup(): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    const now = this.ctx.currentTime;\n\n    // Нарастающий электрический звук\n    const charge = this.ctx.createOscillator();\n    const charge2 = this.ctx.createOscillator();\n    const chargeGain = this.ctx.createGain();\n    const chargeFilter = this.ctx.createBiquadFilter();\n\n    charge.type = 'sawtooth';\n    charge.frequency.setValueAtTime(150, now);\n    charge.frequency.exponentialRampToValueAtTime(800, now + 0.3);\n\n    charge2.type = 'square';\n    charge2.frequency.setValueAtTime(152, now);\n    charge2.frequency.exponentialRampToValueAtTime(810, now + 0.3);\n\n    chargeFilter.type = 'bandpass';\n    chargeFilter.frequency.setValueAtTime(500, now);\n    chargeFilter.frequency.exponentialRampToValueAtTime(2000, now + 0.3);\n    chargeFilter.Q.value = 8;\n\n    chargeGain.gain.setValueAtTime(0.15, now);\n    chargeGain.gain.linearRampToValueAtTime(0.35, now + 0.2);\n    chargeGain.gain.exponentialRampToValueAtTime(0.01, now + 0.5);\n\n    charge.connect(chargeFilter);\n    charge2.connect(chargeFilter);\n    chargeFilter.connect(chargeGain);\n    chargeGain.connect(this.sfxGain);\n    chargeGain.connect(this.reverb!);\n\n    charge.start(now);\n    charge.stop(now + 0.5);\n    charge2.start(now);\n    charge2.stop(now + 0.5);\n\n    // Высокий блеск энергии\n    const shimmer = this.ctx.createOscillator();\n    const shimmerGain = this.ctx.createGain();\n\n    shimmer.type = 'sine';\n    shimmer.frequency.value = 2500;\n\n    shimmerGain.gain.setValueAtTime(0.12, now + 0.15);\n    shimmerGain.gain.exponentialRampToValueAtTime(0.01, now + 0.5);\n\n    shimmer.connect(shimmerGain);\n    shimmerGain.connect(this.reverb!);\n\n    shimmer.start(now + 0.15);\n    shimmer.stop(now + 0.55);\n\n    // Электрический треск\n    const noiseSource2 = this.createNoise(0.2);\n    const noiseGain2 = this.ctx.createGain();\n    const noiseFilter2 = this.ctx.createBiquadFilter();\n\n    noiseFilter2.type = 'highpass';\n    noiseFilter2.frequency.value = 4000;\n\n    noiseGain2.gain.setValueAtTime(0.1, now + 0.1);\n    noiseGain2.gain.exponentialRampToValueAtTime(0.01, now + 0.3);\n\n    noiseSource2.connect(noiseFilter2);\n    noiseFilter2.connect(noiseGain2);\n    noiseGain2.connect(this.sfxGain);\n  }\n\n  /** Кислотный плевок - звук выплёвывания */\n  private playAcidSpit(): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    const now = this.ctx.currentTime;\n\n    // Хлюпающий звук плевка\n    const spit = this.ctx.createOscillator();\n    const spitGain = this.ctx.createGain();\n\n    spit.type = 'sawtooth';\n    spit.frequency.setValueAtTime(150, now);\n    spit.frequency.exponentialRampToValueAtTime(80, now + 0.15);\n\n    spitGain.gain.setValueAtTime(0.25, now);\n    spitGain.gain.exponentialRampToValueAtTime(0.01, now + 0.2);\n\n    spit.connect(spitGain);\n    spitGain.connect(this.sfxGain);\n\n    spit.start(now);\n    spit.stop(now + 0.2);\n\n    // Свистящий звук летящей кислоты\n    const swoosh = this.ctx.createOscillator();\n    const swooshGain = this.ctx.createGain();\n    const swooshFilter = this.ctx.createBiquadFilter();\n\n    swoosh.type = 'sawtooth';\n    swoosh.frequency.setValueAtTime(500, now + 0.1);\n    swoosh.frequency.exponentialRampToValueAtTime(150, now + 1.2);\n\n    swooshFilter.type = 'bandpass';\n    swooshFilter.frequency.setValueAtTime(400, now);\n    swooshFilter.frequency.exponentialRampToValueAtTime(200, now + 1.0);\n    swooshFilter.Q.value = 3;\n\n    swooshGain.gain.setValueAtTime(0, now);\n    swooshGain.gain.linearRampToValueAtTime(0.15, now + 0.1);\n    swooshGain.gain.exponentialRampToValueAtTime(0.01, now + 1.2);\n\n    swoosh.connect(swooshFilter);\n    swooshFilter.connect(swooshGain);\n    swooshGain.connect(this.sfxGain);\n\n    swoosh.start(now);\n    swoosh.stop(now + 1.2);\n  }\n\n  /** Всплеск кислоты - приземление снаряда */\n  public playAcidSplash(): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    const now = this.ctx.currentTime;\n\n    // Мощный плюх\n    const splash = this.createNoise(0.8);\n    const splashGain = this.ctx.createGain();\n    const splashFilter = this.ctx.createBiquadFilter();\n\n    splashFilter.type = 'lowpass';\n    splashFilter.frequency.setValueAtTime(1200, now);\n    splashFilter.frequency.exponentialRampToValueAtTime(400, now + 0.3);\n\n    splashGain.gain.setValueAtTime(0.4, now);\n    splashGain.gain.exponentialRampToValueAtTime(0.01, now + 0.5);\n\n    splash.connect(splashFilter);\n    splashFilter.connect(splashGain);\n    splashGain.connect(this.sfxGain);\n\n    // Шипение кислоты\n    const hiss = this.createNoise(2.0);\n    const hissGain = this.ctx.createGain();\n    const hissFilter = this.ctx.createBiquadFilter();\n\n    hissFilter.type = 'highpass';\n    hissFilter.frequency.value = 3500;\n\n    hissGain.gain.setValueAtTime(0, now + 0.1);\n    hissGain.gain.linearRampToValueAtTime(0.2, now + 0.2);\n    hissGain.gain.exponentialRampToValueAtTime(0.01, now + 2.0);\n\n    hiss.connect(hissFilter);\n    hissFilter.connect(hissGain);\n    hissGain.connect(this.sfxGain);\n\n    // Низкочастотный удар\n    const impact = this.ctx.createOscillator();\n    const impactGain = this.ctx.createGain();\n\n    impact.type = 'sine';\n    impact.frequency.setValueAtTime(80, now);\n    impact.frequency.exponentialRampToValueAtTime(40, now + 0.2);\n\n    impactGain.gain.setValueAtTime(0.35, now);\n    impactGain.gain.exponentialRampToValueAtTime(0.01, now + 0.3);\n\n    impact.connect(impactGain);\n    impactGain.connect(this.sfxGain);\n\n    impact.start(now);\n    impact.stop(now + 0.3);\n  }\n\n  /** Звук установки метки для кислотного дождя - зловещее предупреждение */\n  public playAcidRainMark(): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    const now = this.ctx.currentTime;\n\n    // Нарастающий тревожный тон\n    const warn = this.ctx.createOscillator();\n    const warnGain = this.ctx.createGain();\n    const warnFilter = this.ctx.createBiquadFilter();\n\n    warn.type = 'sawtooth';\n    warn.frequency.setValueAtTime(200, now);\n    warn.frequency.exponentialRampToValueAtTime(600, now + 1.0);\n\n    warnFilter.type = 'bandpass';\n    warnFilter.frequency.setValueAtTime(400, now);\n    warnFilter.Q.value = 5;\n\n    warnGain.gain.setValueAtTime(0.1, now);\n    warnGain.gain.linearRampToValueAtTime(0.25, now + 0.8);\n    warnGain.gain.exponentialRampToValueAtTime(0.01, now + 1.2);\n\n    warn.connect(warnFilter);\n    warnFilter.connect(warnGain);\n    warnGain.connect(this.sfxGain);\n\n    warn.start(now);\n    warn.stop(now + 1.2);\n\n    // Пульсирующий сигнал тревоги\n    for (let i = 0; i < 3; i++) {\n      const beep = this.ctx.createOscillator();\n      const beepGain = this.ctx.createGain();\n\n      beep.type = 'square';\n      beep.frequency.value = 800;\n\n      beepGain.gain.setValueAtTime(0, now + i * 0.3);\n      beepGain.gain.linearRampToValueAtTime(0.1, now + i * 0.3 + 0.05);\n      beepGain.gain.exponentialRampToValueAtTime(0.01, now + i * 0.3 + 0.15);\n\n      beep.connect(beepGain);\n      beepGain.connect(this.sfxGain);\n\n      beep.start(now + i * 0.3);\n      beep.stop(now + i * 0.3 + 0.2);\n    }\n  }\n\n  /** Звук начала кислотного дождя - шипение и хлещущий звук */\n  public playAcidRainStart(): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    const now = this.ctx.currentTime;\n\n    // Мощный шум падающей жидкости\n    const rain = this.createNoise(3.0);\n    const rainGain = this.ctx.createGain();\n    const rainFilter = this.ctx.createBiquadFilter();\n\n    rainFilter.type = 'bandpass';\n    rainFilter.frequency.value = 2000;\n    rainFilter.Q.value = 1;\n\n    rainGain.gain.setValueAtTime(0, now);\n    rainGain.gain.linearRampToValueAtTime(0.3, now + 0.2);\n    rainGain.gain.setValueAtTime(0.25, now + 2.5);\n    rainGain.gain.exponentialRampToValueAtTime(0.01, now + 3.0);\n\n    rain.connect(rainFilter);\n    rainFilter.connect(rainGain);\n    rainGain.connect(this.sfxGain);\n\n    // Шипение кислоты\n    const hiss = this.createNoise(3.0);\n    const hissGain = this.ctx.createGain();\n    const hissFilter = this.ctx.createBiquadFilter();\n\n    hissFilter.type = 'highpass';\n    hissFilter.frequency.value = 5000;\n\n    hissGain.gain.setValueAtTime(0, now + 0.1);\n    hissGain.gain.linearRampToValueAtTime(0.15, now + 0.3);\n    hissGain.gain.exponentialRampToValueAtTime(0.01, now + 3.0);\n\n    hiss.connect(hissFilter);\n    hissFilter.connect(hissGain);\n    hissGain.connect(this.sfxGain);\n\n    // Низкий гул\n    const rumble = this.ctx.createOscillator();\n    const rumbleGain = this.ctx.createGain();\n\n    rumble.type = 'sine';\n    rumble.frequency.value = 50;\n\n    rumbleGain.gain.setValueAtTime(0.2, now);\n    rumbleGain.gain.exponentialRampToValueAtTime(0.01, now + 2.0);\n\n    rumble.connect(rumbleGain);\n    rumbleGain.connect(this.sfxGain);\n\n    rumble.start(now);\n    rumble.stop(now + 2.0);\n  }\n\n  /** Звук предупреждения о боссе */\n  public playBossWarning(): void {\n    if (!this.ctx || !this.sfxGain) return;\n\n    const now = this.ctx.currentTime;\n\n    // Эпичный гонг\n    const gong = this.ctx.createOscillator();\n    const gongGain = this.ctx.createGain();\n\n    gong.type = 'sine';\n    gong.frequency.setValueAtTime(120, now);\n    gong.frequency.exponentialRampToValueAtTime(80, now + 2.0);\n\n    gongGain.gain.setValueAtTime(0.5, now);\n    gongGain.gain.exponentialRampToValueAtTime(0.01, now + 2.5);\n\n    gong.connect(gongGain);\n    gongGain.connect(this.sfxGain);\n    gongGain.connect(this.reverb!);\n\n    gong.start(now);\n    gong.stop(now + 2.5);\n\n    // Второй гонг повыше\n    const gong2 = this.ctx.createOscillator();\n    const gong2Gain = this.ctx.createGain();\n\n    gong2.type = 'sine';\n    gong2.frequency.setValueAtTime(180, now + 0.5);\n    gong2.frequency.exponentialRampToValueAtTime(100, now + 2.5);\n\n    gong2Gain.gain.setValueAtTime(0.3, now + 0.5);\n    gong2Gain.gain.exponentialRampToValueAtTime(0.01, now + 3.0);\n\n    gong2.connect(gong2Gain);\n    gong2Gain.connect(this.sfxGain);\n    gong2Gain.connect(this.reverb!);\n\n    gong2.start(now + 0.5);\n    gong2.stop(now + 3.0);\n\n    // Зловещий шёпот (шум)\n    const whisper = this.createNoise(2.0);\n    const whisperGain = this.ctx.createGain();\n    const whisperFilter = this.ctx.createBiquadFilter();\n\n    whisperFilter.type = 'bandpass';\n    whisperFilter.frequency.value = 800;\n    whisperFilter.Q.value = 5;\n\n    whisperGain.gain.setValueAtTime(0, now + 1.0);\n    whisperGain.gain.linearRampToValueAtTime(0.1, now + 1.5);\n    whisperGain.gain.exponentialRampToValueAtTime(0.01, now + 2.5);\n\n    whisper.connect(whisperFilter);\n    whisperFilter.connect(whisperGain);\n    whisperGain.connect(this.reverb!);\n  }\n\n  // ==================== SYNTHWAVE МУЗЫКА ====================\n\n  private arpInterval: number | null = null;\n\n  /** Текущий режим музыки */\n  private currentMusicMode: 'normal' | 'low_hp' | 'boss_green' | 'boss_black' | 'boss_blue' = 'normal';\n  \n  /** Интервалы музыки для остановки */\n  private musicIntervals: number[] = [];\n\n  /** Флаг тревожного режима */\n  private isLowHpMode = false;\n\n  /** Текущая эпоха (1-3) */\n  private currentEra = 1;\n\n  /** Звук дождя и грома */\n  private rainGain: GainNode | null = null;\n  private rainSource: AudioBufferSourceNode | null = null;\n  private isRainPlaying = false;\n  private thunderInterval: number | null = null;\n\n  /** Установить эпоху музыки */\n  public setEra(wave: number): void {\n    let newEra = 1;\n    if (wave > 10) newEra = 3;\n    else if (wave > 5) newEra = 2;\n\n    // Включаем дождь на волне 15+\n    if (wave >= 15 && !this.isRainPlaying) {\n      this.startRain();\n    } else if (wave < 15 && this.isRainPlaying) {\n      this.stopRain();\n    }\n\n    if (newEra !== this.currentEra && this.currentMusicMode === 'normal') {\n      this.currentEra = newEra;\n      // Перезапускаем музыку для новой эпохи\n      for (const interval of this.musicIntervals) {\n        clearInterval(interval);\n        clearTimeout(interval);\n      }\n      this.musicIntervals = [];\n      this.startSynthwaveMusic();\n    } else {\n      this.currentEra = newEra;\n    }\n  }\n\n  /** Запуск звука дождя */\n  private startRain(): void {\n    if (!this.ctx || !this.masterGain || this.isRainPlaying) return;\n\n    this.isRainPlaying = true;\n\n    // Создаём gain для дождя\n    this.rainGain = this.ctx.createGain();\n    this.rainGain.gain.value = 0;\n    this.rainGain.connect(this.masterGain);\n\n    // Создаём буфер с шумом дождя (белый шум + фильтр)\n    const sampleRate = this.ctx.sampleRate;\n    const duration = 4; // 4 секунды зациклированного шума\n    const bufferSize = sampleRate * duration;\n    const buffer = this.ctx.createBuffer(2, bufferSize, sampleRate);\n\n    // Заполняем буфер шумом капель\n    for (let channel = 0; channel < 2; channel++) {\n      const data = buffer.getChannelData(channel);\n      for (let i = 0; i < bufferSize; i++) {\n        // Базовый шум\n        let sample = (Math.random() * 2 - 1) * 0.3;\n        \n        // Добавляем случайные \"капли\" - короткие щелчки\n        if (Math.random() < 0.001) {\n          sample += (Math.random() * 2 - 1) * 0.8;\n        }\n        \n        // Добавляем низкочастотный гул ветра\n        sample += Math.sin(i / sampleRate * 2 * Math.PI * 0.5) * 0.05;\n        \n        data[i] = sample;\n      }\n    }\n\n    // Создаём источник\n    this.rainSource = this.ctx.createBufferSource();\n    this.rainSource.buffer = buffer;\n    this.rainSource.loop = true;\n\n    // Низкочастотный фильтр для реалистичного звука дождя\n    const lowpass = this.ctx.createBiquadFilter();\n    lowpass.type = 'lowpass';\n    lowpass.frequency.value = 3000;\n    lowpass.Q.value = 0.5;\n\n    // Highpass для убирания низкого гула\n    const highpass = this.ctx.createBiquadFilter();\n    highpass.type = 'highpass';\n    highpass.frequency.value = 200;\n    highpass.Q.value = 0.5;\n\n    this.rainSource.connect(highpass);\n    highpass.connect(lowpass);\n    lowpass.connect(this.rainGain);\n\n    this.rainSource.start();\n\n    // Плавное нарастание громкости\n    this.rainGain.gain.linearRampToValueAtTime(0.25, this.ctx.currentTime + 2);\n\n    // Запускаем периодические раскаты грома\n    this.startThunder();\n  }\n\n  /** Запуск звуков грома */\n  private startThunder(): void {\n    if (!this.ctx || !this.masterGain) return;\n\n    const playThunder = () => {\n      if (!this.ctx || !this.masterGain || !this.isRainPlaying) return;\n\n      const now = this.ctx.currentTime;\n\n      // Создаём gain для грома\n      const thunderGain = this.ctx.createGain();\n      thunderGain.gain.value = 0;\n      thunderGain.connect(this.masterGain);\n\n      // === НИЗКИЙ РАСКАТ ГРОМА ===\n      // Шум для грома\n      const noiseBuffer = this.ctx.createBuffer(1, this.ctx.sampleRate * 3, this.ctx.sampleRate);\n      const noiseData = noiseBuffer.getChannelData(0);\n      for (let i = 0; i < noiseData.length; i++) {\n        noiseData[i] = (Math.random() * 2 - 1) * Math.exp(-i / (this.ctx.sampleRate * 0.8));\n      }\n\n      const noiseSource = this.ctx.createBufferSource();\n      noiseSource.buffer = noiseBuffer;\n\n      // Низкочастотный фильтр для грома\n      const lowpass = this.ctx.createBiquadFilter();\n      lowpass.type = 'lowpass';\n      lowpass.frequency.value = 150 + Math.random() * 100;\n      lowpass.Q.value = 1;\n\n      noiseSource.connect(lowpass);\n      lowpass.connect(thunderGain);\n\n      // === ТРЕСК МОЛНИИ ===\n      const crackOsc = this.ctx.createOscillator();\n      crackOsc.type = 'sawtooth';\n      crackOsc.frequency.value = 80 + Math.random() * 40;\n\n      const crackGain = this.ctx.createGain();\n      crackGain.gain.value = 0;\n\n      const crackFilter = this.ctx.createBiquadFilter();\n      crackFilter.type = 'bandpass';\n      crackFilter.frequency.value = 2000;\n      crackFilter.Q.value = 2;\n\n      crackOsc.connect(crackFilter);\n      crackFilter.connect(crackGain);\n      crackGain.connect(thunderGain);\n\n      // Огибающая грома - нарастание и долгий спад\n      thunderGain.gain.setValueAtTime(0, now);\n      thunderGain.gain.linearRampToValueAtTime(0.6, now + 0.1);\n      thunderGain.gain.exponentialRampToValueAtTime(0.01, now + 2.5);\n\n      // Огибающая треска - короткий резкий\n      crackGain.gain.setValueAtTime(0, now);\n      crackGain.gain.linearRampToValueAtTime(0.4, now + 0.02);\n      crackGain.gain.exponentialRampToValueAtTime(0.01, now + 0.2);\n\n      noiseSource.start(now);\n      crackOsc.start(now);\n      noiseSource.stop(now + 3);\n      crackOsc.stop(now + 0.3);\n    };\n\n    // Первый гром через 2-4 секунды\n    setTimeout(playThunder, 2000 + Math.random() * 2000);\n\n    // Периодические раскаты каждые 3-6 секунд\n    this.thunderInterval = setInterval(() => {\n      if (this.isRainPlaying) {\n        playThunder();\n      }\n    }, 3000 + Math.random() * 3000) as unknown as number;\n  }\n\n  /** Остановка звука дождя */\n  private stopRain(): void {\n    if (!this.ctx || !this.isRainPlaying) return;\n\n    this.isRainPlaying = false;\n\n    // Останавливаем грозу\n    if (this.thunderInterval) {\n      clearInterval(this.thunderInterval);\n      this.thunderInterval = null;\n    }\n\n    // Плавное затухание\n    if (this.rainGain) {\n      this.rainGain.gain.linearRampToValueAtTime(0, this.ctx.currentTime + 1);\n    }\n\n    // Останавливаем источник через секунду\n    setTimeout(() => {\n      if (this.rainSource) {\n        try {\n          this.rainSource.stop();\n        } catch (e) {\n          // Уже остановлен\n        }\n        this.rainSource = null;\n      }\n      this.rainGain = null;\n    }, 1100);\n  }\n\n  /** Запустить synthwave музыку */\n  private startSynthwaveMusic(): void {\n    if (!this.ctx || !this.musicGain) return;\n\n    switch (this.currentEra) {\n      case 1:\n        this.playEra1Music(); // Кислотная\n        break;\n      case 2:\n        this.playEra2Music(); // Чёрная дыра\n        break;\n      case 3:\n        this.playEra3Music(); // Космическая\n        break;\n    }\n  }\n\n  /** ЭПОХА 1: Спокойный эмбиент (волны 1-5) */\n  private playEra1Music(): void {\n    if (!this.ctx || !this.musicGain) return;\n\n    // Мягкий дрон - основа\n    const playDrone = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'normal' || this.currentEra !== 1) return;\n\n      const now = this.ctx.currentTime;\n      \n      // Основной тон\n      const osc1 = this.ctx.createOscillator();\n      const osc2 = this.ctx.createOscillator();\n      const lfo = this.ctx.createOscillator();\n      const lfoGain = this.ctx.createGain();\n      const filter = this.ctx.createBiquadFilter();\n      const gain = this.ctx.createGain();\n\n      // Мягкие волны\n      osc1.type = 'sine';\n      osc1.frequency.value = 82.4; // E2\n      osc2.type = 'triangle';\n      osc2.frequency.value = 82.6; // Лёгкие биения\n\n      // Медленная модуляция\n      lfo.type = 'sine';\n      lfo.frequency.value = 0.05; // Очень медленно\n      lfoGain.gain.value = 3;\n      lfo.connect(lfoGain);\n      lfoGain.connect(osc1.frequency);\n\n      // Мягкий фильтр\n      filter.type = 'lowpass';\n      filter.frequency.value = 400;\n      filter.Q.value = 0.5;\n\n      // Плавное появление и затухание\n      gain.gain.setValueAtTime(0, now);\n      gain.gain.linearRampToValueAtTime(0.08, now + 3);\n      gain.gain.linearRampToValueAtTime(0.06, now + 6);\n      gain.gain.linearRampToValueAtTime(0, now + 9);\n\n      osc1.connect(filter);\n      osc2.connect(filter);\n      filter.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc1.start(now);\n      osc2.start(now);\n      lfo.start(now);\n      osc1.stop(now + 10);\n      osc2.stop(now + 10);\n      lfo.stop(now + 10);\n    };\n\n    // Запускаем дрон каждые 8 секунд (с перекрытием)\n    playDrone();\n    this.musicIntervals.push(setInterval(playDrone, 8000) as unknown as number);\n\n    // Атмосферный pad - меняющиеся аккорды\n    const padNotes = [\n      [164.8, 196, 246.9],   // E3 G3 B3 (Em)\n      [146.8, 185, 220],     // D3 F#3 A3 (D)\n      [130.8, 164.8, 196],   // C3 E3 G3 (C)\n      [146.8, 174.6, 220],   // D3 F3 A3 (Dm)\n    ];\n    let padIndex = 0;\n\n    const playPad = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'normal' || this.currentEra !== 1) return;\n\n      const now = this.ctx.currentTime;\n      const notes = padNotes[padIndex];\n      const filter = this.ctx.createBiquadFilter();\n      const gain = this.ctx.createGain();\n\n      filter.type = 'lowpass';\n      filter.frequency.value = 600;\n      filter.Q.value = 0.7;\n\n      // Очень плавное появление\n      gain.gain.setValueAtTime(0, now);\n      gain.gain.linearRampToValueAtTime(0.04, now + 2);\n      gain.gain.linearRampToValueAtTime(0.03, now + 4);\n      gain.gain.linearRampToValueAtTime(0, now + 6);\n\n      notes.forEach((freq, i) => {\n        const osc = this.ctx!.createOscillator();\n        osc.type = 'sine';\n        osc.frequency.value = freq;\n        \n        // Небольшая расстройка для глубины\n        if (i > 0) osc.detune.value = (Math.random() - 0.5) * 5;\n        \n        osc.connect(filter);\n        osc.start(now);\n        osc.stop(now + 7);\n      });\n\n      filter.connect(gain);\n      gain.connect(this.musicGain!);\n\n      padIndex = (padIndex + 1) % padNotes.length;\n    };\n\n    // Pad каждые 5 секунд\n    setTimeout(() => playPad(), 2000);\n    this.musicIntervals.push(setInterval(playPad, 5000) as unknown as number);\n\n    // Редкие высокие \"звёзды\" - мерцающие ноты\n    const playShimmer = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'normal' || this.currentEra !== 1) return;\n\n      const now = this.ctx.currentTime;\n      const osc = this.ctx.createOscillator();\n      const gain = this.ctx.createGain();\n\n      // Высокие ноты с вибрато\n      const freqs = [659, 784, 988, 1175, 1319]; // E5, G5, B5, D6, E6\n      osc.type = 'sine';\n      osc.frequency.value = freqs[Math.floor(Math.random() * freqs.length)];\n\n      // Очень тихо и мягко\n      gain.gain.setValueAtTime(0, now);\n      gain.gain.linearRampToValueAtTime(0.015, now + 0.5);\n      gain.gain.linearRampToValueAtTime(0, now + 3);\n\n      osc.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 3.5);\n    };\n\n    // Shimmer редко и случайно\n    const shimmerLoop = () => {\n      if (this.currentMusicMode !== 'normal' || this.currentEra !== 1) return;\n      playShimmer();\n      const nextDelay = 3000 + Math.random() * 5000; // 3-8 секунд\n      this.musicIntervals.push(setTimeout(shimmerLoop, nextDelay) as unknown as number);\n    };\n    setTimeout(shimmerLoop, 4000);\n  }\n\n  /** ЭПОХА 2: Чёрная дыра (волны 6-10) */\n  private playEra2Music(): void {\n    if (!this.ctx || !this.musicGain) return;\n\n    // Глубокий мрачный дрон\n    const playDrone = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'normal' || this.currentEra !== 2) return;\n\n      const now = this.ctx.currentTime;\n      const osc = this.ctx.createOscillator();\n      const osc2 = this.ctx.createOscillator();\n      const lfo = this.ctx.createOscillator();\n      const lfoGain = this.ctx.createGain();\n      const gain = this.ctx.createGain();\n      const filter = this.ctx.createBiquadFilter();\n\n      osc.type = 'sawtooth';\n      osc.frequency.value = 41; // E1 - очень низкий\n\n      osc2.type = 'triangle';\n      osc2.frequency.value = 41.2; // Биения\n\n      lfo.type = 'sine';\n      lfo.frequency.value = 0.1;\n      lfoGain.gain.value = 20;\n\n      lfo.connect(lfoGain);\n      lfoGain.connect(osc.frequency);\n\n      filter.type = 'lowpass';\n      filter.frequency.value = 150;\n\n      gain.gain.setValueAtTime(0.12, now);\n      gain.gain.linearRampToValueAtTime(0.08, now + 3);\n      gain.gain.exponentialRampToValueAtTime(0.01, now + 4);\n\n      osc.connect(filter);\n      osc2.connect(filter);\n      filter.connect(gain);\n      gain.connect(this.musicGain!);\n\n      lfo.start(now);\n      osc.start(now);\n      osc2.start(now);\n      lfo.stop(now + 4);\n      osc.stop(now + 4);\n      osc2.stop(now + 4);\n    };\n\n    playDrone();\n    this.musicIntervals.push(setInterval(playDrone, 4000) as unknown as number);\n\n    // Медленный тяжёлый бит\n    let beat = 0;\n    const playBeat = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'normal' || this.currentEra !== 2) return;\n\n      const now = this.ctx.currentTime;\n\n      if (beat % 2 === 0) {\n        // Глухой удар\n        const osc = this.ctx.createOscillator();\n        const gain = this.ctx.createGain();\n\n        osc.type = 'sine';\n        osc.frequency.setValueAtTime(80, now);\n        osc.frequency.exponentialRampToValueAtTime(20, now + 0.3);\n\n        gain.gain.setValueAtTime(0.3, now);\n        gain.gain.exponentialRampToValueAtTime(0.01, now + 0.4);\n\n        osc.connect(gain);\n        gain.connect(this.musicGain!);\n\n        osc.start(now);\n        osc.stop(now + 0.4);\n      }\n\n      beat++;\n    };\n\n    this.musicIntervals.push(setInterval(playBeat, 600) as unknown as number);\n\n    // Жуткие высокие тона\n    const playEerie = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'normal' || this.currentEra !== 2) return;\n\n      const now = this.ctx.currentTime;\n      const freq = 600 + Math.random() * 400;\n\n      const osc = this.ctx.createOscillator();\n      const gain = this.ctx.createGain();\n\n      osc.type = 'sine';\n      osc.frequency.setValueAtTime(freq, now);\n      osc.frequency.linearRampToValueAtTime(freq * 0.7, now + 2);\n\n      gain.gain.setValueAtTime(0, now);\n      gain.gain.linearRampToValueAtTime(0.04, now + 0.5);\n      gain.gain.linearRampToValueAtTime(0, now + 2);\n\n      osc.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 2);\n    };\n\n    this.musicIntervals.push(setInterval(playEerie, 3000 + Math.random() * 2000) as unknown as number);\n\n    // Гравитационный шум\n    const playGravity = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'normal' || this.currentEra !== 2) return;\n\n      const now = this.ctx.currentTime;\n\n      const bufferSize = this.ctx.sampleRate * 0.5;\n      const buffer = this.ctx.createBuffer(1, bufferSize, this.ctx.sampleRate);\n      const data = buffer.getChannelData(0);\n      \n      for (let i = 0; i < bufferSize; i++) {\n        data[i] = (Math.random() * 2 - 1) * Math.exp(-i / (bufferSize * 0.5));\n      }\n\n      const noise = this.ctx.createBufferSource();\n      noise.buffer = buffer;\n\n      const filter = this.ctx.createBiquadFilter();\n      filter.type = 'lowpass';\n      filter.frequency.value = 200;\n\n      const gain = this.ctx.createGain();\n      gain.gain.setValueAtTime(0.08, now);\n      gain.gain.exponentialRampToValueAtTime(0.01, now + 0.5);\n\n      noise.connect(filter);\n      filter.connect(gain);\n      gain.connect(this.musicGain!);\n\n      noise.start(now);\n      noise.stop(now + 0.5);\n    };\n\n    this.musicIntervals.push(setInterval(playGravity, 1500) as unknown as number);\n  }\n\n  /** ЭПОХА 3: Космическая технологическая (волны 11-15) */\n  private playEra3Music(): void {\n    if (!this.ctx || !this.musicGain) return;\n\n    // Быстрый синтвейв бас\n    const bassNotes = [110, 110, 146.8, 110, 130.8, 110, 164.8, 146.8];\n    let noteIndex = 0;\n\n    const playBass = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'normal' || this.currentEra !== 3) return;\n\n      const now = this.ctx.currentTime;\n      const osc = this.ctx.createOscillator();\n      const filter = this.ctx.createBiquadFilter();\n      const gain = this.ctx.createGain();\n\n      osc.type = 'sawtooth';\n      osc.frequency.value = bassNotes[noteIndex];\n\n      filter.type = 'lowpass';\n      filter.frequency.setValueAtTime(400, now);\n      filter.frequency.exponentialRampToValueAtTime(150, now + 0.15);\n\n      gain.gain.setValueAtTime(0.12, now);\n      gain.gain.exponentialRampToValueAtTime(0.01, now + 0.2);\n\n      osc.connect(filter);\n      filter.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 0.22);\n\n      noteIndex = (noteIndex + 1) % bassNotes.length;\n    };\n\n    this.musicIntervals.push(setInterval(playBass, 200) as unknown as number);\n\n    // Космическое арпеджио (высокое)\n    const arpNotes = [880, 1046, 1318, 1760, 1318, 1046, 880, 659];\n    let arpIndex = 0;\n\n    const playArp = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'normal' || this.currentEra !== 3) return;\n\n      const now = this.ctx.currentTime;\n      const osc = this.ctx.createOscillator();\n      const gain = this.ctx.createGain();\n      const delay = this.ctx.createDelay();\n      const delayGain = this.ctx.createGain();\n\n      osc.type = 'triangle';\n      osc.frequency.value = arpNotes[arpIndex];\n\n      delay.delayTime.value = 0.15;\n      delayGain.gain.value = 0.3;\n\n      gain.gain.setValueAtTime(0.05, now);\n      gain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);\n\n      osc.connect(gain);\n      osc.connect(delay);\n      delay.connect(delayGain);\n      delayGain.connect(this.musicGain!);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 0.12);\n\n      arpIndex = (arpIndex + 1) % arpNotes.length;\n    };\n\n    this.musicIntervals.push(setInterval(playArp, 100) as unknown as number);\n\n    // Техно кик\n    const playKick = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'normal' || this.currentEra !== 3) return;\n\n      const now = this.ctx.currentTime;\n      const osc = this.ctx.createOscillator();\n      const gain = this.ctx.createGain();\n\n      osc.type = 'sine';\n      osc.frequency.setValueAtTime(200, now);\n      osc.frequency.exponentialRampToValueAtTime(50, now + 0.08);\n\n      gain.gain.setValueAtTime(0.2, now);\n      gain.gain.exponentialRampToValueAtTime(0.01, now + 0.12);\n\n      osc.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 0.12);\n    };\n\n    this.musicIntervals.push(setInterval(playKick, 400) as unknown as number);\n\n    // Космический пэд\n    const playPad = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'normal' || this.currentEra !== 3) return;\n\n      const now = this.ctx.currentTime;\n      const chord = [220, 277, 330, 440]; // Am7\n\n      for (const freq of chord) {\n        const osc = this.ctx.createOscillator();\n        const gain = this.ctx.createGain();\n\n        osc.type = 'sine';\n        osc.frequency.value = freq;\n\n        gain.gain.setValueAtTime(0, now);\n        gain.gain.linearRampToValueAtTime(0.03, now + 0.5);\n        gain.gain.linearRampToValueAtTime(0.02, now + 2);\n        gain.gain.linearRampToValueAtTime(0, now + 3);\n\n        osc.connect(gain);\n        gain.connect(this.musicGain!);\n\n        osc.start(now);\n        osc.stop(now + 3.5);\n      }\n    };\n\n    playPad();\n    this.musicIntervals.push(setInterval(playPad, 4000) as unknown as number);\n\n    // Электрические разряды\n    const playZap = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'normal' || this.currentEra !== 3) return;\n\n      const now = this.ctx.currentTime;\n\n      const osc = this.ctx.createOscillator();\n      const gain = this.ctx.createGain();\n\n      osc.type = 'sawtooth';\n      osc.frequency.setValueAtTime(1500 + Math.random() * 1000, now);\n      osc.frequency.exponentialRampToValueAtTime(100, now + 0.1);\n\n      gain.gain.setValueAtTime(0.06, now);\n      gain.gain.exponentialRampToValueAtTime(0.001, now + 0.1);\n\n      osc.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 0.1);\n    };\n\n    this.musicIntervals.push(setInterval(playZap, 800 + Math.random() * 600) as unknown as number);\n  }\n\n  /** Включить/выключить режим низкого HP */\n  public setLowHpMode(enabled: boolean): void {\n    if (!this.ctx || !this.musicGain) return;\n    \n    // Не переключаем если сейчас босс\n    if (this.currentMusicMode !== 'normal' && this.currentMusicMode !== 'low_hp') return;\n    \n    if (enabled && !this.isLowHpMode) {\n      // Включаем тревожный режим\n      this.isLowHpMode = true;\n      this.currentMusicMode = 'low_hp';\n      \n      // Останавливаем обычную музыку\n      for (const interval of this.musicIntervals) {\n        clearInterval(interval);\n        clearTimeout(interval);\n      }\n      this.musicIntervals = [];\n      \n      this.playLowHpMusic();\n      \n    } else if (!enabled && this.isLowHpMode) {\n      // Выключаем тревожный режим\n      this.isLowHpMode = false;\n      this.currentMusicMode = 'normal';\n      \n      // Останавливаем тревожную музыку\n      for (const interval of this.musicIntervals) {\n        clearInterval(interval);\n        clearTimeout(interval);\n      }\n      this.musicIntervals = [];\n      \n      this.startSynthwaveMusic();\n    }\n  }\n\n  /** Тревожная музыка при низком HP */\n  private playLowHpMusic(): void {\n    if (!this.ctx || !this.musicGain) return;\n\n    // === ТРЕВОЖНЫЙ ПУЛЬС ===\n    const playHeartbeat = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'low_hp') return;\n\n      const now = this.ctx.currentTime;\n\n      // Двойной удар сердца\n      for (let i = 0; i < 2; i++) {\n        const osc = this.ctx.createOscillator();\n        const gain = this.ctx.createGain();\n\n        osc.type = 'sine';\n        osc.frequency.value = 40;\n\n        const offset = i * 0.15;\n        gain.gain.setValueAtTime(0, now + offset);\n        gain.gain.linearRampToValueAtTime(0.3, now + offset + 0.05);\n        gain.gain.exponentialRampToValueAtTime(0.01, now + offset + 0.2);\n\n        osc.connect(gain);\n        gain.connect(this.musicGain!);\n\n        osc.start(now + offset);\n        osc.stop(now + offset + 0.25);\n      }\n    };\n\n    this.musicIntervals.push(setInterval(playHeartbeat, 800) as unknown as number);\n\n    // === ТРЕВОЖНЫЙ ДРОН ===\n    const playDrone = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'low_hp') return;\n\n      const now = this.ctx.currentTime;\n\n      const osc = this.ctx.createOscillator();\n      const osc2 = this.ctx.createOscillator();\n      const gain = this.ctx.createGain();\n      const filter = this.ctx.createBiquadFilter();\n\n      // Низкий тревожный тон\n      osc.type = 'sawtooth';\n      osc.frequency.value = 55;\n\n      osc2.type = 'sawtooth';\n      osc2.frequency.value = 55.5; // Биения для тревожности\n\n      filter.type = 'lowpass';\n      filter.frequency.value = 200;\n      filter.Q.value = 5;\n\n      gain.gain.setValueAtTime(0.1, now);\n      gain.gain.linearRampToValueAtTime(0.15, now + 1);\n      gain.gain.linearRampToValueAtTime(0.05, now + 2);\n\n      osc.connect(filter);\n      osc2.connect(filter);\n      filter.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 2.5);\n      osc2.start(now);\n      osc2.stop(now + 2.5);\n    };\n\n    playDrone();\n    this.musicIntervals.push(setInterval(playDrone, 2500) as unknown as number);\n\n    // === ИСКРЫ ===\n    const playSpark = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'low_hp') return;\n\n      const now = this.ctx.currentTime;\n\n      // Случайные искры\n      const sparkCount = 1 + Math.floor(Math.random() * 3);\n      for (let i = 0; i < sparkCount; i++) {\n        const bufferSize = Math.floor(this.ctx.sampleRate * (0.02 + Math.random() * 0.03));\n        const buffer = this.ctx.createBuffer(1, bufferSize, this.ctx.sampleRate);\n        const data = buffer.getChannelData(0);\n        \n        for (let j = 0; j < bufferSize; j++) {\n          data[j] = (Math.random() * 2 - 1) * Math.exp(-j / (bufferSize * 0.3));\n        }\n\n        const noise = this.ctx.createBufferSource();\n        noise.buffer = buffer;\n\n        const filter = this.ctx.createBiquadFilter();\n        filter.type = 'highpass';\n        filter.frequency.value = 3000 + Math.random() * 5000;\n\n        const gain = this.ctx.createGain();\n        gain.gain.setValueAtTime(0.05 + Math.random() * 0.05, now + i * 0.05);\n        gain.gain.exponentialRampToValueAtTime(0.001, now + i * 0.05 + 0.05);\n\n        noise.connect(filter);\n        filter.connect(gain);\n        gain.connect(this.musicGain!);\n\n        noise.start(now + i * 0.05);\n        noise.stop(now + i * 0.05 + 0.05);\n      }\n    };\n\n    this.musicIntervals.push(setInterval(playSpark, 500 + Math.random() * 500) as unknown as number);\n\n    // === ТРЕВОЖНЫЕ НОТЫ ===\n    const playWarning = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'low_hp') return;\n\n      const now = this.ctx.currentTime;\n\n      const osc = this.ctx.createOscillator();\n      const gain = this.ctx.createGain();\n\n      osc.type = 'square';\n      // Тревожная секунда (минорный интервал)\n      const notes = [220, 233.1]; // A3, Bb3\n      const note = notes[Math.floor(Math.random() * notes.length)];\n      osc.frequency.value = note;\n\n      gain.gain.setValueAtTime(0, now);\n      gain.gain.linearRampToValueAtTime(0.08, now + 0.1);\n      gain.gain.linearRampToValueAtTime(0.06, now + 0.3);\n      gain.gain.exponentialRampToValueAtTime(0.01, now + 0.5);\n\n      osc.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 0.5);\n    };\n\n    this.musicIntervals.push(setInterval(playWarning, 1500 + Math.random() * 1000) as unknown as number);\n\n    // === СТАТИЧЕСКИЕ ПОМЕХИ ===\n    const playStatic = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'low_hp') return;\n\n      const now = this.ctx.currentTime;\n\n      const bufferSize = this.ctx.sampleRate * 0.1;\n      const buffer = this.ctx.createBuffer(1, bufferSize, this.ctx.sampleRate);\n      const data = buffer.getChannelData(0);\n      \n      for (let i = 0; i < bufferSize; i++) {\n        // Прерывистый шум\n        data[i] = Math.random() > 0.7 ? (Math.random() * 2 - 1) * 0.5 : 0;\n      }\n\n      const noise = this.ctx.createBufferSource();\n      noise.buffer = buffer;\n\n      const filter = this.ctx.createBiquadFilter();\n      filter.type = 'bandpass';\n      filter.frequency.value = 2000;\n      filter.Q.value = 3;\n\n      const gain = this.ctx.createGain();\n      gain.gain.setValueAtTime(0.03, now);\n      gain.gain.exponentialRampToValueAtTime(0.001, now + 0.1);\n\n      noise.connect(filter);\n      filter.connect(gain);\n      gain.connect(this.musicGain!);\n\n      noise.start(now);\n      noise.stop(now + 0.1);\n    };\n\n    this.musicIntervals.push(setInterval(playStatic, 300 + Math.random() * 400) as unknown as number);\n  }\n\n  /** Фаза Зелёного Босса */\n  private bossGreenPhase = 1;\n\n  /** Переключить музыку для босса */\n  public setBossMusic(bossType: 'boss_green' | 'boss_black' | 'boss_blue' | null): void {\n    if (!this.ctx || !this.musicGain) return;\n\n    // Останавливаем все текущие интервалы\n    for (const interval of this.musicIntervals) {\n      clearInterval(interval);\n      clearTimeout(interval);\n    }\n    this.musicIntervals = [];\n    this.bossGreenPhase = 1; // Сброс фазы\n\n    if (bossType === null) {\n      // Обычная музыка\n      this.currentMusicMode = 'normal';\n      this.startSynthwaveMusic();\n    } else {\n      this.currentMusicMode = bossType;\n      \n      switch (bossType) {\n        case 'boss_green':\n          this.playBossGreenMusic();\n          break;\n        case 'boss_black':\n          this.playBossBlackMusic();\n          break;\n        case 'boss_blue':\n          this.playBossBlueMusic();\n          break;\n      }\n    }\n  }\n\n  /** Переход в фазу 2 для Зелёного Босса - добавляем БОЧКУ! */\n  public setBossGreenPhase2(): void {\n    if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'boss_green') return;\n    if (this.bossGreenPhase === 2) return; // Уже во второй фазе\n\n    this.bossGreenPhase = 2;\n\n    // === ТЯЖЁЛАЯ БОЧКА (808 стиль) ===\n    const playHeavyKick = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'boss_green') return;\n\n      const now = this.ctx.currentTime;\n\n      // Основной кик\n      const osc = this.ctx.createOscillator();\n      const osc2 = this.ctx.createOscillator();\n      const gain = this.ctx.createGain();\n      const distortion = this.ctx.createWaveShaper();\n\n      osc.type = 'sine';\n      osc.frequency.setValueAtTime(200, now);\n      osc.frequency.exponentialRampToValueAtTime(30, now + 0.15);\n\n      osc2.type = 'sine';\n      osc2.frequency.setValueAtTime(100, now);\n      osc2.frequency.exponentialRampToValueAtTime(20, now + 0.2);\n\n      // Дисторшн для грязи\n      const curve = new Float32Array(256);\n      for (let i = 0; i < 256; i++) {\n        const x = (i / 128) - 1;\n        curve[i] = Math.tanh(x * 5);\n      }\n      distortion.curve = curve;\n\n      gain.gain.setValueAtTime(0.8, now); // ГРОМЧЕ!\n      gain.gain.exponentialRampToValueAtTime(0.01, now + 0.25);\n\n      osc.connect(distortion);\n      osc2.connect(distortion);\n      distortion.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 0.25);\n      osc2.start(now);\n      osc2.stop(now + 0.25);\n    };\n\n    // Тяжёлая бочка на каждую восьмую - агрессивнее! 160 BPM\n    this.musicIntervals.push(setInterval(playHeavyKick, 187) as unknown as number);\n\n    // === ЗЛОЙ СИНТ ===\n    const playEvilSynth = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'boss_green') return;\n\n      const now = this.ctx.currentTime;\n\n      const osc = this.ctx.createOscillator();\n      const osc2 = this.ctx.createOscillator();\n      const filter = this.ctx.createBiquadFilter();\n      const gain = this.ctx.createGain();\n\n      // Два осциллятора для дисторшн эффекта\n      osc.type = 'sawtooth';\n      osc2.type = 'square';\n      \n      // Злой паттерн\n      const notes = [110, 110, 146.8, 110]; // A2, A2, D3, A2\n      const note = notes[Math.floor(Math.random() * notes.length)];\n      osc.frequency.value = note;\n      osc2.frequency.value = note * 1.5; // Квинта для агрессии\n\n      // Резонансный фильтр - ОЧЕНЬ злой\n      filter.type = 'lowpass';\n      filter.Q.value = 25;\n      filter.frequency.setValueAtTime(300, now);\n      filter.frequency.exponentialRampToValueAtTime(2000, now + 0.05);\n      filter.frequency.exponentialRampToValueAtTime(150, now + 0.15);\n\n      gain.gain.setValueAtTime(0.4, now);\n      gain.gain.exponentialRampToValueAtTime(0.01, now + 0.15);\n\n      osc.connect(filter);\n      osc2.connect(filter);\n      filter.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc2.start(now);\n      osc.stop(now + 0.2);\n      osc2.stop(now + 0.2);\n    };\n\n    // Злой синт на оффбитах\n    this.musicIntervals.push(setInterval(playEvilSynth, 93) as unknown as number);\n\n    // === СИРЕНА ТРЕВОГИ ===\n    const playAlarm = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'boss_green') return;\n\n      const now = this.ctx.currentTime;\n\n      const osc = this.ctx.createOscillator();\n      const gain = this.ctx.createGain();\n\n      osc.type = 'square';\n      osc.frequency.setValueAtTime(500, now);\n      osc.frequency.linearRampToValueAtTime(900, now + 0.15);\n      osc.frequency.linearRampToValueAtTime(500, now + 0.3);\n\n      gain.gain.setValueAtTime(0.12, now);\n      gain.gain.linearRampToValueAtTime(0.18, now + 0.15);\n      gain.gain.linearRampToValueAtTime(0.0, now + 0.3);\n\n      osc.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 0.35);\n    };\n\n    // Сирена каждые 1.5 секунды - чаще!\n    this.musicIntervals.push(setInterval(playAlarm, 1500) as unknown as number);\n  }\n\n  /** Звук вихря чёрного босса */\n  private vortexGain: GainNode | null = null;\n  private vortexOsc: OscillatorNode | null = null;\n  private vortexNoise: AudioBufferSourceNode | null = null;\n  \n  /** Флаг storm режима для музыки */\n  private isStormMode = false;\n  private stormGain: GainNode | null = null;\n\n  public playVortexSound(start: boolean): void {\n    if (!this.ctx || !this.masterGain) return;\n\n    if (start) {\n      // === ЗАПУСК ВИХРЯ ===\n      \n      // Создаём gain\n      this.vortexGain = this.ctx.createGain();\n      this.vortexGain.gain.value = 0;\n      this.vortexGain.connect(this.masterGain);\n\n      // Низкий гудящий осциллятор (ветер)\n      this.vortexOsc = this.ctx.createOscillator();\n      this.vortexOsc.type = 'sawtooth';\n      this.vortexOsc.frequency.value = 60;\n      \n      const oscGain = this.ctx.createGain();\n      oscGain.gain.value = 0.15;\n      \n      // LFO для модуляции частоты (эффект вращения)\n      const lfo = this.ctx.createOscillator();\n      lfo.type = 'sine';\n      lfo.frequency.value = 3; // 3 оборота в секунду\n      \n      const lfoGain = this.ctx.createGain();\n      lfoGain.gain.value = 30; // Модуляция ±30 Гц\n      \n      lfo.connect(lfoGain);\n      lfoGain.connect(this.vortexOsc.frequency);\n      \n      // Фильтр для глубокого звука\n      const lowpass = this.ctx.createBiquadFilter();\n      lowpass.type = 'lowpass';\n      lowpass.frequency.value = 200;\n      lowpass.Q.value = 5;\n      \n      this.vortexOsc.connect(lowpass);\n      lowpass.connect(oscGain);\n      oscGain.connect(this.vortexGain);\n      \n      // Шум ветра\n      const noiseBuffer = this.ctx.createBuffer(1, this.ctx.sampleRate * 4, this.ctx.sampleRate);\n      const noiseData = noiseBuffer.getChannelData(0);\n      for (let i = 0; i < noiseData.length; i++) {\n        noiseData[i] = (Math.random() * 2 - 1) * 0.5;\n      }\n      \n      this.vortexNoise = this.ctx.createBufferSource();\n      this.vortexNoise.buffer = noiseBuffer;\n      this.vortexNoise.loop = true;\n      \n      const noiseFilter = this.ctx.createBiquadFilter();\n      noiseFilter.type = 'bandpass';\n      noiseFilter.frequency.value = 400;\n      noiseFilter.Q.value = 2;\n      \n      const noiseGain = this.ctx.createGain();\n      noiseGain.gain.value = 0.3;\n      \n      this.vortexNoise.connect(noiseFilter);\n      noiseFilter.connect(noiseGain);\n      noiseGain.connect(this.vortexGain);\n      \n      // Запускаем всё\n      this.vortexOsc.start();\n      lfo.start();\n      this.vortexNoise.start();\n      \n      // Плавное нарастание\n      this.vortexGain.gain.linearRampToValueAtTime(0.5, this.ctx.currentTime + 0.5);\n      \n      // Активируем storm режим музыки\n      this.activateStormMode();\n      \n    } else {\n      // === ОСТАНОВКА ВИХРЯ ===\n      if (this.vortexGain) {\n        this.vortexGain.gain.linearRampToValueAtTime(0, this.ctx.currentTime + 0.5);\n      }\n      \n      // Деактивируем storm режим\n      this.deactivateStormMode();\n      \n      setTimeout(() => {\n        if (this.vortexOsc) {\n          try { this.vortexOsc.stop(); } catch (e) {}\n          this.vortexOsc = null;\n        }\n        if (this.vortexNoise) {\n          try { this.vortexNoise.stop(); } catch (e) {}\n          this.vortexNoise = null;\n        }\n        this.vortexGain = null;\n      }, 600);\n    }\n  }\n\n  /** Активация storm режима музыки */\n  private activateStormMode(): void {\n    if (!this.ctx || !this.musicGain || this.isStormMode) return;\n    this.isStormMode = true;\n\n    // Создаём gain для storm элементов\n    this.stormGain = this.ctx.createGain();\n    this.stormGain.gain.value = 0;\n    this.stormGain.connect(this.musicGain);\n    this.stormGain.gain.linearRampToValueAtTime(1, this.ctx.currentTime + 0.5);\n\n    // === STORM: ИНТЕНСИВНЫЙ РЕЙЗЕР ===\n    const playRiser = () => {\n      if (!this.ctx || !this.stormGain || !this.isStormMode) return;\n\n      const now = this.ctx.currentTime;\n      const osc = this.ctx.createOscillator();\n      const filter = this.ctx.createBiquadFilter();\n      const gain = this.ctx.createGain();\n\n      osc.type = 'sawtooth';\n      osc.frequency.setValueAtTime(100, now);\n      osc.frequency.exponentialRampToValueAtTime(800, now + 2);\n\n      filter.type = 'lowpass';\n      filter.frequency.setValueAtTime(200, now);\n      filter.frequency.exponentialRampToValueAtTime(4000, now + 2);\n      filter.Q.value = 8;\n\n      gain.gain.setValueAtTime(0, now);\n      gain.gain.linearRampToValueAtTime(0.15, now + 1);\n      gain.gain.linearRampToValueAtTime(0, now + 2);\n\n      osc.connect(filter);\n      filter.connect(gain);\n      gain.connect(this.stormGain!);\n\n      osc.start(now);\n      osc.stop(now + 2.1);\n    };\n\n    // Рейзер каждые 2 секунды\n    this.musicIntervals.push(setInterval(playRiser, 2000) as unknown as number);\n    playRiser();\n\n    // === STORM: ТЯЖЁЛЫЙ SUB DROP ===\n    const playSubDrop = () => {\n      if (!this.ctx || !this.stormGain || !this.isStormMode) return;\n\n      const now = this.ctx.currentTime;\n      const osc = this.ctx.createOscillator();\n      const gain = this.ctx.createGain();\n\n      osc.type = 'sine';\n      osc.frequency.setValueAtTime(80, now);\n      osc.frequency.exponentialRampToValueAtTime(25, now + 0.5);\n\n      gain.gain.setValueAtTime(0.4, now);\n      gain.gain.exponentialRampToValueAtTime(0.01, now + 0.6);\n\n      osc.connect(gain);\n      gain.connect(this.stormGain!);\n\n      osc.start(now);\n      osc.stop(now + 0.7);\n    };\n\n    // Sub drop каждые 500ms\n    this.musicIntervals.push(setInterval(playSubDrop, 500) as unknown as number);\n\n    // === STORM: ШУМОВОЙ SWEEP ===\n    const playNoiseSweep = () => {\n      if (!this.ctx || !this.stormGain || !this.isStormMode) return;\n\n      const now = this.ctx.currentTime;\n      const bufferSize = this.ctx.sampleRate * 1;\n      const buffer = this.ctx.createBuffer(1, bufferSize, this.ctx.sampleRate);\n      const data = buffer.getChannelData(0);\n      for (let i = 0; i < bufferSize; i++) {\n        data[i] = Math.random() * 2 - 1;\n      }\n\n      const noise = this.ctx.createBufferSource();\n      noise.buffer = buffer;\n\n      const filter = this.ctx.createBiquadFilter();\n      filter.type = 'bandpass';\n      filter.frequency.setValueAtTime(500, now);\n      filter.frequency.exponentialRampToValueAtTime(8000, now + 0.5);\n      filter.frequency.exponentialRampToValueAtTime(500, now + 1);\n      filter.Q.value = 5;\n\n      const gain = this.ctx.createGain();\n      gain.gain.setValueAtTime(0, now);\n      gain.gain.linearRampToValueAtTime(0.1, now + 0.25);\n      gain.gain.linearRampToValueAtTime(0.1, now + 0.75);\n      gain.gain.linearRampToValueAtTime(0, now + 1);\n\n      noise.connect(filter);\n      filter.connect(gain);\n      gain.connect(this.stormGain!);\n\n      noise.start(now);\n      noise.stop(now + 1.1);\n    };\n\n    this.musicIntervals.push(setInterval(playNoiseSweep, 1000) as unknown as number);\n    playNoiseSweep();\n\n    // === STORM: БЫСТРЫЕ ХАЙХЭТЫ ===\n    const playFastHihat = () => {\n      if (!this.ctx || !this.stormGain || !this.isStormMode) return;\n\n      const now = this.ctx.currentTime;\n      const bufferSize = this.ctx.sampleRate * 0.02;\n      const buffer = this.ctx.createBuffer(1, bufferSize, this.ctx.sampleRate);\n      const data = buffer.getChannelData(0);\n      for (let i = 0; i < bufferSize; i++) {\n        data[i] = Math.random() * 2 - 1;\n      }\n\n      const noise = this.ctx.createBufferSource();\n      noise.buffer = buffer;\n\n      const filter = this.ctx.createBiquadFilter();\n      filter.type = 'highpass';\n      filter.frequency.value = 10000;\n\n      const gain = this.ctx.createGain();\n      gain.gain.setValueAtTime(0.12, now);\n      gain.gain.exponentialRampToValueAtTime(0.001, now + 0.02);\n\n      noise.connect(filter);\n      filter.connect(gain);\n      gain.connect(this.stormGain!);\n\n      noise.start(now);\n      noise.stop(now + 0.03);\n    };\n\n    // 16th notes (очень быстро)\n    this.musicIntervals.push(setInterval(playFastHihat, 119) as unknown as number);\n  }\n\n  /** Деактивация storm режима */\n  private deactivateStormMode(): void {\n    if (!this.isStormMode) return;\n    this.isStormMode = false;\n\n    if (this.stormGain && this.ctx) {\n      this.stormGain.gain.linearRampToValueAtTime(0, this.ctx.currentTime + 1);\n    }\n\n    setTimeout(() => {\n      this.stormGain = null;\n    }, 1100);\n  }\n\n  /** Музыка Зелёного Босса - ЖЁСТКОЕ ACID TECHNO */\n  private playBossGreenMusic(): void {\n    if (!this.ctx || !this.musicGain) return;\n\n    // === АГРЕССИВНЫЙ 303 ACID ===\n    const acidPattern = [55, 55, 110, 55, 82.4, 110, 73.4, 55]; // Более агрессивный паттерн\n    const slidePattern = [0, 0, 1, 0, 1, 1, 0, 1]; // Глайды\n    let step = 0;\n    let acidFilter: BiquadFilterNode | null = null;\n\n    const playAcidBass = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'boss_green') return;\n      const now = this.ctx.currentTime;\n\n      const osc = this.ctx.createOscillator();\n      const osc2 = this.ctx.createOscillator();\n      const filter = this.ctx.createBiquadFilter();\n      const gain = this.ctx.createGain();\n\n      // Два осциллятора для жирности\n      osc.type = 'sawtooth';\n      osc2.type = 'square';\n      const freq = acidPattern[step];\n      osc.frequency.value = freq;\n      osc2.frequency.value = freq * 1.01; // Лёгкая расстройка\n\n      // ОЧЕНЬ резонансный фильтр - главная фишка ACID!\n      filter.type = 'lowpass';\n      filter.Q.value = 22; // МАКСИМАЛЬНЫЙ резонанс!\n      \n      // Агрессивная модуляция фильтра\n      const isSlide = slidePattern[step] === 1;\n      const filterStart = 150 + Math.random() * 100;\n      const filterPeak = 1200 + Math.random() * 800;\n      \n      filter.frequency.setValueAtTime(filterStart, now);\n      filter.frequency.exponentialRampToValueAtTime(filterPeak, now + 0.03);\n      filter.frequency.exponentialRampToValueAtTime(isSlide ? filterPeak * 0.7 : 200, now + 0.1);\n\n      // Акцент - ГРОМЧЕ!\n      const accent = step % 4 === 0 ? 0.5 : 0.3;\n      gain.gain.setValueAtTime(accent, now);\n      gain.gain.exponentialRampToValueAtTime(0.01, now + 0.12);\n\n      osc.connect(filter);\n      osc2.connect(filter);\n      filter.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc2.start(now);\n      osc.stop(now + 0.15);\n      osc2.stop(now + 0.15);\n\n      step = (step + 1) % acidPattern.length;\n      acidFilter = filter;\n    };\n\n    // 150 BPM 16-е ноты\n    this.musicIntervals.push(setInterval(playAcidBass, 100) as unknown as number);\n\n    // === ЖЁСТКИЙ КИК ===\n    const playKick = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'boss_green') return;\n      const now = this.ctx.currentTime;\n\n      const osc = this.ctx.createOscillator();\n      const click = this.ctx.createOscillator();\n      const gain = this.ctx.createGain();\n      const clickGain = this.ctx.createGain();\n\n      // Основа кика\n      osc.type = 'sine';\n      osc.frequency.setValueAtTime(180, now);\n      osc.frequency.exponentialRampToValueAtTime(35, now + 0.08);\n\n      // Клик атаки\n      click.type = 'triangle';\n      click.frequency.value = 1500;\n\n      gain.gain.setValueAtTime(0.7, now);\n      gain.gain.exponentialRampToValueAtTime(0.01, now + 0.25);\n\n      clickGain.gain.setValueAtTime(0.2, now);\n      clickGain.gain.exponentialRampToValueAtTime(0.001, now + 0.02);\n\n      osc.connect(gain);\n      click.connect(clickGain);\n      gain.connect(this.musicGain!);\n      clickGain.connect(this.musicGain!);\n\n      osc.start(now);\n      click.start(now);\n      osc.stop(now + 0.3);\n      click.stop(now + 0.03);\n    };\n\n    this.musicIntervals.push(setInterval(playKick, 400) as unknown as number);\n\n    // === ХАЙХЭТ ===\n    let hihatStep = 0;\n    const playHihat = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'boss_green') return;\n      const now = this.ctx.currentTime;\n\n      const noise = this.createNoise(0.04);\n      const filter = this.ctx.createBiquadFilter();\n      const gain = this.ctx.createGain();\n\n      filter.type = 'highpass';\n      filter.frequency.value = 9000;\n\n      // Акцент на оффбит - ГРОМЧЕ!\n      const isOffbeat = hihatStep % 2 === 1;\n      gain.gain.setValueAtTime(isOffbeat ? 0.18 : 0.1, now);\n      gain.gain.exponentialRampToValueAtTime(0.001, now + 0.04);\n\n      noise.connect(filter);\n      filter.connect(gain);\n      gain.connect(this.musicGain!);\n\n      hihatStep++;\n    };\n\n    // Хайхэт на каждую восьмую\n    this.musicIntervals.push(setInterval(playHihat, 207) as unknown as number);\n\n    // === КИСЛОТНЫЙ СКРИМ (acid scream) ===\n    const playAcidScream = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'boss_green') return;\n\n      const now = this.ctx.currentTime;\n\n      const osc = this.ctx.createOscillator();\n      const filter = this.ctx.createBiquadFilter();\n      const gain = this.ctx.createGain();\n\n      osc.type = 'sawtooth';\n      osc.frequency.setValueAtTime(200 + Math.random() * 100, now);\n      osc.frequency.exponentialRampToValueAtTime(800 + Math.random() * 400, now + 0.3);\n\n      filter.type = 'bandpass';\n      filter.frequency.setValueAtTime(500, now);\n      filter.frequency.exponentialRampToValueAtTime(3000, now + 0.3);\n      filter.Q.value = 10;\n\n      gain.gain.setValueAtTime(0.1, now);\n      gain.gain.linearRampToValueAtTime(0.15, now + 0.15);\n      gain.gain.exponentialRampToValueAtTime(0.01, now + 0.4);\n\n      osc.connect(filter);\n      filter.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 0.4);\n    };\n\n    // Скрим каждые 2 такта\n    this.musicIntervals.push(setInterval(playAcidScream, 1656) as unknown as number);\n  }\n\n  /** Музыка Чёрного Босса - DUB TECHNO с жёсткой бочкой */\n  private playBossBlackMusic(): void {\n    if (!this.ctx || !this.musicGain) return;\n\n    // === ЖЁСТКАЯ БОЧКА (130 BPM - агрессивный темп для босс-файта) ===\n    const playKick = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'boss_black') return;\n\n      const now = this.ctx.currentTime;\n\n      // Жёсткий индустриальный кик\n      const osc = this.ctx.createOscillator();\n      const osc2 = this.ctx.createOscillator();\n      const distortion = this.ctx.createWaveShaper();\n      const gain = this.ctx.createGain();\n\n      // Агрессивный pitch envelope\n      osc.type = 'sine';\n      osc.frequency.setValueAtTime(200, now);\n      osc.frequency.exponentialRampToValueAtTime(50, now + 0.04);\n      osc.frequency.exponentialRampToValueAtTime(30, now + 0.15);\n\n      // Тяжёлый sub\n      osc2.type = 'sine';\n      osc2.frequency.setValueAtTime(60, now);\n      osc2.frequency.exponentialRampToValueAtTime(25, now + 0.25);\n\n      // Дисторшн для жёсткости\n      const curve = new Float32Array(256);\n      for (let i = 0; i < 256; i++) {\n        const x = (i / 128) - 1;\n        curve[i] = Math.tanh(x * 8); // Жёсткий клиппинг\n      }\n      distortion.curve = curve;\n\n      gain.gain.setValueAtTime(0.9, now);\n      gain.gain.exponentialRampToValueAtTime(0.01, now + 0.3);\n\n      osc.connect(distortion);\n      osc2.connect(gain);\n      distortion.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 0.3);\n      osc2.start(now);\n      osc2.stop(now + 0.35);\n    };\n\n    // 130 BPM = ~461ms\n    this.musicIntervals.push(setInterval(playKick, 461) as unknown as number);\n\n    // === ДАБОВЫЙ БАС С ДИЛЭЕМ ===\n    const bassNotes = [36.7, 36.7, 32.7, 36.7, 41.2, 36.7, 32.7, 29.1]; // D минор\n    let bassIndex = 0;\n\n    const playDubBass = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'boss_black') return;\n\n      const now = this.ctx.currentTime;\n      const note = bassNotes[bassIndex];\n\n      // Основной бас\n      const osc = this.ctx.createOscillator();\n      const filter = this.ctx.createBiquadFilter();\n      const gain = this.ctx.createGain();\n\n      osc.type = 'sawtooth';\n      osc.frequency.value = note;\n\n      filter.type = 'lowpass';\n      filter.frequency.setValueAtTime(400, now);\n      filter.frequency.exponentialRampToValueAtTime(80, now + 0.3);\n      filter.Q.value = 10;\n\n      gain.gain.setValueAtTime(0.35, now);\n      gain.gain.exponentialRampToValueAtTime(0.01, now + 0.4);\n\n      osc.connect(filter);\n      filter.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 0.45);\n\n      // Дабовое эхо (3 повтора с затуханием)\n      for (let echo = 1; echo <= 3; echo++) {\n        const echoOsc = this.ctx.createOscillator();\n        const echoFilter = this.ctx.createBiquadFilter();\n        const echoGain = this.ctx.createGain();\n        const echoTime = now + echo * 0.15;\n        const echoVol = 0.15 / echo;\n\n        echoOsc.type = 'sine';\n        echoOsc.frequency.value = note;\n\n        echoFilter.type = 'lowpass';\n        echoFilter.frequency.value = 200 - echo * 40;\n\n        echoGain.gain.setValueAtTime(echoVol, echoTime);\n        echoGain.gain.exponentialRampToValueAtTime(0.001, echoTime + 0.25);\n\n        echoOsc.connect(echoFilter);\n        echoFilter.connect(echoGain);\n        echoGain.connect(this.musicGain!);\n\n        echoOsc.start(echoTime);\n        echoOsc.stop(echoTime + 0.3);\n      }\n\n      bassIndex = (bassIndex + 1) % bassNotes.length;\n    };\n\n    this.musicIntervals.push(setInterval(playDubBass, 461) as unknown as number);\n\n    // === БРЕЙКБИТ (Amen-style паттерн) ===\n    // Классический брейк: kick-snare-kick-kick-snare с вариациями\n    // 16 шагов паттерна: K=kick, S=snare, H=hihat, _=пауза\n    // Pattern: K_H_S_HK__H_S_HK\n    const breakPattern = [\n      { type: 'kick', vol: 1.0 },\n      { type: 'none', vol: 0 },\n      { type: 'hat', vol: 0.6 },\n      { type: 'none', vol: 0 },\n      { type: 'snare', vol: 1.0 },\n      { type: 'none', vol: 0 },\n      { type: 'hat', vol: 0.5 },\n      { type: 'kick', vol: 0.8 },\n      { type: 'none', vol: 0 },\n      { type: 'none', vol: 0 },\n      { type: 'hat', vol: 0.7 },\n      { type: 'none', vol: 0 },\n      { type: 'snare', vol: 1.0 },\n      { type: 'none', vol: 0 },\n      { type: 'hat', vol: 0.5 },\n      { type: 'kick', vol: 0.7 },\n    ];\n    let breakIndex = 0;\n\n    const playBreakHit = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'boss_black') return;\n\n      const now = this.ctx.currentTime;\n      const hit = breakPattern[breakIndex];\n\n      if (hit.type === 'kick') {\n        // Брейкбит кик - короткий и панчевый\n        const osc = this.ctx.createOscillator();\n        const gain = this.ctx.createGain();\n\n        osc.type = 'sine';\n        osc.frequency.setValueAtTime(180, now);\n        osc.frequency.exponentialRampToValueAtTime(60, now + 0.03);\n        osc.frequency.exponentialRampToValueAtTime(40, now + 0.08);\n\n        gain.gain.setValueAtTime(0.5 * hit.vol, now);\n        gain.gain.exponentialRampToValueAtTime(0.01, now + 0.12);\n\n        osc.connect(gain);\n        gain.connect(this.musicGain!);\n\n        osc.start(now);\n        osc.stop(now + 0.15);\n\n      } else if (hit.type === 'snare') {\n        // Брейкбит снэйр - хрустящий\n        const osc = this.ctx.createOscillator();\n        const oscGain = this.ctx.createGain();\n\n        osc.type = 'triangle';\n        osc.frequency.setValueAtTime(250, now);\n        osc.frequency.exponentialRampToValueAtTime(150, now + 0.02);\n\n        oscGain.gain.setValueAtTime(0.2 * hit.vol, now);\n        oscGain.gain.exponentialRampToValueAtTime(0.01, now + 0.08);\n\n        osc.connect(oscGain);\n        oscGain.connect(this.musicGain!);\n\n        osc.start(now);\n        osc.stop(now + 0.1);\n\n        // Шум\n        const bufferSize = this.ctx.sampleRate * 0.1;\n        const buffer = this.ctx.createBuffer(1, bufferSize, this.ctx.sampleRate);\n        const data = buffer.getChannelData(0);\n        for (let i = 0; i < bufferSize; i++) {\n          data[i] = (Math.random() * 2 - 1) * Math.exp(-i / (this.ctx.sampleRate * 0.025));\n        }\n        const noise = this.ctx.createBufferSource();\n        noise.buffer = buffer;\n\n        const noiseFilter = this.ctx.createBiquadFilter();\n        noiseFilter.type = 'bandpass';\n        noiseFilter.frequency.value = 3000;\n        noiseFilter.Q.value = 1;\n\n        const noiseGain = this.ctx.createGain();\n        noiseGain.gain.setValueAtTime(0.35 * hit.vol, now);\n        noiseGain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);\n\n        noise.connect(noiseFilter);\n        noiseFilter.connect(noiseGain);\n        noiseGain.connect(this.musicGain!);\n\n        noise.start(now);\n        noise.stop(now + 0.12);\n\n      } else if (hit.type === 'hat') {\n        // Брейкбит хайхэт\n        const bufferSize = this.ctx.sampleRate * 0.04;\n        const buffer = this.ctx.createBuffer(1, bufferSize, this.ctx.sampleRate);\n        const data = buffer.getChannelData(0);\n        for (let i = 0; i < bufferSize; i++) {\n          data[i] = Math.random() * 2 - 1;\n        }\n        const noise = this.ctx.createBufferSource();\n        noise.buffer = buffer;\n\n        const filter = this.ctx.createBiquadFilter();\n        filter.type = 'highpass';\n        filter.frequency.value = 7000;\n\n        const gain = this.ctx.createGain();\n        gain.gain.setValueAtTime(0.15 * hit.vol, now);\n        gain.gain.exponentialRampToValueAtTime(0.001, now + 0.035);\n\n        noise.connect(filter);\n        filter.connect(gain);\n        gain.connect(this.musicGain!);\n\n        noise.start(now);\n        noise.stop(now + 0.045);\n      }\n\n      breakIndex = (breakIndex + 1) % breakPattern.length;\n    };\n\n    // 16th notes при 130 BPM\n    this.musicIntervals.push(setInterval(playBreakHit, 115) as unknown as number);\n\n    // Снэйр и хайхэты уже в брейкбите!\n\n    // === ДАБОВЫЙ CHORD STAB С ЭХОМ ===\n    const playDubChord = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'boss_black') return;\n\n      const now = this.ctx.currentTime;\n      const chord = [146.8, 174.6, 220]; // Dm: D3, F3, A3\n\n      for (const freq of chord) {\n        const osc = this.ctx.createOscillator();\n        const filter = this.ctx.createBiquadFilter();\n        const gain = this.ctx.createGain();\n\n        osc.type = 'sawtooth';\n        osc.frequency.value = freq;\n\n        filter.type = 'lowpass';\n        filter.frequency.setValueAtTime(2000, now);\n        filter.frequency.exponentialRampToValueAtTime(300, now + 0.2);\n        filter.Q.value = 5;\n\n        gain.gain.setValueAtTime(0.08, now);\n        gain.gain.exponentialRampToValueAtTime(0.001, now + 0.25);\n\n        osc.connect(filter);\n        filter.connect(gain);\n        gain.connect(this.musicGain!);\n\n        osc.start(now);\n        osc.stop(now + 0.3);\n\n        // Множественное эхо (даб!)\n        for (let e = 1; e <= 5; e++) {\n          const echoOsc = this.ctx.createOscillator();\n          const echoFilter = this.ctx.createBiquadFilter();\n          const echoGain = this.ctx.createGain();\n          const echoTime = now + e * 0.18;\n\n          echoOsc.type = 'sine';\n          echoOsc.frequency.value = freq;\n          echoFilter.type = 'lowpass';\n          echoFilter.frequency.value = 800 - e * 120;\n\n          echoGain.gain.setValueAtTime(0.04 / e, echoTime);\n          echoGain.gain.exponentialRampToValueAtTime(0.001, echoTime + 0.2);\n\n          echoOsc.connect(echoFilter);\n          echoFilter.connect(echoGain);\n          echoGain.connect(this.musicGain!);\n\n          echoOsc.start(echoTime);\n          echoOsc.stop(echoTime + 0.25);\n        }\n      }\n    };\n\n    this.musicIntervals.push(setInterval(playDubChord, 1844) as unknown as number); // Каждые 4 такта\n\n    // === ГЛУБОКИЙ SUB DRONE ===\n    const playSubDrone = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'boss_black') return;\n\n      const now = this.ctx.currentTime;\n\n      const osc = this.ctx.createOscillator();\n      const lfo = this.ctx.createOscillator();\n      const lfoGain = this.ctx.createGain();\n      const gain = this.ctx.createGain();\n\n      osc.type = 'sine';\n      osc.frequency.value = 36.7; // D1\n\n      lfo.type = 'sine';\n      lfo.frequency.value = 0.2;\n      lfoGain.gain.value = 3;\n\n      lfo.connect(lfoGain);\n      lfoGain.connect(osc.frequency);\n\n      gain.gain.setValueAtTime(0, now);\n      gain.gain.linearRampToValueAtTime(0.25, now + 1);\n      gain.gain.linearRampToValueAtTime(0.2, now + 3);\n      gain.gain.linearRampToValueAtTime(0, now + 4);\n\n      osc.connect(gain);\n      gain.connect(this.musicGain!);\n\n      lfo.start(now);\n      osc.start(now);\n      lfo.stop(now + 4.5);\n      osc.stop(now + 4.5);\n    };\n\n    playSubDrone();\n    this.musicIntervals.push(setInterval(playSubDrone, 3688) as unknown as number);\n\n    // === FX: РЕЙЗЕР/ПАДЕНИЕ (каждые 8 тактов) ===\n    const playFx = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'boss_black') return;\n      if (Math.random() > 0.5) return;\n\n      const now = this.ctx.currentTime;\n\n      const osc = this.ctx.createOscillator();\n      const filter = this.ctx.createBiquadFilter();\n      const gain = this.ctx.createGain();\n\n      osc.type = 'sawtooth';\n      // Случайно вверх или вниз\n      if (Math.random() > 0.5) {\n        osc.frequency.setValueAtTime(100, now);\n        osc.frequency.exponentialRampToValueAtTime(800, now + 1);\n      } else {\n        osc.frequency.setValueAtTime(600, now);\n        osc.frequency.exponentialRampToValueAtTime(50, now + 1.5);\n      }\n\n      filter.type = 'lowpass';\n      filter.frequency.setValueAtTime(3000, now);\n      filter.frequency.exponentialRampToValueAtTime(200, now + 1.5);\n      filter.Q.value = 8;\n\n      gain.gain.setValueAtTime(0.1, now);\n      gain.gain.exponentialRampToValueAtTime(0.001, now + 1.5);\n\n      osc.connect(filter);\n      filter.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 1.6);\n    };\n\n    this.musicIntervals.push(setInterval(playFx, 3688) as unknown as number);\n  }\n\n  /** Райзер перед вихрем */\n  public playVortexRiser(): void {\n    if (!this.ctx || !this.musicGain) return;\n\n    const now = this.ctx.currentTime;\n    const duration = 2.0; // 2 секунды райзера\n\n    // === ОСНОВНОЙ РАЙЗЕР (нарастающий шум) ===\n    const bufferSize = this.ctx.sampleRate * duration;\n    const buffer = this.ctx.createBuffer(1, bufferSize, this.ctx.sampleRate);\n    const data = buffer.getChannelData(0);\n    for (let i = 0; i < bufferSize; i++) {\n      data[i] = Math.random() * 2 - 1;\n    }\n\n    const noise = this.ctx.createBufferSource();\n    noise.buffer = buffer;\n\n    const filter = this.ctx.createBiquadFilter();\n    filter.type = 'bandpass';\n    filter.frequency.setValueAtTime(200, now);\n    filter.frequency.exponentialRampToValueAtTime(8000, now + duration);\n    filter.Q.value = 5;\n\n    const gain = this.ctx.createGain();\n    gain.gain.setValueAtTime(0, now);\n    gain.gain.linearRampToValueAtTime(0.3, now + duration * 0.8);\n    gain.gain.linearRampToValueAtTime(0.5, now + duration);\n\n    noise.connect(filter);\n    filter.connect(gain);\n    gain.connect(this.musicGain);\n\n    noise.start(now);\n    noise.stop(now + duration + 0.1);\n\n    // === ТОНАЛЬНЫЙ РАЙЗЕР (нарастающий тон) ===\n    const osc = this.ctx.createOscillator();\n    const oscFilter = this.ctx.createBiquadFilter();\n    const oscGain = this.ctx.createGain();\n\n    osc.type = 'sawtooth';\n    osc.frequency.setValueAtTime(50, now);\n    osc.frequency.exponentialRampToValueAtTime(400, now + duration);\n\n    oscFilter.type = 'lowpass';\n    oscFilter.frequency.setValueAtTime(100, now);\n    oscFilter.frequency.exponentialRampToValueAtTime(2000, now + duration);\n    oscFilter.Q.value = 8;\n\n    oscGain.gain.setValueAtTime(0, now);\n    oscGain.gain.linearRampToValueAtTime(0.25, now + duration);\n\n    osc.connect(oscFilter);\n    oscFilter.connect(oscGain);\n    oscGain.connect(this.musicGain);\n\n    osc.start(now);\n    osc.stop(now + duration + 0.1);\n\n    // === УДАРНЫЕ АКЦЕНТЫ (нарастающие) ===\n    const playRiserHit = (time: number, vol: number) => {\n      if (!this.ctx || !this.musicGain) return;\n\n      const hitOsc = this.ctx.createOscillator();\n      const hitGain = this.ctx.createGain();\n\n      hitOsc.type = 'sine';\n      hitOsc.frequency.setValueAtTime(100, time);\n      hitOsc.frequency.exponentialRampToValueAtTime(30, time + 0.1);\n\n      hitGain.gain.setValueAtTime(vol, time);\n      hitGain.gain.exponentialRampToValueAtTime(0.001, time + 0.15);\n\n      hitOsc.connect(hitGain);\n      hitGain.connect(this.musicGain);\n\n      hitOsc.start(time);\n      hitOsc.stop(time + 0.2);\n    };\n\n    // Ускоряющиеся удары\n    playRiserHit(now + 0.5, 0.15);\n    playRiserHit(now + 1.0, 0.2);\n    playRiserHit(now + 1.3, 0.25);\n    playRiserHit(now + 1.5, 0.3);\n    playRiserHit(now + 1.65, 0.35);\n    playRiserHit(now + 1.8, 0.4);\n    playRiserHit(now + 1.9, 0.45);\n  }\n\n  /** Музыка Синего Босса - быстрый электронный бит */\n  private playBossBlueMusic(): void {\n    if (!this.ctx || !this.musicGain) return;\n\n    // Быстрый синтезаторный бас\n    const bassNotes = [110, 110, 146.8, 164.8, 110, 130.8, 146.8, 110]; // Быстрая прогрессия\n    let noteIndex = 0;\n\n    const playBass = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'boss_blue') return;\n\n      const now = this.ctx.currentTime;\n\n      const osc = this.ctx.createOscillator();\n      const gain = this.ctx.createGain();\n      const filter = this.ctx.createBiquadFilter();\n\n      osc.type = 'square';\n      osc.frequency.value = bassNotes[noteIndex];\n\n      filter.type = 'lowpass';\n      filter.frequency.setValueAtTime(800, now);\n      filter.frequency.exponentialRampToValueAtTime(200, now + 0.2);\n\n      gain.gain.setValueAtTime(0.15, now);\n      gain.gain.linearRampToValueAtTime(0, now + 0.2);\n\n      osc.connect(filter);\n      filter.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 0.25);\n\n      noteIndex = (noteIndex + 1) % bassNotes.length;\n    };\n\n    this.musicIntervals.push(setInterval(playBass, 250) as unknown as number);\n\n    // Быстрое арпеджио\n    const arpNotes = [880, 1046, 1318, 1567, 1318, 1046];\n    let arpIndex = 0;\n\n    const playArp = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'boss_blue') return;\n\n      const now = this.ctx.currentTime;\n\n      const osc = this.ctx.createOscillator();\n      const gain = this.ctx.createGain();\n\n      osc.type = 'triangle';\n      osc.frequency.value = arpNotes[arpIndex];\n\n      gain.gain.setValueAtTime(0.08, now);\n      gain.gain.exponentialRampToValueAtTime(0.001, now + 0.1);\n\n      osc.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 0.12);\n\n      arpIndex = (arpIndex + 1) % arpNotes.length;\n    };\n\n    this.musicIntervals.push(setInterval(playArp, 125) as unknown as number);\n\n    // Электрические разряды\n    const playZap = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'boss_blue') return;\n\n      const now = this.ctx.currentTime;\n\n      const osc = this.ctx.createOscillator();\n      const gain = this.ctx.createGain();\n\n      osc.type = 'sawtooth';\n      osc.frequency.setValueAtTime(2000, now);\n      osc.frequency.exponentialRampToValueAtTime(100, now + 0.15);\n\n      gain.gain.setValueAtTime(0.1, now);\n      gain.gain.exponentialRampToValueAtTime(0.001, now + 0.15);\n\n      osc.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 0.15);\n    };\n\n    this.musicIntervals.push(setInterval(playZap, 500 + Math.random() * 300) as unknown as number);\n\n    // Быстрые удары\n    const playKick = () => {\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'boss_blue') return;\n\n      const now = this.ctx.currentTime;\n\n      const osc = this.ctx.createOscillator();\n      const gain = this.ctx.createGain();\n\n      osc.type = 'sine';\n      osc.frequency.setValueAtTime(150, now);\n      osc.frequency.exponentialRampToValueAtTime(50, now + 0.1);\n\n      gain.gain.setValueAtTime(0.2, now);\n      gain.gain.exponentialRampToValueAtTime(0.001, now + 0.15);\n\n      osc.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 0.15);\n    };\n\n    this.musicIntervals.push(setInterval(playKick, 500) as unknown as number);\n  }\n\n  /** Бас-линия */\n  private playBassline(): void {\n    if (!this.ctx || !this.musicGain) return;\n\n    const bassNotes = [55, 55, 73.4, 82.4]; // A1, A1, D2, E2\n    let noteIndex = 0;\n\n    const playBassNote = () => {\n      // Останавливаем если переключились на босса\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'normal') return;\n\n      const now = this.ctx.currentTime;\n\n      const osc = this.ctx.createOscillator();\n      const osc2 = this.ctx.createOscillator();\n      const gain = this.ctx.createGain();\n      const filter = this.ctx.createBiquadFilter();\n\n      osc.type = 'sawtooth';\n      osc.frequency.value = bassNotes[noteIndex];\n\n      osc2.type = 'square';\n      osc2.frequency.value = bassNotes[noteIndex] * 1.005; // Детюн\n\n      filter.type = 'lowpass';\n      filter.frequency.setValueAtTime(300, now);\n      filter.frequency.linearRampToValueAtTime(150, now + 0.8);\n\n      gain.gain.setValueAtTime(0.2, now);\n      gain.gain.linearRampToValueAtTime(0.15, now + 0.1);\n      gain.gain.linearRampToValueAtTime(0, now + 0.9);\n\n      osc.connect(filter);\n      osc2.connect(filter);\n      filter.connect(gain);\n      gain.connect(this.musicGain!);\n\n      osc.start(now);\n      osc.stop(now + 1);\n      osc2.start(now);\n      osc2.stop(now + 1);\n\n      noteIndex = (noteIndex + 1) % bassNotes.length;\n\n      setTimeout(playBassNote, 1000);\n    };\n\n    playBassNote();\n  }\n\n  /** Арпеджио */\n  private playArpeggio(): void {\n    if (!this.ctx || !this.musicGain) return;\n\n    // A minor pentatonic: A, C, D, E, G\n    const arpNotes = [440, 523, 587, 659, 784, 659, 587, 523];\n    let noteIndex = 0;\n\n    const playArpNote = () => {\n      // Останавливаем если переключились на босса\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'normal') return;\n\n      const now = this.ctx.currentTime;\n\n      const osc = this.ctx.createOscillator();\n      const gain = this.ctx.createGain();\n      const filter = this.ctx.createBiquadFilter();\n      const delay = this.ctx.createDelay();\n      const delayGain = this.ctx.createGain();\n\n      osc.type = 'square';\n      osc.frequency.value = arpNotes[noteIndex];\n\n      filter.type = 'lowpass';\n      filter.frequency.setValueAtTime(2000, now);\n      filter.frequency.exponentialRampToValueAtTime(500, now + 0.15);\n      filter.Q.value = 5;\n\n      gain.gain.setValueAtTime(0.08, now);\n      gain.gain.exponentialRampToValueAtTime(0.01, now + 0.12);\n\n      // Дилей для глубины\n      delay.delayTime.value = 0.25;\n      delayGain.gain.value = 0.3;\n\n      osc.connect(filter);\n      filter.connect(gain);\n      gain.connect(this.musicGain!);\n      gain.connect(delay);\n      delay.connect(delayGain);\n      delayGain.connect(this.musicGain!);\n      delayGain.connect(this.reverb!);\n\n      osc.start(now);\n      osc.stop(now + 0.15);\n\n      noteIndex = (noteIndex + 1) % arpNotes.length;\n\n      setTimeout(playArpNote, 125); // 16th notes at 120 BPM\n    };\n\n    setTimeout(playArpNote, 2000);\n  }\n\n  /** Атмосферный пэд */\n  private playPad(): void {\n    if (!this.ctx || !this.musicGain) return;\n\n    const padChords = [\n      [220, 261.6, 329.6], // Am\n      [196, 246.9, 293.7], // G\n      [174.6, 220, 261.6], // F\n      [164.8, 196, 246.9], // Em\n    ];\n    let chordIndex = 0;\n\n    const playPadChord = () => {\n      // Останавливаем если переключились на босса\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'normal') return;\n\n      const now = this.ctx.currentTime;\n      const chord = padChords[chordIndex];\n\n      chord.forEach((freq, i) => {\n        const osc = this.ctx!.createOscillator();\n        const osc2 = this.ctx!.createOscillator();\n        const gain = this.ctx!.createGain();\n        const filter = this.ctx!.createBiquadFilter();\n\n        osc.type = 'sawtooth';\n        osc.frequency.value = freq;\n\n        osc2.type = 'triangle';\n        osc2.frequency.value = freq * 1.002;\n\n        filter.type = 'lowpass';\n        filter.frequency.value = 800;\n        filter.Q.value = 1;\n\n        // Медленное нарастание\n        gain.gain.setValueAtTime(0, now);\n        gain.gain.linearRampToValueAtTime(0.03, now + 1);\n        gain.gain.linearRampToValueAtTime(0.03, now + 3);\n        gain.gain.linearRampToValueAtTime(0, now + 4);\n\n        osc.connect(filter);\n        osc2.connect(filter);\n        filter.connect(gain);\n        gain.connect(this.musicGain!);\n        gain.connect(this.reverb!);\n\n        osc.start(now + i * 0.1);\n        osc.stop(now + 4.5);\n        osc2.start(now + i * 0.1);\n        osc2.stop(now + 4.5);\n      });\n\n      chordIndex = (chordIndex + 1) % padChords.length;\n\n      setTimeout(playPadChord, 4000);\n    };\n\n    setTimeout(playPadChord, 500);\n  }\n\n  /** Драм-машина */\n  private playDrums(): void {\n    if (!this.ctx || !this.musicGain) return;\n\n    let beat = 0;\n\n    const playBeat = () => {\n      // Останавливаем если переключились на босса\n      if (!this.ctx || !this.musicGain || this.currentMusicMode !== 'normal') return;\n\n      const now = this.ctx.currentTime;\n\n      // Кик на 1 и 3\n      if (beat % 4 === 0 || beat % 4 === 2) {\n        const kick = this.ctx.createOscillator();\n        const kickGain = this.ctx.createGain();\n\n        kick.type = 'sine';\n        kick.frequency.setValueAtTime(150, now);\n        kick.frequency.exponentialRampToValueAtTime(40, now + 0.1);\n\n        kickGain.gain.setValueAtTime(0.3, now);\n        kickGain.gain.exponentialRampToValueAtTime(0.01, now + 0.15);\n\n        kick.connect(kickGain);\n        kickGain.connect(this.musicGain!);\n\n        kick.start(now);\n        kick.stop(now + 0.2);\n      }\n\n      // Снэйр на 2 и 4\n      if (beat % 4 === 1 || beat % 4 === 3) {\n        const snare = this.createNoise(0.15);\n        const snareGain = this.ctx.createGain();\n        const snareFilter = this.ctx.createBiquadFilter();\n\n        snareFilter.type = 'highpass';\n        snareFilter.frequency.value = 1000;\n\n        snareGain.gain.setValueAtTime(0.15, now);\n        snareGain.gain.exponentialRampToValueAtTime(0.01, now + 0.1);\n\n        snare.connect(snareFilter);\n        snareFilter.connect(snareGain);\n        snareGain.connect(this.musicGain!);\n\n        // Тональная часть снэйра\n        const snareTone = this.ctx.createOscillator();\n        const snareToneGain = this.ctx.createGain();\n\n        snareTone.type = 'triangle';\n        snareTone.frequency.value = 180;\n\n        snareToneGain.gain.setValueAtTime(0.1, now);\n        snareToneGain.gain.exponentialRampToValueAtTime(0.01, now + 0.08);\n\n        snareTone.connect(snareToneGain);\n        snareToneGain.connect(this.musicGain!);\n\n        snareTone.start(now);\n        snareTone.stop(now + 0.1);\n      }\n\n      // Хай-хэт на каждый бит\n      const hihat = this.createNoise(0.03);\n      const hihatGain = this.ctx.createGain();\n      const hihatFilter = this.ctx.createBiquadFilter();\n\n      hihatFilter.type = 'highpass';\n      hihatFilter.frequency.value = 8000;\n\n      hihatGain.gain.setValueAtTime(beat % 2 === 0 ? 0.08 : 0.04, now);\n      hihatGain.gain.exponentialRampToValueAtTime(0.01, now + 0.03);\n\n      hihat.connect(hihatFilter);\n      hihatFilter.connect(hihatGain);\n      hihatGain.connect(this.musicGain!);\n\n      beat = (beat + 1) % 16;\n\n      setTimeout(playBeat, 250); // 120 BPM\n    };\n\n    setTimeout(playBeat, 1000);\n  }\n\n  /** Остановить аудио */\n  public stop(): void {\n    if (this.arpInterval) {\n      clearInterval(this.arpInterval);\n    }\n    if (this.ctx) {\n      this.ctx.close();\n      this.ctx = null;\n    }\n    this.isStarted = false;\n  }\n}\n","/** Вершинный шейдер */\nexport const VERTEX_SHADER = `#version 300 es\nprecision highp float;\n\nin vec2 a_position;\nout vec2 v_uv;\n\nvoid main() {\n  v_uv = a_position * 0.5 + 0.5;\n  gl_Position = vec4(a_position, 0.0, 1.0);\n}\n`;\n\n/** Фрагментный шейдер - Circular Arena with Pools */\nexport const FRAGMENT_SHADER = `#version 300 es\nprecision highp float;\n\nuniform vec2 u_resolution;\nuniform float u_time;\nuniform vec3 u_cameraPos;\nuniform float u_cameraYaw;\nuniform float u_cameraPitch;\nuniform vec4 u_targets[16];\nuniform int u_targetCount;\nuniform float u_muzzleFlash;\nuniform vec4 u_pools[8]; // Токсичные лужи [x, z, radius, lifetime]\nuniform int u_poolCount;\nuniform vec4 u_acidProjectiles[4]; // Летящие снаряды кислоты [x, y, z, progress]\nuniform int u_acidProjectileCount;\nuniform vec4 u_spikes[8]; // Лазеры спайкеров [startX, startY, startZ, lifetime]\nuniform vec4 u_spikeTargets[8]; // Конечные точки лазеров [endX, endY, endZ, intensity]\nuniform int u_spikeCount;\nuniform vec4 u_acidRainZones[4]; // Зоны кислотного дождя [x, z, radius, state]\nuniform int u_acidRainZoneCount;\nuniform int u_era; // Эпоха: 1=кислотная, 2=чёрная дыра, 3=космическая\nuniform vec4 u_altars[2]; // Алтари [x, y, z, score]\nuniform vec4 u_darts[16]; // Летящие лучи [x, y, z, active]\nuniform vec4 u_dartDirs[16]; // Направления лучей [dx, dy, dz, speed]\nuniform int u_dartCount;\nuniform float u_voidPortalActive; // Активен ли портал в войд (0 или время жизни)\nuniform vec4 u_bloodCoins[12]; // Монеты крови в войде [x, y, z, active]\nuniform int u_bloodCoinCount;\nuniform int u_wave; // Текущая волна (для эффекта дождя на 15+)\nuniform int u_greenBossPhase2; // Фаза 2 зелёного босса - зелёное небо!\nuniform vec4 u_pickups[8]; // Пикапы [x, y, z, type] type: 9=health, 10=stimpack, 11=charge\nuniform int u_pickupCount;\nuniform vec4 u_crystals[6]; // Кристаллы силы [x, z, height, active]\nuniform int u_voidMode; // Режим войда (засосан Владыкой пустоты)\nuniform float u_voidProgress; // Прогресс войда (0-1, для анимации выхода)\nuniform float u_voidFallOffset; // Смещение падения для визуального эффекта\nuniform vec3 u_portalPos; // Позиция портала выхода в войде\nuniform vec4 u_grenades[8]; // Гранаты [x, y, z, lifetime]\nuniform int u_grenadeCount;\nuniform vec4 u_explosions[8]; // Взрывы [x, y, z, progress]\nuniform int u_explosionCount;\nuniform int u_voidVariant; // Вариант войда (0-3: багровый, изумрудный, золотой, ледяной)\n\n// === КАТАНА (3D viewmodel) ===\nuniform float u_katanaAttack; // Прогресс атаки 0-1\nuniform float u_katanaBob; // Фаза покачивания\nuniform int u_katanaCharges; // Заряды сплеша (0-3)\nuniform float u_katanaTargetAngle; // Угол к ближайшему врагу (-1 = нет врага)\nuniform float u_katanaTargetDist; // Расстояние до ближайшего врага\nuniform int u_katanaAttackType; // Тип удара: 0=справа сверху, 1=слева локтевой, 2=сплеш\n\n// === ЭФФЕКТЫ СМЕРТИ ВРАГОВ ===\nuniform vec4 u_deathEffects[8]; // [x, y, z, progress] - до 8 одновременных смертей\n\n// === ФРАГМЕНТЫ ВРАГОВ (разрубленные куски) ===\nuniform vec4 u_fragments[32]; // [x, y, z, size] - до 32 фрагментов\nuniform int u_fragmentCount;\n\nin vec2 v_uv;\nout vec4 fragColor;\n\n// === ПАРАМЕТРЫ РЕЙТРЕЙСИНГА (УЛЬТРА-ОПТИМИЗАЦИЯ) ===\n#define MAX_STEPS 24\n#define MAX_DIST 60.0\n#define SURF_DIST 0.015\n#define PI 3.14159265\n\n// === РАЗМЕРЫ АРЕНЫ ===\n#define ARENA_RADIUS 38.0\n#define DOME_HEIGHT 22.0\n#define POOL_RADIUS 8.0\n#define POOL_DEPTH 2.0\n// Малые бассейны удалены для упрощения\n#define PLATFORM_HEIGHT 2.0\n#define PLATFORM_X 20.0\n#define BRIDGE_WIDTH 3.0\n// Площадки за порталами\n#define BACK_PLATFORM_RADIUS 8.0\n#define BACK_PLATFORM_X 30.0\n\n// === NOISE ===\nfloat hash(vec2 p) {\n  return fract(sin(dot(p, vec2(127.1, 311.7))) * 43758.5453);\n}\n\nfloat hash3(vec3 p) {\n  return fract(sin(dot(p, vec3(127.1, 311.7, 74.7))) * 43758.5453);\n}\n\n// === GLITCH DISSOLVE ЭФФЕКТ СМЕРТИ ===\n// Возвращает: x = dissolve factor (0=живой, 1=растворён), y = glitch offset\nvec2 getDeathEffect(vec3 worldPos) {\n  float totalDissolve = 0.0;\n  float totalGlitch = 0.0;\n  \n  for (int i = 0; i < 4; i++) {\n    vec4 death = u_deathEffects[i];\n    if (death.w > 0.01) {\n      float dist = length(worldPos - death.xyz);\n      float progress = death.w;\n      \n      // Волна растворения распространяется от центра\n      float waveRadius = progress * 3.0;\n      float waveFront = smoothstep(waveRadius + 0.5, waveRadius - 0.5, dist);\n      \n      // Шумовой dissolve\n      float noiseVal = hash3(worldPos * 10.0 + progress * 5.0);\n      float dissolve = waveFront * step(noiseVal, progress * 1.5);\n      \n      // Glitch distortion\n      float glitch = 0.0;\n      if (progress > 0.1 && progress < 0.9) {\n        float glitchNoise = hash3(worldPos * 50.0 + vec3(progress * 20.0));\n        if (glitchNoise > 0.92) {\n          glitch = (glitchNoise - 0.92) * 2.0 * sin(progress * 50.0);\n        }\n      }\n      \n      totalDissolve = max(totalDissolve, dissolve);\n      totalGlitch = max(totalGlitch, glitch * waveFront);\n    }\n  }\n  \n  return vec2(totalDissolve, totalGlitch);\n}\n\n// Цвет распада - яркие частицы\nvec3 getDeathColor(vec3 worldPos, vec3 baseColor, float progress) {\n  // Яркие искры на границе распада\n  float sparkle = hash3(worldPos * 30.0 + progress * 10.0);\n  if (sparkle > 0.95) {\n    return vec3(1.0, 0.5, 0.0) * 3.0; // Оранжевые искры\n  }\n  \n  // Энергетическое свечение\n  float glow = sin(progress * 20.0 + length(worldPos) * 5.0) * 0.5 + 0.5;\n  vec3 energyColor = mix(vec3(1.0, 0.3, 0.0), vec3(0.0, 1.0, 0.5), glow);\n  \n  return mix(baseColor, energyColor, progress * 2.0);\n}\n\nfloat noise(vec2 p) {\n  vec2 i = floor(p);\n  vec2 f = fract(p);\n  // Улучшенная интерполяция (quintic)\n  f = f * f * f * (f * (f * 6.0 - 15.0) + 10.0);\n  return mix(\n    mix(hash(i), hash(i + vec2(1, 0)), f.x),\n    mix(hash(i + vec2(0, 1)), hash(i + vec2(1, 1)), f.x),\n    f.y\n  );\n}\n\n// Быстрый фрактальный шум (3 октавы вместо 5)\nfloat fbm(vec2 p) {\n  float value = 0.0;\n  value += 0.5 * noise(p);\n  value += 0.25 * noise(p * 2.0);\n  value += 0.125 * noise(p * 4.0);\n  return value;\n}\n\n// Острый шум для трещин и швов\nfloat sharpNoise(vec2 p) {\n  vec2 i = floor(p);\n  vec2 f = fract(p);\n  // Без сглаживания - резкие границы\n  float a = hash(i);\n  float b = hash(i + vec2(1.0, 0.0));\n  float c = hash(i + vec2(0.0, 1.0));\n  float d = hash(i + vec2(1.0, 1.0));\n  return mix(mix(a, b, step(0.5, f.x)), mix(c, d, step(0.5, f.x)), step(0.5, f.y));\n}\n\nfloat waterWaves(vec2 p, float t) {\n  float wave = 0.0;\n  wave += sin(p.x * 0.5 + t * 0.8) * 0.08;\n  wave += sin(p.y * 0.4 + t * 0.6) * 0.06;\n  wave += sin((p.x + p.y) * 0.7 + t) * 0.04;\n  return wave;\n}\n\n// === SDF ПРИМИТИВЫ ===\nfloat sdSphere(vec3 p, float r) {\n  return length(p) - r;\n}\n\nfloat sdBox(vec3 p, vec3 b) {\n  vec3 q = abs(p) - b;\n  return length(max(q, 0.0)) + min(max(q.x, max(q.y, q.z)), 0.0);\n}\n\nfloat sdCylinder(vec3 p, float r, float h) {\n  vec2 d = abs(vec2(length(p.xz), p.y)) - vec2(r, h);\n  return min(max(d.x, d.y), 0.0) + length(max(d, 0.0));\n}\n\nfloat sdTorus(vec3 p, vec2 t) {\n  vec2 q = vec2(length(p.xz) - t.x, p.y);\n  return length(q) - t.y;\n}\n\n// Октаэдр (кристалл)\nfloat sdOctahedron(vec3 p, float s) {\n  p = abs(p);\n  return (p.x + p.y + p.z - s) * 0.57735027;\n}\n\nfloat sdCappedCone(vec3 p, float h, float r1, float r2) {\n  vec2 q = vec2(length(p.xz), p.y);\n  vec2 k1 = vec2(r2, h);\n  vec2 k2 = vec2(r2 - r1, 2.0 * h);\n  vec2 ca = vec2(q.x - min(q.x, (q.y < 0.0) ? r1 : r2), abs(q.y) - h);\n  vec2 cb = q - k1 + k2 * clamp(dot(k1 - q, k2) / dot(k2, k2), 0.0, 1.0);\n  float s = (cb.x < 0.0 && ca.y < 0.0) ? -1.0 : 1.0;\n  return s * sqrt(min(dot(ca, ca), dot(cb, cb)));\n}\n\n// Плавное объединение\nfloat smin(float a, float b, float k) {\n  float h = clamp(0.5 + 0.5 * (b - a) / k, 0.0, 1.0);\n  return mix(b, a, h) - k * h * (1.0 - h);\n}\n\n// === МАТЕРИАЛ ===\n// 0 = стены/пол, 1 = вода, 2 = растения, 3 = металл, 4 = свечение\nint materialId = 0;\n\n// === ПАЛЬМА ===\nfloat sdPalm(vec3 p, vec3 pos) {\n  vec3 lp = p - pos;\n  float d = MAX_DIST;\n  \n  // Горшок\n  float pot = sdCappedCone(lp - vec3(0.0, 0.3, 0.0), 0.3, 0.5, 0.4);\n  d = min(d, pot);\n  \n  // Ствол\n  float trunk = sdCylinder(lp - vec3(0.0, 1.5, 0.0), 0.12, 1.2);\n  d = min(d, trunk);\n  \n  // Крона (несколько сфер)\n  float crown = sdSphere(lp - vec3(0.0, 3.0, 0.0), 1.0);\n  crown = min(crown, sdSphere(lp - vec3(0.5, 2.8, 0.3), 0.7));\n  crown = min(crown, sdSphere(lp - vec3(-0.5, 2.8, -0.3), 0.7));\n  crown = min(crown, sdSphere(lp - vec3(0.3, 2.9, -0.5), 0.6));\n  crown = min(crown, sdSphere(lp - vec3(-0.3, 2.9, 0.5), 0.6));\n  d = min(d, crown);\n  \n  return d;\n}\n\n// === КУСТ ===\nfloat sdBush(vec3 p, vec3 pos, float size) {\n  vec3 lp = p - pos;\n  float d = sdSphere(lp, size);\n  // Добавляем неровности\n  d += sin(lp.x * 8.0) * sin(lp.y * 8.0) * sin(lp.z * 8.0) * 0.05 * size;\n  return d;\n}\n\n// === ФАКЕЛ ===\nfloat sdTorch(vec3 p, vec3 pos) {\n  vec3 lp = p - pos;\n  float holder = sdCylinder(lp, 0.08, 0.3);\n  float bowl = sdCappedCone(lp - vec3(0.0, 0.35, 0.0), 0.15, 0.05, 0.15);\n  return min(holder, bowl);\n}\n\n// === ЛЕСТНИЦА ===\nfloat sdStairs(vec3 p, vec3 pos, float width, float height, float depth, int steps) {\n  vec3 lp = p - pos;\n  float d = MAX_DIST;\n  \n  float stepH = height / float(steps);\n  float stepD = depth / float(steps);\n  \n  for (int i = 0; i < steps; i++) {\n    if (i >= 10) break; // Ограничение для производительности\n    float y = float(i) * stepH;\n    float z = float(i) * stepD;\n    float step = sdBox(lp - vec3(0.0, y + stepH * 0.5, z + stepD * 0.5), \n                       vec3(width * 0.5, stepH * 0.5, stepD * 0.5));\n    d = min(d, step);\n  }\n  \n  return d;\n}\n\n// === СЦЕНА ===\nfloat map(vec3 p) {\n  float d = MAX_DIST;\n  materialId = 0;\n  \n  float distFromCenter = length(p.xz);\n  \n  // === ПРОСТОЙ КРАЙ АРЕНЫ ===\n  float arenaRadius = ARENA_RADIUS - 5.0;\n  float arenaEdge = length(p.xz) - arenaRadius;\n  \n  // === ПОЛ (ДЕТАЛИЗИРОВАННЫЙ) ===\n  float floor_d = p.y;\n  if (arenaEdge < 0.0) {\n    // Основной пол\n    if (floor_d < d) {\n      d = floor_d;\n      \n      // Определяем зону пола для разных материалов\n      float centerDist = length(p.xz);\n      \n      if (centerDist < 4.0) {\n        materialId = 53; // Мозаика в центре\n      } else if (centerDist < 8.0) {\n        materialId = 54; // Декоративное кольцо\n      } else {\n        materialId = 55; // Основной пол - каменная плитка\n      }\n    }\n  }\n  \n  // === ТОКСИЧНЫЕ ЛУЖИ (оптимизировано) ===\n  for (int i = 0; i < u_poolCount; i++) {\n    if (i >= 8) break;\n    vec4 pool = u_pools[i];\n    if (pool.w > 0.0 && p.y < 0.15 && p.y > -0.1) {\n      float distToPool = length(p.xz - pool.xy);\n      if (distToPool < pool.z) {\n        float poolSurface = p.y - 0.08;\n        if (poolSurface < d) {\n          d = poolSurface;\n          materialId = 13;\n        }\n      }\n    }\n  }\n  \n  // === ЗОНЫ КИСЛОТНОГО ДОЖДЯ ===\n  for (int i = 0; i < u_acidRainZoneCount; i++) {\n    if (i >= 4) break;\n    vec4 zone = u_acidRainZones[i];\n    float state = zone.w;\n    float distToZone = length(p.xz - zone.xy);\n    float zoneRadius = zone.z;\n    \n    if (state < 1.0) {\n      // Метка предупреждения на земле\n      if (p.y < 0.1 && p.y > -0.05) {\n        float markRadius = zoneRadius * (0.3 + state * 1.4);\n        if (distToZone < markRadius) {\n          float ring = smoothstep(0.2, 0.0, abs(distToZone - markRadius * 0.85));\n          float pulse = sin(u_time * 10.0) * 0.5 + 0.5;\n          float center = step(distToZone, markRadius * 0.3) * pulse;\n          if (ring + center > 0.3) {\n            d = p.y - 0.02;\n            materialId = 20;\n          }\n        }\n      }\n    } else {\n      // === АКТИВНЫЙ ДОЖДЬ - СТОЛБ КИСЛОТЫ ===\n      // Светящийся круг на земле\n      if (p.y < 0.15 && p.y > -0.05 && distToZone < zoneRadius) {\n        d = p.y - 0.03;\n        materialId = 21; // Зелёный светящийся круг\n      }\n      // Вертикальный столб дождя (цилиндр частиц)\n      if (p.y > 0.0 && p.y < 15.0 && distToZone < zoneRadius * 0.8) {\n        // Анимированные \"струи\" внутри столба\n        float angle = atan(p.z - zone.y, p.x - zone.x);\n        float streams = sin(angle * 8.0 + p.y * 2.0 - u_time * 10.0) * 0.5 + 0.5;\n        float fade = 1.0 - p.y / 15.0; // Затухание к верху\n        float streamDist = distToZone / (zoneRadius * 0.8);\n        \n        if (streams > 0.7 && streamDist > 0.3) {\n          float pillarD = distToZone - zoneRadius * 0.75;\n          if (pillarD < d) {\n            d = pillarD;\n            materialId = 22; // Полупрозрачные струи\n          }\n        }\n      }\n    }\n  }\n  \n  // === ЛЕТЯЩИЕ СНАРЯДЫ КИСЛОТЫ ===\n  for (int i = 0; i < u_acidProjectileCount; i++) {\n    if (i >= 4) break;\n    vec4 proj = u_acidProjectiles[i];\n    vec3 projPos = proj.xyz;\n    float progress = proj.w;\n    \n    if (progress > 0.0 && progress < 1.0) {\n      // Основная сфера кислоты\n      float projSphere = length(p - projPos) - 0.5;\n      if (projSphere < d) {\n        d = projSphere;\n        materialId = 19; // Снаряд кислоты\n      }\n      \n      // Хвост из капель (упрощён)\n      for (int j = 1; j <= 2; j++) {\n        vec3 tailPos = projPos - vec3(0.0, float(j) * 0.5, 0.0);\n        float tailDrop = length(p - tailPos) - (0.25 - float(j) * 0.1);\n        if (tailDrop < d) {\n          d = tailDrop;\n          materialId = 19;\n        }\n      }\n    }\n  }\n  \n  // === ЭНЕРГЕТИЧЕСКИЕ ЛУЧИ (оптимизировано) ===\n  for (int i = 0; i < u_dartCount; i++) {\n    if (i >= 8) break;\n    vec4 dart = u_darts[i];\n    vec4 dartDir = u_dartDirs[i];\n    \n    if (dart.w > 0.5) {\n      vec3 dartPos = dart.xyz;\n      vec3 dir = normalize(dartDir.xyz);\n      vec3 dp = p - dartPos;\n      \n      // Яркое ядро луча (очень тонкое)\n      float core = length(dp) - 0.1;\n      \n      // Внешнее свечение (больше, вытянутое)\n      float glow = length(dp) - 0.25;\n      \n      // Длинный красивый след\n      float trail = 1000.0;\n      for (int t = 1; t <= 2; t++) {\n        float trailDist = float(t) * 0.6;\n        vec3 trailPos = dartPos - dir * trailDist;\n        float trailSize = 0.18 - float(t) * 0.04;\n        if (trailSize > 0.02) {\n          float trailSphere = length(p - trailPos) - trailSize;\n          trail = min(trail, trailSphere);\n        }\n      }\n      \n      // Дополнительные искры вокруг следа\n      for (int s = 0; s < 2; s++) {\n        float sparkOffset = float(s) * 0.5 + sin(u_time * 20.0 + float(s)) * 0.3;\n        vec3 sparkPos = dartPos - dir * sparkOffset;\n        sparkPos += vec3(\n          sin(u_time * 15.0 + float(s) * 2.0) * 0.15,\n          cos(u_time * 18.0 + float(s) * 3.0) * 0.15,\n          sin(u_time * 12.0 + float(s) * 1.5) * 0.15\n        );\n        float spark = length(p - sparkPos) - 0.06;\n        trail = min(trail, spark);\n      }\n      \n      if (core < d) {\n        d = core;\n        materialId = 35; // Ядро луча (ярко-белое)\n      } else if (glow < d) {\n        d = glow;\n        materialId = 36; // Свечение (голубое)\n      } else if (trail < d) {\n        d = trail;\n        materialId = 37; // След (затухающий с искрами)\n      }\n    }\n  }\n  \n  // === ЛАЗЕРЫ СПАЙКЕРОВ ===\n  for (int i = 0; i < u_spikeCount; i++) {\n    if (i >= 8) break;\n    vec4 spike = u_spikes[i];\n    vec4 spikeTarget = u_spikeTargets[i];\n    vec3 laserStart = spike.xyz;\n    vec3 laserEnd = spikeTarget.xyz;\n    float lifetime = spike.w;\n    float intensity = spikeTarget.w;\n    \n    if (lifetime > 0.0 && intensity > 0.0) {\n      // Вектор луча\n      vec3 laserDir = laserEnd - laserStart;\n      float laserLen = length(laserDir);\n      if (laserLen > 0.1) {\n        laserDir /= laserLen;\n        \n        // Расстояние до линии лазера\n        vec3 toPoint = p - laserStart;\n        float proj = clamp(dot(toPoint, laserDir), 0.0, laserLen);\n        vec3 closestPoint = laserStart + laserDir * proj;\n        float distToLaser = length(p - closestPoint);\n        \n        // Толщина луча зависит от интенсивности\n        float beamRadius = 0.08 + intensity * 0.05;\n        float laserD = distToLaser - beamRadius;\n        \n        // Свечение вокруг луча\n        float glow = max(0.0, 0.3 - distToLaser) * intensity * 2.0;\n        \n        if (laserD < d) {\n          d = laserD;\n          materialId = 27; // Лазер\n        }\n      }\n    }\n  }\n  \n  // === ГРАНАТЫ ===\n  for (int i = 0; i < u_grenadeCount; i++) {\n    if (i >= 8) break;\n    vec4 grenade = u_grenades[i];\n    vec3 grenadePos = grenade.xyz;\n    float lifetime = grenade.w;\n    \n    // Сфера гранаты\n    float grenadeD = length(p - grenadePos) - 0.3;\n    \n    if (grenadeD < d) {\n      d = grenadeD;\n      materialId = lifetime < 0.5 ? 42 : 41; // Красная если скоро взрыв\n    }\n  }\n  \n  // === ВЗРЫВЫ ===\n  for (int i = 0; i < u_explosionCount; i++) {\n    if (i >= 8) break;\n    vec4 explosion = u_explosions[i];\n    vec3 expPos = explosion.xyz;\n    float progress = explosion.w;\n    \n    // Расширяющаяся сфера взрыва\n    float expRadius = progress * 8.0; // Радиус 8 метров\n    float expD = length(p - expPos) - expRadius;\n    \n    // Только оболочка (полая сфера)\n    float shell = abs(expD) - 0.3 * (1.0 - progress);\n    \n    if (shell < d && progress < 1.0) {\n      d = shell;\n      materialId = 43; // Взрыв\n    }\n  }\n  \n  // === ПИКАПЫ ===\n  for (int i = 0; i < u_pickupCount; i++) {\n    if (i >= 8) break;\n    vec4 pickup = u_pickups[i];\n    float pType = pickup.w;\n    \n    if (pType > 0.0) {\n      vec3 pickupPos = pickup.xyz;\n      float pickupDist = length(p - pickupPos);\n      \n      // Парящая сфера/куб\n      if (pType == 9.0) {\n        // === РОЗА (аптечка) ===\n        vec3 localP = p - pickupPos;\n        float bob = sin(u_time * 2.0 + pickupPos.x) * 0.1;\n        localP.y -= bob;\n        \n        // Вращение\n        float rotAngle = u_time * 1.5;\n        float cs = cos(rotAngle), sn = sin(rotAngle);\n        localP.xz = mat2(cs, -sn, sn, cs) * localP.xz;\n        \n        // Стебель\n        float stem = sdCylinder(localP + vec3(0.0, 0.3, 0.0), 0.04, 0.35);\n        if (stem < d) { d = stem; materialId = 79; } // Стебель зелёный\n        \n        // Бутон розы (несколько лепестков - торусы под углом)\n        float bud = 1000.0;\n        for (int j = 0; j < 5; j++) {\n          float angle = float(j) * 1.256 + u_time * 0.3;\n          float cj = cos(angle), sj = sin(angle);\n          vec3 petalP = localP;\n          petalP.xz = mat2(cj, -sj, sj, cj) * petalP.xz;\n          petalP.x *= 1.5; // Сплюснуть\n          float petal = sdTorus(petalP + vec3(0.0, 0.1, 0.0), vec2(0.18, 0.08));\n          bud = min(bud, petal);\n        }\n        // Центр бутона\n        float center = sdSphere(localP, 0.15);\n        bud = min(bud, center);\n        \n        if (bud < d) { d = bud; materialId = 14; } // Лепестки красные\n        \n      } else if (pType == 10.0) {\n        // === ЭНЕРГЕТИЧЕСКАЯ СУЩНОСТЬ (баф) ===\n        vec3 localP = p - pickupPos;\n        float bob = sin(u_time * 3.0 + pickupPos.z) * 0.15;\n        localP.y -= bob;\n        \n        // Вращение по двум осям\n        float rotY = u_time * 2.0;\n        float rotX = u_time * 1.3;\n        float cy = cos(rotY), sy = sin(rotY);\n        float cx = cos(rotX), sx = sin(rotX);\n        localP.xz = mat2(cy, -sy, sy, cy) * localP.xz;\n        localP.yz = mat2(cx, -sx, sx, cx) * localP.yz;\n        \n        // Ядро (пульсирующая сфера)\n        float pulse = 0.25 + 0.05 * sin(u_time * 8.0);\n        float core = sdSphere(localP, pulse);\n        if (core < d) { d = core; materialId = 80; } // Ядро энергии\n        \n        // Орбитальные кольца (3 пересекающихся тора)\n        float ring1 = sdTorus(localP.xzy, vec2(0.4, 0.03));\n        float ring2 = sdTorus(localP.yxz, vec2(0.4, 0.03));\n        float ring3 = sdTorus(localP.zyx, vec2(0.4, 0.03));\n        float rings = min(ring1, min(ring2, ring3));\n        if (rings < d) { d = rings; materialId = 81; } // Кольца энергии\n        \n      } else if (pType == 11.0) {\n        // Заряд катаны - энергетическая сфера\n        float chargeSphere = length(p - pickupPos) - 0.5;\n        if (chargeSphere < d) {\n          d = chargeSphere;\n          materialId = 17; // Заряд\n        }\n      } else if (pType == 12.0) {\n        // === БОЛЬШАЯ РОЗА (на краях карты) ===\n        vec3 localP = p - pickupPos;\n        float bob = sin(u_time * 1.5) * 0.15;\n        localP.y -= bob;\n        \n        // Вращение\n        float rotAngle = u_time * 1.0;\n        float cs = cos(rotAngle), sn = sin(rotAngle);\n        localP.xz = mat2(cs, -sn, sn, cs) * localP.xz;\n        \n        // Толстый стебель\n        float stem = sdCylinder(localP + vec3(0.0, 0.5, 0.0), 0.08, 0.55);\n        if (stem < d) { d = stem; materialId = 79; }\n        \n        // Большой бутон\n        float bud = 1000.0;\n        for (int j = 0; j < 7; j++) {\n          float angle = float(j) * 0.898;\n          float cj = cos(angle), sj = sin(angle);\n          vec3 petalP = localP;\n          petalP.xz = mat2(cj, -sj, sj, cj) * petalP.xz;\n          petalP.x *= 1.5;\n          float petal = sdTorus(petalP + vec3(0.0, 0.15, 0.0), vec2(0.3, 0.12));\n          bud = min(bud, petal);\n        }\n        float center = sdSphere(localP, 0.25);\n        bud = min(bud, center);\n        \n        if (bud < d) { d = bud; materialId = 31; } // Золотая роза\n      }\n    }\n  }\n  \n  // === ОБРЫВ ПО КРАЯМ ===\n  // Бортик края - тор вокруг арены\n  float rimTorus = sdTorus(p - vec3(0.0, 0.0, 0.0), vec2(33.0, 0.4));\n  if (rimTorus < d) {\n    d = rimTorus;\n    materialId = 46;\n  }\n  \n  // За краем - бездна (простой пол далеко внизу)\n  if (arenaEdge > 0.5) {\n    float voidFloor = p.y + 10.0;\n    if (voidFloor < d) {\n      d = voidFloor;\n      materialId = 44;\n    }\n  }\n  \n  // === ЦЕНТРАЛЬНЫЙ ФОНТАН СО СТАТУЕЙ АНГЕЛА ===\n  // Анимация трансформации: статуя уезжает вниз, появляется портал\n  float portalProgress = clamp(u_voidPortalActive, 0.0, 1.0);\n  float angelOffset = portalProgress * 5.0; // Статуя уезжает вниз на 5 единиц\n  \n  if (distFromCenter < 6.0) {\n    // Основание фонтана (всегда видно)\n    float fountBase = sdCylinder(p - vec3(0.0, 0.15, 0.0), 3.0, 0.15);\n    if (fountBase < d) { d = fountBase; materialId = 75; }\n    \n    // Нижняя чаша\n    float bowl1 = sdTorus(p - vec3(0.0, 0.6, 0.0), vec2(2.0, 0.25));\n    if (bowl1 < d) { d = bowl1; materialId = 51; }\n    \n    // === СТАТУЯ (классическая колонна с чашей - уезжает вниз при активации портала) ===\n    if (portalProgress < 0.95) {\n      vec3 statuePos = vec3(0.0, 0.7 - angelOffset, 0.0);\n      \n      // Центральная колонна\n      float pillar = sdCylinder(p - statuePos, 0.35, 1.8);\n      if (pillar < d) { d = pillar; materialId = 51; }\n      \n      // База колонны (расширение внизу)\n      float pillarBase = sdCylinder(p - statuePos + vec3(0.0, 1.6, 0.0), 0.5, 0.25);\n      if (pillarBase < d) { d = pillarBase; materialId = 51; }\n      \n      // Верхняя чаша\n      float topBowl = sdTorus(p - statuePos - vec3(0.0, 1.8, 0.0), vec2(0.6, 0.15));\n      if (topBowl < d) { d = topBowl; materialId = 51; }\n      \n      // Декоративные кольца на колонне\n      float ring1 = sdTorus(p - statuePos - vec3(0.0, 0.6, 0.0), vec2(0.38, 0.04));\n      float ring2 = sdTorus(p - statuePos - vec3(0.0, 1.2, 0.0), vec2(0.38, 0.04));\n      if (ring1 < d) { d = ring1; materialId = 52; } // Бронза\n      if (ring2 < d) { d = ring2; materialId = 52; }\n      \n      // Сфера на вершине (оранжевая как луна)\n      float topOrb = sdSphere(p - statuePos - vec3(0.0, 2.2, 0.0), 0.3);\n      if (topOrb < d) { d = topOrb; materialId = 78; } // Оранжевый шар\n    }\n    \n    // === ПОРТАЛ (появляется при активации) ===\n    if (portalProgress > 0.05) {\n      vec3 portalPos = vec3(0.0, 2.7, 0.0);\n      \n      // Каменная рамка - тор\n      float portalRing = sdTorus(p - portalPos, vec2(1.0, 0.15));\n      if (portalRing < d) { d = portalRing; materialId = 68; }\n      \n      // Бронзовый внутренний обод\n      float innerRing = sdTorus(p - portalPos, vec2(0.8, 0.06));\n      if (innerRing < d) { d = innerRing; materialId = 52; }\n      \n      // Огненная сфера внутри портала (как у боковых)\n      float energyCore = sdSphere(p - portalPos, 0.7 * portalProgress);\n      if (energyCore < d) { d = energyCore; materialId = 38; }\n    }\n  }\n  \n  // === ЦЕНТРАЛЬНЫЙ БАССЕЙН ===\n  float poolDist = distFromCenter;\n  \n  // Бортик бассейна (детализированный)\n  if (poolDist < POOL_RADIUS + 0.5 && poolDist > POOL_RADIUS - 0.8) {\n    // Внешний край бортика\n    float rimOuter = sdTorus(p - vec3(0.0, 0.2, 0.0), vec2(POOL_RADIUS + 0.1, 0.25));\n    if (rimOuter < d) { d = rimOuter; materialId = 75; }\n    \n    // Верхняя плоскость бортика\n    float rimTop = sdCylinder(p - vec3(0.0, 0.35, 0.0), POOL_RADIUS + 0.3, 0.1);\n    rimTop = max(rimTop, -(length(p.xz) - POOL_RADIUS + 0.5));\n    if (rimTop < d) { d = rimTop; materialId = 75; }\n  }\n  \n  // Дно бассейна\n  if (poolDist < POOL_RADIUS - 0.3 && p.y < 0.3 && p.y > -POOL_DEPTH - 0.1) {\n    float poolBottom = p.y + POOL_DEPTH;\n    if (poolBottom < d) { d = poolBottom; materialId = 77; } // Дно бассейна (мозаика)\n  }\n  \n  // === МОСТЫ ЧЕРЕЗ БАССЕЙН ===\n  // Мост по X\n  float bridgeX = sdBox(p - vec3(0.0, 0.2, 0.0), vec3(POOL_RADIUS + 1.0, 0.2, BRIDGE_WIDTH * 0.5));\n  // Вырезаем центр для колонны\n  bridgeX = max(bridgeX, -sdCylinder(p, 2.0, 1.0));\n  d = min(d, bridgeX);\n  \n  // Мост по Z\n  float bridgeZ = sdBox(p - vec3(0.0, 0.2, 0.0), vec3(BRIDGE_WIDTH * 0.5, 0.2, POOL_RADIUS + 1.0));\n  bridgeZ = max(bridgeZ, -sdCylinder(p, 2.0, 1.0));\n  d = min(d, bridgeZ);\n  \n  // === ПОДХОДЫ К ПОРТАЛАМ (рампы) ===\n  // Левая рампа к порталу\n  float rampL = sdBox(p - vec3(-19.0, 0.15, 0.0), vec3(3.5, 0.15, 2.5));\n  d = min(d, rampL);\n  \n  // Правая рампа к порталу\n  float rampR = sdBox(p - vec3(19.0, 0.15, 0.0), vec3(3.5, 0.15, 2.5));\n  d = min(d, rampR);\n  \n  // === ПОРТАЛЫ (ТОРИИ-СТИЛЬ) - ОПТИМИЗИРОВАНО ===\n  // Левый портал (только если близко)\n  float leftPortalDist = abs(p.x + 22.0);\n  if (leftPortalDist < 8.0) {\n    vec3 pp = p - vec3(-22.0, 0.0, 0.0);\n    \n    // Платформа (одна объединённая)\n    float platform = sdBox(pp - vec3(0.0, 0.25, 0.0), vec3(3.5, 0.25, 3.5));\n    if (platform < d) { d = platform; materialId = 68; }\n    \n    // Колонны (упрощённые - без сужения)\n    float colL = sdBox(pp - vec3(0.0, 2.5, -2.0), vec3(0.4, 2.0, 0.4));\n    float colR = sdBox(pp - vec3(0.0, 2.5, 2.0), vec3(0.4, 2.0, 0.4));\n    if (colL < d) { d = colL; materialId = 23; }\n    if (colR < d) { d = colR; materialId = 23; }\n    \n    // Верхняя перекладина\n    float kasagi = sdBox(pp - vec3(0.0, 5.0, 0.0), vec3(0.4, 0.2, 2.8));\n    if (kasagi < d) { d = kasagi; materialId = 23; }\n    \n    // Нижняя перекладина\n    float nuki = sdBox(pp - vec3(0.0, 3.8, 0.0), vec3(0.25, 0.12, 2.3));\n    if (nuki < d) { d = nuki; materialId = 23; }\n    \n    // Энергия портала\n    vec3 portalCenter = pp - vec3(0.0, 2.8, 0.0);\n    float portalDist = length(portalCenter.yz);\n    float energyCore = portalDist - 1.3;\n    energyCore = max(energyCore, abs(portalCenter.x) - 0.3);\n    if (energyCore < d) { d = energyCore; materialId = 24; }\n  }\n  \n  // Правый портал (только если близко)\n  float rightPortalDist = abs(p.x - 22.0);\n  if (rightPortalDist < 8.0) {\n    vec3 pp = p - vec3(22.0, 0.0, 0.0);\n    \n    float platform = sdBox(pp - vec3(0.0, 0.25, 0.0), vec3(3.5, 0.25, 3.5));\n    if (platform < d) { d = platform; materialId = 68; }\n    \n    float colL = sdBox(pp - vec3(0.0, 2.5, -2.0), vec3(0.4, 2.0, 0.4));\n    float colR = sdBox(pp - vec3(0.0, 2.5, 2.0), vec3(0.4, 2.0, 0.4));\n    if (colL < d) { d = colL; materialId = 23; }\n    if (colR < d) { d = colR; materialId = 23; }\n    \n    float kasagi = sdBox(pp - vec3(0.0, 5.0, 0.0), vec3(0.4, 0.2, 2.8));\n    if (kasagi < d) { d = kasagi; materialId = 23; }\n    \n    float nuki = sdBox(pp - vec3(0.0, 3.8, 0.0), vec3(0.25, 0.12, 2.3));\n    if (nuki < d) { d = nuki; materialId = 23; }\n    \n    vec3 portalCenter = pp - vec3(0.0, 2.8, 0.0);\n    float portalDist = length(portalCenter.yz);\n    float energyCore = portalDist - 1.3;\n    energyCore = max(energyCore, abs(portalCenter.x) - 0.3);\n    if (energyCore < d) { d = energyCore; materialId = 24; }\n  }\n  \n  // === КРУГЛЫЕ ПЛОЩАДКИ ЗА ПОРТАЛАМИ (ОПТИМИЗИРОВАНО) ===\n  // Левая площадка (только если близко)\n  float leftPlatDist = length(p.xz - vec2(-BACK_PLATFORM_X, 0.0));\n  if (leftPlatDist < BACK_PLATFORM_RADIUS + 2.0) {\n    vec3 lp = p - vec3(-BACK_PLATFORM_X, 0.0, 0.0);\n    float lpDist = length(lp.xz);\n    \n    // Одна платформа вместо трёх ступеней\n    float platform = sdCylinder(lp - vec3(0.0, 0.2, 0.0), BACK_PLATFORM_RADIUS, 0.2);\n    if (platform < d) { d = platform; materialId = 71; }\n    \n    // Бортик (упрощённый)\n    float rim = sdTorus(lp - vec3(0.0, 0.35, 0.0), vec2(BACK_PLATFORM_RADIUS, 0.15));\n    if (rim < d) { d = rim; materialId = 72; }\n    \n    // 4 столбика вместо 8 (только по осям)\n    float pillar1 = sdBox(lp - vec3(BACK_PLATFORM_RADIUS - 0.3, 0.6, 0.0), vec3(0.2, 0.5, 0.2));\n    float pillar2 = sdBox(lp - vec3(-(BACK_PLATFORM_RADIUS - 0.3), 0.6, 0.0), vec3(0.2, 0.5, 0.2));\n    float pillar3 = sdBox(lp - vec3(0.0, 0.6, BACK_PLATFORM_RADIUS - 0.3), vec3(0.2, 0.5, 0.2));\n    float pillar4 = sdBox(lp - vec3(0.0, 0.6, -(BACK_PLATFORM_RADIUS - 0.3)), vec3(0.2, 0.5, 0.2));\n    float pillars = min(min(pillar1, pillar2), min(pillar3, pillar4));\n    if (pillars < d) { d = pillars; materialId = 72; }\n  }\n  \n  // Правая площадка (только если близко)\n  float rightPlatDist = length(p.xz - vec2(BACK_PLATFORM_X, 0.0));\n  if (rightPlatDist < BACK_PLATFORM_RADIUS + 2.0) {\n    vec3 lp = p - vec3(BACK_PLATFORM_X, 0.0, 0.0);\n    float lpDist = length(lp.xz);\n    \n    float platform = sdCylinder(lp - vec3(0.0, 0.2, 0.0), BACK_PLATFORM_RADIUS, 0.2);\n    if (platform < d) { d = platform; materialId = 71; }\n    \n    float rim = sdTorus(lp - vec3(0.0, 0.35, 0.0), vec2(BACK_PLATFORM_RADIUS, 0.15));\n    if (rim < d) { d = rim; materialId = 72; }\n    \n    float pillar1 = sdBox(lp - vec3(BACK_PLATFORM_RADIUS - 0.3, 0.6, 0.0), vec3(0.2, 0.5, 0.2));\n    float pillar2 = sdBox(lp - vec3(-(BACK_PLATFORM_RADIUS - 0.3), 0.6, 0.0), vec3(0.2, 0.5, 0.2));\n    float pillar3 = sdBox(lp - vec3(0.0, 0.6, BACK_PLATFORM_RADIUS - 0.3), vec3(0.2, 0.5, 0.2));\n    float pillar4 = sdBox(lp - vec3(0.0, 0.6, -(BACK_PLATFORM_RADIUS - 0.3)), vec3(0.2, 0.5, 0.2));\n    float pillars = min(min(pillar1, pillar2), min(pillar3, pillar4));\n    if (pillars < d) { d = pillars; materialId = 72; }\n  }\n  \n  // === МОСТЫ К ПЛОЩАДКАМ ЗА ПОРТАЛАМИ ===\n  // Левый мост (от портала к площадке)\n  float bridgeLeft = sdBox(p - vec3(-26.0, 0.15, 0.0), vec3(4.5, 0.15, 2.5));\n  if (bridgeLeft < d) {\n    d = bridgeLeft;\n    materialId = 0;\n  }\n  \n  // Правый мост\n  float bridgeRight = sdBox(p - vec3(26.0, 0.15, 0.0), vec3(4.5, 0.15, 2.5));\n  if (bridgeRight < d) {\n    d = bridgeRight;\n    materialId = 0;\n  }\n  \n  \n  // === ЛЕТАЮЩИЕ ПЛАТФОРМЫ (каменные с бронзовым ободком) ===\n  float bob1 = sin(u_time * 1.5) * 0.3;\n  float bob2 = sin(u_time * 1.5 + 0.8) * 0.3;\n  float bob3 = sin(u_time * 1.5 + 1.6) * 0.3;\n  float bob4 = sin(u_time * 1.5 + 2.4) * 0.3;\n  float bob5 = sin(u_time * 1.5 + 3.2) * 0.3;\n  float bob6 = sin(u_time * 1.5 + 4.0) * 0.3;\n  \n  // Позиции платформ\n  vec3 plat1Pos = vec3(10.0, 1.8 + bob1, 0.0);\n  vec3 plat2Pos = vec3(5.0, 3.0 + bob2, 8.66);\n  vec3 plat3Pos = vec3(-5.0, 4.2 + bob3, 8.66);\n  vec3 plat4Pos = vec3(-10.0, 5.4 + bob4, 0.0);\n  vec3 plat5Pos = vec3(-5.0, 6.6 + bob5, -8.66);\n  vec3 plat6Pos = vec3(5.0, 7.8 + bob6, -8.66);\n  \n  // Каменные основания платформ\n  float jp1 = sdCylinder(p - plat1Pos, 1.5, 0.2);\n  float jp2 = sdCylinder(p - plat2Pos, 1.4, 0.2);\n  float jp3 = sdCylinder(p - plat3Pos, 1.4, 0.2);\n  float jp4 = sdCylinder(p - plat4Pos, 1.3, 0.2);\n  float jp5 = sdCylinder(p - plat5Pos, 1.3, 0.2);\n  float jp6 = sdCylinder(p - plat6Pos, 1.2, 0.2);\n  \n  float jumpPlats = min(jp1, min(jp2, min(jp3, min(jp4, min(jp5, jp6)))));\n  if (jumpPlats < d) {\n    d = jumpPlats;\n    materialId = 71; // Каменная платформа (как площадки порталов)\n  }\n  \n  // Бронзовые ободки платформ\n  float rim1 = sdTorus(p - plat1Pos + vec3(0.0, 0.15, 0.0), vec2(1.5, 0.08));\n  float rim2 = sdTorus(p - plat2Pos + vec3(0.0, 0.15, 0.0), vec2(1.4, 0.08));\n  float rim3 = sdTorus(p - plat3Pos + vec3(0.0, 0.15, 0.0), vec2(1.4, 0.08));\n  float rim4 = sdTorus(p - plat4Pos + vec3(0.0, 0.15, 0.0), vec2(1.3, 0.08));\n  float rim5 = sdTorus(p - plat5Pos + vec3(0.0, 0.15, 0.0), vec2(1.3, 0.08));\n  float rim6 = sdTorus(p - plat6Pos + vec3(0.0, 0.15, 0.0), vec2(1.2, 0.08));\n  \n  float rims = min(rim1, min(rim2, min(rim3, min(rim4, min(rim5, rim6)))));\n  if (rims < d) {\n    d = rims;\n    materialId = 72; // Бронзовый ободок\n  }\n  \n  // === ВЕРХНЯЯ ПЛАТФОРМА (главная, над фонтаном) ===\n  float topBob = sin(u_time * 1.0) * 0.2;\n  vec3 topPos = vec3(0.0, 9.5 + topBob, 0.0);\n  \n  // Каменное основание\n  float topPlat = sdCylinder(p - topPos, 2.5, 0.3);\n  if (topPlat < d) {\n    d = topPlat;\n    materialId = 71;\n  }\n  \n  // Бронзовый ободок по краю (снизу)\n  float topRim = sdTorus(p - topPos - vec3(0.0, 0.2, 0.0), vec2(2.5, 0.08));\n  if (topRim < d) {\n    d = topRim;\n    materialId = 72;\n  }\n  \n  // Декоративный бронзовый обод снизу платформы\n  float bottomRim = sdTorus(p - topPos + vec3(0.0, 0.25, 0.0), vec2(2.3, 0.08));\n  if (bottomRim < d) {\n    d = bottomRim;\n    materialId = 52; // Бронза\n  }\n\n  // === КРИСТАЛЛЫ СИЛЫ (только на волне 10) ===\n  if (u_wave == 10) {\n    for (int i = 0; i < 6; i++) {\n      if (u_crystals[i].w > 0.5) { // active\n        float cx = u_crystals[i].x;\n        float cz = u_crystals[i].y;\n        float ch = u_crystals[i].z;\n        \n        // Кристалл парит и вращается\n        float bobOffset = sin(u_time * 2.0 + float(i)) * 0.15;\n        float rotation = u_time * 1.5 + float(i) * 1.047; // Вращение\n        \n        vec3 crystalPos = vec3(cx, ch + bobOffset, cz);\n        vec3 lp = p - crystalPos;\n        \n        // Вращаем вокруг Y\n        float cosR = cos(rotation);\n        float sinR = sin(rotation);\n        lp.xz = mat2(cosR, -sinR, sinR, cosR) * lp.xz;\n        \n        // Октаэдр (кристалл)\n        float crystal = sdOctahedron(lp, 0.5);\n        \n        if (crystal < d) {\n          d = crystal;\n          materialId = 18; // Чёрный кристалл\n        }\n      }\n    }\n  }\n  \n  // Портал в войд теперь отрисовывается в фонтане (статуя ангела уезжает)\n  \n  // === АЛТАРИ НА КРАЯХ КАРТЫ ===\n  for (int i = 0; i < 2; i++) {\n    vec4 altar = u_altars[i];\n    vec3 altarPos = vec3(altar.x, 0.0, altar.z);\n    vec3 ap = p - altarPos;\n    \n    // Основание алтаря (круглая платформа)\n    float base = sdCylinder(ap - vec3(0.0, 0.2, 0.0), 2.5, 0.4);\n    \n    // Ступени (3 уровня)\n    float step1 = sdCylinder(ap - vec3(0.0, 0.5, 0.0), 2.0, 0.15);\n    float step2 = sdCylinder(ap - vec3(0.0, 0.75, 0.0), 1.5, 0.15);\n    float step3 = sdCylinder(ap - vec3(0.0, 1.0, 0.0), 1.0, 0.15);\n    \n    // Центральный столб (тории-образный)\n    float pillarL = sdBox(ap - vec3(-1.2, 2.5, 0.0), vec3(0.15, 1.5, 0.15));\n    float pillarR = sdBox(ap - vec3(1.2, 2.5, 0.0), vec3(0.15, 1.5, 0.15));\n    \n    // Перекладина сверху\n    float top = sdBox(ap - vec3(0.0, 4.0, 0.0), vec3(1.8, 0.2, 0.2));\n    float topSub = sdBox(ap - vec3(0.0, 3.6, 0.0), vec3(1.5, 0.1, 0.15));\n    \n    // Чаша для очков (в центре)\n    float bowl = sdTorus(ap - vec3(0.0, 1.3, 0.0), vec2(0.6, 0.15));\n    float bowlInner = sdCylinder(ap - vec3(0.0, 1.4, 0.0), 0.5, 0.2);\n    \n    // Собираем алтарь\n    float altarD = base;\n    altarD = min(altarD, step1);\n    altarD = min(altarD, step2);\n    altarD = min(altarD, step3);\n    altarD = min(altarD, pillarL);\n    altarD = min(altarD, pillarR);\n    altarD = min(altarD, top);\n    altarD = min(altarD, topSub);\n    altarD = min(altarD, bowl);\n    \n    if (altarD < d) {\n      d = altarD;\n      materialId = 32; // Камень алтаря\n    }\n    \n    // Огонь в чаше (если есть очки)\n    if (altar.w > 0.0) {\n      float fireY = 1.5 + sin(u_time * 5.0 + float(i)) * 0.2;\n      float fireSize = 0.3 + altar.w * 0.001; // Размер зависит от очков\n      float fire = length(ap - vec3(0.0, fireY, 0.0)) - min(fireSize, 0.8);\n      \n      if (fire < d) {\n        d = fire;\n        materialId = 33; // Огонь в алтаре\n      }\n    }\n    \n    // Светящийся символ (кольцо вокруг чаши)\n    float glow = sdTorus(ap - vec3(0.0, 1.2, 0.0), vec2(0.9, 0.05));\n    if (glow < d) {\n      d = glow;\n      materialId = 34; // Светящийся символ\n    }\n  }\n  \n  // === ВОДА В БАССЕЙНЕ (замедляет игрока!) ===\n  // Центральный бассейн с водой\n  if (distFromCenter > 2.5 && distFromCenter < POOL_RADIUS - 0.3) {\n    // Проверяем что не на мосту\n    bool onBridge = (abs(p.z) < BRIDGE_WIDTH * 0.5) || (abs(p.x) < BRIDGE_WIDTH * 0.5);\n    if (!onBridge) {\n      float waterY = 0.05 + waterWaves(p.xz, u_time) * 0.05;\n      // Плоскость воды как SDF\n      float waterSdf = abs(p.y - waterY) - 0.02;\n      if (waterSdf < d) {\n        d = waterSdf;\n        materialId = 30; // Вода!\n      }\n    }\n  }\n  \n  // Фонтан в центре (декоративная вода)\n  float fountainWater = length(p.xz);\n  if (fountainWater < 1.8 && fountainWater > 1.3) {\n    float waterY = 0.45 + waterWaves(p.xz * 3.0, u_time * 2.0) * 0.02;\n    float waterSdf = abs(p.y - waterY) - 0.02;\n    if (waterSdf < d) {\n      d = waterSdf;\n      materialId = 30; // Вода!\n    }\n  }\n  \n  // === ВРАГИ ===\n  // w: 0=неактивен, 1-2=бейнлинг, 3-4=фантом, 5-6=runner, 7-8=hopper, 9-10=spiker\n  // 11-12=boss_green, 13-14=boss_black, 15-16=boss_blue\n  // w >= 100 = умирает (тип = w - 100)\n  for (int i = 0; i < u_targetCount; i++) {\n    if (i >= 12) break;\n    vec4 target = u_targets[i];\n    if (target.w > 0.5) {\n      // Проверка на умирающего врага\n      bool isDying = target.w >= 100.0;\n      float baseW = isDying ? target.w - 100.0 : target.w;\n      int enemyType = int(baseW / 2.0); // 0=baneling, 1=phantom, 2=runner, 3=hopper, 4=spiker, 5=boss_green, 6=boss_black, 7=boss_blue\n      \n      vec3 tp = p - target.xyz;\n      \n      // Для умирающих врагов - сплющивание + растекание\n      float deathScale = 1.0;\n      if (isDying) {\n        // Прогресс смерти закодирован в дробной части (0-0.99)\n        float deathProgress = fract(baseW) * 2.0; // 0-1.98\n        deathProgress = clamp(deathProgress, 0.0, 1.0);\n        \n        // Сплющивание по Y (падение и растекание)\n        float yScale = mix(1.0, 0.15, deathProgress);\n        float xzScale = mix(1.0, 1.8, deathProgress);\n        \n        tp.y /= yScale;\n        tp.x /= xzScale;\n        tp.z /= xzScale;\n        deathScale = yScale; // Для корректировки расстояния\n      }\n      \n      float targetD;\n      int matId;\n      \n      if (enemyType == 5) {\n        // === ЗЕЛЁНЫЙ БОСС (огромная зелёная жижа) ===\n        float wobble = sin(u_time * 2.0 + tp.x * 1.5) * 0.3\n                     + sin(u_time * 1.5 + tp.y * 2.0) * 0.25\n                     + sin(u_time * 2.5 + tp.z * 1.0) * 0.2;\n        float radius = 2.5 + wobble;\n        targetD = sdSphere(tp, radius);\n        \n        // Пузырящаяся поверхность\n        float bubbles = sin(tp.x * 4.0 + u_time * 3.0) \n                      * sin(tp.y * 4.0 + u_time * 2.5) \n                      * sin(tp.z * 4.0 + u_time * 3.5) * 0.2;\n        targetD += bubbles;\n        \n        // Щупальца\n        for (int t = 0; t < 4; t++) {\n          float angle = float(t) * 1.57 + u_time * 0.5;\n          vec3 tentacle = tp - vec3(cos(angle) * 1.5, -1.0, sin(angle) * 1.5);\n          targetD = smin(targetD, sdCylinder(tentacle, 0.3, 1.5), 0.3);\n        }\n        matId = 10; // Зелёный босс\n        \n      } else if (enemyType == 6) {\n        // === ЧЁРНЫЙ БОСС (искривляет пространство) ===\n        // Искажённое пространство вокруг\n        vec3 distorted = tp;\n        float distortAmount = sin(u_time * 3.0) * 0.3;\n        distorted.x += sin(tp.y * 3.0 + u_time * 2.0) * distortAmount;\n        distorted.z += cos(tp.y * 3.0 + u_time * 2.0) * distortAmount;\n        \n        float radius = 2.0;\n        targetD = sdSphere(distorted, radius);\n        \n        // Кольца тёмной энергии\n        float ring1 = abs(sdTorus(tp, vec2(3.0, 0.1))) - 0.05;\n        float ring2 = abs(sdTorus(tp * vec3(1.0, 0.7, 1.0), vec2(3.5, 0.08))) - 0.03;\n        targetD = min(targetD, ring1);\n        targetD = min(targetD, ring2);\n        matId = 11; // Чёрный босс\n        \n      } else if (enemyType == 7) {\n        // === СИНИЙ БОСС (телепортирующийся) ===\n        // Мерцающая форма\n        float flicker = abs(sin(u_time * 20.0)) * 0.3 + 0.7;\n        float radius = 1.8 * flicker;\n        targetD = sdSphere(tp, radius);\n        \n        // Электрические разряды\n        float sparks = sin(tp.x * 15.0 + u_time * 30.0) \n                     * sin(tp.y * 15.0 + u_time * 25.0) * 0.1;\n        targetD += sparks;\n        \n        // Призрачные копии\n        vec3 ghost1 = tp - vec3(sin(u_time * 5.0) * 2.0, 0.0, cos(u_time * 5.0) * 2.0);\n        vec3 ghost2 = tp + vec3(cos(u_time * 4.0) * 2.0, 0.0, sin(u_time * 4.0) * 2.0);\n        targetD = min(targetD, sdSphere(ghost1, 0.5) - 0.1);\n        targetD = min(targetD, sdSphere(ghost2, 0.5) - 0.1);\n        matId = 12; // Синий босс\n        \n      } else if (enemyType == 1) {\n        // === ФАНТОМ (чёрный шар) ===\n        float distort = sin(u_time * 8.0 + tp.x * 5.0) * 0.08\n                      + sin(u_time * 7.0 + tp.z * 6.0) * 0.06;\n        float radius = 0.55 + distort;\n        targetD = sdSphere(tp, radius);\n        \n        vec3 trail = tp + vec3(0.0, 0.0, 0.3);\n        float trailD = sdSphere(trail, 0.3) - 0.1;\n        targetD = min(targetD, trailD);\n        matId = 5;\n        \n      } else if (enemyType == 2) {\n        // === RUNNER (оранжевый, вытянутый) ===\n        vec3 stretched = tp;\n        stretched.x *= 0.6;\n        float radius = 0.35;\n        targetD = sdSphere(stretched, radius);\n        \n        float speedTrail = sdSphere(tp + vec3(0.3, 0.0, 0.0), 0.2);\n        speedTrail = min(speedTrail, sdSphere(tp + vec3(0.5, 0.0, 0.0), 0.12));\n        targetD = min(targetD, speedTrail);\n        matId = 6;\n        \n      } else if (enemyType == 3) {\n        // === HOPPER (синий, пружинистый) ===\n        float squeeze = 1.0 + sin(u_time * 12.0) * 0.15;\n        vec3 squashed = tp;\n        squashed.y *= squeeze;\n        float radius = 0.45;\n        targetD = sdSphere(squashed, radius);\n        \n        vec3 ear1 = tp - vec3(0.2, 0.4, 0.0);\n        vec3 ear2 = tp - vec3(-0.2, 0.4, 0.0);\n        float ears = min(sdSphere(ear1, 0.12), sdSphere(ear2, 0.12));\n        targetD = min(targetD, ears);\n        matId = 7;\n        \n      } else if (enemyType == 4) {\n        // === SPIKER (летающий шар с глазом-лазером) ===\n        \n        // Покачивание\n        float bob = sin(u_time * 6.0 + float(i) * 2.0) * 0.2;\n        vec3 bobbed = tp - vec3(0.0, bob, 0.0);\n        \n        // Вращение - глаз смотрит на камеру\n        vec3 toCamera = normalize(u_cameraPos - target.xyz);\n        \n        // Основной шар тела\n        float bodyRadius = 0.55;\n        targetD = sdSphere(bobbed, bodyRadius);\n        \n        // Текстура на шаре - \"прожилки\"\n        float veins = sin(bobbed.x * 15.0 + u_time * 2.0) \n                    * sin(bobbed.y * 12.0 + u_time * 1.5) \n                    * sin(bobbed.z * 15.0 + u_time * 2.5);\n        targetD += veins * 0.02;\n        \n        // Пульсация\n        float pulse = 1.0 + sin(u_time * 4.0 + float(i)) * 0.08;\n        targetD *= pulse;\n        \n        // Глаз - выпуклость в направлении камеры\n        vec3 eyeOffset = toCamera * 0.4;\n        vec3 eyePos = bobbed - eyeOffset;\n        float eyeBulge = sdSphere(eyePos, 0.35);\n        targetD = min(targetD, eyeBulge);\n        \n        // Зрачок - в центре глаза (чёрный)\n        vec3 pupilPos = bobbed - toCamera * 0.55;\n        float pupilD = sdSphere(pupilPos, 0.15);\n        \n        // Радужка вокруг зрачка\n        vec3 irisPos = bobbed - toCamera * 0.5;\n        float irisD = sdSphere(irisPos, 0.25);\n        \n        // Маленькие шипы по краям\n        for (int s = 0; s < 4; s++) {\n          float angle = float(s) * 1.57 + u_time * 0.5;\n          vec3 spikeDir = vec3(cos(angle), 0.0, sin(angle));\n          vec3 spikePos = bobbed - spikeDir * 0.6;\n          float spikeD = length(spikePos) - 0.08;\n          targetD = min(targetD, spikeD);\n        }\n        \n        // Определяем материал по расстоянию\n        if (pupilD < 0.01) {\n          matId = 28; // Зрачок (чёрный с красным свечением)\n        } else if (irisD < eyeBulge) {\n          matId = 29; // Радужка (красно-оранжевая)\n        } else {\n          matId = 26; // Тело спайкера\n        }\n        \n      } else {\n        // === БЕЙНЛИНГ (зелёная жижа) ===\n        float wobble = sin(u_time * 4.0 + tp.x * 3.0) * 0.1\n                     + sin(u_time * 3.0 + tp.y * 4.0) * 0.1\n                     + sin(u_time * 5.0 + tp.z * 2.0) * 0.08;\n        float radius = 0.7 + wobble;\n        targetD = sdSphere(tp, radius);\n        \n        float bubbles = sin(tp.x * 8.0 + u_time * 2.0) \n                      * sin(tp.y * 8.0 + u_time * 1.5) \n                      * sin(tp.z * 8.0 + u_time * 2.5) * 0.05;\n        targetD += bubbles;\n        matId = 4;\n      }\n      \n      if (targetD < d) {\n        d = targetD;\n        materialId = matId;\n      }\n    }\n  }\n  \n  // === ФРАГМЕНТЫ ВРАГОВ (КАПЛИ ЖИЖИ) ===\n  for (int i = 0; i < u_fragmentCount; i++) {\n    if (i >= 16) break;\n    vec4 frag = u_fragments[i];\n    if (frag.w > 0.0) {\n      vec3 fp = p - frag.xyz;\n      \n      // Размер капли\n      float dropSize = frag.w * 0.35;\n      \n      // Сфера (основа капли)\n      float fragD = length(fp) - dropSize;\n      \n      // Деформация - вытянутая капля (больше вниз когда падает)\n      float stretch = 1.0 + abs(fp.y) * 0.3; // Вытягивание\n      vec3 stretched = vec3(fp.x, fp.y * 0.7, fp.z);\n      fragD = length(stretched) - dropSize;\n      \n      // Волнистость поверхности (жижа колышется)\n      float wobble = sin(fp.x * 15.0 + u_time * 8.0) * \n                     sin(fp.y * 12.0 + u_time * 6.0) * \n                     sin(fp.z * 15.0 + u_time * 7.0) * 0.02;\n      fragD += wobble;\n      \n      if (fragD < d) {\n        d = fragD;\n        materialId = 200 + i; // Материал фрагмента\n      }\n    }\n  }\n  \n  // === 4 КАМЕННЫХ ФОНАРЯ (ОПТИМИЗИРОВАНО) ===\n  float lanternRadius = 28.0;\n  \n  // Проверяем близость к любому из 4 фонарей\n  vec2 lp1 = p.xz - vec2(0.0, lanternRadius);\n  vec2 lp2 = p.xz - vec2(0.0, -lanternRadius);\n  vec2 lp3 = p.xz - vec2(lanternRadius, 0.0);\n  vec2 lp4 = p.xz - vec2(-lanternRadius, 0.0);\n  \n  float dl1 = length(lp1);\n  float dl2 = length(lp2);\n  float dl3 = length(lp3);\n  float dl4 = length(lp4);\n  \n  // Находим ближайший фонарь\n  float minLDist = min(min(dl1, dl2), min(dl3, dl4));\n  \n  if (minLDist < 4.0) {\n    // Определяем позицию ближайшего фонаря\n    vec3 lPos = vec3(0.0, 0.0, lanternRadius);\n    if (dl2 < dl1 && dl2 <= dl3 && dl2 <= dl4) lPos = vec3(0.0, 0.0, -lanternRadius);\n    else if (dl3 <= dl1 && dl3 <= dl2 && dl3 <= dl4) lPos = vec3(lanternRadius, 0.0, 0.0);\n    else if (dl4 <= dl1 && dl4 <= dl2 && dl4 <= dl3) lPos = vec3(-lanternRadius, 0.0, 0.0);\n    \n    vec3 lp = p - lPos;\n    \n    // Платформа (одна)\n    float platform = sdBox(lp - vec3(0.0, 0.2, 0.0), vec3(1.0, 0.2, 1.0));\n    if (platform < d) { d = platform; materialId = 64; }\n    \n    // Столб\n    float pillar = sdBox(lp - vec3(0.0, 1.7, 0.0), vec3(0.25, 1.3, 0.25));\n    if (pillar < d) { d = pillar; materialId = 60; }\n    \n    // Камера для огня (упрощённая)\n    float chamber = sdBox(lp - vec3(0.0, 3.15, 0.0), vec3(0.4, 0.35, 0.4));\n    if (chamber < d) { d = chamber; materialId = 60; }\n    \n    // Огонь (простой сферический)\n    float flame = sdSphere(lp - vec3(0.0, 3.15, 0.0), 0.2);\n    if (flame < d) { d = flame; materialId = 66; }\n    \n    // Крыша (упрощённая)\n    float roof = sdBox(lp - vec3(0.0, 3.75, 0.0), vec3(0.6, 0.1, 0.6));\n    if (roof < d) { d = roof; materialId = 60; }\n  }\n  \n  return d;\n}\n\n// === RAY MARCHING (ТУРБО) ===\nfloat rayMarch(vec3 ro, vec3 rd) {\n  float d = 0.0;\n  \n  // Аналитическое пересечение с полом (y=0) - ГАРАНТИРОВАННО попадает\n  float floorDist = MAX_DIST;\n  if (rd.y < -0.001) {\n    floorDist = -ro.y / rd.y;\n    if (floorDist < 0.0) floorDist = MAX_DIST;\n  }\n  \n  for (int i = 0; i < MAX_STEPS; i++) {\n    vec3 p = ro + rd * d;\n    float dist = map(p);\n    \n    d += dist * 0.9;\n    \n    if (dist < SURF_DIST) return d;\n    if (d > MAX_DIST) break;\n    \n    // Если достигли пола раньше - выходим\n    if (d > floorDist) {\n      return floorDist;\n    }\n  }\n  \n  // Если raymarching не попал ни во что, но пол есть - возвращаем пол\n  if (floorDist < MAX_DIST) {\n    return floorDist;\n  }\n  \n  return MAX_DIST;\n}\n\nvec3 getNormal(vec3 p) {\n  // Тетраэдрный метод - 4 вызова вместо 6!\n  vec2 e = vec2(0.01, -0.01);\n  return normalize(\n    e.xyy * map(p + e.xyy) +\n    e.yyx * map(p + e.yyx) +\n    e.yxy * map(p + e.yxy) +\n    e.xxx * map(p + e.xxx)\n  );\n}\n\n// === ДИНАМИЧЕСКИЕ ТЕНИ ОТ ВРАГОВ (оптимизировано) ===\nfloat enemyShadow(vec3 p, vec4 targets[16], int targetCount) {\n  // Только на полу (y < 0.5)\n  if (p.y > 0.5) return 1.0;\n  \n  float shadow = 1.0;\n  \n  for (int i = 0; i < 8; i++) {\n    if (i >= targetCount) break;\n    \n    vec4 enemy = targets[i];\n    if (enemy.w < 0.5) continue;\n    \n    vec2 toEnemy = p.xz - enemy.xz;\n    float dist = length(toEnemy);\n    if (dist > 3.0) continue; // Далеко - пропускаем\n    \n    float shadowStrength = smoothstep(1.5, 0.0, dist);\n    shadow = min(shadow, 1.0 - shadowStrength * 0.5);\n  }\n  \n  return shadow;\n}\n\n// === БЫСТРЫЕ ТЕНИ (2 шага) ===\nfloat softShadow(vec3 ro, vec3 rd, float mint, float maxt, float k) {\n  float res = 1.0;\n  float t = mint;\n  \n  for (int i = 0; i < 2; i++) {\n    float h = map(ro + rd * t);\n    res = min(res, k * h / t);\n    t += clamp(h, 1.0, 5.0);\n    if (res < 0.2 || t > maxt) break;\n  }\n  return clamp(res, 0.3, 1.0);\n}\n\n// === КОНТАКТНЫЕ ТЕНИ (2 шага) ===\nfloat contactShadowRay(vec3 p, vec3 rd, float maxDist) {\n  float t = 0.1;\n  for (int i = 0; i < 2; i++) {\n    float h = map(p + rd * t);\n    if (h < 0.02) return 0.4;\n    t += max(h, 0.3);\n    if (t > maxDist) break;\n  }\n  return 1.0;\n}\n\n// === FAKE ТЕНИ (дополнение) ===\nfloat fakeShadow(vec3 p, float lightY) {\n  float heightFade = smoothstep(0.0, 3.0, p.y);\n  float distFromCenter = length(p.xz);\n  float centerDark = smoothstep(10.0, 0.0, distFromCenter) * 0.2;\n  return mix(0.5, 1.0, heightFade) - centerDark;\n}\n\n// === УЛУЧШЕННЫЙ AO (оптимизировано) ===\nfloat calcAO(vec3 pos, vec3 nor) {\n  // 2 сэмпла\n  float d1 = map(pos + nor * 0.1);\n  float d2 = map(pos + nor * 0.3);\n  float occ = (0.1 - d1) + (0.3 - d2) * 0.5;\n  return clamp(1.0 - occ * 2.0, 0.4, 1.0);\n}\n\n// === КОНТАКТНЫЕ ТЕНИ ===\nfloat contactShadow(vec3 p) {\n  return smoothstep(-1.0, 2.0, p.y) * 0.5 + 0.5;\n}\n\n// === ПЛЁНОЧНАЯ ЗЕРНИСТОСТЬ (упрощённая) ===\nfloat filmGrain(vec2 uv, float time) {\n  float seed = dot(uv, vec2(12.9898, 78.233)) + time;\n  return fract(sin(seed) * 43758.5453) - 0.5;\n}\n\n// === КАУСТИКИ (упрощённые) ===\nfloat caustics(vec2 p, float t) {\n  vec2 uv = p * 1.5 + vec2(sin(t * 0.3), cos(t * 0.4)) * 0.5;\n  return pow(0.5 + 0.5 * sin(uv.x * 3.0 + uv.y * 2.0 + t), 3.0);\n}\n\n// === КАТАНА 3D (viewmodel) - КЛАССИЧЕСКАЯ ДЕТАЛИЗИРОВАННАЯ ===\n\n// SDF капсулы\nfloat sdCapsule(vec3 p, vec3 a, vec3 b, float r) {\n  vec3 pa = p - a, ba = b - a;\n  float h = clamp(dot(pa, ba) / dot(ba, ba), 0.0, 1.0);\n  return length(pa - ba * h) - r;\n}\n\n// SDF лезвия катаны - классическое с изгибом (сори)\nfloat sdKatanaBlade(vec3 p) {\n  // Масштаб катаны (меньше для viewmodel)\n  float scale = 0.15;\n  vec3 sp = p / scale;\n  \n  // Длина лезвия\n  float bladeLen = 2.2;\n  \n  // Лёгкий изгиб (сори) - характерная черта катаны\n  float curve = sp.y * sp.y * 0.02;\n  sp.z -= curve;\n  \n  // Сечение лезвия - треугольное (синоги-дзукури)\n  // Сужение к острию\n  float taper = 1.0 - smoothstep(0.0, bladeLen, sp.y) * 0.6;\n  float width = 0.12 * taper;\n  float thick = 0.025 * taper;\n  \n  // Треугольное сечение\n  float d2d = max(abs(sp.x) - width, abs(sp.z) - thick + abs(sp.x) * 0.15);\n  float d = max(d2d, sp.y - bladeLen);\n  d = max(d, -sp.y - 0.05); // Начало лезвия\n  \n  // Острие (киссаки) - скошенное\n  vec3 tipP = sp - vec3(0.0, bladeLen - 0.15, 0.0);\n  float tipAngle = atan(tipP.z, tipP.y - 0.15);\n  float tip = length(tipP) - 0.08;\n  tip = max(tip, sp.y - bladeLen);\n  d = min(d, tip);\n  \n  return d * scale;\n}\n\n// SDF рукояти (цука)\nfloat sdKatanaHandle(vec3 p) {\n  float scale = 0.15;\n  vec3 sp = p / scale;\n  \n  // Овальное сечение рукояти\n  float handleLen = 0.8;\n  vec3 hp = sp - vec3(0.0, -handleLen * 0.5, 0.0);\n  \n  // Овал\n  vec2 sz = vec2(0.055, 0.04);\n  float d = length(hp.xz / sz) - 1.0;\n  d = max(d * min(sz.x, sz.y), abs(hp.y) - handleLen * 0.5);\n  \n  // Касира (навершие) - торцевая крышка\n  vec3 kashiraP = sp - vec3(0.0, -handleLen - 0.02, 0.0);\n  float kashira = length(kashiraP / vec3(0.06, 0.03, 0.045)) - 1.0;\n  kashira *= 0.03;\n  d = min(d * scale, kashira * scale);\n  \n  return d;\n}\n\n// SDF цуба (гарда)\nfloat sdKatanaGuard(vec3 p) {\n  float scale = 0.15;\n  vec3 sp = p / scale;\n  \n  // Круглая цуба с орнаментом\n  float radius = 0.18;\n  float thick = 0.015;\n  \n  // Основной диск\n  float d = length(sp.xz) - radius;\n  d = max(d, abs(sp.y) - thick);\n  \n  // Отверстие для лезвия\n  float hole = length(sp.xz / vec2(0.13, 0.03)) - 1.0;\n  d = max(d, -hole * 0.02);\n  \n  // Декоративные вырезы (сукаши)\n  float angle = atan(sp.z, sp.x);\n  float r = length(sp.xz);\n  float pattern = sin(angle * 4.0) * 0.02;\n  if (r > 0.12 && r < 0.16) {\n    d = max(d, -abs(sp.y) + thick * 0.3 + pattern);\n  }\n  \n  return d * scale;\n}\n\n// SDF хабаки (муфта между лезвием и гардой)\nfloat sdKatanaHabaki(vec3 p) {\n  float scale = 0.15;\n  vec3 sp = p / scale;\n  \n  vec3 hp = sp - vec3(0.0, -0.02, 0.0);\n  float d = length(hp.xz / vec2(0.08, 0.035)) - 1.0;\n  d = max(d * 0.03, abs(hp.y) - 0.05);\n  \n  return d * scale;\n}\n\n// SDF сэппа (шайбы у гарды)\nfloat sdKatanaSeppa(vec3 p, float yOffset) {\n  float scale = 0.15;\n  vec3 sp = p / scale;\n  \n  vec3 seppaP = sp - vec3(0.0, yOffset, 0.0);\n  float d = length(seppaP.xz) - 0.1;\n  d = max(d, abs(seppaP.y) - 0.008);\n  \n  return d * scale;\n}\n\n// Полная катана SDF\nfloat sdKatana(vec3 p) {\n  float blade = sdKatanaBlade(p);\n  float handle = sdKatanaHandle(p);\n  float guard = sdKatanaGuard(p);\n  float habaki = sdKatanaHabaki(p);\n  float seppa1 = sdKatanaSeppa(p, 0.015);\n  float seppa2 = sdKatanaSeppa(p, -0.015);\n  \n  float d = min(blade, handle);\n  d = min(d, guard);\n  d = min(d, habaki);\n  d = min(d, seppa1);\n  d = min(d, seppa2);\n  \n  return d;\n}\n\n// Материал катаны (0=лезвие, 1=рукоять, 2=гарда, 3=металл.детали)\nint getKatanaMaterial(vec3 p) {\n  float blade = sdKatanaBlade(p);\n  float handle = sdKatanaHandle(p);\n  float guard = sdKatanaGuard(p);\n  float habaki = sdKatanaHabaki(p);\n  float seppa = min(sdKatanaSeppa(p, 0.015), sdKatanaSeppa(p, -0.015));\n  \n  float minD = blade;\n  int mat = 0;\n  \n  if (handle < minD) { minD = handle; mat = 1; }\n  if (guard < minD) { minD = guard; mat = 2; }\n  if (habaki < minD || seppa < minD) { mat = 3; }\n  \n  return mat;\n}\n\n// Raymarching катаны (viewmodel - в экранном пространстве)\nvec4 renderKatana(vec3 ro, vec3 rd, float attack, float bob, int charges, vec3 ambient, vec3 accentColor) {\n  // Матрица камеры (из yaw и pitch) - такая же как в основном рендере\n  float cy = cos(u_cameraYaw), sy = sin(u_cameraYaw);\n  float cp = cos(u_cameraPitch), sp = sin(u_cameraPitch);\n  \n  // Базисные векторы камеры (совпадают с main)\n  vec3 camForward = vec3(sy * cp, sp, -cy * cp);\n  vec3 camRight = vec3(cy, 0.0, sy);\n  vec3 camUp = cross(camRight, camForward);\n  \n  // Позиция катаны относительно камеры (ближе к центру)\n  vec3 localOffset = vec3(0.06, -0.1, 0.32); // Почти по центру, чуть ниже\n  \n  // Покачивание при ходьбе\n  localOffset.x += sin(bob) * 0.003;\n  localOffset.y += abs(sin(bob * 2.0)) * 0.002;\n  \n  // Базовые углы катаны - ОСТРИЕ ВПЕРЁД\n  float rotX = -1.5;  // Лезвие горизонтально, острие вперёд\n  float rotZ = 0.08;  // Минимальный наклон\n  float rotY = 0.05;  // Режущая кромка чуть вниз\n  \n  // === УПРЕЖДАЮЩИЙ ЗАМАХ - катана заносится ПРОТИВОПОЛОЖНО врагу! ===\n  if (u_katanaTargetAngle > -0.5 && attack < 0.1) {\n    // Враг в зоне (до 6м) - готовимся к удару\n    float targetInfluence = smoothstep(6.0, 3.0, u_katanaTargetDist);\n    \n    // Угол к врагу определяет сторону замаха\n    float angleOffset = u_katanaTargetAngle;\n    angleOffset = clamp(angleOffset, -0.8, 0.8);\n    \n    // Чем ближе враг - тем сильнее замах (до 3м - почти полный замах)\n    float windUpAmount = smoothstep(5.0, 3.0, u_katanaTargetDist);\n    \n    if (angleOffset < 0.0) {\n      // ВРАГ СЛЕВА → заносим ВПРАВО (удар пойдёт справа налево)\n      rotX += windUpAmount * 0.7;     // Острие вверх\n      rotZ += windUpAmount * 0.6;     // Вправо!\n      rotY += windUpAmount * 0.5;     // Ладонь наружу\n      \n      localOffset.y += windUpAmount * 0.12;  // Рука вверх\n      localOffset.x += windUpAmount * 0.08;  // Вправо!\n    } else {\n      // ВРАГ СПРАВА → заносим ВЛЕВО (удар пойдёт слева направо)\n      rotX += windUpAmount * 0.8;     // Острие вверх\n      rotZ -= windUpAmount * 0.7;     // Влево!\n      rotY -= windUpAmount * 0.5;     // Ладонь внутрь\n      \n      localOffset.y += windUpAmount * 0.14;  // Рука вверх\n      localOffset.x -= windUpAmount * 0.1;   // Влево!\n    }\n    \n    // Лёгкое напряжение - дрожание готовности\n    float tension = sin(u_time * 12.0) * 0.01 * targetInfluence;\n    rotZ += tension;\n    rotX += tension * 0.5;\n  }\n  \n  // РЕАЛИСТИЧНАЯ АНИМАЦИЯ АТАКИ - КАК РУКОЙ\n  if (attack > 0.0) {\n    float t = attack;\n    \n    // Фазы: замах (0-0.12), удар (0.12-0.4), возврат (0.4-1.0)\n    float windUp = smoothstep(0.0, 0.12, t);      // Замах\n    float strike = smoothstep(0.12, 0.38, t);     // Удар\n    float recover = smoothstep(0.42, 1.0, t);     // Возврат\n    \n    // Агрессивный easing для удара\n    float strikeEase = 1.0 - pow(1.0 - strike, 5.0);\n    float swingPower = strikeEase * (1.0 - recover);\n    float windUpPower = windUp * (1.0 - strike);\n    \n    if (u_katanaAttackType == 0) {\n      // === ТИП 0: УДАР СПРАВА СВЕРХУ (кэса-гири) ===\n      // Рука поднимается вверх, ладонь разворачивается наружу\n      \n      // ЗАМАХ: рука идёт вверх-вправо, ладонь разворачивается\n      rotX += windUpPower * 1.1;    // Острие вверх (рука поднимается)\n      rotZ += windUpPower * 0.6;    // Вправо (плечо отводится)\n      rotY += windUpPower * 0.7;    // Ладонь разворачивается наружу!\n      \n      // Позиция руки при замахе\n      localOffset.y += windUpPower * 0.18;  // Рука вверх\n      localOffset.x += windUpPower * 0.1;   // Плечо вправо\n      localOffset.z -= windUpPower * 0.05;  // Отводим назад\n      \n      // УДАР: мощный рубящий сверху вниз по диагонали\n      rotX -= swingPower * 2.0;     // Острие вниз (рука опускается)\n      rotZ -= swingPower * 1.4;     // Влево (плечо вперёд)\n      rotY -= swingPower * 0.3;     // Ладонь возвращается\n      \n      // Выпад руки вперёд\n      localOffset.y -= swingPower * 0.14;\n      localOffset.x -= swingPower * 0.12;\n      localOffset.z += swingPower * 0.12;\n      \n    } else if (u_katanaAttackType == 1) {\n      // === ТИП 1: УДАР СЛЕВА (гяку-кэса) ===\n      // Рука заносится высоко влево, локоть ведёт\n      \n      // ЗАМАХ: рука высоко влево над плечом!\n      rotX += windUpPower * 1.2;    // Острие высоко вверх\n      rotZ -= windUpPower * 1.1;    // СИЛЬНО влево!\n      rotY -= windUpPower * 0.8;    // Ладонь внутрь\n      \n      // Позиция руки при замахе - высоко и влево\n      localOffset.y += windUpPower * 0.2;   // Рука ВЫСОКО вверх\n      localOffset.x -= windUpPower * 0.15;  // Сильно влево\n      localOffset.z -= windUpPower * 0.06;  // Отводим назад\n      \n      // УДАР: мощный диагональный взмах вправо-вниз\n      rotX -= swingPower * 2.0;     // Острие резко вниз\n      rotZ += swingPower * 2.0;     // Сильно вправо\n      rotY += swingPower * 0.6;     // Ладонь разворачивается\n      \n      // Выпад вперёд и вправо\n      localOffset.y -= swingPower * 0.14;\n      localOffset.x += swingPower * 0.16;\n      localOffset.z += swingPower * 0.1;\n      \n    } else {\n      // === ТИП 2: СПЛЕШ (ёко-гири - горизонтальный) ===\n      // Широкий горизонтальный взмах обеими руками\n      \n      // ЗАМАХ: рука отводится вправо, ладонь разворачивается\n      rotZ += windUpPower * 0.7;\n      rotY += windUpPower * 0.4;    // Ладонь наружу\n      localOffset.x += windUpPower * 0.08;\n      localOffset.z -= windUpPower * 0.03;\n      \n      // УДАР: мощный горизонтальный рубящий\n      rotZ -= swingPower * 2.6;\n      rotX -= swingPower * 0.25;\n      rotY -= swingPower * 0.3;     // Ладонь возвращается\n      \n      localOffset.x -= swingPower * 0.2;\n      localOffset.z += swingPower * 0.1;\n    }\n    \n    // Встряска при ударе (импакт)\n    if (t > 0.28 && t < 0.48) {\n      float shake = sin(t * 180.0) * 0.005 * (1.0 - smoothstep(0.28, 0.48, t));\n      localOffset.x += shake;\n      localOffset.y += shake * 0.5;\n    }\n  }\n  \n  // Позиция катаны в мировых координатах (относительно камеры)\n  vec3 katanaWorldPos = ro + camRight * localOffset.x + camUp * localOffset.y + camForward * localOffset.z;\n  \n  // Матрица локального поворота катаны (XYZ euler)\n  float cx = cos(rotX), sx = sin(rotX);\n  float cy2 = cos(rotY), sy2 = sin(rotY);\n  float cz = cos(rotZ), sz = sin(rotZ);\n  \n  // Комбинированная матрица поворота ZYX\n  mat3 localRot = mat3(\n    cz * cy2, -sz * cx + cz * sy2 * sx, sz * sx + cz * sy2 * cx,\n    sz * cy2, cz * cx + sz * sy2 * sx, -cz * sx + sz * sy2 * cx,\n    -sy2, cy2 * sx, cy2 * cx\n  );\n  \n  // Комбинированная матрица: локальный поворот + ориентация камеры\n  mat3 camMat = mat3(camRight, camUp, camForward);\n  mat3 rotMat = camMat * localRot;\n  \n  float t = 0.0;\n  float maxDist = 1.0;\n  \n  for (int i = 0; i < 20; i++) {\n    vec3 p = ro + rd * t;\n    \n    // Трансформация в локальное пространство катаны\n    vec3 localP = transpose(rotMat) * (p - katanaWorldPos);\n    \n    float d = sdKatana(localP);\n    \n    if (d < 0.002) {\n      vec3 hitP = localP;\n      int mat = getKatanaMaterial(hitP);\n      \n      // Нормаль\n      vec2 e = vec2(0.0005, 0.0);\n      vec3 n = normalize(vec3(\n        sdKatana(hitP + e.xyy) - sdKatana(hitP - e.xyy),\n        sdKatana(hitP + e.yxy) - sdKatana(hitP - e.yxy),\n        sdKatana(hitP + e.yyx) - sdKatana(hitP - e.yyx)\n      ));\n      // Трансформация нормали в мировое пространство\n      n = rotMat * n;\n      \n      // Освещение от камеры + сверху\n      vec3 lightDir = normalize(vec3(0.2, 0.8, -0.5));\n      vec3 viewLight = normalize(vec3(0.0, 0.0, -1.0)); // От камеры\n      float diff = max(dot(n, lightDir), 0.0) * 0.5 + 0.3;\n      diff += max(dot(n, viewLight), 0.0) * 0.3;\n      float spec = pow(max(dot(reflect(rd, n), lightDir), 0.0), 64.0);\n      float viewSpec = pow(max(dot(reflect(rd, n), viewLight), 0.0), 32.0);\n      \n      vec3 color;\n      \n      if (mat == 0) {\n        // ЛЕЗВИЕ - полированная сталь с хамоном\n        vec3 steelColor = vec3(0.85, 0.88, 0.92);\n        \n        // Хамон (волнистая линия закалки)\n        float hamonY = hitP.y * 0.15; // Масштаб\n        float hamonLine = sin(hamonY * 80.0 + sin(hamonY * 30.0) * 2.0) * 0.003;\n        float hamon = smoothstep(0.002, -0.002, hitP.z - hamonLine - 0.002);\n        \n        // Дзи (основа) темнее, якиба (закалённая часть) светлее\n        vec3 ji = vec3(0.6, 0.62, 0.65);\n        vec3 yakiba = vec3(0.95, 0.97, 1.0);\n        steelColor = mix(ji, yakiba, hamon);\n        \n        color = steelColor * diff * ambient * 4.0;\n        color += vec3(1.0) * (spec + viewSpec) * 0.9;\n        \n        // Режущая кромка - яркая линия\n        float edge = smoothstep(0.002, 0.0, abs(hitP.z) - 0.001);\n        color += vec3(1.0, 0.98, 0.95) * edge * 0.4;\n        \n        // Неоновый акцент на кромке\n        color += accentColor * edge * 0.2;\n        \n        // Заряды - свечение\n        if (charges > 0) {\n          float scale = 0.15;\n          for (int j = 0; j < 3; j++) {\n            if (j < charges) {\n              float cy = (0.3 + float(j) * 0.25) * scale;\n              float dist = abs(hitP.y - cy);\n              float glow = smoothstep(0.03, 0.0, dist);\n              color += accentColor * glow * 0.6;\n            }\n          }\n        }\n        \n      } else if (mat == 1) {\n        // РУКОЯТЬ - чёрная с ито (обмоткой)\n        vec3 handleBase = vec3(0.02, 0.02, 0.02); // Самэ (кожа ската) под обмоткой\n        vec3 itoColor = vec3(0.08, 0.05, 0.12); // Шёлковая обмотка\n        \n        // Ромбовидный узор обмотки\n        float scale = 0.15;\n        float wrapY = hitP.y / scale;\n        float wrapAngle = atan(hitP.z, hitP.x);\n        float wrap = step(0.5, fract(wrapY * 12.0 + wrapAngle * 0.5));\n        \n        vec3 handleColor = mix(handleBase, itoColor, wrap);\n        color = handleColor * diff * ambient * 3.0;\n        \n        // Неоновые линии между обмоткой\n        float wrapGlow = smoothstep(0.52, 0.48, fract(wrapY * 12.0));\n        color += accentColor * wrapGlow * 0.1 * (0.6 + 0.4 * sin(u_time * 2.0));\n        \n      } else if (mat == 2) {\n        // ЦУБА (гарда) - тёмный металл с узором\n        vec3 tsubaColor = vec3(0.12, 0.1, 0.08);\n        \n        // Патина\n        float patina = hash(hitP.xz * 100.0) * 0.1;\n        tsubaColor += vec3(0.0, patina * 0.5, patina);\n        \n        color = tsubaColor * diff * ambient * 3.5;\n        color += vec3(0.3, 0.25, 0.2) * spec * 0.2;\n        \n        // Неоновый край\n        float edgeDist = length(hitP.xz) - 0.025;\n        float tsubaEdge = smoothstep(0.003, 0.0, abs(edgeDist));\n        color += accentColor * tsubaEdge * 0.3;\n        \n      } else {\n        // МЕТАЛЛИЧЕСКИЕ ДЕТАЛИ (хабаки, сэппа)\n        vec3 brassColor = vec3(0.7, 0.55, 0.3); // Латунь\n        color = brassColor * diff * ambient * 4.0;\n        color += vec3(1.0, 0.9, 0.6) * spec * 0.5;\n      }\n      \n      // Вспышка атаки\n      if (attack > 0.3 && attack < 0.8) {\n        float flash = sin((attack - 0.3) / 0.5 * 3.14159);\n        color += accentColor * flash * 0.5;\n      }\n      \n      return vec4(color, t);\n    }\n    \n    t += d;\n    if (t > maxDist) break;\n  }\n  \n  // Не попали - прозрачно\n  return vec4(0.0, 0.0, 0.0, -1.0);\n}\n\n// === НЕБО И ГОРИЗОНТ ===\nvec3 renderSky(vec3 rd) {\n  // Базовый цвет неба\n  vec3 color = vec3(0.04, 0.05, 0.1);\n  \n  // Плавный градиент от зенита к горизонту\n  float horizonFade = 1.0 - abs(rd.y);\n  float horizonPow = horizonFade * horizonFade * horizonFade;\n  \n  // Горизонт - светлее и с дымкой\n  vec3 horizonColor = vec3(0.08, 0.07, 0.12);  // Фиолетово-серая дымка\n  vec3 horizonGlow = vec3(0.04, 0.08, 0.1);    // Циановый отсвет\n  \n  color = mix(color, horizonColor, horizonPow);\n  color += horizonGlow * horizonFade * 0.5;\n  \n  // ФАЗА 2 ЗЕЛЁНОГО БОССА - ТОКСИЧНОЕ НЕБО\n  if (u_greenBossPhase2 == 1) {\n    float heightFade = smoothstep(-0.2, 0.8, rd.y);\n    vec3 toxicGreen = mix(vec3(0.04, 0.12, 0.02), vec3(0.08, 0.3, 0.04), heightFade);\n    color = toxicGreen;\n    float clouds = sin(rd.x * 3.0 + u_time * 0.5) * sin(rd.z * 2.0 + u_time * 0.3) * 0.5 + 0.5;\n    color += vec3(0.0, 0.15, 0.0) * clouds * 0.2;\n    color *= (sin(u_time * 2.0) * 0.15 + 0.85);\n    return color;\n  }\n  \n  // Звёзды (только вверху)\n  if (rd.y > 0.1) {\n    vec2 skyUV = rd.xz / (rd.y + 0.3);\n    float stars = hash(floor(skyUV * 100.0));\n    if (stars > 0.975) {\n      float starBright = (stars - 0.975) * 20.0 * rd.y;\n      color += vec3(0.8, 0.85, 1.0) * starBright;\n    }\n  }\n  \n  // Луна - большая оранжевая\n  vec3 moonDir = normalize(vec3(0.4, 0.5, -0.4));\n  float moonDot = dot(rd, moonDir);\n  \n  // Основной диск луны (больше и объёмнее)\n  float moon = smoothstep(0.96, 0.97, moonDot);\n  \n  // Объёмное затемнение к краям (как у настоящей луны)\n  float moonEdge = smoothstep(0.97, 0.99, moonDot);\n  vec3 moonCore = vec3(1.0, 0.7, 0.3); // Яркий оранжевый центр\n  vec3 moonRim = vec3(0.9, 0.4, 0.1);  // Тёмный оранжевый край\n  vec3 moonColor = mix(moonRim, moonCore, moonEdge);\n  \n  // Текстура кратеров (шум)\n  float moonNoise = noise(rd.xy * 30.0) * 0.15;\n  moonColor *= (0.9 + moonNoise);\n  \n  color += moonColor * moon * 1.5;\n  \n  // Свечение вокруг луны\n  float moonGlow = pow(max(0.0, moonDot), 8.0);\n  color += vec3(0.4, 0.2, 0.05) * moonGlow * 0.6;\n  \n  return color;\n}\n\n// === ЭФФЕКТ ДОЖДЯ И МОЛНИЙ ===\n\n// Функция для вертикальных линий дождя\nfloat rainStreak(vec2 uv, float speed, float density, float seed) {\n  vec2 st = uv * vec2(density, 1.0);\n  st.y = st.y * 0.1 - u_time * speed;\n  \n  float id = floor(st.x);\n  float x = fract(st.x);\n  float y = fract(st.y + fract(sin(id * seed) * 1000.0));\n  \n  // Тонкая вертикальная линия\n  float streak = smoothstep(0.45, 0.5, x) * smoothstep(0.55, 0.5, x);\n  // Ограничиваем длину капли\n  streak *= smoothstep(0.0, 0.02, y) * smoothstep(0.15, 0.08, y);\n  // Случайность появления\n  streak *= step(0.7, fract(sin(id * 127.1 + seed) * 43758.5453));\n  \n  return streak;\n}\n\n// Функция молнии\nfloat lightning(vec2 uv, float time, float seed) {\n  // Позиция молнии по X (меняется каждые несколько секунд)\n  float strikeTime = floor(time * 0.3 + seed);\n  float strikeX = fract(sin(strikeTime * 127.1 + seed) * 43758.5453) * 2.0 - 1.0;\n  \n  // Фаза молнии (0-1 в пределах удара)\n  float phase = fract(time * 0.3 + seed);\n  \n  // Молния видна только короткое время\n  float visible = smoothstep(0.7, 0.75, phase) * smoothstep(0.95, 0.85, phase);\n  \n  // Основной канал молнии с зигзагами\n  float bolt = 0.0;\n  float x = strikeX;\n  float segments = 4.0;\n  \n  for (float i = 0.0; i < segments; i++) {\n    float segY = 1.0 - i / segments;\n    float nextY = 1.0 - (i + 1.0) / segments;\n    float nextX = x + (fract(sin((strikeTime + i) * 73.7) * 43758.5453) - 0.5) * 0.4;\n    \n    if (uv.y < segY && uv.y > nextY) {\n      float t = (segY - uv.y) / (segY - nextY);\n      float dist = abs(uv.x - mix(x, nextX, t));\n      bolt += smoothstep(0.03, 0.0, dist) * 2.0;\n    }\n    x = nextX;\n  }\n  \n  return bolt * visible;\n}\n\n// Предупреждающее свечение перед молнией\nfloat lightningWarning(vec2 uv, float time, float seed) {\n  float strikeTime = floor(time * 0.3 + seed);\n  float strikeX = fract(sin(strikeTime * 127.1 + seed) * 43758.5453) * 2.0 - 1.0;\n  float phase = fract(time * 0.3 + seed);\n  \n  // Свечение появляется перед ударом (фаза 0.5-0.7)\n  float warning = smoothstep(0.5, 0.6, phase) * smoothstep(0.75, 0.65, phase);\n  \n  // Пульсация\n  warning *= 0.5 + 0.5 * sin(time * 20.0);\n  \n  // Область свечения сверху\n  float glow = smoothstep(0.3, 1.0, uv.y);\n  glow *= smoothstep(0.5, 0.0, abs(uv.x - strikeX));\n  \n  return glow * warning;\n}\n\n// Кислотный дождь - капли только когда игрок В зоне\nvec3 renderAcidRain(vec2 uv, vec3 color, float time, vec3 camPos) {\n  if (u_acidRainZoneCount == 0) return color;\n  \n  vec3 result = color;\n  float inRainIntensity = 0.0; // Игрок ВНУТРИ зоны дождя\n  \n  // Проверяем находится ли игрок в зоне дождя\n  for (int i = 0; i < u_acidRainZoneCount; i++) {\n    if (i >= 4) break;\n    vec4 zone = u_acidRainZones[i];\n    if (zone.w >= 1.0) {\n      float dist = length(camPos.xz - zone.xy);\n      float zoneRadius = zone.z;\n      // Только если игрок ВНУТРИ зоны (с небольшим запасом)\n      if (dist < zoneRadius + 1.0) {\n        inRainIntensity = max(inRainIntensity, 1.0 - dist / (zoneRadius + 1.0));\n      }\n    }\n  }\n  \n  // Капли на экране ТОЛЬКО если игрок под дождём\n  if (inRainIntensity > 0.01) {\n    float drops = 0.0;\n    \n    // Толстые струи\n    float y1 = fract(uv.y * 3.0 - time * 15.0);\n    drops += step(0.0, y1) * step(y1, 0.5) * step(0.4, fract(uv.x * 3.0)) * step(fract(uv.x * 3.0), 0.6) * 0.5;\n    \n    float y1b = fract(uv.y * 3.0 - time * 18.0 + 0.33);\n    drops += step(0.0, y1b) * step(y1b, 0.5) * step(0.4, fract(uv.x * 3.0 + 0.33)) * step(fract(uv.x * 3.0 + 0.33), 0.6) * 0.5;\n    \n    // Средние капли\n    float y2 = fract(uv.y * 6.0 - time * 22.0);\n    drops += step(0.1, y2) * step(y2, 0.4) * step(0.45, fract(uv.x * 6.0)) * step(fract(uv.x * 6.0), 0.55) * 0.3;\n    \n    // Мелкие капли\n    float y3 = fract(uv.y * 10.0 - time * 28.0);\n    drops += step(0.15, y3) * step(y3, 0.35) * step(0.47, fract(uv.x * 10.0)) * step(fract(uv.x * 10.0), 0.53) * 0.2;\n    \n    // Зелёные капли на экране\n    result += vec3(0.2, 1.0, 0.1) * drops * inRainIntensity * 5.0;\n    \n    // Зелёная дымка когда под дождём\n    result = mix(result, vec3(0.1, 0.5, 0.1), inRainIntensity * 0.35);\n  }\n  \n  return result;\n}\n\n// === ЭФФЕКТ ВОЙДА - СТИЛЬ ЧЁРНОГО БОССА ===\n// Рендерит skybox который вращается с камерой\n// voidVariant: 0=багровый, 1=изумрудный, 2=золотой, 3=ледяной\nvec3 renderVoidSky(vec3 rd, float time) {\n  // Базовые цвета для разных вариантов войда\n  vec3 baseSky, upColor, nebulaColor1, nebulaColor2, starColor1, starColor2;\n  \n  if (u_voidVariant == 0) {\n    // БАГРОВЫЙ войд\n    baseSky = vec3(0.04, 0.01, 0.02);\n    upColor = vec3(0.1, 0.02, 0.05);\n    nebulaColor1 = vec3(0.15, 0.02, 0.05);\n    nebulaColor2 = vec3(0.1, 0.0, 0.03);\n    starColor1 = vec3(0.8, 0.3, 0.3);\n    starColor2 = vec3(1.0, 0.5, 0.4);\n  } else if (u_voidVariant == 1) {\n    // ИЗУМРУДНЫЙ войд\n    baseSky = vec3(0.01, 0.04, 0.02);\n    upColor = vec3(0.02, 0.1, 0.05);\n    nebulaColor1 = vec3(0.02, 0.15, 0.08);\n    nebulaColor2 = vec3(0.0, 0.1, 0.05);\n    starColor1 = vec3(0.3, 0.8, 0.5);\n    starColor2 = vec3(0.5, 1.0, 0.7);\n  } else if (u_voidVariant == 2) {\n    // ЗОЛОТОЙ войд\n    baseSky = vec3(0.04, 0.03, 0.01);\n    upColor = vec3(0.1, 0.08, 0.02);\n    nebulaColor1 = vec3(0.15, 0.1, 0.02);\n    nebulaColor2 = vec3(0.1, 0.06, 0.0);\n    starColor1 = vec3(1.0, 0.8, 0.3);\n    starColor2 = vec3(1.0, 0.9, 0.5);\n  } else {\n    // ЛЕДЯНОЙ войд (по умолчанию)\n    baseSky = vec3(0.01, 0.02, 0.04);\n    upColor = vec3(0.02, 0.05, 0.1);\n    nebulaColor1 = vec3(0.02, 0.08, 0.15);\n    nebulaColor2 = vec3(0.0, 0.05, 0.1);\n    starColor1 = vec3(0.3, 0.5, 0.8);\n    starColor2 = vec3(0.6, 0.8, 1.0);\n  }\n  \n  vec3 skyColor = baseSky;\n  \n  // Градиент вверх - немного светлее\n  float upGrad = max(0.0, rd.y);\n  skyColor += upColor * upGrad * 0.5;\n  \n  // Градиент вниз - бездна\n  float downGrad = max(0.0, -rd.y);\n  skyColor = mix(skyColor, baseSky * 0.3, downGrad);\n  \n  // === ЗВЁЗДЫ (оптимизировано) ===\n  vec3 starDir = normalize(rd);\n  \n  for (float i = 0.0; i < 20.0; i++) {\n    vec3 starPos = normalize(vec3(\n      sin(i * 73.1) * cos(i * 127.3),\n      sin(i * 91.7) * cos(i * 173.1),\n      cos(i * 47.3) * sin(i * 311.7)\n    ));\n    \n    float starDist = length(starDir - starPos);\n    float star = smoothstep(0.02, 0.0, starDist);\n    skyColor += mix(starColor1, starColor2, fract(i * 0.37)) * star * 0.4;\n  }\n  \n  // === ТУМАННОСТИ (упрощённые) ===\n  float nebula = sin(rd.x * 3.0 + rd.z * 2.0) * cos(rd.y * 4.0);\n  skyColor += nebulaColor1 * smoothstep(-0.3, 0.5, nebula) * 0.25;\n  \n  return skyColor;\n}\n\n// Старая функция для совместимости (не используется в новом войде)\nvec3 renderVoid(vec2 uv, float fallOffset) {\n  return vec3(0.0);\n}\n\nvec3 renderRain(vec2 uv, vec3 color, float time) {\n  // Нормализуем UV для эффектов\n  vec2 screenUV = uv;\n  \n  // === ДОЖДЬ ===\n  float rain = 0.0;\n  \n  // Слой 1 - крупные яркие капли (передний план)\n  rain += rainStreak(screenUV, 3.0, 80.0, 1.0) * 0.8;\n  rain += rainStreak(screenUV + vec2(0.1, 0.0), 3.5, 90.0, 2.0) * 0.7;\n  \n  // Слой 2 - средние капли\n  rain += rainStreak(screenUV, 2.5, 120.0, 3.0) * 0.5;\n  rain += rainStreak(screenUV + vec2(0.05, 0.0), 2.8, 140.0, 4.0) * 0.4;\n  \n  // Слой 3 - мелкие капли (задний план)\n  rain += rainStreak(screenUV, 2.0, 200.0, 5.0) * 0.3;\n  \n  // Цвет дождя - яркий голубой\n  vec3 rainColor = vec3(0.6, 0.8, 1.0);\n  color += rainColor * rain;\n  \n  // === МОЛНИИ ===\n  // Несколько независимых молний с разным таймингом\n  float bolt1 = lightning(screenUV, time, 0.0);\n  float bolt2 = lightning(screenUV, time, 3.7);\n  float bolt3 = lightning(screenUV, time, 7.3);\n  \n  float totalBolt = bolt1 + bolt2 + bolt3;\n  \n  // Цвет молнии - яркий бело-голубой\n  vec3 boltColor = vec3(0.8, 0.9, 1.0);\n  color += boltColor * totalBolt;\n  \n  // Вспышка освещения при ударе молнии\n  float flash = max(bolt1, max(bolt2, bolt3));\n  color = mix(color, vec3(0.9, 0.95, 1.0), flash * 0.3);\n  \n  // === ПРЕДУПРЕЖДАЮЩЕЕ СВЕЧЕНИЕ ===\n  float warn1 = lightningWarning(screenUV, time, 0.0);\n  float warn2 = lightningWarning(screenUV, time, 3.7);\n  float warn3 = lightningWarning(screenUV, time, 7.3);\n  \n  float totalWarning = warn1 + warn2 + warn3;\n  \n  // Жёлто-белое свечение предупреждения\n  vec3 warningColor = vec3(1.0, 0.95, 0.7);\n  color += warningColor * totalWarning * 0.4;\n  \n  // === АТМОСФЕРА ШТОРМА ===\n  // Тёмное грозовое небо\n  color = mix(color, vec3(0.08, 0.1, 0.15), 0.2);\n  \n  return color;\n}\n\n// === ГЛАВНАЯ (ОПТИМИЗИРОВАННАЯ) ===\nvoid main() {\n  vec2 uv = (v_uv - 0.5) * 2.0;\n  uv.x *= u_resolution.x / u_resolution.y;\n  \n  vec3 ro = u_cameraPos;\n  \n  float cy = cos(u_cameraYaw);\n  float sy = sin(u_cameraYaw);\n  float cp = cos(u_cameraPitch);\n  float sp = sin(u_cameraPitch);\n  \n  vec3 forward = vec3(sy * cp, sp, -cy * cp);\n  vec3 right = vec3(cy, 0.0, sy);\n  vec3 up = cross(right, forward);\n  \n  vec3 rd = normalize(forward + uv.x * right + uv.y * up);\n  \n  // === РЕЖИМ ВОЙДА - СТИЛЬ ЧЁРНОГО БОССА ===\n  if (u_voidMode == 1) {\n    // Skybox - вращается с камерой\n    vec3 voidSky = renderVoidSky(rd, u_time);\n    \n    // Рендерим врагов, портал и острова\n    float d = MAX_DIST;\n    int hitMat = 0;\n    vec3 hitPos = ro;\n    \n    // Ray march\n    float marchDist = 0.0;\n    for (int i = 0; i < MAX_STEPS; i++) {\n      vec3 p = ro + rd * marchDist;\n      float minD = MAX_DIST;\n      \n      // === ОСТРОВА - несколько платформ ===\n      // Главный остров под игроком (уменьшен!)\n      float mainIsland = length(vec2(p.x, p.z)) - 10.0; // Радиус 10\n      float mainHeight = p.y + 0.5; // Толщина острова\n      float mainD = max(mainIsland, mainHeight);\n      mainD = max(mainD, -(p.y + 2.0)); // Нижняя граница\n      if (mainD < minD) {\n        minD = mainD;\n        hitMat = 100; // ground\n      }\n      \n      // Остров у портала (маленький!)\n      vec2 portalIslandPos = u_portalPos.xz;\n      float portalIsland = length(p.xz - portalIslandPos) - 5.0; // Радиус 5\n      float portalIslandH = p.y + 0.5;\n      float portalIslandD = max(portalIsland, portalIslandH);\n      portalIslandD = max(portalIslandD, -(p.y + 2.0));\n      if (portalIslandD < minD) {\n        minD = portalIslandD;\n        hitMat = 100;\n      }\n      \n      // Обломки между островами (прыгать!)\n      vec2 toPortal = normalize(portalIslandPos);\n      float bridgeLen = length(portalIslandPos) - 5.0 - 10.0; // Длина дорожки (портал 5 + главный 10)\n      \n      // 6-8 обломков разного размера и высоты\n      for (int i = 0; i < 8; i++) {\n        // Позиция обломка вдоль дорожки (начинаем после главного острова)\n        float fragmentPos = 12.0 + float(i) * (bridgeLen / 7.0);\n        \n        // Случайное смещение в стороны и по высоте\n        float randX = sin(float(i) * 73.1) * 2.0;\n        float randZ = cos(float(i) * 47.3) * 2.0;\n        float randY = sin(float(i) * 91.7) * 0.8 - 0.3; // Разная высота\n        \n        // Случайный размер (2-4м)\n        float fragmentSize = 2.0 + fract(sin(float(i) * 127.3) * 43758.5) * 2.0;\n        \n        // Позиция обломка\n        vec3 fragmentCenter = vec3(\n          toPortal.x * fragmentPos + randX,\n          randY,\n          toPortal.y * fragmentPos + randZ\n        );\n        \n        // Неровная форма - используем смесь бокса и сферы\n        vec3 fp = p - fragmentCenter;\n        \n        // Вращаем каждый обломок по-разному\n        float rotAngle = float(i) * 0.7;\n        vec3 rotFp = vec3(\n          fp.x * cos(rotAngle) - fp.z * sin(rotAngle),\n          fp.y,\n          fp.x * sin(rotAngle) + fp.z * cos(rotAngle)\n        );\n        \n        // Неровный бокс (разные размеры по осям)\n        float sizeX = fragmentSize * (0.8 + fract(sin(float(i) * 31.7) * 100.0) * 0.4);\n        float sizeZ = fragmentSize * (0.8 + fract(sin(float(i) * 57.3) * 100.0) * 0.4);\n        float fragmentD = max(max(abs(rotFp.x) - sizeX, abs(rotFp.y) - 0.5), abs(rotFp.z) - sizeZ);\n        \n        if (fragmentD < minD) {\n          minD = fragmentD;\n          hitMat = 101; // Обломок\n        }\n      }\n      \n      // Портал выхода (светящаяся сфера)\n      float portalD = length(p - u_portalPos) - 3.0;\n      if (portalD < minD) {\n        minD = portalD;\n        hitMat = 99; // portal\n      }\n      \n      // Враги в войде\n      for (int j = 0; j < u_targetCount; j++) {\n        if (j >= 16) break;\n        vec4 target = u_targets[j];\n        if (target.w > 0.5) {\n          vec3 tp = p - target.xyz;\n          float enemyD = length(tp) - 0.6;\n          if (enemyD < minD) {\n            minD = enemyD;\n            hitMat = 5; // phantom\n          }\n        }\n      }\n      \n      // === ГЛИТЧ-МОНЕТЫ ===\n      for (int c = 0; c < u_bloodCoinCount; c++) {\n        if (c >= 12) break;\n        vec4 coin = u_bloodCoins[c];\n        if (coin.w > 0.5) {\n          vec3 coinPos = coin.xyz;\n          vec3 cp = p - coinPos;\n          \n          // Маленький глитч-куб с искажением\n          float glitchOffset = sin(u_time * 20.0 + float(c) * 10.0) * 0.05;\n          vec3 glitchP = cp + vec3(glitchOffset, 0.0, -glitchOffset);\n          \n          // Маленький кубик (0.2м)\n          float coinD = max(max(abs(glitchP.x), abs(glitchP.y)), abs(glitchP.z)) - 0.15;\n          \n          // Второй смещённый куб для глитч-эффекта\n          vec3 glitchP2 = cp + vec3(-glitchOffset * 0.5, glitchOffset, glitchOffset * 0.3);\n          float cube2 = max(max(abs(glitchP2.x), abs(glitchP2.y)), abs(glitchP2.z)) - 0.12;\n          coinD = min(coinD, cube2);\n          \n          if (coinD < minD) {\n            minD = coinD;\n            hitMat = 102; // glitch coin\n          }\n          \n          // Глитч-аура вокруг монеты (меньше)\n          float glow = length(cp) - 0.4;\n          if (glow < minD && glow > 0.0) {\n            minD = glow;\n            hitMat = 103; // glitch glow\n          }\n        }\n      }\n      \n      marchDist += minD;\n      if (minD < SURF_DIST) {\n        hitPos = p;\n        d = marchDist;\n        break;\n      }\n      if (marchDist > MAX_DIST) break;\n    }\n    \n    vec3 color = voidSky;\n    \n    // Рендерим то, во что попали\n    if (d < MAX_DIST) {\n      if (hitMat == 100 || hitMat == 101) {\n        // === ОСТРОВА - тёмный камень с фиолетовым свечением ===\n        vec3 rockBase = vec3(0.03, 0.02, 0.05);\n        \n        // Текстура камня\n        float noise = sin(hitPos.x * 3.0) * sin(hitPos.z * 3.0) * 0.5 + 0.5;\n        noise += sin(hitPos.x * 7.0 + hitPos.z * 5.0) * 0.2;\n        \n        vec3 rockColor = mix(rockBase, vec3(0.06, 0.03, 0.1), noise);\n        \n        // Светящиеся трещины (фиолетовые)\n        float cracks = sin(hitPos.x * 5.0) * cos(hitPos.z * 4.0);\n        cracks = smoothstep(0.7, 0.9, abs(cracks));\n        rockColor += vec3(0.2, 0.05, 0.4) * cracks * 0.5;\n        \n        // Края острова светятся\n        float edgeDist = length(hitPos.xz);\n        if (hitMat == 100 && edgeDist > 12.0) {\n          float edgeGlow = smoothstep(12.0, 15.0, edgeDist);\n          rockColor += vec3(0.15, 0.05, 0.3) * edgeGlow;\n        }\n        \n        // Мост немного другой цвет\n        if (hitMat == 101) {\n          rockColor = mix(rockColor, vec3(0.05, 0.02, 0.08), 0.3);\n        }\n        \n        // Затухание с расстоянием\n        float fogDist = d / 100.0;\n        rockColor = mix(rockColor, voidSky, smoothstep(0.3, 1.0, fogDist));\n        \n        color = rockColor;\n      } else if (hitMat == 99) {\n        // === ПОРТАЛ ВЫХОДА - фиолетовое свечение ===\n        float pulse = sin(u_time * 3.0) * 0.3 + 0.7;\n        vec3 portalCore = vec3(0.6, 0.2, 1.0) * pulse;\n        vec3 portalEdge = vec3(0.3, 0.1, 0.6);\n        \n        // Fresnel\n        float fresnel = pow(1.0 - max(0.0, dot(-rd, normalize(hitPos - ro))), 2.0);\n        color = mix(portalCore, portalEdge, fresnel);\n        \n        // Искры\n        float spark = sin(u_time * 15.0 + hitPos.y * 8.0 + hitPos.x * 6.0);\n        if (spark > 0.85) {\n          color += vec3(0.8, 0.5, 1.0) * 0.5;\n        }\n        \n        // Свечение\n        color += vec3(0.3, 0.1, 0.5) * (1.0 - fresnel) * 0.6;\n      } else if (hitMat == 5) {\n        // === ВРАГИ - как фантомы босса ===\n        vec3 phantomBlack = vec3(0.01, 0.0, 0.02);\n        vec3 phantomGlow = vec3(0.2, 0.05, 0.35);\n        \n        // Мерцание\n        float flicker = 0.6 + 0.4 * sin(u_time * 12.0 + hitPos.x * 5.0);\n        vec3 enemyColor = phantomBlack * flicker;\n        \n        // Фиолетовое свечение по краям\n        float fresnel = pow(1.0 - max(0.0, dot(-rd, normalize(hitPos - ro))), 3.0);\n        color = mix(enemyColor, phantomGlow, fresnel * 0.8);\n        \n        // Тёмные искры\n        float spark = sin(u_time * 10.0 + hitPos.y * 15.0);\n        if (spark > 0.9) {\n          color += vec3(0.3, 0.1, 0.5) * 0.3;\n        }\n      } else if (hitMat == 102) {\n        // === ГЛИТЧ-МОНЕТА ===\n        vec3 glitchCyan = vec3(0.0, 1.0, 1.0);\n        vec3 glitchMagenta = vec3(1.0, 0.0, 1.0);\n        vec3 glitchWhite = vec3(1.0, 1.0, 1.0);\n        \n        // Хаотичное мерцание между цветами\n        float glitchNoise = fract(sin(dot(hitPos.xy + u_time * 30.0, vec2(12.9898, 78.233))) * 43758.5453);\n        vec3 coinColor = mix(glitchCyan, glitchMagenta, step(0.5, glitchNoise));\n        \n        // Белые вспышки\n        if (glitchNoise > 0.85) {\n          coinColor = glitchWhite;\n        }\n        \n        // RGB сдвиг\n        float rgbShift = sin(u_time * 40.0) * 0.3;\n        coinColor.r *= 1.0 + rgbShift;\n        coinColor.b *= 1.0 - rgbShift;\n        \n        // Scanlines\n        float scanline = step(0.5, fract(hitPos.y * 30.0 + u_time * 50.0));\n        coinColor *= 0.7 + scanline * 0.5;\n        \n        // Яркий\n        coinColor *= 4.0;\n        \n        color = coinColor;\n        \n      } else if (hitMat == 103) {\n        // === ГЛИТЧ-АУРА ===\n        vec3 glitchCyan = vec3(0.0, 0.8, 1.0);\n        vec3 glitchMagenta = vec3(1.0, 0.0, 0.8);\n        \n        // Быстрое мерцание\n        float flicker = fract(sin(u_time * 50.0 + hitPos.x * 20.0) * 100.0);\n        color = mix(glitchCyan, glitchMagenta, step(0.5, flicker)) * 0.8;\n        \n        // Случайные пиксели\n        float noise = fract(sin(dot(hitPos.xz + u_time * 10.0, vec2(12.9898, 78.233))) * 43758.5453);\n        if (noise > 0.9) {\n          color = vec3(1.0) * 2.0;\n        }\n      }\n    }\n    \n    // Фиолетовая виньетка\n    float vig = 1.0 - length(v_uv - 0.5) * 0.5;\n    color *= vig;\n    \n    // Усиливаем фиолетовый\n    color.b *= 1.1;\n    \n    // Тонмаппинг\n    color = color / (color + vec3(1.0));\n    color = pow(color, vec3(0.9));\n    \n    fragColor = vec4(color, 1.0);\n    return;\n  }\n  \n  float d = rayMarch(ro, rd);\n  \n  // Небо как фон (полная яркость)\n  vec3 skyColor = renderSky(rd);\n  vec3 color = skyColor;\n  \n  if (d < MAX_DIST) {\n    vec3 p = ro + rd * d;\n    vec3 n = getNormal(p);\n    \n    map(p);\n    int mat = materialId;\n    \n    // === ОСВЕЩЕНИЕ ПО ЭПОХАМ ===\n    vec3 ambient;\n    vec3 mainLight;\n    vec3 accentColor;\n    vec3 fogColor;\n    \n    if (u_era == 1) {\n      // ЭПОХА 1: Кислотный киберпанк\n      ambient = vec3(0.08, 0.12, 0.08);\n      mainLight = vec3(0.4, 0.6, 0.4);\n      accentColor = vec3(0.3, 1.0, 0.4);\n      fogColor = vec3(0.03, 0.05, 0.03);\n    } else if (u_era == 2) {\n      // ЭПОХА 2: Фиолетовый киберпанк\n      ambient = vec3(0.08, 0.06, 0.12);\n      mainLight = vec3(0.4, 0.3, 0.55);\n      accentColor = vec3(0.8, 0.2, 1.0);\n      fogColor = vec3(0.04, 0.03, 0.06);\n    } else {\n      // ЭПОХА 3: Бирюзовый киберпанк\n      ambient = vec3(0.06, 0.1, 0.12);\n      mainLight = vec3(0.35, 0.5, 0.55);\n      accentColor = vec3(0.0, 0.9, 1.0);\n      fogColor = vec3(0.03, 0.05, 0.07);\n    }\n    \n    // === ЕДИНАЯ СИСТЕМА ОСВЕЩЕНИЯ ===\n    \n    // Цветовая палитра\n    vec3 cyan = vec3(0.2, 0.9, 1.0);\n    vec3 magenta = vec3(1.0, 0.2, 0.6);\n    vec3 warmLight = vec3(1.0, 0.85, 0.7);\n    \n    // AO\n    float ao = calcAO(p, n);\n    \n    // --- KEY LIGHT (луна - тёплый оранжевый) ---\n    vec3 keyDir = normalize(vec3(0.4, 0.5, -0.4)); // Совпадает с moonDir\n    float keyDiff = max(dot(n, keyDir), 0.0);\n    float keyWrap = max(dot(n, keyDir) * 0.5 + 0.5, 0.0); // Wrap lighting для мягкости\n    float keyShadow = softShadow(p + n * 0.02, keyDir, 0.1, 30.0, 8.0);\n    vec3 keyColor = vec3(1.0, 0.6, 0.25); // Тёплый оранжевый от луны\n    vec3 keyLight = keyColor * mix(keyDiff, keyWrap, 0.3) * keyShadow * 0.9;\n    \n    // --- FILL LIGHT (тёплый снизу, сильнее) ---\n    vec3 fillDir = normalize(vec3(-0.2, -0.6, 0.3));\n    float fillDiff = max(dot(n, -fillDir), 0.0) * 0.4 + 0.15;\n    vec3 fillColor = vec3(1.0, 0.7, 0.4); // Тёплый оранжевый\n    vec3 fillLight = fillColor * fillDiff * 0.2;\n    \n    // --- RIM LIGHT (контурный свет сзади) ---\n    vec3 rimDir = normalize(vec3(-0.5, 0.3, 0.8));\n    float rimDot = 1.0 - max(dot(n, -rd), 0.0);\n    float rimLight = pow(rimDot, 3.0) * max(dot(n, rimDir), 0.0);\n    vec3 rimColor = mix(cyan, accentColor, 0.5) * rimLight * 0.4;\n    \n    // --- НЕОНОВЫЕ ИСТОЧНИКИ (4 столба) ---\n    vec3 neonLight = vec3(0.0);\n    float nR = 25.0, nH = 4.0;\n    \n    // Север - циан\n    vec3 toN1 = vec3(0.0, nH, nR) - p;\n    neonLight += cyan * max(dot(n, normalize(toN1)), 0.0) * 20.0 / (1.0 + length(toN1) * 0.1);\n    \n    // Юг - маджента\n    vec3 toN2 = vec3(0.0, nH, -nR) - p;\n    neonLight += magenta * max(dot(n, normalize(toN2)), 0.0) * 20.0 / (1.0 + length(toN2) * 0.1);\n    \n    // Восток/Запад - акцент\n    vec3 toN3 = vec3(nR, nH, 0.0) - p;\n    vec3 toN4 = vec3(-nR, nH, 0.0) - p;\n    neonLight += accentColor * max(dot(n, normalize(toN3)), 0.0) * 18.0 / (1.0 + length(toN3) * 0.1);\n    neonLight += accentColor * max(dot(n, normalize(toN4)), 0.0) * 18.0 / (1.0 + length(toN4) * 0.1);\n    \n    // --- ЦЕНТРАЛЬНЫЙ ИСТОЧНИК ---\n    vec3 toCenter = vec3(0.0, 2.0, 0.0) - p;\n    float centerPulse = 0.8 + 0.2 * sin(u_time * 2.5);\n    vec3 centerLight = accentColor * max(dot(n, normalize(toCenter)), 0.0) * 15.0 / (1.0 + length(toCenter) * 0.08) * centerPulse;\n    \n    // --- SPECULAR ---\n    vec3 halfVec = normalize(keyDir - rd);\n    float spec = pow(max(dot(n, halfVec), 0.0), 48.0);\n    vec3 specColor = vec3(1.0, 0.95, 0.9) * spec * keyShadow * 0.5;\n    // Дополнительный блик от неона\n    float neonSpec = pow(max(dot(n, normalize(vec3(0.0, 1.0, 0.0) - rd)), 0.0), 32.0);\n    specColor += mix(cyan, magenta, 0.5) * neonSpec * 0.4;\n    // Блик от rim\n    specColor += accentColor * pow(rimDot, 5.0) * 0.25;\n    // Блик от rimlight\n    specColor += accentColor * pow(rimDot, 5.0) * 0.3;\n    \n    // --- СОБИРАЕМ ---\n    ambient = vec3(0.04, 0.045, 0.06) * (0.4 + ao * 0.6);\n    vec3 torchLight = keyLight + fillLight + rimColor + neonLight * 0.15 + centerLight * 0.25;\n    torchLight *= ao;\n    \n    // mainDot для материалов\n    float mainDot = keyDiff * keyShadow * 0.6 + 0.2;\n    \n    // Подсветка пола\n    float distFromCenter = length(p.xz);\n    vec3 poolLight = accentColor * smoothstep(20.0, 0.0, distFromCenter) * 0.3;\n    \n    // === МАТЕРИАЛЫ (упрощённые) ===\n    if (mat == 1) {\n      // === ВОДА (стилизованная) ===\n      vec3 waterDeep = vec3(0.02, 0.08, 0.12);\n      vec3 waterMid = vec3(0.05, 0.15, 0.2);\n      vec3 waterSurface = vec3(0.1, 0.25, 0.3);\n      \n      // Глубина воды\n      float depth = smoothstep(0.0, 2.0, -p.y + 1.0);\n      vec3 waterColor = mix(waterDeep, waterMid, depth);\n      \n      // Волны на поверхности\n      float wave = sin(p.x * 3.0 + u_time * 1.5) * sin(p.z * 2.5 + u_time * 1.2) * 0.5 + 0.5;\n      waterColor = mix(waterColor, waterSurface, wave * 0.3);\n      \n      // Неоновые отражения\n      waterColor += accentColor * 0.1 * smoothstep(5.0, 0.0, length(p.xz));\n      \n      // Fresnel\n      float fresnel = pow(1.0 - max(0.0, dot(-rd, n)), 3.0);\n      color = waterColor;\n      color += vec3(0.2, 0.3, 0.35) * fresnel * 0.4;\n      \n    } else if (mat >= 4 && mat <= 12) {\n      // === ВРАГИ (стилизованные) ===\n      \n      vec3 enemyBase = vec3(0.15);\n      vec3 enemyGlow = vec3(0.5);\n      float glowStrength = 0.3;\n      \n      if (mat == 4) {\n        // БЕЙНЛИНГ - токсичный зелёный\n        float pulse = 0.8 + 0.2 * sin(u_time * 3.0 + p.x * 2.0);\n        enemyBase = vec3(0.05, 0.2, 0.05) * pulse;\n        enemyGlow = vec3(0.3, 0.8, 0.2);\n        glowStrength = 0.4;\n        \n      } else if (mat == 5) {\n        // ФАНТОМ - тёмный фиолетовый\n        float flicker = 0.7 + 0.3 * sin(u_time * 8.0 + p.x * 4.0);\n        enemyBase = vec3(0.04, 0.02, 0.08) * flicker;\n        enemyGlow = vec3(0.4, 0.15, 0.6);\n        glowStrength = 0.5;\n      \n    } else if (mat == 6) {\n        // RUNNER - тёплый оранжевый\n        float flame = 0.7 + 0.3 * sin(u_time * 12.0 + p.x * 6.0);\n        enemyBase = vec3(0.4, 0.12, 0.02) * flame;\n        enemyGlow = vec3(0.9, 0.5, 0.1);\n        glowStrength = 0.35;\n        \n      } else if (mat == 7) {\n        // HOPPER - холодный синий\n        float spark = sin(u_time * 20.0 + p.y * 10.0) * 0.5 + 0.5;\n        enemyBase = vec3(0.05, 0.15, 0.35) * (0.8 + spark * 0.2);\n        enemyGlow = vec3(0.3, 0.6, 1.0);\n        glowStrength = 0.4;\n        \n      } else if (mat == 8) {\n        // SPIKER - пурпурный\n        float pulse = 0.8 + 0.2 * sin(u_time * 6.0);\n        enemyBase = vec3(0.15, 0.03, 0.2) * pulse;\n        enemyGlow = vec3(0.6, 0.2, 0.8);\n        glowStrength = 0.35;\n        \n      } else {\n        // БОССЫ\n        float pulse = 0.85 + 0.15 * sin(u_time * 2.0);\n        if (mat == 10) {\n          enemyBase = vec3(0.08, 0.35, 0.06) * pulse;\n          enemyGlow = vec3(0.3, 0.9, 0.2);\n        } else if (mat == 11) {\n          enemyBase = vec3(0.03, 0.01, 0.06) * pulse;\n          enemyGlow = vec3(0.4, 0.1, 0.7);\n        } else {\n          enemyBase = vec3(0.06, 0.12, 0.4) * pulse;\n          enemyGlow = vec3(0.2, 0.5, 0.9);\n        }\n        glowStrength = 0.5;\n      }\n      \n      // Матовая поверхность + мягкое свечение по краям\n      float fresnel = pow(1.0 - max(0.0, dot(-rd, n)), 2.5);\n      color = enemyBase + enemyGlow * fresnel * glowStrength;\n      \n    } else if (mat == 100) {\n      // Placeholder для старого кода (не используется)\n      vec3 blue = vec3(0.2, 0.4, 1.0);\n      vec3 white = vec3(1.0);\n      vec3 cyan = vec3(0.0, 0.8, 1.0);\n      float spark1 = sin(u_time * 30.0 + p.y * 15.0);\n      float spark2 = sin(u_time * 35.0 + p.x * 12.0);\n      float electric = spark1 * spark2;\n      \n      color = mix(blue, cyan, 0.5 + 0.5 * sin(u_time * 8.0));\n      \n      // Яркие вспышки\n      if (electric > 0.8) {\n        color = mix(color, white, 0.7);\n      }\n      color *= 1.5;\n      \n      // Свечение\n      float fresnel = pow(1.0 - max(0.0, dot(-rd, n)), 2.5);\n      color += vec3(0.3, 0.6, 1.0) * fresnel * 0.8;\n      \n    } else if (mat >= 200 && mat < 232) {\n      // === КАПЛИ ЖИЖИ (слизь разлетается!) ===\n      int fragIndex = mat - 200;\n      \n      // Цвет слизи в зависимости от эпохи\n      vec3 slimeColor;\n      vec3 coreGlow; // Внутреннее свечение\n      if (u_era == 1) {\n        // Токсичная зелёная слизь\n        slimeColor = vec3(0.2, 0.85, 0.3);\n        coreGlow = vec3(0.4, 1.0, 0.2);\n      } else if (u_era == 2) {\n        // Тёмная фиолетовая слизь\n        slimeColor = vec3(0.5, 0.1, 0.7);\n        coreGlow = vec3(0.8, 0.2, 1.0);\n      } else {\n        // Огненная оранжевая слизь\n        slimeColor = vec3(0.9, 0.4, 0.05);\n        coreGlow = vec3(1.0, 0.6, 0.1);\n      }\n      \n      // Полупрозрачность и внутреннее свечение (как желе)\n      float fresnel = pow(1.0 - max(0.0, dot(-rd, n)), 2.5);\n      \n      // Подповерхностное рассеивание\n      float sss = pow(max(0.0, dot(n, vec3(0.0, -1.0, 0.0))), 1.5) * 0.4;\n      \n      // Базовый цвет с внутренним свечением\n      color = slimeColor * 0.6;\n      color += coreGlow * (0.3 + sss);\n      \n      // Яркий блик (мокрая поверхность)\n      vec3 lightDir = normalize(vec3(0.3, 1.0, -0.2));\n      float spec = pow(max(0.0, dot(reflect(rd, n), lightDir)), 32.0);\n      color += vec3(1.0) * spec * 0.8;\n      \n      // Френель (края ярче - полупрозрачность)\n      color += coreGlow * fresnel * 0.6;\n      \n      // Пульсация (живая слизь)\n      float pulse = 0.9 + 0.1 * sin(u_time * 15.0 + float(fragIndex) * 2.5);\n      color *= pulse;\n      \n    } else if (mat == 10) {\n      // === ЗЕЛЁНЫЙ БОСС (огромная токсичная жижа) ===\n      vec3 toxicGreen = vec3(0.1, 0.9, 0.2);\n      vec3 darkGreen = vec3(0.0, 0.4, 0.1);\n      vec3 yellow = vec3(0.8, 1.0, 0.0);\n      \n      // Пульсирующее ядовитое свечение\n      float pulse = 0.6 + 0.4 * sin(u_time * 3.0);\n      color = mix(darkGreen, toxicGreen, pulse);\n      \n      // Пузыри на поверхности\n      float bubbles = sin(p.x * 6.0 + u_time * 4.0) * sin(p.z * 6.0 + u_time * 3.0);\n      if (bubbles > 0.7) {\n        color = mix(color, yellow, 0.5);\n      }\n      \n      // Яркое свечение\n      float fresnel = pow(1.0 - max(0.0, dot(-rd, n)), 2.0);\n      color += toxicGreen * fresnel * 1.5;\n      color *= 2.0; // Очень яркий!\n      \n    } else if (mat == 11) {\n      // === ЧЁРНЫЙ БОСС (искривляет пространство) ===\n      vec3 voidBlack = vec3(0.02, 0.0, 0.05);\n      vec3 purple = vec3(0.4, 0.0, 0.6);\n      vec3 darkPurple = vec3(0.15, 0.0, 0.25);\n      \n      // Почти чёрный с пурпурным мерцанием\n      float darkPulse = sin(u_time * 2.0 + p.y * 3.0) * 0.5 + 0.5;\n      color = mix(voidBlack, darkPurple, darkPulse * 0.3);\n      \n      // Искривление видно как переливы\n      float distortion = sin(u_time * 5.0 + p.x * 8.0) * sin(u_time * 4.0 + p.z * 8.0);\n      if (distortion > 0.6) {\n        color += purple * 0.3;\n      }\n      \n      // Жуткое свечение по краям\n      float fresnel = pow(1.0 - max(0.0, dot(-rd, n)), 4.0);\n      color += purple * fresnel * 2.0;\n      \n      // Звёзды внутри (как чёрная дыра)\n      float stars = sin(p.x * 30.0) * sin(p.y * 30.0) * sin(p.z * 30.0);\n      if (stars > 0.95) {\n        color += vec3(1.0, 1.0, 1.0) * 0.5;\n      }\n      \n    } else if (mat == 12) {\n      // === СИНИЙ БОСС (телепортирующийся) ===\n      vec3 electricBlue = vec3(0.0, 0.5, 1.0);\n      vec3 cyan = vec3(0.0, 1.0, 1.0);\n      vec3 white = vec3(1.0, 1.0, 1.0);\n      \n      // Мерцание (телепорт эффект)\n      float flicker = abs(sin(u_time * 25.0));\n      color = mix(electricBlue, cyan, flicker);\n      \n      // Разряды\n      float spark = sin(u_time * 50.0 + p.x * 20.0) * sin(u_time * 45.0 + p.y * 20.0);\n      if (spark > 0.85) {\n        color = white;\n      }\n      \n      // Призрачность\n      float ghost = sin(u_time * 8.0) * 0.3 + 0.7;\n      color *= ghost;\n      \n      // Яркое свечение\n      float fresnel = pow(1.0 - max(0.0, dot(-rd, n)), 2.0);\n      color += cyan * fresnel * 1.5;\n      color *= 1.8;\n      \n    } else if (mat == 13) {\n      // === ТОКСИЧНАЯ ЛУЖА ===\n      vec3 toxicGreen = vec3(0.2, 1.0, 0.3);\n      vec3 darkGreen = vec3(0.0, 0.3, 0.1);\n      \n      // Пульсирующий эффект\n      float pulse = 0.5 + 0.5 * sin(u_time * 4.0 + p.x * 2.0 + p.z * 2.0);\n      color = mix(darkGreen, toxicGreen, pulse);\n      \n      // Пузыри\n      float bubbles = sin(p.x * 10.0 + u_time * 5.0) * sin(p.z * 10.0 + u_time * 4.0);\n      if (bubbles > 0.7) {\n        color += vec3(0.3, 0.5, 0.1);\n      }\n      \n      // Яркое свечение\n      color *= 2.0;\n      \n    } else if (mat == 14) {\n      // === ЛЕПЕСТКИ РОЗЫ (красные, бархатные) ===\n      vec3 roseRed = vec3(0.8, 0.1, 0.15);\n      vec3 roseDark = vec3(0.5, 0.05, 0.1);\n      vec3 rosePink = vec3(1.0, 0.3, 0.4);\n      \n      // Градиент от центра к краям\n      float fresnel = pow(1.0 - max(0.0, dot(-rd, n)), 1.5);\n      color = mix(roseDark, roseRed, 0.5);\n      color = mix(color, rosePink, fresnel * 0.3);\n      \n      // Бархатистая текстура\n      float velvet = pow(max(0.0, dot(-rd, n)), 0.5);\n      color *= (0.7 + velvet * 0.5);\n      \n      // Мягкая пульсация\n      float pulse = 0.9 + 0.1 * sin(u_time * 2.0);\n      color *= pulse;\n      \n      // Свечение\n      color *= 1.8;\n      \n    } else if (mat == 15) {\n      // === СТИМПАК ===\n      // Жёлто-оранжевый энергетический шар\n      vec3 stimYellow = vec3(1.0, 0.8, 0.2);\n      vec3 stimOrange = vec3(1.0, 0.5, 0.1);\n      \n      // Быстрая пульсация\n      float pulse = 0.5 + 0.5 * sin(u_time * 8.0);\n      color = mix(stimOrange, stimYellow, pulse);\n      \n      // Электрические искры\n      float spark = fract(sin(dot(p.xz + u_time * 10.0, vec2(12.9898, 78.233))) * 43758.5453);\n      if (spark > 0.95) {\n        color += vec3(1.0, 1.0, 0.5);\n      }\n      \n      // Яркое свечение\n      color *= 2.5;\n      \n    } else if (mat == 16) {\n      // === БАЛКОН ===\n      vec3 balconyColor = vec3(0.3, 0.25, 0.4); // Тёмно-фиолетовый\n      \n      // Светящиеся линии\n      float gridX = step(0.9, fract(p.x * 2.0));\n      float gridZ = step(0.9, fract(p.z * 2.0));\n      float grid = max(gridX, gridZ);\n      \n      color = mix(balconyColor, accentColor, grid * 0.5);\n      color += accentColor * 0.1; // Лёгкое свечение\n      \n    } else if (mat == 17) {\n      // === ЗАРЯД КАТАНЫ (энергетическая сфера) ===\n      vec3 chargeColor1 = vec3(0.0, 0.8, 1.0); // Бирюзовый\n      vec3 chargeColor2 = vec3(0.0, 1.0, 1.0); // Циан\n      vec3 chargeColor3 = vec3(0.5, 0.8, 1.0); // Светло-голубой\n      \n      // Интенсивная пульсация\n      float pulse = 0.5 + 0.5 * sin(u_time * 6.0);\n      float pulse2 = 0.5 + 0.5 * sin(u_time * 8.0 + 1.0);\n      color = mix(chargeColor1, chargeColor2, pulse);\n      color = mix(color, chargeColor3, pulse2 * 0.3);\n      \n      // Электрические разряды\n      float spark = fract(sin(dot(p.xy + u_time * 10.0, vec2(12.9898, 78.233))) * 43758.5453);\n      if (spark > 0.85) {\n        color += vec3(1.0, 1.0, 1.0); // Белые искры\n      }\n      \n      // Вращающиеся кольца энергии\n      float ring = sin(atan(p.y, p.x) * 3.0 + u_time * 5.0);\n      color += chargeColor2 * max(0.0, ring) * 0.3;\n      \n      // Очень яркое свечение\n      color *= 4.0;\n      \n    } else if (mat == 18) {\n      // === ЧЁРНЫЙ КРИСТАЛЛ СИЛЫ ===\n      vec3 crystalBase = vec3(0.05, 0.02, 0.1); // Очень тёмный фиолетовый\n      vec3 crystalGlow = vec3(0.3, 0.0, 0.5); // Фиолетовое свечение\n      vec3 crystalEdge = vec3(0.8, 0.2, 1.0); // Яркие края\n      \n      // Пульсация\n      float pulse = 0.5 + 0.5 * sin(u_time * 3.0);\n      \n      // Эффект внутреннего свечения\n      float fresnel = pow(1.0 - abs(dot(n, -rd)), 3.0);\n      \n      // Энергетические линии на гранях\n      float edge = fract(p.x * 5.0 + p.y * 5.0 + u_time * 2.0);\n      edge = smoothstep(0.8, 1.0, edge);\n      \n      color = crystalBase;\n      color += crystalGlow * fresnel * 2.0;\n      color += crystalEdge * edge * 0.5;\n      color += crystalGlow * pulse * 0.3;\n      \n      // Искры внутри\n      float spark = fract(sin(dot(p.xyz + u_time * 5.0, vec3(12.9898, 78.233, 45.164))) * 43758.5453);\n      if (spark > 0.95) {\n        color += vec3(1.0, 0.5, 1.0); // Розовые искры\n      }\n      \n      // Общее свечение\n      color *= 2.5;\n      \n    } else if (mat == 19) {\n      // === СНАРЯД КИСЛОТЫ ===\n      vec3 acidCore = vec3(0.2, 1.0, 0.3);\n      vec3 acidGlow = vec3(0.5, 1.0, 0.2);\n      vec3 acidDark = vec3(0.1, 0.4, 0.1);\n      \n      float bubble = sin(p.x * 20.0 + u_time * 15.0) * \n                    sin(p.y * 20.0 + u_time * 12.0) * \n                    sin(p.z * 20.0 + u_time * 18.0);\n      bubble = bubble * 0.5 + 0.5;\n      \n      float veins = sin(p.x * 10.0 + p.y * 15.0 + u_time * 5.0);\n      veins = smoothstep(0.7, 1.0, veins);\n      \n      float fresnel = pow(1.0 - abs(dot(n, -rd)), 2.0);\n      \n      color = mix(acidDark, acidCore, bubble);\n      color += acidGlow * veins * 0.5;\n      color += acidGlow * fresnel * 2.0;\n      \n      float drip = sin(u_time * 8.0 + p.y * 10.0);\n      color *= 0.8 + 0.2 * drip;\n      color *= 3.0;\n      \n    } else if (mat == 20) {\n      // === МЕТКА ДОЖДЯ ===\n      float pulse = sin(u_time * 10.0) * 0.5 + 0.5;\n      color = mix(vec3(1.0, 0.2, 0.0), vec3(0.3, 1.0, 0.2), pulse);\n      color *= 4.0;\n      \n    } else if (mat == 21) {\n      // === ЗОНА ДОЖДЯ НА ЗЕМЛЕ ===\n      float pulse = sin(u_time * 5.0) * 0.3 + 0.7;\n      color = vec3(0.1, 0.8, 0.2) * pulse * 3.0;\n      \n    } else if (mat == 22) {\n      // === СТРУИ КИСЛОТНОГО ДОЖДЯ ===\n      float flicker = sin(u_time * 20.0 + p.y * 5.0) * 0.3 + 0.7;\n      color = vec3(0.2, 1.0, 0.3) * flicker * 2.0;\n      \n    } else if (mat == 23) {\n      // === РАМКА ПОРТАЛА (обсидиан с руническим свечением) ===\n      vec3 obsidian = vec3(0.02, 0.02, 0.03); // Глубокий чёрный\n      vec3 obsidianHighlight = vec3(0.08, 0.06, 0.1); // Лёгкий фиолетовый отлив\n      \n      // Гладкая полированная поверхность\n      float polish = pow(1.0 - max(0.0, dot(-rd, n)), 2.0);\n      color = mix(obsidian, obsidianHighlight, polish * 0.3);\n      \n      // Руны вдоль рамки (светящиеся символы)\n      float runeY = sin(p.y * 3.0) * sin(p.z * 3.0 + u_time * 0.5);\n      float runePattern = smoothstep(0.6, 0.8, abs(runeY));\n      vec3 runeGlow = vec3(1.0, 0.5, 0.1); // Оранжевое свечение\n      color += runeGlow * runePattern * 0.4;\n      \n      // Отблеск огня изнутри\n      vec3 fireGlow = vec3(1.0, 0.4, 0.1);\n      float innerGlow = 1.0 - min(1.0, abs(p.z) / 2.0);\n      float pulse = sin(u_time * 3.0) * 0.2 + 0.8;\n      color += fireGlow * innerGlow * pulse * 0.3;\n      \n      // Металлический блеск\n      float specular = pow(max(0.0, dot(reflect(rd, n), normalize(vec3(1.0, 1.0, 0.5)))), 30.0);\n      color += vec3(1.0, 0.8, 0.6) * specular * 0.2;\n      \n    } else if (mat == 24) {\n      // === ОГНЕННЫЙ ШАР ПОРТАЛА ===\n      // Базовые цвета огня\n      vec3 fireCore = vec3(1.0, 1.0, 0.8);    // Белое ядро\n      vec3 fireYellow = vec3(1.0, 0.9, 0.3);  // Жёлтый\n      vec3 fireOrange = vec3(1.0, 0.5, 0.1);  // Оранжевый\n      vec3 fireRed = vec3(1.0, 0.2, 0.05);    // Красный\n      vec3 fireDark = vec3(0.5, 0.1, 0.0);    // Тёмно-красный\n      \n      // Расстояние от центра шара\n      float dist = length(p - vec3(sign(p.x) * 22.0, 2.0, 0.0));\n      float normalDist = dist / 1.2; // 0 в центре, 1 на краю\n      \n      // Анимированные волны огня\n      float flame1 = sin(p.y * 5.0 + p.z * 3.0 - u_time * 8.0) * 0.5 + 0.5;\n      float flame2 = sin(p.y * 7.0 - p.z * 4.0 + u_time * 6.0) * 0.5 + 0.5;\n      float flame3 = cos(p.y * 4.0 + p.z * 6.0 - u_time * 10.0) * 0.5 + 0.5;\n      float flames = (flame1 + flame2 + flame3) / 3.0;\n      \n      // Градиент от центра к краям\n      color = mix(fireCore, fireYellow, normalDist * 0.5);\n      color = mix(color, fireOrange, normalDist * 0.8);\n      color = mix(color, fireRed, normalDist);\n      \n      // Добавляем анимацию пламени\n      color = mix(color, fireYellow, flames * (1.0 - normalDist) * 0.5);\n      \n      // Пульсация яркости\n      float pulse = 0.8 + 0.2 * sin(u_time * 6.0);\n      float pulse2 = 0.9 + 0.1 * sin(u_time * 15.0 + p.y * 10.0);\n      color *= pulse * pulse2;\n      \n      // Яркость (умеренная)\n      color *= 2.5;\n      \n      // Искры (яркие точки)\n      float spark = sin(p.x * 30.0 + u_time * 20.0) * sin(p.y * 25.0 - u_time * 15.0) * sin(p.z * 28.0 + u_time * 18.0);\n      if (spark > 0.88) {\n        color += vec3(1.0, 0.9, 0.5) * 1.5;\n      }\n      \n    } else if (mat == 25) {\n      // === ПОСТАМЕНТ ПОРТАЛА (каменные ступени) ===\n      vec3 stoneLight = vec3(0.18, 0.15, 0.12); // Светлый камень\n      vec3 stoneMid = vec3(0.12, 0.10, 0.08);   // Средний тон\n      vec3 stoneDark = vec3(0.06, 0.05, 0.04);  // Тёмный камень\n      \n      // Текстура камня - слои и трещины\n      float noise1 = sin(p.x * 8.0) * sin(p.y * 12.0) * sin(p.z * 8.0);\n      float noise2 = sin(p.x * 20.0 + p.z * 15.0) * 0.3;\n      float noise3 = cos(p.y * 25.0 + p.x * 10.0) * 0.2;\n      float stoneTexture = noise1 * 0.15 + noise2 * 0.1 + noise3 * 0.1;\n      \n      // Базовый цвет с текстурой\n      color = mix(stoneDark, stoneMid, 0.5 + stoneTexture);\n      \n      // Светлые грани (верхние поверхности)\n      if (n.y > 0.5) {\n        color = mix(color, stoneLight, 0.4);\n      }\n      \n      // Тёмные грани (боковые и нижние)\n      if (n.y < -0.3) {\n        color = mix(color, stoneDark, 0.5);\n      }\n      \n      // Отблеск огня от портала\n      vec3 fireGlow = vec3(1.0, 0.4, 0.1);\n      float glowIntensity = sin(u_time * 3.0) * 0.15 + 0.25;\n      float distToCenter = abs(p.z) / 3.0; // Ближе к центру - ярче\n      float fireInfluence = max(0.0, 1.0 - distToCenter) * glowIntensity;\n      color += fireGlow * fireInfluence * 0.3;\n      \n      // Патина/мох в углублениях\n      float moss = sin(p.x * 30.0) * sin(p.z * 30.0);\n      if (moss > 0.7 && n.y > 0.3) {\n        color = mix(color, vec3(0.05, 0.12, 0.05), 0.2); // Зеленоватый оттенок\n      }\n      \n      // Блики на гранях\n      float edgeHighlight = pow(max(0.0, dot(n, normalize(vec3(1.0, 1.0, 0.5)))), 8.0);\n      color += vec3(0.15, 0.12, 0.1) * edgeHighlight * 0.3;\n      \n    } else if (mat == 26) {\n      // === ТЕЛО СПАЙКЕРА (органическая кожа с прожилками) ===\n      vec3 skinBase = vec3(0.4, 0.15, 0.1);      // Тёмно-красная кожа\n      vec3 skinLight = vec3(0.7, 0.25, 0.15);    // Светлые участки\n      vec3 veinColor = vec3(0.2, 0.0, 0.05);     // Тёмные прожилки\n      vec3 glowColor = vec3(1.0, 0.3, 0.1);      // Внутреннее свечение\n      \n      // Базовая текстура кожи - неровности\n      float skinNoise = sin(p.x * 20.0 + u_time * 0.5) \n                      * sin(p.y * 18.0 + u_time * 0.3) \n                      * sin(p.z * 22.0 + u_time * 0.4);\n      \n      // Прожилки - сеть линий\n      float veins = sin(p.x * 8.0 + p.y * 5.0) * sin(p.z * 7.0 + p.y * 3.0);\n      veins = smoothstep(0.6, 0.9, abs(veins));\n      \n      // Пульсирующие \"вены\" под кожей\n      float veinPulse = sin(u_time * 3.0 + length(p) * 5.0) * 0.5 + 0.5;\n      \n      // Собираем цвет\n      color = mix(skinBase, skinLight, skinNoise * 0.3 + 0.3);\n      color = mix(color, veinColor, veins * 0.4);\n      \n      // Внутреннее свечение (как будто внутри огонь)\n      float innerGlow = pow(1.0 - max(0.0, dot(-rd, n)), 2.5);\n      color += glowColor * innerGlow * veinPulse * 0.5;\n      \n      // Пульсация\n      float pulse = 0.9 + 0.1 * sin(u_time * 4.0);\n      color *= pulse;\n      \n      // Шипы по краям темнее\n      float distFromCenter = length(p.xz);\n      if (distFromCenter > 0.5) {\n        color = mix(color, veinColor, 0.3);\n      }\n      \n      // Подсветка\n      color *= 1.4;\n      \n      // Fresnel - красноватый отблеск\n      float fresnel = pow(1.0 - max(0.0, dot(-rd, n)), 2.0);\n      color += glowColor * fresnel * 0.4;\n      \n    } else if (mat == 27) {\n      // === ЛАЗЕР СПАЙКЕРА ===\n      vec3 laserCore = vec3(1.0, 1.0, 1.0);   // Яркое белое ядро\n      vec3 laserRed = vec3(1.0, 0.1, 0.0);    // Красный\n      vec3 laserOrange = vec3(1.0, 0.4, 0.0); // Оранжевый\n      \n      // Пульсация\n      float pulse = 0.8 + 0.2 * sin(u_time * 30.0 + p.x * 20.0 + p.y * 25.0);\n      \n      // Электрические разряды вдоль луча\n      float spark = sin(u_time * 50.0 + length(p) * 30.0);\n      \n      // Ядро белое, края красно-оранжевые\n      color = mix(laserCore, laserRed, 0.3);\n      if (spark > 0.7) {\n        color = mix(color, laserCore, 0.5); // Яркие вспышки\n      }\n      \n      color *= pulse;\n      color *= 5.0; // Очень ярко!\n      \n      // Fresnel свечение\n      float fresnel = pow(1.0 - max(0.0, dot(-rd, n)), 1.0);\n      color += laserOrange * fresnel * 2.0;\n      \n    } else if (mat == 28) {\n      // === ЗРАЧОК СПАЙКЕРА (чёрный с красным свечением) ===\n      vec3 pupilBlack = vec3(0.0, 0.0, 0.0);\n      vec3 glowRed = vec3(1.0, 0.0, 0.0);\n      \n      color = pupilBlack;\n      \n      // Красное свечение изнутри\n      float innerGlow = pow(1.0 - max(0.0, dot(-rd, n)), 3.0);\n      color += glowRed * innerGlow * 2.0;\n      \n      // Пульсация\n      float pulse = 0.5 + 0.5 * sin(u_time * 4.0);\n      color += glowRed * pulse * 0.3;\n      \n    } else if (mat == 29) {\n      // === РАДУЖКА СПАЙКЕРА (красно-оранжевая, огненная) ===\n      vec3 irisRed = vec3(0.9, 0.1, 0.0);\n      vec3 irisOrange = vec3(1.0, 0.5, 0.0);\n      vec3 irisYellow = vec3(1.0, 0.8, 0.2);\n      \n      // Радиальные полосы как в настоящем глазе\n      float angle = atan(p.y, p.x);\n      float radialPattern = sin(angle * 12.0 + u_time * 2.0) * 0.5 + 0.5;\n      \n      // Пульсирующие кольца\n      float rings = sin(length(p) * 30.0 - u_time * 5.0) * 0.5 + 0.5;\n      \n      color = mix(irisRed, irisOrange, radialPattern);\n      color = mix(color, irisYellow, rings * 0.3);\n      \n      // Огненное свечение\n      color *= 2.0;\n      \n      // Блик\n      float highlight = pow(max(0.0, dot(-rd, n)), 20.0);\n      color += vec3(1.0, 0.9, 0.8) * highlight * 0.5;\n      \n    } else if (mat == 32) {\n      // === КАМЕНЬ АЛТАРЯ ===\n      vec3 stoneBase = vec3(0.2, 0.18, 0.15);     // Тёмный камень\n      vec3 stoneLight = vec3(0.35, 0.3, 0.25);    // Светлые участки\n      vec3 mossColor = vec3(0.1, 0.2, 0.1);       // Мох\n      \n      // Текстура камня\n      float stoneNoise = sin(p.x * 10.0) * sin(p.y * 8.0) * sin(p.z * 12.0);\n      \n      color = mix(stoneBase, stoneLight, stoneNoise * 0.3 + 0.3);\n      \n      // Немного мха внизу\n      float mossAmount = smoothstep(1.0, 0.0, p.y) * 0.3;\n      color = mix(color, mossColor, mossAmount);\n      \n      // Резьба/узоры\n      float carving = sin(p.y * 20.0) * sin(atan(p.x, p.z) * 8.0);\n      color *= 0.9 + carving * 0.1;\n      \n      // Освещение\n      float light = max(0.0, dot(n, normalize(vec3(1.0, 1.0, 0.5))));\n      color *= 0.6 + light * 0.6;\n      \n    } else if (mat == 33) {\n      // === ОГОНЬ В АЛТАРЕ ===\n      vec3 fireWhite = vec3(1.0, 1.0, 0.9);\n      vec3 fireOrange = vec3(1.0, 0.6, 0.1);\n      vec3 fireRed = vec3(1.0, 0.2, 0.0);\n      \n      // Динамическое пламя\n      float flame = sin(u_time * 15.0 + p.y * 10.0 + p.x * 5.0);\n      float flicker = sin(u_time * 20.0 + p.z * 8.0);\n      \n      // Цвет от центра к краям\n      float gradient = smoothstep(0.0, 1.0, p.y);\n      color = mix(fireWhite, fireOrange, gradient);\n      color = mix(color, fireRed, gradient * 0.5);\n      \n      // Мерцание\n      color *= 0.8 + flame * 0.2 + flicker * 0.1;\n      \n      // Очень яркий\n      color *= 4.0;\n      \n      // Свечение\n      float fresnel = pow(1.0 - max(0.0, dot(-rd, n)), 1.5);\n      color += fireOrange * fresnel * 2.0;\n      \n    } else if (mat == 34) {\n      // === СВЕТЯЩИЙСЯ СИМВОЛ АЛТАРЯ ===\n      vec3 glowCyan = vec3(0.0, 1.0, 0.8);\n      vec3 glowWhite = vec3(1.0, 1.0, 1.0);\n      \n      // Пульсация\n      float pulse = 0.7 + 0.3 * sin(u_time * 3.0);\n      \n      color = mix(glowCyan, glowWhite, 0.3);\n      color *= pulse * 3.0;\n      \n      // Fresnel\n      float fresnel = pow(1.0 - max(0.0, dot(-rd, n)), 2.0);\n      color += glowCyan * fresnel * 1.5;\n      \n    } else if (mat == 35) {\n      // === ЯДРО ЭНЕРГЕТИЧЕСКОГО ЛУЧА (ярко-белое) ===\n      vec3 coreWhite = vec3(1.0, 1.0, 1.0);\n      vec3 coreBlue = vec3(0.8, 0.9, 1.0);\n      \n      // Пульсация\n      float pulse = 0.9 + 0.1 * sin(u_time * 30.0);\n      \n      // Ярко-белое ядро\n      color = mix(coreWhite, coreBlue, 0.1);\n      color *= pulse;\n      \n      // ОЧЕНЬ яркое!\n      color *= 8.0;\n      \n      // Дополнительное свечение от fresnel\n      float fresnel = pow(1.0 - max(0.0, dot(-rd, n)), 1.0);\n      color += coreWhite * fresnel * 3.0;\n      \n    } else if (mat == 36) {\n      // === ВНЕШНЕЕ СВЕЧЕНИЕ ЛУЧА (голубое) ===\n      vec3 glowCyan = vec3(0.3, 0.8, 1.0);\n      vec3 glowWhite = vec3(0.9, 0.95, 1.0);\n      \n      // Пульсация\n      float pulse = 0.7 + 0.3 * sin(u_time * 25.0 + p.x * 5.0);\n      \n      color = mix(glowCyan, glowWhite, 0.4);\n      color *= pulse * 4.0;\n      \n      // Fresnel для объёма\n      float fresnel = pow(1.0 - max(0.0, dot(-rd, n)), 2.0);\n      color += glowCyan * fresnel * 2.0;\n      \n    } else if (mat == 37) {\n      // === СЛЕД ЛУЧА (затухающий) ===\n      vec3 trailCyan = vec3(0.2, 0.6, 1.0);\n      vec3 trailPurple = vec3(0.5, 0.2, 1.0);\n      \n      // Мерцание\n      float flicker = sin(u_time * 40.0 + p.y * 10.0 + p.x * 15.0);\n      \n      // Цвет меняется по следу\n      color = mix(trailCyan, trailPurple, 0.3 + flicker * 0.2);\n      \n      // Яркость\n      color *= 2.5;\n      \n      // Искры\n      if (flicker > 0.8) {\n        color += vec3(1.0) * 1.5;\n      }\n      \n    } else if (mat == 38) {\n      // === ЦЕНТРАЛЬНЫЙ ПОРТАЛ (огненный вихрь как боковые) ===\n      \n      // Расстояние от центра\n      float distFromCenter = length(p.xz);\n      float normalizedDist = distFromCenter / 0.9;\n      \n      // Базовые цвета огня\n      vec3 fireCore = vec3(1.0, 1.0, 0.8);    // Белое ядро\n      vec3 fireYellow = vec3(1.0, 0.9, 0.3);  // Жёлтый\n      vec3 fireOrange = vec3(1.0, 0.5, 0.1);  // Оранжевый\n      vec3 fireRed = vec3(1.0, 0.2, 0.05);    // Красный\n      \n      // Анимированные волны огня\n      float angle = atan(p.z, p.x);\n      float flame1 = sin(angle * 6.0 + p.y * 5.0 - u_time * 8.0) * 0.5 + 0.5;\n      float flame2 = sin(angle * 8.0 - p.y * 3.0 + u_time * 6.0) * 0.5 + 0.5;\n      float flame3 = cos(angle * 4.0 + p.y * 6.0 - u_time * 10.0) * 0.5 + 0.5;\n      float flames = (flame1 + flame2 + flame3) / 3.0;\n      \n      // Градиент от центра к краям\n      color = mix(fireCore, fireYellow, normalizedDist * 0.4);\n      color = mix(color, fireOrange, normalizedDist * 0.6 + flames * 0.3);\n      color = mix(color, fireRed, normalizedDist * 0.8);\n      \n      // Вихревой эффект\n      float swirl = sin(angle * 12.0 - u_time * 5.0) * 0.5 + 0.5;\n      color += vec3(1.0, 0.6, 0.2) * swirl * (1.0 - normalizedDist) * 0.5;\n      \n      // Пульсация\n      float pulse = 0.8 + 0.2 * sin(u_time * 5.0);\n      color *= pulse;\n      \n      // Яркость\n      color *= 3.0 * (1.0 - normalizedDist * 0.5);\n      \n    } else if (mat == 39) {\n      // === СВЕЧЕНИЕ ПОРТАЛА (фиолетовое) ===\n      vec3 glowPurple = vec3(0.6, 0.2, 1.0);\n      vec3 glowPink = vec3(1.0, 0.4, 0.8);\n      \n      // Пульсация\n      float pulse = 0.6 + 0.4 * sin(u_time * 5.0 + p.y * 2.0);\n      \n      // Вращение\n      float angle = atan(p.z, p.x);\n      float spin = sin(angle * 8.0 - u_time * 3.0) * 0.5 + 0.5;\n      \n      color = mix(glowPurple, glowPink, spin * 0.5);\n      color *= pulse * 2.5;\n      \n      // Fresnel\n      float fresnel = pow(1.0 - max(0.0, dot(-rd, n)), 1.5);\n      color += glowPurple * fresnel * 1.5;\n      \n    } else if (mat == 40) {\n      // === ЭНЕРГЕТИЧЕСКИЕ КОЛЬЦА ПОРТАЛА ===\n      vec3 ringPurple = vec3(0.8, 0.3, 1.0);\n      vec3 ringWhite = vec3(1.0, 0.9, 1.0);\n      \n      // Быстрая пульсация\n      float pulse = 0.7 + 0.3 * sin(u_time * 15.0 + p.y * 5.0);\n      \n      color = mix(ringPurple, ringWhite, 0.3);\n      color *= pulse * 4.0;\n      \n      // Искры\n      float sparkle = sin(u_time * 30.0 + p.x * 10.0 + p.z * 12.0);\n      if (sparkle > 0.85) {\n        color += vec3(1.0) * 2.0;\n      }\n      \n    } else if (mat == 41) {\n      // === ГРАНАТА (обычная, зелёная) ===\n      vec3 grenadeGreen = vec3(0.2, 0.5, 0.2);\n      vec3 grenadeBlack = vec3(0.1, 0.1, 0.1);\n      \n      // Полоски на гранате\n      float stripes = sin(p.y * 20.0);\n      color = mix(grenadeGreen, grenadeBlack, stripes * 0.3 + 0.35);\n      \n      // Металлический блеск\n      float fresnel = pow(1.0 - max(0.0, dot(-rd, n)), 2.0);\n      color += vec3(0.4, 0.5, 0.4) * fresnel * 0.5;\n      \n    } else if (mat == 42) {\n      // === ГРАНАТА (мигает перед взрывом) ===\n      vec3 grenadeRed = vec3(1.0, 0.2, 0.1);\n      vec3 grenadeYellow = vec3(1.0, 0.8, 0.2);\n      \n      // Быстрое мигание\n      float blink = sin(u_time * 30.0) * 0.5 + 0.5;\n      color = mix(grenadeRed, grenadeYellow, blink);\n      \n      // Яркое свечение\n      color *= 3.0;\n      \n    } else if (mat == 43) {\n      // === ВЗРЫВ (GLITCH ЭФФЕКТ) ===\n      // Базовые цвета глитча\n      vec3 glitchCyan = vec3(0.0, 1.0, 1.0);\n      vec3 glitchMagenta = vec3(1.0, 0.0, 1.0);\n      vec3 glitchWhite = vec3(1.0, 1.0, 1.0);\n      vec3 glitchBlack = vec3(0.0, 0.0, 0.0);\n      \n      // Хаотичный шум для глитча\n      float glitchNoise = fract(sin(dot(p.xy + u_time * 50.0, vec2(12.9898, 78.233))) * 43758.5453);\n      float blockNoise = floor(glitchNoise * 8.0) / 8.0;\n      \n      // Горизонтальные полосы сбоя\n      float scanline = step(0.5, fract(p.y * 20.0 + u_time * 100.0));\n      \n      // RGB сдвиг\n      float rgbShift = sin(u_time * 30.0 + p.y * 5.0) * 0.5;\n      \n      // Основной цвет - мерцание между циан и маджента\n      color = mix(glitchCyan, glitchMagenta, blockNoise);\n      \n      // Добавляем белые вспышки\n      if (glitchNoise > 0.8) {\n        color = glitchWhite;\n      }\n      \n      // Чёрные провалы\n      if (glitchNoise < 0.15) {\n        color = glitchBlack;\n      }\n      \n      // Scanlines\n      color *= 0.8 + scanline * 0.4;\n      \n      // RGB смещение\n      color.r *= 1.0 + rgbShift * 0.3;\n      color.b *= 1.0 - rgbShift * 0.3;\n      \n      // Очень яркий\n      color *= 4.0;\n      \n      // Случайные яркие пиксели\n      if (fract(sin(dot(floor(p.xz * 10.0), vec2(41.1, 67.3)) + u_time * 20.0) * 1000.0) > 0.95) {\n        color = glitchWhite * 8.0;\n      }\n      \n    } else if (mat == 44) {\n      // === ГЛУБИНА ЖИЛЫ/ВОЙДА (тёмная бездна) ===\n      vec3 voidDeep = vec3(0.02, 0.03, 0.05);\n      vec3 voidGlow = vec3(0.08, 0.15, 0.2);\n      \n      // Глубинное затемнение\n      float depth = abs(p.y + 5.0) / 10.0;\n      color = mix(voidGlow, voidDeep, depth);\n      \n      // Еле заметные течения\n      float flow = sin(p.x * 1.5 + u_time * 0.3) * sin(p.z * 1.5 + u_time * 0.2);\n      color += vec3(0.03, 0.06, 0.08) * flow * 0.5;\n      \n      // Очень редкие блики\n      float flash = fract(sin(dot(floor(p.xz * 0.3), vec2(12.9, 78.2)) + u_time * 0.5) * 43758.0);\n      if (flash > 0.98) {\n        color += vec3(0.1, 0.2, 0.25);\n      }\n      \n    } else if (mat == 45) {\n      // === ПОВЕРХНОСТЬ ВОЙДА (прозрачная дымка) ===\n      vec3 surfaceCore = vec3(0.1, 0.2, 0.25);\n      vec3 surfaceEdge = vec3(0.05, 0.08, 0.12);\n      vec3 surfaceHighlight = vec3(0.3, 0.4, 0.5);\n      \n      // Мягкие волны\n      float wave1 = sin(p.x * 2.0 + u_time * 1.0) * sin(p.z * 1.8 + u_time * 0.8);\n      float wave2 = sin(p.x * 3.0 - u_time * 0.7) * sin(p.z * 2.5 + u_time * 0.5);\n      float waves = (wave1 + wave2) * 0.5;\n      \n      // Прозрачный цвет\n      color = mix(surfaceEdge, surfaceCore, 0.4 + waves * 0.2);\n      \n      // Редкие блики\n      float highlight = pow(max(0.0, waves), 4.0);\n      color = mix(color, surfaceHighlight, highlight * 0.3);\n      \n      // Редкие белые искры\n      float glint = fract(sin(dot(p.xz + u_time * 3.0, vec2(12.9, 78.2))) * 43758.0);\n      if (glint > 0.96) {\n        color = mix(color, vec3(0.4, 0.5, 0.6), 0.5);\n      }\n      \n      // Умеренное свечение\n      color *= 1.5;\n      \n    } else if (mat == 46) {\n      // === БОРТИК ОБРЫВА ===\n      vec3 stoneBase = vec3(0.15, 0.1, 0.2);\n      vec3 voidGlow = vec3(0.4, 0.0, 0.8);\n      \n      // Грубая текстура камня\n      float noise = fract(sin(dot(floor(p.xz * 5.0), vec2(12.9, 78.2))) * 43758.0);\n      color = mix(stoneBase, stoneBase * 1.5, noise);\n      \n      // Фиолетовое свечение от реки войда\n      float glowStrength = sin(u_time * 3.0) * 0.3 + 0.5;\n      color = mix(color, voidGlow, glowStrength * 0.4);\n      \n      // Блестящие прожилки\n      float vein = sin(p.x * 20.0 + p.z * 15.0) * sin(p.y * 30.0);\n      if (vein > 0.85) {\n        color += vec3(0.3, 0.0, 0.5);\n      }\n      \n    } else if (mat == 47) {\n      // === БОРТИК ЖИЛЫ (обветренный камень) ===\n      vec3 darkStone = vec3(0.12, 0.11, 0.10);\n      vec3 edgeGlow = vec3(0.15, 0.25, 0.3);\n      \n      // Тёмный обветренный камень\n      float stoneNoise = noise(p.xz * 8.0);\n      color = darkStone * (0.8 + stoneNoise * 0.4);\n      \n      // Тонкие прожилки энергии\n      float vein1 = sin(p.x * 20.0) * sin(p.z * 18.0);\n      if (vein1 > 0.9) {\n        color = mix(color, edgeGlow, 0.5);\n      }\n      \n      // Лёгкое голубоватое свечение от жилы\n      color += edgeGlow * 0.05;\n      \n    } else if (mat == 48) {\n      // === ПОВЕРХНОСТЬ ЖИЛЫ (прозрачная энергия) ===\n      vec3 voidBlue = vec3(0.05, 0.1, 0.2);\n      vec3 voidCyan = vec3(0.1, 0.3, 0.4);\n      vec3 glitchWhite = vec3(0.5, 0.6, 0.7);\n      \n      // Мягкое течение\n      float flow = sin(p.x * 2.0 + p.z * 2.0 - u_time * 1.5);\n      flow = flow * 0.5 + 0.5;\n      \n      // Прозрачный голубоватый цвет\n      color = mix(voidBlue, voidCyan, flow * 0.6);\n      \n      // Лёгкая пульсация\n      float pulse = sin(u_time * 0.8) * 0.2 + 0.8;\n      color *= pulse;\n      \n      // Редкие белые блики\n      float glint = fract(sin(dot(p.xz + u_time * 2.0, vec2(12.9, 78.2))) * 43758.0);\n      if (glint > 0.97) {\n        color = mix(color, glitchWhite, 0.4);\n      }\n      \n      // Умеренное свечение\n      color *= 1.2;\n      \n    } else if (mat == 31) {\n      // === БОЛЬШАЯ АПТЕЧКА (на краях карты) ===\n      vec3 healthWhite = vec3(1.0, 1.0, 1.0);\n      vec3 healthGold = vec3(1.0, 0.85, 0.3);\n      vec3 healthGreen = vec3(0.3, 1.0, 0.5);\n      \n      // Пульсация\n      float pulse = 0.7 + 0.3 * sin(u_time * 5.0);\n      \n      // Градиент от золотого к белому\n      float gradient = p.y * 0.5 + 0.5;\n      color = mix(healthGold, healthWhite, gradient);\n      \n      // Зелёный оттенок для \"здоровья\"\n      color = mix(color, healthGreen, 0.2);\n      \n      // Очень яркое свечение\n      color *= pulse * 2.5;\n      \n      // Fresnel аура\n      float fresnel = pow(1.0 - max(0.0, dot(-rd, n)), 2.0);\n      color += healthGold * fresnel * 1.5;\n      \n      // Искры\n      float sparkle = sin(u_time * 20.0 + p.x * 10.0 + p.y * 15.0);\n      if (sparkle > 0.9) {\n        color += vec3(1.0) * 0.5;\n      }\n      \n    } else if (mat == 30) {\n      // === ВОДА В БАССЕЙНЕ (тёмная, атмосферная) ===\n      vec3 waterDeep = vec3(0.01, 0.04, 0.06);\n      vec3 waterMid = vec3(0.03, 0.08, 0.12);\n      vec3 waterGlow = vec3(0.1, 0.25, 0.35);\n      \n      // Волны (медленные, плавные)\n      float wave = sin(p.x * 2.0 + u_time * 0.8) * sin(p.z * 1.8 + u_time * 0.6);\n      float ripple = sin(length(p.xz) * 4.0 - u_time * 1.5) * 0.5 + 0.5;\n      \n      // Глубина\n      float depth = smoothstep(2.0, 8.0, length(p.xz));\n      vec3 waterColor = mix(waterDeep, waterMid, depth);\n      waterColor += waterGlow * wave * 0.15;\n      \n      // Неоновые отблески\n      waterColor += accentColor * 0.08 * smoothstep(8.0, 2.0, length(p.xz));\n      \n      // Мягкие блики\n      float fresnel = pow(1.0 - max(0.0, dot(-rd, n)), 3.0);\n      float spec = pow(max(0.0, dot(reflect(rd, n), vec3(0.0, 1.0, 0.0))), 16.0);\n      \n      color = waterColor;\n      color += waterGlow * fresnel * 0.25;\n      color += vec3(0.15, 0.2, 0.25) * spec * 0.3;\n      color += waterGlow * ripple * 0.05;\n      \n    } else if (mat == 50) {\n      // === ТЁМНЫЙ КАМЕНЬ (основание) ===\n      vec3 stoneBase = vec3(0.06, 0.055, 0.05);\n      vec3 stoneDark = vec3(0.025, 0.022, 0.02);\n      vec3 stoneLight = vec3(0.09, 0.08, 0.07);\n      \n      // Текстура камня\n      float stoneNoise = noise(p.xz * 6.0);\n      float detailNoise = noise(p.xz * 20.0) * 0.3;\n      \n      vec3 stone = mix(stoneDark, stoneBase, stoneNoise * 0.6);\n      stone = mix(stone, stoneLight, detailNoise);\n      \n      // Трещины\n      float crack = sharpNoise(p.xz * 15.0);\n      if (crack > 0.88) stone *= 0.6;\n      \n      // Грани\n      float angle = atan(p.z, p.x);\n      float edge = smoothstep(0.9, 1.0, abs(cos(angle * 8.0)));\n      stone = mix(stone, stoneLight, edge * 0.2);\n      \n      color = stone * ambient * 1.3;\n      color += stone * torchLight * 0.5;\n      \n    } else if (mat == 51) {\n      // === МРАМОР (колонна) ===\n      vec3 marbleBase = vec3(0.15, 0.14, 0.13);\n      vec3 marbleLight = vec3(0.22, 0.2, 0.18);\n      vec3 marbleVein = vec3(0.06, 0.055, 0.05);\n      \n      // Прожилки\n      float vein1 = sin(p.x * 8.0 + p.y * 3.0 + noise(p.xz * 2.0) * 4.0);\n      float vein2 = sin(p.z * 6.0 - p.y * 4.0 + noise(p.xy * 2.0) * 3.0);\n      float veins = smoothstep(0.8, 0.95, abs(vein1)) + smoothstep(0.85, 0.98, abs(vein2)) * 0.5;\n      \n      // Базовый цвет\n      vec3 marble = mix(marbleBase, marbleLight, noise(p.xz * 1.5) * 0.3);\n      marble = mix(marble, marbleVein, veins * 0.6);\n      \n      // Мягкий блик\n      float fresnel = pow(1.0 - max(0.0, dot(-rd, n)), 3.0);\n      float spec = pow(max(0.0, dot(reflect(rd, n), vec3(0.0, 1.0, 0.0))), 32.0);\n      \n      color = marble * ambient * 1.4;\n      color += marble * torchLight * 0.4;\n      color += vec3(0.15, 0.13, 0.12) * spec * 0.2;\n      color += marbleLight * fresnel * 0.1;\n      \n    } else if (mat == 52) {\n      // === БРОНЗА (декор) ===\n      vec3 bronzeBase = vec3(0.12, 0.08, 0.04);\n      vec3 bronzeHighlight = vec3(0.2, 0.14, 0.06);\n      vec3 bronzePatina = vec3(0.05, 0.1, 0.08);\n      \n      // Патина\n      float patina = noise(p.xz * 6.0);\n      vec3 bronze = mix(bronzeBase, bronzePatina, patina * 0.4);\n      \n      // Металлический блеск\n      float fresnel = pow(1.0 - max(0.0, dot(-rd, n)), 3.0);\n      float spec = pow(max(0.0, dot(reflect(rd, n), vec3(0.0, 1.0, 0.0))), 24.0);\n      \n      color = bronze * ambient * 1.3;\n      color += bronze * torchLight * 0.5;\n      color += bronzeHighlight * spec * 0.25;\n      color += bronzeHighlight * fresnel * 0.15;\n      \n    } else if (mat == 53) {\n      // === МОЗАИКА (центр арены) ===\n      vec3 mosaicDark = vec3(0.04, 0.035, 0.05);\n      vec3 mosaicMid = vec3(0.08, 0.07, 0.09);\n      vec3 mosaicAccent = accentColor * 0.3;\n      \n      // Геометрический паттерн\n      float angle = atan(p.z, p.x);\n      float dist = length(p.xz);\n      \n      // Лучи + круги\n      float rays = sin(angle * 8.0) * 0.5 + 0.5;\n      float rings = sin(dist * 3.0) * 0.5 + 0.5;\n      float pattern = rays * rings;\n      \n      vec3 mosaic = mix(mosaicDark, mosaicMid, pattern * 0.6);\n      \n      // Неоновые линии (редкие)\n      float neonLine = smoothstep(0.94, 0.96, abs(sin(angle * 12.0)));\n      neonLine += smoothstep(0.94, 0.96, abs(sin(dist * 5.0)));\n      mosaic += mosaicAccent * neonLine * 0.5;\n      \n      color = mosaic * ambient * 1.4;\n      color += mosaic * torchLight * 0.5;\n      \n    } else if (mat == 54) {\n      // === ДЕКОРАТИВНОЕ КОЛЬЦО ===\n      vec3 ringBase = vec3(0.05, 0.045, 0.04);\n      vec3 ringLight = vec3(0.08, 0.07, 0.06);\n      vec3 ringGlow = accentColor * 0.4;\n      \n      // Руны\n      float angle = atan(p.z, p.x);\n      float rune = sin(angle * 12.0) * sin(length(p.xz) * 3.0);\n      \n      vec3 ring = mix(ringBase, ringLight, noise(p.xz * 4.0) * 0.4);\n      \n      // Мягкое свечение рун\n      float runeGlow = smoothstep(0.6, 0.8, abs(rune)) * (0.6 + 0.4 * sin(u_time * 1.5));\n      ring += ringGlow * runeGlow * 0.3;\n      \n      color = ring * ambient * 1.3;\n      color += ring * torchLight * 0.5;\n      \n    } else if (mat == 55) {\n      // === ПОЛ (тёмный бетон с неоновыми акцентами) ===\n      \n      // Базовые цвета - тёмно-серый бетон\n      vec3 concreteBase = vec3(0.08, 0.075, 0.07);\n      vec3 concreteDark = vec3(0.04, 0.038, 0.035);\n      vec3 concreteLight = vec3(0.12, 0.11, 0.1);\n      \n      // Большие плиты (2x2 метра)\n      vec2 tileCoord = floor(p.xz * 0.5);\n      vec2 tileFract = fract(p.xz * 0.5);\n      float tileId = hash(tileCoord);\n      \n      // Вариация цвета плиты\n      vec3 tileColor = mix(concreteDark, concreteBase, tileId * 0.5);\n      \n      // Текстура бетона (шум)\n      float concreteNoise = noise(p.xz * 8.0) * 0.3;\n      tileColor = mix(tileColor, concreteLight, concreteNoise);\n      \n      // Мелкие трещины\n      float cracks = sharpNoise(p.xz * 25.0);\n      if (cracks > 0.85) {\n        tileColor *= 0.7;\n      }\n      \n      // Швы между плитами\n      float seamX = smoothstep(0.02, 0.04, tileFract.x) * smoothstep(0.02, 0.04, 1.0 - tileFract.x);\n      float seamY = smoothstep(0.02, 0.04, tileFract.y) * smoothstep(0.02, 0.04, 1.0 - tileFract.y);\n      float seam = seamX * seamY;\n      tileColor = mix(vec3(0.02), tileColor, seam);\n      \n      // Неоновые полосы на полу (редкие)\n      float stripeX = smoothstep(0.48, 0.5, tileFract.x) * smoothstep(0.52, 0.5, tileFract.x);\n      float stripeY = smoothstep(0.48, 0.5, tileFract.y) * smoothstep(0.52, 0.5, tileFract.y);\n      float stripe = max(stripeX, stripeY) * step(0.8, tileId);\n      \n      // Мокрые отражения (приглушённые)\n      vec3 reflDir = reflect(rd, n);\n      float fresnel = pow(1.0 - max(dot(-rd, n), 0.0), 2.5);\n      \n      vec3 wetReflect = vec3(0.0);\n      float ref1 = pow(max(dot(reflDir, vec3(0.0, 1.0, 0.0)), 0.0), 8.0);\n      wetReflect += accentColor * ref1 * 0.15;\n      \n      // Собираем цвет\n      color = tileColor * ambient * 1.2;\n      color += tileColor * torchLight * 0.4;\n      color += wetReflect * fresnel * 0.5;\n      \n      // Неоновые полосы\n      color += accentColor * stripe * 0.3 * (0.7 + 0.3 * sin(u_time * 2.0));\n      \n    } else if (mat == 60) {\n      // === КАМЕНЬ СТОЛБА ===\n      vec3 stoneBase = vec3(0.07, 0.065, 0.06);\n      vec3 stoneDark = vec3(0.035, 0.03, 0.028);\n      vec3 stoneLight = vec3(0.1, 0.09, 0.08);\n      \n      // Текстура\n      float stoneNoise = noise(p.xz * 3.0);\n      vec3 stoneColor = mix(stoneDark, stoneBase, stoneNoise * 0.5);\n      \n      // Детали\n      float detail = noise(p.xz * 10.0) * 0.3;\n      stoneColor = mix(stoneColor, stoneLight, detail);\n      \n      // Мох (редкий)\n      float moss = smoothstep(0.3, 1.0, p.y) * noise(p.xz * 2.0);\n      stoneColor = mix(stoneColor, vec3(0.03, 0.06, 0.02), moss * 0.2);\n      \n      color = stoneColor * ambient * 1.3;\n      color += stoneColor * torchLight * 0.5;\n      \n    } else if (mat == 61) {\n      // === МЕТАЛЛ ЧАШИ (тёмная бронза) ===\n      vec3 metalBase = vec3(0.08, 0.055, 0.03);\n      vec3 metalHighlight = vec3(0.15, 0.1, 0.05);\n      vec3 metalPatina = vec3(0.04, 0.07, 0.06);\n      \n      // Патина\n      float patina = noise(p.xz * 5.0);\n      vec3 metal = mix(metalBase, metalPatina, patina * 0.35);\n      \n      // Блик\n      float fresnel = pow(1.0 - max(0.0, dot(-rd, n)), 3.0);\n      float spec = pow(max(0.0, dot(reflect(rd, n), vec3(0.0, 1.0, 0.0))), 20.0);\n      \n      color = metal * ambient * 1.3;\n      color += metal * torchLight * 0.5;\n      color += metalHighlight * spec * 0.2;\n      color += metalHighlight * fresnel * 0.1;\n      \n      // Отсвет от огня (мягкий)\n      color += accentColor * 0.05;\n      \n    } else if (mat == 62) {\n      // === НЕОНОВЫЙ ИСТОЧНИК СВЕТА ===\n      // Определяем цвет по позиции (север/юг/восток/запад)\n      vec3 neonCol;\n      float angle = atan(p.z, p.x);\n      \n      if (abs(p.z) > abs(p.x)) {\n        // Север или юг\n        neonCol = p.z > 0.0 ? vec3(0.0, 1.0, 0.9) : vec3(1.0, 0.1, 0.6);\n      } else {\n        // Восток или запад\n        neonCol = p.x > 0.0 ? accentColor : vec3(1.0, 0.9, 0.2);\n      }\n      \n      // Пульсация\n      float pulse = 0.85 + 0.15 * sin(u_time * 4.0 + angle * 2.0);\n      \n      // Яркий неон (но не слишком)\n      color = neonCol * 3.0 * pulse;\n      \n    } else if (mat == 63) {\n      // === ДЕРЕВО (тёмное, состаренное) ===\n      vec3 woodBase = vec3(0.08, 0.05, 0.03);\n      vec3 woodDark = vec3(0.035, 0.02, 0.01);\n      vec3 woodLight = vec3(0.12, 0.07, 0.04);\n      \n      // Текстура волокон\n      float grain = sin(p.y * 15.0 + sin(p.x * 3.0) * 1.5) * 0.5 + 0.5;\n      vec3 woodColor = mix(woodDark, woodBase, grain * 0.6);\n      \n      // Детали\n      float detail = noise(p.xz * 8.0);\n      woodColor = mix(woodColor, woodLight, detail * 0.2);\n      \n      // Старение\n      float age = noise(p.xz * 3.0) * 0.15;\n      woodColor *= 1.0 - age;\n      \n      color = woodColor * ambient * 1.3;\n      color += woodColor * torchLight * 0.4;\n      color += woodColor * torchLight * 1.2;\n      color += rimColor * 0.2;\n      \n    } else if (mat == 64) {\n      // === ТЁМНЫЙ КАМЕНЬ ПЛАТФОРМЫ ФОНАРЯ ===\n      vec3 baseColor = vec3(0.04, 0.035, 0.03);\n      vec3 darkColor = vec3(0.02, 0.018, 0.015);\n      vec3 lightColor = vec3(0.08, 0.07, 0.06);\n      \n      // Плиты с швами\n      vec2 tileCoord = floor(p.xz * 2.0);\n      vec2 tileFract = fract(p.xz * 2.0);\n      float tileId = hash(tileCoord);\n      \n      // Вариация цвета плиты\n      vec3 tileColor = mix(darkColor, baseColor, tileId * 0.4);\n      \n      // Текстура камня\n      float stoneNoise = noise(p.xz * 8.0) * 0.2;\n      tileColor = mix(tileColor, lightColor, stoneNoise);\n      \n      // Швы между плитами\n      float seamX = smoothstep(0.03, 0.06, tileFract.x) * smoothstep(0.03, 0.06, 1.0 - tileFract.x);\n      float seamY = smoothstep(0.03, 0.06, tileFract.y) * smoothstep(0.03, 0.06, 1.0 - tileFract.y);\n      float seam = seamX * seamY;\n      tileColor = mix(vec3(0.01), tileColor, seam);\n      \n      // Трещины\n      float crack = sharpNoise(p.xz * 20.0);\n      if (crack > 0.88) {\n        tileColor *= 0.6;\n      }\n      \n      // Неоновое свечение в швах (редкое)\n      float glowSeam = (1.0 - seam) * step(0.7, tileId);\n      \n      color = tileColor * ambient * 1.5;\n      color += tileColor * torchLight * 0.8;\n      color += accentColor * glowSeam * 0.15 * (0.7 + 0.3 * sin(u_time * 2.0));\n      \n    } else if (mat == 65) {\n      // === БРОНЗА РЕШЁТОК ФОНАРЯ ===\n      vec3 bronzeBase = vec3(0.45, 0.28, 0.12);\n      vec3 bronzeHighlight = vec3(0.75, 0.55, 0.25);\n      vec3 bronzePatina = vec3(0.15, 0.3, 0.25);\n      \n      // Кованая текстура\n      float forged = sin(p.y * 30.0) * sin(p.x * 25.0 + p.z * 25.0) * 0.02;\n      \n      // Патина в углублениях\n      float patinaMask = smoothstep(0.3, 0.6, noise(p.xz * 12.0));\n      vec3 bronze = mix(bronzeBase, bronzePatina, patinaMask * 0.25);\n      \n      // Царапины\n      float scratch = sharpNoise(p.xz * 40.0);\n      if (scratch > 0.92) {\n        bronze = mix(bronze, bronzeHighlight, 0.3);\n      }\n      \n      // Металлический блеск\n      float spec = pow(max(0.0, dot(reflect(rd, n), normalize(vec3(1.0, 1.0, 0.5)))), 50.0);\n      float fresnel = pow(1.0 - max(0.0, dot(-rd, n)), 3.0);\n      \n      color = bronze * ambient * 2.0;\n      color += bronze * torchLight * 1.5;\n      color += bronzeHighlight * spec * 0.5;\n      color += bronzeHighlight * fresnel * 0.2;\n      \n      // Отражение огня\n      color += vec3(1.0, 0.5, 0.15) * 0.15;\n      \n    } else if (mat == 66) {\n      // === ОГОНЬ ВНУТРИ ФОНАРЯ ===\n      vec3 fireCore = vec3(1.0, 0.95, 0.7);\n      vec3 fireYellow = vec3(1.0, 0.7, 0.2);\n      vec3 fireOrange = vec3(1.0, 0.4, 0.08);\n      vec3 fireRed = vec3(0.9, 0.15, 0.02);\n      \n      // Анимация пламени\n      float flame1 = sin(p.y * 8.0 - u_time * 12.0 + p.x * 3.0) * 0.5 + 0.5;\n      float flame2 = sin(p.y * 12.0 - u_time * 15.0 + p.z * 4.0) * 0.5 + 0.5;\n      float flame3 = cos(p.y * 6.0 - u_time * 10.0) * 0.5 + 0.5;\n      float flames = (flame1 + flame2 + flame3) / 3.0;\n      \n      // Расстояние от центра (для градиента)\n      float dist = length(p.xz);\n      float heightFade = smoothstep(0.0, 0.4, -p.y + 3.3);\n      \n      // Цвет от центра к краям\n      color = mix(fireCore, fireYellow, dist * 2.0);\n      color = mix(color, fireOrange, dist * 3.0);\n      color = mix(color, fireRed, dist * 4.0);\n      \n      // Мерцание\n      float flicker = 0.85 + 0.15 * sin(u_time * 25.0 + p.x * 10.0);\n      color *= flicker;\n      \n      // Яркость\n      color *= 4.0;\n      \n      // Языки пламени (яркие вспышки)\n      if (flames > 0.7) {\n        color = mix(color, fireCore * 5.0, (flames - 0.7) * 2.0);\n      }\n      \n    } else if (mat == 68) {\n      // === КАМЕНЬ ПЛАТФОРМЫ ПОРТАЛА ===\n      vec3 stoneBase = vec3(0.06, 0.055, 0.05);\n      vec3 stoneDark = vec3(0.03, 0.028, 0.025);\n      vec3 stoneLight = vec3(0.1, 0.09, 0.08);\n      \n      // Плиты с швами\n      vec2 tileCoord = floor(p.xz * 1.5);\n      vec2 tileFract = fract(p.xz * 1.5);\n      float tileId = hash(tileCoord);\n      \n      // Вариация цвета плиты\n      vec3 tileColor = mix(stoneDark, stoneBase, tileId * 0.5);\n      \n      // Текстура камня (многослойная)\n      float stoneNoise = noise(p.xz * 6.0) * 0.3;\n      float detailNoise = noise(p.xz * 15.0) * 0.15;\n      tileColor = mix(tileColor, stoneLight, stoneNoise + detailNoise);\n      \n      // Швы между плитами\n      float seamX = smoothstep(0.02, 0.05, tileFract.x) * smoothstep(0.02, 0.05, 1.0 - tileFract.x);\n      float seamY = smoothstep(0.02, 0.05, tileFract.y) * smoothstep(0.02, 0.05, 1.0 - tileFract.y);\n      float seam = seamX * seamY;\n      tileColor = mix(vec3(0.015), tileColor, seam);\n      \n      // Трещины\n      float crack = sharpNoise(p.xz * 25.0);\n      if (crack > 0.9) {\n        tileColor *= 0.5;\n      }\n      \n      // Руны в швах (свечение)\n      float runeGlow = (1.0 - seam) * step(0.75, tileId);\n      float runePulse = 0.6 + 0.4 * sin(u_time * 2.0 + tileId * 6.28);\n      \n      color = tileColor * ambient * 1.8;\n      color += tileColor * torchLight * 1.0;\n      color += accentColor * runeGlow * 0.25 * runePulse;\n      \n      // Отблеск от портала\n      float portalGlow = smoothstep(3.0, 0.0, length(p.xz - vec2(sign(p.x) * 22.0, 0.0)));\n      color += vec3(1.0, 0.5, 0.2) * portalGlow * 0.15;\n      \n    } else if (mat == 69) {\n      // === БРОНЗА ДЕКОРА ПОРТАЛА ===\n      vec3 bronzeBase = vec3(0.5, 0.32, 0.15);\n      vec3 bronzeHighlight = vec3(0.8, 0.6, 0.3);\n      vec3 bronzePatina = vec3(0.18, 0.35, 0.28);\n      \n      // Кованая текстура\n      float forged = sin(p.y * 25.0) * sin(p.x * 20.0 + p.z * 20.0) * 0.015;\n      \n      // Патина в углублениях\n      float patinaMask = smoothstep(0.35, 0.65, noise(p.xz * 10.0));\n      vec3 bronze = mix(bronzeBase, bronzePatina, patinaMask * 0.3);\n      \n      // Износ на углах\n      float edgeWear = pow(1.0 - max(0.0, dot(-rd, n)), 2.0);\n      bronze = mix(bronze, bronzeHighlight, edgeWear * 0.2);\n      \n      // Металлический блеск\n      float spec = pow(max(0.0, dot(reflect(rd, n), normalize(vec3(1.0, 1.0, 0.5)))), 60.0);\n      float fresnel = pow(1.0 - max(0.0, dot(-rd, n)), 3.0);\n      \n      color = bronze * ambient * 2.2;\n      color += bronze * torchLight * 1.5;\n      color += bronzeHighlight * spec * 0.6;\n      color += bronzeHighlight * fresnel * 0.25;\n      \n      // Отражение огня портала\n      color += vec3(1.0, 0.5, 0.15) * 0.2;\n      \n    } else if (mat == 70) {\n      // === СВЕЧЕНИЕ ПОРТАЛА (внешнее) ===\n      vec3 glowCore = vec3(1.0, 0.6, 0.2);\n      vec3 glowEdge = vec3(1.0, 0.3, 0.05);\n      \n      // Расстояние от центра портала\n      float portalX = sign(p.x) * 22.0;\n      vec3 toPortal = p - vec3(portalX, 2.8, 0.0);\n      float dist = length(toPortal.yz);\n      float normalizedDist = dist / 1.6;\n      \n      // Градиент от центра\n      color = mix(glowCore, glowEdge, normalizedDist);\n      \n      // Вихревой эффект\n      float swirl = sin(atan(toPortal.y, toPortal.z) * 6.0 - u_time * 4.0) * 0.5 + 0.5;\n      color = mix(color, glowCore * 1.5, swirl * 0.3);\n      \n      // Пульсация\n      float pulse = 0.8 + 0.2 * sin(u_time * 3.0);\n      color *= pulse * 2.5;\n      \n      // Искры\n      float spark = sin(u_time * 20.0 + p.y * 15.0 + p.z * 12.0);\n      if (spark > 0.9) {\n        color += vec3(1.0, 0.9, 0.7) * 2.0;\n      }\n      \n    } else if (mat == 71) {\n      // === КАМЕНЬ ПЛАТФОРМЫ ЗА ПОРТАЛОМ ===\n      vec3 stoneBase = vec3(0.07, 0.065, 0.06);\n      vec3 stoneDark = vec3(0.035, 0.032, 0.03);\n      vec3 stoneLight = vec3(0.11, 0.1, 0.09);\n      \n      // Радиальные плиты\n      float angle = atan(p.z, p.x);\n      float dist = length(p.xz - vec2(sign(p.x) * BACK_PLATFORM_X, 0.0));\n      \n      // Концентрические кольца плит\n      float ringId = floor(dist * 1.5);\n      float ringFract = fract(dist * 1.5);\n      \n      // Секторы\n      float sectorId = floor(angle * 4.0 / 3.14159);\n      float sectorFract = fract(angle * 4.0 / 3.14159);\n      \n      float tileId = hash(vec2(ringId, sectorId));\n      vec3 tileColor = mix(stoneDark, stoneBase, tileId * 0.5);\n      \n      // Текстура\n      float stoneNoise = noise(p.xz * 5.0) * 0.25;\n      tileColor = mix(tileColor, stoneLight, stoneNoise);\n      \n      // Швы (радиальные и концентрические)\n      float seamRing = smoothstep(0.03, 0.08, ringFract) * smoothstep(0.03, 0.08, 1.0 - ringFract);\n      float seamSector = smoothstep(0.02, 0.06, sectorFract) * smoothstep(0.02, 0.06, 1.0 - sectorFract);\n      float seam = seamRing * seamSector;\n      tileColor = mix(vec3(0.015), tileColor, seam);\n      \n      color = tileColor * ambient * 1.6;\n      color += tileColor * torchLight * 0.9;\n      \n      // Свечение от портала\n      float portalGlow = smoothstep(15.0, 5.0, dist);\n      color += accentColor * portalGlow * 0.1;\n      \n    } else if (mat == 72) {\n      // === БОРТИК/СТОЛБИКИ ПЛАТФОРМЫ ===\n      vec3 stoneBase = vec3(0.09, 0.08, 0.07);\n      vec3 stoneDark = vec3(0.04, 0.035, 0.03);\n      vec3 stoneAccent = vec3(0.12, 0.1, 0.08);\n      \n      // Текстура камня\n      float stoneNoise = noise(p.xz * 6.0) * 0.3 + noise(p.xz * 15.0) * 0.15;\n      vec3 stoneColor = mix(stoneDark, stoneBase, stoneNoise);\n      \n      // Резной узор (вертикальные линии)\n      float carving = sin(p.y * 20.0) * sin(atan(p.z, p.x) * 8.0);\n      if (abs(carving) > 0.8) {\n        stoneColor = mix(stoneColor, stoneAccent, 0.3);\n      }\n      \n      color = stoneColor * ambient * 1.8;\n      color += stoneColor * torchLight * 1.0;\n      \n      // Подсветка сверху\n      color += accentColor * smoothstep(0.5, 0.7, p.y) * 0.08;\n      \n    } else if (mat == 73) {\n      // === МАЛЕНЬКИЙ ОГОНЬ НА СТОЛБИКЕ ===\n      vec3 fireCore = vec3(1.0, 0.9, 0.6);\n      vec3 fireOuter = vec3(1.0, 0.4, 0.1);\n      \n      float flicker = 0.8 + 0.2 * sin(u_time * 15.0 + p.x * 8.0 + p.z * 8.0);\n      \n      color = mix(fireCore, fireOuter, 0.4);\n      color *= flicker * 3.5;\n      \n    } else if (mat == 74) {\n      // === СВЕТЯЩИЙСЯ СИМВОЛ НА ПЛАТФОРМЕ ===\n      // Пульсирующее свечение в цвете эпохи\n      float pulse = 0.6 + 0.4 * sin(u_time * 2.0);\n      color = accentColor * pulse * 2.5;\n      \n      // Добавляем белый центр\n      color += vec3(0.3, 0.3, 0.3) * pulse;\n      \n    } else if (mat == 75) {\n      // === ГРАНИТ ОСНОВАНИЯ ФОНТАНА ===\n      vec3 graniteBase = vec3(0.08, 0.075, 0.07);\n      vec3 graniteDark = vec3(0.04, 0.038, 0.035);\n      vec3 graniteLight = vec3(0.12, 0.11, 0.1);\n      vec3 graniteSpeckle = vec3(0.15, 0.14, 0.13);\n      \n      // Многослойная текстура гранита\n      float baseNoise = noise(p.xz * 4.0) * 0.4;\n      float detailNoise = noise(p.xz * 12.0) * 0.2;\n      float microNoise = noise(p.xz * 30.0) * 0.1;\n      \n      vec3 granite = mix(graniteDark, graniteBase, baseNoise);\n      granite = mix(granite, graniteLight, detailNoise);\n      \n      // Крапинки (характерно для гранита)\n      float speckle = sharpNoise(p.xz * 50.0);\n      if (speckle > 0.85) {\n        granite = mix(granite, graniteSpeckle, 0.4);\n      }\n      \n      // Восьмиугольные грани (блики на рёбрах)\n      float angle = atan(p.z, p.x);\n      float edgeFactor = abs(cos(angle * 8.0));\n      float edgeHighlight = smoothstep(0.9, 1.0, edgeFactor) * 0.1;\n      granite += edgeHighlight;\n      \n      // Мокрые участки (около воды)\n      float wetness = smoothstep(2.5, 1.5, length(p.xz)) * 0.15;\n      granite *= 1.0 - wetness * 0.3;\n      \n      color = granite * ambient * 1.8;\n      color += granite * torchLight * 0.9;\n      \n      // Отражение воды\n      color += vec3(0.05, 0.08, 0.1) * wetness;\n      \n    } else if (mat == 76) {\n      // === ВОДА СТРУИ ФОНТАНА ===\n      vec3 waterCore = vec3(0.7, 0.85, 0.95);\n      vec3 waterEdge = vec3(0.4, 0.6, 0.75);\n      vec3 waterSparkle = vec3(1.0, 1.0, 1.0);\n      \n      // Прозрачная вода с бликами\n      float fresnel = pow(1.0 - max(0.0, dot(-rd, n)), 2.0);\n      \n      // Анимация потока\n      float flow = sin(p.y * 15.0 - u_time * 8.0) * 0.5 + 0.5;\n      \n      color = mix(waterCore, waterEdge, fresnel * 0.5);\n      \n      // Искрящиеся капли\n      float sparkle = sin(p.y * 30.0 - u_time * 15.0 + p.x * 20.0 + p.z * 20.0);\n      if (sparkle > 0.8) {\n        color = mix(color, waterSparkle, (sparkle - 0.8) * 3.0);\n      }\n      \n      // Яркость\n      color *= 2.0;\n      \n      // Свечение в цвете эпохи\n      color += accentColor * flow * 0.15;\n      \n    } else if (mat == 77) {\n      // === ДНО БАССЕЙНА (мозаика) ===\n      vec3 mosaicBlue = vec3(0.05, 0.15, 0.25);\n      vec3 mosaicTeal = vec3(0.08, 0.2, 0.22);\n      vec3 mosaicGold = vec3(0.4, 0.3, 0.1);\n      vec3 mosaicWhite = vec3(0.2, 0.22, 0.25);\n      \n      // Мелкие плитки мозаики\n      vec2 tileCoord = floor(p.xz * 4.0);\n      vec2 tileFract = fract(p.xz * 4.0);\n      float tileId = hash(tileCoord);\n      \n      // Выбор цвета плитки\n      vec3 tileColor;\n      if (tileId < 0.5) {\n        tileColor = mix(mosaicBlue, mosaicTeal, fract(tileId * 4.0));\n      } else if (tileId < 0.9) {\n        tileColor = mosaicWhite;\n      } else {\n        tileColor = mosaicGold; // Редкие золотые плитки\n      }\n      \n      // Швы между плитками\n      float seamX = smoothstep(0.02, 0.05, tileFract.x) * smoothstep(0.02, 0.05, 1.0 - tileFract.x);\n      float seamY = smoothstep(0.02, 0.05, tileFract.y) * smoothstep(0.02, 0.05, 1.0 - tileFract.y);\n      float seam = seamX * seamY;\n      tileColor = mix(vec3(0.02, 0.03, 0.04), tileColor, seam);\n      \n      // Узор в центре (круговой)\n      float centerDist = length(p.xz);\n      float centerPattern = sin(centerDist * 3.0) * sin(atan(p.z, p.x) * 8.0);\n      if (abs(centerPattern) > 0.8 && centerDist < 2.0) {\n        tileColor = mosaicGold;\n      }\n      \n      // Подводное освещение\n      color = tileColor * ambient * 1.2;\n      \n      // Каустики (световые узоры от воды)\n      float caustic1 = sin(p.x * 8.0 + u_time * 2.0) * sin(p.z * 7.0 + u_time * 1.5);\n      float caustic2 = sin(p.x * 6.0 - u_time * 1.8) * sin(p.z * 9.0 - u_time * 2.2);\n      float caustics = (caustic1 + caustic2) * 0.5 + 0.5;\n      color += vec3(0.1, 0.15, 0.2) * caustics * 0.3;\n      \n      // Свечение в цвете эпохи\n      color += accentColor * 0.05;\n      \n    } else if (mat == 56) {\n      // === ОРБИТАЛЬНЫЙ ОГОНЬ 1 (основной цвет эпохи) ===\n      float pulse = 0.8 + 0.2 * sin(u_time * 20.0);\n      color = accentColor * 5.0 * pulse;\n      // Ореол\n      color += accentColor * 2.0;\n      \n    } else if (mat == 57) {\n      // === ОРБИТАЛЬНЫЙ ОГОНЬ 2 (оранжевый) ===\n      vec3 fireOrange = vec3(1.0, 0.5, 0.0);\n      float pulse = 0.8 + 0.2 * sin(u_time * 23.0 + 1.0);\n      color = fireOrange * 5.0 * pulse;\n      color += fireOrange * 2.0;\n      \n    } else if (mat == 58) {\n      // === ОРБИТАЛЬНЫЙ ОГОНЬ 3 (циан) ===\n      vec3 fireCyan = vec3(0.0, 1.0, 0.8);\n      float pulse = 0.8 + 0.2 * sin(u_time * 19.0 + 2.0);\n      color = fireCyan * 5.0 * pulse;\n      color += fireCyan * 2.0;\n      \n    } else if (mat == 59) {\n      // === ОРБИТАЛЬНЫЙ ОГОНЬ 4 (розовый) ===\n      vec3 firePink = vec3(1.0, 0.2, 0.5);\n      float pulse = 0.8 + 0.2 * sin(u_time * 17.0 + 3.0);\n      color = firePink * 5.0 * pulse;\n      color += firePink * 2.0;\n      \n    } else if (mat == 78) {\n      // === ОРАНЖЕВЫЙ ШАР (как луна) ===\n      float pulse = 0.85 + 0.15 * sin(u_time * 2.0);\n      \n      // Объёмное затемнение к краям (fresnel)\n      float fresnel = pow(1.0 - max(0.0, dot(-rd, n)), 2.5);\n      \n      // Цвета как у луны\n      vec3 orbCore = vec3(1.0, 0.7, 0.3) * 2.5;   // Яркий оранжевый центр\n      vec3 orbRim = vec3(0.9, 0.35, 0.05) * 1.5;  // Тёмно-оранжевый край\n      \n      color = mix(orbCore, orbRim, fresnel) * pulse;\n      \n      // Текстура поверхности (пятна)\n      float surfNoise = noise(p.xz * 8.0) * 0.2;\n      color *= (0.9 + surfNoise);\n      \n      // Яркое свечение\n      color += vec3(1.0, 0.5, 0.1) * 1.5;\n      \n    } else if (mat == 79) {\n      // === СТЕБЕЛЬ РОЗЫ (зелёный) ===\n      vec3 stemGreen = vec3(0.15, 0.4, 0.1);\n      vec3 stemDark = vec3(0.08, 0.25, 0.05);\n      \n      // Текстура\n      float stemNoise = noise(p.xy * 20.0) * 0.3;\n      color = mix(stemDark, stemGreen, 0.5 + stemNoise);\n      \n      // Освещение\n      color *= ambient * 1.5;\n      color += stemGreen * mainLight * mainDot * 0.4;\n      \n    } else if (mat == 80) {\n      // === ЯДРО ЭНЕРГЕТИЧЕСКОЙ СУЩНОСТИ ===\n      float pulse = 0.7 + 0.3 * sin(u_time * 10.0);\n      float pulse2 = 0.8 + 0.2 * sin(u_time * 15.0 + 1.5);\n      \n      // Градиент от белого ядра к золотому краю\n      float fresnel = pow(1.0 - max(0.0, dot(-rd, n)), 2.0);\n      vec3 coreWhite = vec3(1.0, 1.0, 0.95) * 4.0;\n      vec3 coreGold = vec3(1.0, 0.7, 0.2) * 3.0;\n      vec3 coreOrange = vec3(1.0, 0.4, 0.1) * 2.0;\n      \n      color = mix(coreWhite, coreGold, fresnel);\n      color = mix(color, coreOrange, fresnel * fresnel);\n      color *= pulse * pulse2;\n      \n      // Электрические разряды\n      float spark = fract(sin(dot(p.xy + u_time * 20.0, vec2(12.9898, 78.233))) * 43758.5453);\n      if (spark > 0.92) {\n        color += vec3(1.0, 1.0, 1.0) * 3.0;\n      }\n      \n    } else if (mat == 81) {\n      // === КОЛЬЦА ЭНЕРГИИ ===\n      float pulse = 0.6 + 0.4 * sin(u_time * 8.0 + p.y * 5.0);\n      \n      // Переливающийся цвет\n      float colorShift = sin(u_time * 3.0 + length(p) * 4.0) * 0.5 + 0.5;\n      vec3 ringCyan = vec3(0.2, 0.9, 1.0);\n      vec3 ringGold = vec3(1.0, 0.8, 0.3);\n      vec3 ringMagenta = vec3(1.0, 0.3, 0.8);\n      \n      vec3 ringColor = mix(ringCyan, ringGold, colorShift);\n      ringColor = mix(ringColor, ringMagenta, sin(u_time * 2.0) * 0.3 + 0.3);\n      \n      color = ringColor * pulse * 3.0;\n      \n      // Свечение\n      color += ringColor * 1.5;\n      \n    } else {\n      // === FALLBACK ===\n      vec3 baseColor = vec3(0.2, 0.18, 0.15);\n      color = baseColor * ambient * 2.0;\n      color += baseColor * mainLight * mainDot * 0.5;\n      color += baseColor * torchLight * 1.2;\n      color += rimColor + specColor;\n    }\n    \n    // Вспышка от выстрела\n    if (u_muzzleFlash > 0.0) {\n      color += vec3(1.0, 0.7, 0.4) * u_muzzleFlash * 0.4;\n    }\n    \n    // Мягкая атмосферная дымка (не скрывает, только добавляет цвет)\n    float atmFade = smoothstep(70.0, MAX_DIST, d);\n    vec3 atmColor = mix(fogColor, skyColor, 0.5);\n    color = mix(color, atmColor, atmFade * 0.4);\n    \n    // Очень лёгкий туман\n    float fog = 1.0 - exp(-d * 0.004);\n    color = mix(color, fogColor * 1.2, fog * 0.1);\n  }\n  \n  // Кислотный дождь от зелёного босса (всегда когда есть зоны)\n  if (u_acidRainZoneCount > 0) {\n    color = renderAcidRain(v_uv, color, u_time, u_cameraPos);\n  }\n  \n  // Эффект дождя на волне 15+\n  if (u_wave >= 15) {\n    color = renderRain(v_uv, color, u_time);\n  }\n  \n  // === АКЦЕНТНЫЕ ЦВЕТА ПО ЭПОХЕ ===\n  vec3 volAccent;\n  vec3 volSecondary;\n  if (u_era == 1) {\n    volAccent = vec3(0.3, 1.0, 0.4);\n    volSecondary = vec3(0.0, 0.8, 0.6);\n  } else if (u_era == 2) {\n    volAccent = vec3(0.8, 0.2, 1.0);\n    volSecondary = vec3(0.4, 0.0, 0.8);\n  } else {\n    volAccent = vec3(0.0, 0.9, 1.0);\n    volSecondary = vec3(0.0, 0.5, 0.8);\n  }\n  \n  vec2 screenPos = v_uv * 2.0 - 1.0;\n  vec2 screenUV = gl_FragCoord.xy / u_resolution;\n  \n  // === GOD RAYS (упрощённые) ===\n  vec2 moonScreenPos = vec2(0.35, 0.55);\n  float rayDist = length(screenPos - moonScreenPos);\n  float godRays = exp(-rayDist * 2.5) * 0.15 * smoothstep(0.8, 0.0, rayDist);\n  color += vec3(0.8, 0.4, 0.1) * godRays;\n  \n  // === VOLUMETRIC (упрощённый) ===\n  float depthFactor = 1.0 - smoothstep(0.0, 60.0, d);\n  float beam = exp(-length(screenPos) * 3.0);\n  color += volAccent * beam * depthFactor * 0.04;\n  \n  // === МИНИМАЛИСТИЧНЫЕ ЧАСТИЦЫ ===\n  \n  // --- СВЕТЛЯЧКИ (немного, мягкие) ---\n  for (int i = 0; i < 5; i++) {\n    float seed = float(i) * 127.1;\n    vec2 fireflyPos = vec2(\n      sin(u_time * 0.2 + seed) * 0.5 + hash(vec2(seed, 0.0)) * 0.4,\n      cos(u_time * 0.15 + seed * 1.3) * 0.4 + hash(vec2(0.0, seed)) * 0.3\n    );\n    float dist = length(screenPos - fireflyPos);\n    float glow = exp(-dist * 12.0);\n    float flicker = 0.6 + 0.4 * sin(u_time * 3.0 + seed * 10.0);\n    color += volAccent * glow * flicker * 0.06;\n  }\n  \n  // --- ПЫЛИНКИ (редкие) ---\n  vec2 dustUV = screenUV * 40.0 + u_time * 0.01;\n  float dustId = hash(floor(dustUV));\n  if (dustId > 0.985) {\n    float dustBright = (dustId - 0.985) * 30.0;\n    color += vec3(0.7, 0.75, 0.8) * dustBright * 0.015;\n  }\n  \n  // Слой 5: Горизонтальные полосы света (сканлайны атмосферы)\n  float scanY = fract(screenUV.y * 200.0 + u_time * 0.5);\n  float scanLine = smoothstep(0.0, 0.02, scanY) * smoothstep(0.04, 0.02, scanY);\n  color += volSecondary * scanLine * 0.015 * depthFactor;\n  \n  // === АТМОСФЕРНАЯ ДЫМКА С ГРАДИЕНТОМ ===\n  float fogDist = d / MAX_DIST;\n  \n  // Верхняя дымка (небо просачивается)\n  float skyHaze = smoothstep(0.3, 0.8, screenUV.y) * 0.1;\n  color += vec3(0.05, 0.08, 0.15) * skyHaze;\n  \n  // Нижняя дымка (от пола)\n  float groundHaze = smoothstep(0.5, 0.2, screenUV.y) * 0.08;\n  color += volAccent * groundHaze * 0.3;\n  \n  // Дальняя дымка\n  float hazeFade = smoothstep(0.5, 1.0, fogDist);\n  vec3 hazeColor = mix(vec3(0.03, 0.04, 0.08), volSecondary * 0.2, 0.3);\n  color = mix(color, hazeColor, hazeFade * 0.3);\n  \n  // === BLOOM (мягкое свечение ярких областей) ===\n  float bloomLum = dot(color, vec3(0.299, 0.587, 0.114));\n  if (bloomLum > 0.8) {\n    float bloomAmt = (bloomLum - 0.8) * 0.4;\n    vec3 bloomCol = color * (1.0 + bloomAmt);\n    color = mix(color, bloomCol, 0.5);\n  }\n  \n  // === ХРОМАТИЧЕСКАЯ АБЕРРАЦИЯ (лёгкая) ===\n  float aberration = length(screenPos) * 0.003;\n  color.r += hash(screenUV + 0.1) * aberration * 0.5;\n  color.b -= hash(screenUV + 0.2) * aberration * 0.5;\n  \n  // === КАТАНА 3D ===\n  // Определяем цвета освещения для катаны по эпохе\n  vec3 katanaAmbient;\n  vec3 katanaAccent;\n  if (u_era == 1) {\n    katanaAmbient = vec3(0.08, 0.12, 0.08);\n    katanaAccent = vec3(0.4, 1.0, 0.2);\n  } else if (u_era == 2) {\n    katanaAmbient = vec3(0.07, 0.05, 0.12);\n    katanaAccent = vec3(0.7, 0.15, 1.0);\n  } else {\n    katanaAmbient = vec3(0.08, 0.1, 0.14);\n    katanaAccent = vec3(0.15, 0.7, 1.0);\n  }\n  \n  // Рендерим катану (ro = позиция камеры)\n  vec4 katanaResult = renderKatana(u_cameraPos, rd, u_katanaAttack, u_katanaBob, u_katanaCharges, katanaAmbient, katanaAccent);\n  if (katanaResult.w > 0.0) {\n    // Катана попала - накладываем поверх сцены\n    color = katanaResult.rgb;\n  }\n  \n  // === ХОЛОДНЫЙ СЛЕД КАТАНЫ (серебристо-голубой) ===\n  if (u_katanaAttack > 0.08 && u_katanaAttack < 0.65) {\n    vec2 screenUV = gl_FragCoord.xy / u_resolution;\n    \n    // Прогресс взмаха (быстрее!)\n    float swingProgress = smoothstep(0.08, 0.4, u_katanaAttack);\n    float fadeOut = 1.0 - smoothstep(0.35, 0.65, u_katanaAttack);\n    \n    // Центр и углы дуги - КРУЧЕ!\n    vec2 arcCenter;\n    float arcStartAngle, arcEndAngle;\n    \n    if (u_katanaAttackType == 0) {\n      // Удар справа - крутая диагональ сверху-справа вниз-влево\n      arcCenter = vec2(0.75, 0.2);\n      arcStartAngle = -0.8;\n      arcEndAngle = 2.8;  // Больше угол!\n    } else if (u_katanaAttackType == 1) {\n      // Удар слева - крутая диагональ сверху-слева вниз-вправо\n      arcCenter = vec2(0.25, 0.2);\n      arcStartAngle = 0.4;\n      arcEndAngle = 4.0;  // Больше угол!\n    } else {\n      // Сплеш - широкая горизонтальная\n      arcCenter = vec2(0.5, 0.45);\n      arcStartAngle = -0.5;\n      arcEndAngle = 3.6;\n    }\n    \n    vec2 toPixel = screenUV - arcCenter;\n    float dist = length(toPixel);\n    float angle = atan(toPixel.y, toPixel.x);\n    \n    // Дуга движется\n    float currentAngle = mix(arcStartAngle, arcEndAngle, swingProgress);\n    float angleDiff = abs(angle - currentAngle);\n    if (angleDiff > 3.14159) angleDiff = 6.28318 - angleDiff;\n    \n    // След по дуге - тоньше и резче\n    float arcRadius = 0.4;\n    float radiusDiff = abs(dist - arcRadius);\n    float trail = smoothstep(0.35, 0.0, angleDiff) * smoothstep(0.06, 0.01, radiusDiff);\n    \n    // Острие - яркая точка\n    float tipGlow = smoothstep(0.15, 0.0, angleDiff) * smoothstep(0.04, 0.005, radiusDiff);\n    \n    // === ХОЛОДНЫЕ ЦВЕТА СТАЛИ ===\n    // Основа - серебристо-голубой\n    vec3 steelBlue = vec3(0.7, 0.85, 1.0);\n    // Яркий край - белый с голубым\n    vec3 sharpEdge = vec3(0.9, 0.95, 1.0);\n    // Внутреннее свечение - холодный синий\n    vec3 innerGlow = vec3(0.4, 0.6, 0.9);\n    \n    // Хвост следа с градиентом\n    float trailFade = smoothstep(0.0, 0.3, angleDiff);\n    vec3 trailColor = mix(sharpEdge, innerGlow, trailFade);\n    \n    // Применяем с мерцанием\n    float shimmer = 0.8 + 0.2 * sin(u_time * 30.0 + angle * 10.0);\n    float intensity = (trail * 0.5 + tipGlow * 1.2) * fadeOut * shimmer;\n    \n    // Аддитивное смешивание для яркости\n    color += trailColor * intensity * 0.8;\n    color = mix(color, sharpEdge, tipGlow * fadeOut * 0.6);\n  }\n  \n  // === СОВРЕМЕННЫЙ AAA ПОСТ-ПРОЦЕСС ===\n  \n  // 1. EXPOSURE (экспозиция)\n  color *= 1.3;\n  \n  // 2. ACES FILMIC TONEMAPPING (киношный вид)\n  // Матрица преобразования в ACES\n  mat3 aces_input = mat3(\n    0.59719, 0.35458, 0.04823,\n    0.07600, 0.90834, 0.01566,\n    0.02840, 0.13383, 0.83777\n  );\n  mat3 aces_output = mat3(\n    1.60475, -0.53108, -0.07367,\n    -0.10208, 1.10813, -0.00605,\n    -0.00327, -0.07276, 1.07602\n  );\n  color = aces_input * color;\n  vec3 a = color * (color + 0.0245786) - 0.000090537;\n  vec3 b = color * (0.983729 * color + 0.4329510) + 0.238081;\n  color = a / b;\n  color = aces_output * color;\n  color = clamp(color, 0.0, 1.0);\n  \n  // 3. ГАММА КОРРЕКЦИЯ\n  color = pow(color, vec3(0.9));\n  \n  // 4. ГЛУБОКИЙ COLOR GRADING (teal & orange киношный стиль)\n  float lum = dot(color, vec3(0.299, 0.587, 0.114));\n  \n  // Тени → холодный циан/синий\n  vec3 shadowTint = vec3(0.0, 0.12, 0.18);\n  float shadowMask = 1.0 - smoothstep(0.0, 0.4, lum);\n  color += shadowTint * shadowMask * 0.2;\n  \n  // Средние тона → слегка зеленоватый\n  vec3 midTint = vec3(-0.02, 0.03, -0.02);\n  float midMask = smoothstep(0.2, 0.5, lum) * smoothstep(0.8, 0.5, lum);\n  color += midTint * midMask * 0.15;\n  \n  // Света → тёплый оранжевый\n  vec3 highlightTint = vec3(0.12, 0.06, 0.0);\n  float highlightMask = smoothstep(0.5, 1.0, lum);\n  color += highlightTint * highlightMask * 0.15;\n  \n  // 5. НАСЫЩЕННОСТЬ (vibrance - больше на ненасыщенные цвета)\n  float maxC = max(max(color.r, color.g), color.b);\n  float minC = min(min(color.r, color.g), color.b);\n  float saturation = (maxC - minC) / (maxC + 0.001);\n  float vibranceAmt = 1.0 + (1.0 - saturation) * 0.25;\n  vec3 grayCol = vec3(lum);\n  color = mix(grayCol, color, vibranceAmt);\n  \n  // 6. МЯГКИЙ КОНТРАСТ (Cyberpunk стиль - серые тени)\n  // Поднимаем чёрную точку - тени становятся серыми\n  color = color * 0.85 + 0.08; // Чёрный → тёмно-серый\n  // Лёгкий S-curve\n  color = mix(color, color * color * (3.0 - 2.0 * color), 0.1);\n  \n  // 7. BLOOM GLOW (мягкое свечение)\n  float bloomBright = max(max(color.r, color.g), color.b);\n  if (bloomBright > 0.7) {\n    float bloomStr = (bloomBright - 0.7) * 0.5;\n    vec3 bloomCol = color * (1.0 + bloomStr);\n    // Распространение по экрану\n    float bloomSpread = exp(-length(v_uv - 0.5) * 2.0);\n    color = mix(color, bloomCol, bloomStr * bloomSpread);\n  }\n  \n  // 8. АНАМОРФНЫЕ БЛИКИ (горизонтальные полосы от ярких точек)\n  if (bloomBright > 0.75) {\n    float streak = exp(-abs(v_uv.y - 0.5) * 6.0) * (bloomBright - 0.75) * 0.4;\n    color += vec3(0.5, 0.7, 1.0) * streak;\n  }\n  \n  // 9. ВИНЬЕТКА (кинематографичная глубина)\n  vec2 vigUV = v_uv - 0.5;\n  float vigDist = length(vigUV);\n  float vig = 1.0 - vigDist * vigDist * 1.2;\n  vig = smoothstep(0.0, 0.8, vig);\n  color *= mix(0.7, 1.0, vig);\n  \n  // 10. ХРОМАТИЧЕСКАЯ АБЕРРАЦИЯ (на краях)\n  float aberr = vigDist * vigDist * 0.015;\n  color.r += (hash(v_uv + 0.1) - 0.5) * aberr;\n  color.b -= (hash(v_uv + 0.2) - 0.5) * aberr;\n  \n  // 11. ПЛЁНОЧНАЯ ЗЕРНИСТОСТЬ\n  float grain = filmGrain(v_uv * u_resolution, u_time * 60.0);\n  float grainStr = mix(0.035, 0.01, lum); // Больше в тенях\n  color += (grain - 0.5) * grainStr;\n  \n  // 12. DITHERING (устранение color banding)\n  float dither = (fract(sin(dot(gl_FragCoord.xy, vec2(12.9898, 78.233))) * 43758.5453) - 0.5) / 128.0;\n  color += dither;\n  \n  // Финальный clamp\n  color = clamp(color, 0.0, 1.0);\n  \n  fragColor = vec4(color, 1.0);\n}\n`;\n","import { VERTEX_SHADER, FRAGMENT_SHADER } from './Shaders';\nimport type { ShaderUniforms, Vec3 } from '@/types';\n\n/**\n * WebGL2 рендерер\n * Ray marching через фрагментный шейдер\n */\nexport class WebGLRenderer {\n  private gl: WebGL2RenderingContext;\n  private program: WebGLProgram | null = null;\n  private uniforms: ShaderUniforms;\n  private vao: WebGLVertexArrayObject | null = null;\n\n  /** Масштаб рендеринга (0-1) */\n  public renderScale = 0.75;\n\n  constructor(private canvas: HTMLCanvasElement) {\n    const gl = canvas.getContext('webgl2');\n    if (!gl) {\n      throw new Error('WebGL2 не поддерживается');\n    }\n    this.gl = gl;\n\n    this.uniforms = {\n      resolution: null,\n      time: null,\n      cameraPos: null,\n      cameraDir: null,\n      cameraYaw: null,\n      cameraPitch: null,\n      targets: null,\n      targetCount: null,\n      muzzleFlash: null,\n      pools: null,\n      poolCount: null,\n      acidProjectiles: null,\n      acidProjectileCount: null,\n      spikes: null,\n      spikeTargets: null,\n      spikeCount: null,\n      acidRainZones: null,\n      acidRainZoneCount: null,\n      era: null,\n      altars: null,\n      darts: null,\n      dartDirs: null,\n      dartCount: null,\n      voidPortalActive: null,\n      bloodCoins: null,\n      bloodCoinCount: null,\n      wave: null,\n      greenBossPhase2: null,\n      pickups: null,\n      pickupCount: null,\n      crystals: null,\n      crystalCount: null,\n      voidMode: null,\n      voidProgress: null,\n      voidFallOffset: null,\n      portalPos: null,\n      grenades: null,\n      grenadeCount: null,\n      explosions: null,\n      explosionCount: null,\n      voidVariant: null,\n      katanaAttack: null,\n      katanaBob: null,\n      katanaCharges: null,\n      katanaTargetAngle: null,\n      katanaTargetDist: null,\n      katanaAttackType: null,\n      deathEffects: null,\n      fragments: null,\n      fragmentCount: null,\n    };\n\n    this.init();\n  }\n\n  /** Инициализация WebGL */\n  private init(): void {\n    const gl = this.gl;\n\n    // Компилируем шейдеры\n    const vertShader = this.compileShader(gl.VERTEX_SHADER, VERTEX_SHADER);\n    const fragShader = this.compileShader(gl.FRAGMENT_SHADER, FRAGMENT_SHADER);\n\n    if (!vertShader || !fragShader) {\n      throw new Error('Ошибка компиляции шейдеров');\n    }\n\n    // Создаём программу\n    this.program = gl.createProgram()!;\n    gl.attachShader(this.program, vertShader);\n    gl.attachShader(this.program, fragShader);\n    gl.linkProgram(this.program);\n\n    if (!gl.getProgramParameter(this.program, gl.LINK_STATUS)) {\n      throw new Error('Ошибка линковки: ' + gl.getProgramInfoLog(this.program));\n    }\n\n    // Получаем uniform locations\n    this.uniforms.resolution = gl.getUniformLocation(this.program, 'u_resolution');\n    this.uniforms.time = gl.getUniformLocation(this.program, 'u_time');\n    this.uniforms.cameraPos = gl.getUniformLocation(this.program, 'u_cameraPos');\n    this.uniforms.cameraYaw = gl.getUniformLocation(this.program, 'u_cameraYaw');\n    this.uniforms.cameraPitch = gl.getUniformLocation(this.program, 'u_cameraPitch');\n    this.uniforms.targets = gl.getUniformLocation(this.program, 'u_targets');\n    this.uniforms.targetCount = gl.getUniformLocation(this.program, 'u_targetCount');\n    this.uniforms.muzzleFlash = gl.getUniformLocation(this.program, 'u_muzzleFlash');\n    this.uniforms.pools = gl.getUniformLocation(this.program, 'u_pools');\n    this.uniforms.poolCount = gl.getUniformLocation(this.program, 'u_poolCount');\n    this.uniforms.acidProjectiles = gl.getUniformLocation(this.program, 'u_acidProjectiles');\n    this.uniforms.acidProjectileCount = gl.getUniformLocation(this.program, 'u_acidProjectileCount');\n    this.uniforms.spikes = gl.getUniformLocation(this.program, 'u_spikes');\n    this.uniforms.spikeTargets = gl.getUniformLocation(this.program, 'u_spikeTargets');\n    this.uniforms.spikeCount = gl.getUniformLocation(this.program, 'u_spikeCount');\n    this.uniforms.acidRainZones = gl.getUniformLocation(this.program, 'u_acidRainZones');\n    this.uniforms.acidRainZoneCount = gl.getUniformLocation(this.program, 'u_acidRainZoneCount');\n    this.uniforms.era = gl.getUniformLocation(this.program, 'u_era');\n    this.uniforms.altars = gl.getUniformLocation(this.program, 'u_altars');\n    this.uniforms.darts = gl.getUniformLocation(this.program, 'u_darts');\n    this.uniforms.dartDirs = gl.getUniformLocation(this.program, 'u_dartDirs');\n    this.uniforms.dartCount = gl.getUniformLocation(this.program, 'u_dartCount');\n    this.uniforms.voidPortalActive = gl.getUniformLocation(this.program, 'u_voidPortalActive');\n    this.uniforms.bloodCoins = gl.getUniformLocation(this.program, 'u_bloodCoins');\n    this.uniforms.bloodCoinCount = gl.getUniformLocation(this.program, 'u_bloodCoinCount');\n    this.uniforms.wave = gl.getUniformLocation(this.program, 'u_wave');\n    this.uniforms.greenBossPhase2 = gl.getUniformLocation(this.program, 'u_greenBossPhase2');\n    this.uniforms.pickups = gl.getUniformLocation(this.program, 'u_pickups');\n    this.uniforms.pickupCount = gl.getUniformLocation(this.program, 'u_pickupCount');\n    this.uniforms.crystals = gl.getUniformLocation(this.program, 'u_crystals');\n    this.uniforms.voidMode = gl.getUniformLocation(this.program, 'u_voidMode');\n    this.uniforms.voidProgress = gl.getUniformLocation(this.program, 'u_voidProgress');\n    this.uniforms.voidFallOffset = gl.getUniformLocation(this.program, 'u_voidFallOffset');\n    this.uniforms.portalPos = gl.getUniformLocation(this.program, 'u_portalPos');\n    this.uniforms.grenades = gl.getUniformLocation(this.program, 'u_grenades');\n    this.uniforms.grenadeCount = gl.getUniformLocation(this.program, 'u_grenadeCount');\n    this.uniforms.explosions = gl.getUniformLocation(this.program, 'u_explosions');\n    this.uniforms.explosionCount = gl.getUniformLocation(this.program, 'u_explosionCount');\n    this.uniforms.voidVariant = gl.getUniformLocation(this.program, 'u_voidVariant');\n    \n    // Катана 3D\n    this.uniforms.katanaAttack = gl.getUniformLocation(this.program, 'u_katanaAttack');\n    this.uniforms.katanaBob = gl.getUniformLocation(this.program, 'u_katanaBob');\n    this.uniforms.katanaCharges = gl.getUniformLocation(this.program, 'u_katanaCharges');\n    this.uniforms.katanaTargetAngle = gl.getUniformLocation(this.program, 'u_katanaTargetAngle');\n    this.uniforms.katanaTargetDist = gl.getUniformLocation(this.program, 'u_katanaTargetDist');\n    this.uniforms.katanaAttackType = gl.getUniformLocation(this.program, 'u_katanaAttackType');\n    \n    // Эффекты смерти врагов\n    this.uniforms.deathEffects = gl.getUniformLocation(this.program, 'u_deathEffects');\n    \n    // Фрагменты врагов\n    this.uniforms.fragments = gl.getUniformLocation(this.program, 'u_fragments');\n    this.uniforms.fragmentCount = gl.getUniformLocation(this.program, 'u_fragmentCount');\n\n    // Создаём fullscreen quad\n    this.createQuad();\n  }\n\n  /** Компиляция шейдера */\n  private compileShader(type: number, source: string): WebGLShader | null {\n    const gl = this.gl;\n    const shader = gl.createShader(type);\n    if (!shader) return null;\n\n    gl.shaderSource(shader, source);\n    gl.compileShader(shader);\n\n    if (!gl.getShaderParameter(shader, gl.COMPILE_STATUS)) {\n      console.error('Ошибка шейдера:', gl.getShaderInfoLog(shader));\n      gl.deleteShader(shader);\n      return null;\n    }\n\n    return shader;\n  }\n\n  /** Создание fullscreen quad */\n  private createQuad(): void {\n    const gl = this.gl;\n\n    // Вершины квада (-1 до 1)\n    const vertices = new Float32Array([\n      -1, -1,\n       1, -1,\n      -1,  1,\n       1,  1,\n    ]);\n\n    // VAO\n    this.vao = gl.createVertexArray();\n    gl.bindVertexArray(this.vao);\n\n    // VBO\n    const vbo = gl.createBuffer();\n    gl.bindBuffer(gl.ARRAY_BUFFER, vbo);\n    gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);\n\n    // Атрибут позиции\n    const posLoc = gl.getAttribLocation(this.program!, 'a_position');\n    gl.enableVertexAttribArray(posLoc);\n    gl.vertexAttribPointer(posLoc, 2, gl.FLOAT, false, 0, 0);\n\n    gl.bindVertexArray(null);\n  }\n\n  /** Обновить размер canvas */\n  public resize(): void {\n    const dpr = window.devicePixelRatio || 1;\n    const width = Math.floor(this.canvas.clientWidth * dpr * this.renderScale);\n    const height = Math.floor(this.canvas.clientHeight * dpr * this.renderScale);\n\n    if (this.canvas.width !== width || this.canvas.height !== height) {\n      this.canvas.width = width;\n      this.canvas.height = height;\n      this.gl.viewport(0, 0, width, height);\n    }\n  }\n\n  /** Рендеринг кадра */\n  public render(\n    time: number,\n    cameraPos: Vec3,\n    cameraYaw: number,\n    cameraPitch: number,\n    targetsData: Float32Array,\n    targetCount: number,\n    muzzleFlash: number,\n    poolsData?: Float32Array,\n    poolCount?: number,\n    era?: number,\n    wave?: number,\n    pickupsData?: Float32Array,\n    pickupCount?: number,\n    crystalsData?: Float32Array,\n    acidProjectilesData?: Float32Array,\n    acidProjectileCount?: number,\n    spikesData?: Float32Array,\n    spikeTargetsData?: Float32Array,\n    spikeCount?: number,\n    acidRainZonesData?: Float32Array,\n    acidRainZoneCount?: number,\n    greenBossPhase2?: boolean,\n    voidMode?: boolean,\n    voidProgress?: number,\n    voidFallOffset?: number,\n    portalPos?: { x: number; y: number; z: number },\n    altarsData?: Float32Array,\n    dartsData?: Float32Array,\n    dartDirsData?: Float32Array,\n    dartCount?: number,\n    voidPortalActive?: number,\n    bloodCoinsData?: Float32Array,\n    bloodCoinCount?: number,\n    grenadesData?: Float32Array,\n    grenadeCount?: number,\n    explosionsData?: Float32Array,\n    explosionCount?: number,\n    voidVariant?: number,\n    katanaAttack?: number,\n    katanaBob?: number,\n    katanaCharges?: number,\n    katanaTargetAngle?: number,\n    katanaTargetDist?: number,\n    katanaAttackType?: number,\n    deathEffectsData?: Float32Array,\n    fragmentsData?: Float32Array,\n    fragmentCount?: number\n  ): void {\n    const gl = this.gl;\n\n    this.resize();\n\n    gl.useProgram(this.program);\n    gl.bindVertexArray(this.vao);\n\n    // Устанавливаем uniforms\n    gl.uniform2f(this.uniforms.resolution, this.canvas.width, this.canvas.height);\n    gl.uniform1f(this.uniforms.time, time);\n    gl.uniform3f(this.uniforms.cameraPos, cameraPos.x, cameraPos.y, cameraPos.z);\n    gl.uniform1f(this.uniforms.cameraYaw, cameraYaw);\n    gl.uniform1f(this.uniforms.cameraPitch, cameraPitch);\n    gl.uniform4fv(this.uniforms.targets, targetsData);\n    gl.uniform1i(this.uniforms.targetCount, targetCount);\n    gl.uniform1f(this.uniforms.muzzleFlash, muzzleFlash);\n    \n    // Лужи\n    if (poolsData && poolCount !== undefined) {\n      gl.uniform4fv(this.uniforms.pools, poolsData);\n      gl.uniform1i(this.uniforms.poolCount, poolCount);\n    } else {\n      gl.uniform1i(this.uniforms.poolCount, 0);\n    }\n\n    // Снаряды кислоты\n    if (acidProjectilesData && acidProjectileCount !== undefined && acidProjectileCount > 0) {\n      gl.uniform4fv(this.uniforms.acidProjectiles, acidProjectilesData);\n      gl.uniform1i(this.uniforms.acidProjectileCount, acidProjectileCount);\n    } else {\n      gl.uniform1i(this.uniforms.acidProjectileCount, 0);\n    }\n\n    // Лазеры спайкеров\n    if (spikesData && spikeTargetsData && spikeCount !== undefined && spikeCount > 0) {\n      gl.uniform4fv(this.uniforms.spikes, spikesData);\n      gl.uniform4fv(this.uniforms.spikeTargets, spikeTargetsData);\n      gl.uniform1i(this.uniforms.spikeCount, spikeCount);\n    } else {\n      gl.uniform1i(this.uniforms.spikeCount, 0);\n    }\n\n    // Зоны кислотного дождя\n    if (acidRainZonesData && acidRainZoneCount !== undefined && acidRainZoneCount > 0) {\n      gl.uniform4fv(this.uniforms.acidRainZones, acidRainZonesData);\n      gl.uniform1i(this.uniforms.acidRainZoneCount, acidRainZoneCount);\n    } else {\n      gl.uniform1i(this.uniforms.acidRainZoneCount, 0);\n    }\n    \n    // Эпоха (1-3)\n    gl.uniform1i(this.uniforms.era, era || 1);\n    \n    // Волна (для дождя на 15+)\n    gl.uniform1i(this.uniforms.wave, wave || 1);\n    \n    // Фаза 2 зелёного босса (зелёное небо)\n    gl.uniform1i(this.uniforms.greenBossPhase2, greenBossPhase2 ? 1 : 0);\n    \n    // Пикапы\n    if (pickupsData && pickupCount !== undefined) {\n      gl.uniform4fv(this.uniforms.pickups, pickupsData);\n      gl.uniform1i(this.uniforms.pickupCount, pickupCount);\n    } else {\n      gl.uniform1i(this.uniforms.pickupCount, 0);\n    }\n\n    // Кристаллы силы\n    if (crystalsData) {\n      gl.uniform4fv(this.uniforms.crystals, crystalsData);\n    }\n\n    // Режим войда\n    gl.uniform1i(this.uniforms.voidMode, voidMode ? 1 : 0);\n    gl.uniform1f(this.uniforms.voidProgress, voidProgress || 0.0);\n    gl.uniform1f(this.uniforms.voidFallOffset, voidFallOffset || 0.0);\n    gl.uniform3f(\n      this.uniforms.portalPos,\n      portalPos?.x || 0.0,\n      portalPos?.y || 0.0,\n      portalPos?.z || 0.0\n    );\n    \n    // Алтари\n    if (altarsData) {\n      gl.uniform4fv(this.uniforms.altars, altarsData);\n    }\n    \n    // Энергетические лучи\n    if (dartsData && dartDirsData && dartCount !== undefined && dartCount > 0) {\n      gl.uniform4fv(this.uniforms.darts, dartsData);\n      gl.uniform4fv(this.uniforms.dartDirs, dartDirsData);\n      gl.uniform1i(this.uniforms.dartCount, dartCount);\n    } else {\n      gl.uniform1i(this.uniforms.dartCount, 0);\n    }\n    \n    // Портал в войд\n    gl.uniform1f(this.uniforms.voidPortalActive, voidPortalActive || 0.0);\n    \n    // Монеты крови\n    if (bloodCoinsData && bloodCoinCount !== undefined && bloodCoinCount > 0) {\n      gl.uniform4fv(this.uniforms.bloodCoins, bloodCoinsData);\n      gl.uniform1i(this.uniforms.bloodCoinCount, bloodCoinCount);\n    } else {\n      gl.uniform1i(this.uniforms.bloodCoinCount, 0);\n    }\n    \n    // Гранаты\n    if (grenadesData && grenadeCount !== undefined && grenadeCount > 0) {\n      gl.uniform4fv(this.uniforms.grenades, grenadesData);\n      gl.uniform1i(this.uniforms.grenadeCount, grenadeCount);\n    } else {\n      gl.uniform1i(this.uniforms.grenadeCount, 0);\n    }\n    \n    // Взрывы\n    if (explosionsData && explosionCount !== undefined && explosionCount > 0) {\n      gl.uniform4fv(this.uniforms.explosions, explosionsData);\n      gl.uniform1i(this.uniforms.explosionCount, explosionCount);\n    } else {\n      gl.uniform1i(this.uniforms.explosionCount, 0);\n    }\n    \n    // Вариант войда\n    gl.uniform1i(this.uniforms.voidVariant, voidVariant || 0);\n    \n    // Катана 3D\n    gl.uniform1f(this.uniforms.katanaAttack, katanaAttack || 0);\n    gl.uniform1f(this.uniforms.katanaBob, katanaBob || 0);\n    gl.uniform1i(this.uniforms.katanaCharges, katanaCharges || 0);\n    gl.uniform1f(this.uniforms.katanaTargetAngle, katanaTargetAngle !== undefined ? katanaTargetAngle : -1);\n    gl.uniform1f(this.uniforms.katanaTargetDist, katanaTargetDist || 100);\n    gl.uniform1i(this.uniforms.katanaAttackType, katanaAttackType || 0);\n    \n    // Эффекты смерти врагов\n    if (deathEffectsData) {\n      gl.uniform4fv(this.uniforms.deathEffects, deathEffectsData);\n    } else {\n      gl.uniform4fv(this.uniforms.deathEffects, new Float32Array(32)); // 8 * 4\n    }\n    \n    // Фрагменты врагов\n    if (fragmentsData && fragmentsData.length > 0) {\n      // Расширяем массив до 128 элементов (32 фрагмента * 4 компонента)\n      const paddedData = new Float32Array(128);\n      paddedData.set(fragmentsData.subarray(0, Math.min(fragmentsData.length, 128)));\n      gl.uniform4fv(this.uniforms.fragments, paddedData);\n      gl.uniform1i(this.uniforms.fragmentCount, Math.min(fragmentCount || 0, 32));\n    } else {\n      gl.uniform4fv(this.uniforms.fragments, new Float32Array(128)); // 32 * 4\n      gl.uniform1i(this.uniforms.fragmentCount, 0);\n    }\n\n    // Рисуем\n    gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n  }\n\n  /** Уничтожить рендерер */\n  public destroy(): void {\n    if (this.program) {\n      this.gl.deleteProgram(this.program);\n    }\n  }\n}\n\n","/**\n * HUD для Samurai Pool Arena\n * Здоровье, волна, счёт, эффекты\n */\nexport class HUD {\n  private healthEl: HTMLElement | null;\n  private ammoEl: HTMLElement | null;\n  private fragsEl: HTMLElement | null;\n  private crosshairEl: HTMLElement | null;\n  private hitmarkerEl: HTMLElement | null;\n  private reloadEl: HTMLElement | null;\n  private waveEl: HTMLElement | null;\n  private messageEl: HTMLElement | null;\n  private damageOverlay: HTMLElement | null;\n  private weaponEl: HTMLElement | null;\n  private scoreEl: HTMLElement | null;\n  private altarScoreEl: HTMLElement | null;\n  private dartsEl: HTMLElement | null;\n\n  constructor() {\n    this.healthEl = document.getElementById('health-value');\n    this.ammoEl = document.getElementById('ammo-value');\n    this.fragsEl = document.getElementById('frags-value');\n    this.crosshairEl = document.getElementById('crosshair');\n    this.hitmarkerEl = document.getElementById('hitmarker');\n    this.reloadEl = document.getElementById('reload-indicator');\n    \n    // Скрываем перезарядку - катане не нужна\n    if (this.reloadEl) {\n      this.reloadEl.style.display = 'none';\n    }\n    \n    // Создаём элементы для волн\n    this.waveEl = this.createWaveElement();\n    this.messageEl = this.createMessageElement();\n    this.damageOverlay = this.createDamageOverlay();\n    this.weaponEl = this.createWeaponElement();\n    this.scoreEl = this.createScoreElement();\n    this.altarScoreEl = this.createAltarScoreElement();\n    this.dartsEl = this.createDartsElement();\n    \n    // Скрываем все HUD элементы до старта игры\n    this.hideHUD();\n  }\n  \n  /** Скрыть HUD (в главном меню) */\n  public hideHUD(): void {\n    const hudEl = document.getElementById('hud');\n    if (hudEl) hudEl.style.opacity = '0';\n    if (this.weaponEl) this.weaponEl.style.display = 'none';\n    if (this.scoreEl) this.scoreEl.style.display = 'none';\n    if (this.altarScoreEl) this.altarScoreEl.style.display = 'none';\n    if (this.dartsEl) this.dartsEl.style.display = 'none';\n    if (this.doubleJumpEl) this.doubleJumpEl.style.display = 'none';\n    if (this.splashChargesEl) this.splashChargesEl.style.display = 'none';\n  }\n  \n  /** Показать HUD (при старте игры) */\n  public showHUD(): void {\n    const hudEl = document.getElementById('hud');\n    if (hudEl) hudEl.style.opacity = '1';\n    if (this.weaponEl) this.weaponEl.style.display = 'block';\n    if (this.scoreEl) this.scoreEl.style.display = 'block';\n    if (this.altarScoreEl) this.altarScoreEl.style.display = 'block';\n    if (this.dartsEl) this.dartsEl.style.display = 'block';\n    if (this.doubleJumpEl) this.doubleJumpEl.style.display = 'block';\n    // splashChargesEl показывается только когда есть заряды\n  }\n  \n  /** Создать элемент количества дротиков - CYBERPUNK */\n  private createDartsElement(): HTMLElement {\n    let el = document.getElementById('darts-count');\n    if (!el) {\n      el = document.createElement('div');\n      el.id = 'darts-count';\n      el.style.cssText = `\n        position: fixed;\n        bottom: 70px;\n        right: 15px;\n        font-family: 'Rajdhani', sans-serif;\n        font-size: 11px;\n        font-weight: 500;\n        color: rgba(255, 102, 0, 0.6);\n        padding: 6px 12px;\n        background: linear-gradient(180deg, rgba(255,102,0,0.08) 0%, transparent 100%);\n        border-top: 1px solid rgba(255, 102, 0, 0.4);\n        transform: skewX(-5deg);\n        pointer-events: none;\n        z-index: 1000;\n        letter-spacing: 2px;\n        text-transform: uppercase;\n      `;\n      el.innerHTML = '◎ <span id=\"darts-value\" style=\"font-family:Orbitron;font-size:16px;color:#ff6600;\">0</span>';\n      document.body.appendChild(el);\n    }\n    return el;\n  }\n  \n  /** Создать элемент текущих очков - CYBERPUNK */\n  private createScoreElement(): HTMLElement {\n    let el = document.getElementById('score-carrying');\n    if (!el) {\n      el = document.createElement('div');\n      el.id = 'score-carrying';\n      el.style.cssText = `\n        position: fixed;\n        bottom: 105px;\n        right: 15px;\n        font-family: 'Rajdhani', sans-serif;\n        font-size: 11px;\n        font-weight: 500;\n        color: rgba(255, 204, 0, 0.6);\n        padding: 6px 12px;\n        background: linear-gradient(180deg, rgba(255,204,0,0.08) 0%, transparent 100%);\n        border-top: 1px solid rgba(255, 204, 0, 0.4);\n        transform: skewX(-5deg);\n        pointer-events: none;\n        z-index: 1000;\n        letter-spacing: 2px;\n        text-transform: uppercase;\n      `;\n      el.innerHTML = '✕ <span id=\"score-value\" style=\"font-family:Orbitron;font-size:16px;color:#ffcc00;\">0</span>';\n      document.body.appendChild(el);\n    }\n    return el;\n  }\n  \n  /** Создать элемент общего счёта алтарей - CYBERPUNK */\n  private createAltarScoreElement(): HTMLElement {\n    let el = document.getElementById('altar-score');\n    if (!el) {\n      el = document.createElement('div');\n      el.id = 'altar-score';\n      el.style.cssText = `\n        position: fixed;\n        bottom: 140px;\n        right: 15px;\n        font-family: 'Rajdhani', sans-serif;\n        font-size: 11px;\n        font-weight: 500;\n        color: rgba(0, 240, 255, 0.6);\n        padding: 8px 14px;\n        background: linear-gradient(180deg, rgba(0,240,255,0.1) 0%, transparent 100%);\n        border-top: 1px solid rgba(0, 240, 255, 0.5);\n        transform: skewX(-5deg);\n        pointer-events: none;\n        z-index: 1000;\n        letter-spacing: 2px;\n        text-transform: uppercase;\n      `;\n      el.innerHTML = '⌂ <span id=\"altar-value\" style=\"font-family:Orbitron;font-size:20px;color:#00f0ff;text-shadow:0 0 20px rgba(0,240,255,0.6);\">0</span>';\n      document.body.appendChild(el);\n    }\n    return el;\n  }\n\n  /** Создать элемент волны - CYBERPUNK TOAST */\n  private createWaveElement(): HTMLElement {\n    let el = document.getElementById('wave-indicator');\n    if (!el) {\n      el = document.createElement('div');\n      el.id = 'wave-indicator';\n      el.style.cssText = `\n        position: fixed;\n        top: 12%;\n        left: 50%;\n        transform: translateX(-50%) skewX(-3deg);\n        font-family: 'Orbitron', sans-serif;\n        font-size: 20px;\n        font-weight: 600;\n        color: #00f0ff;\n        text-shadow: 0 0 30px rgba(0, 240, 255, 0.8);\n        opacity: 0;\n        padding: 12px 50px;\n        background: linear-gradient(90deg, \n          transparent 0%, \n          rgba(0, 240, 255, 0.08) 10%, \n          rgba(0, 240, 255, 0.12) 50%, \n          rgba(0, 240, 255, 0.08) 90%, \n          transparent 100%\n        );\n        border-left: 2px solid rgba(0, 240, 255, 0.8);\n        border-right: 2px solid rgba(0, 240, 255, 0.8);\n        backdrop-filter: blur(4px);\n        transition: all 0.3s cubic-bezier(0.16, 1, 0.3, 1);\n        pointer-events: none;\n        z-index: 1000;\n        letter-spacing: 8px;\n        text-transform: uppercase;\n      `;\n      document.body.appendChild(el);\n    }\n    return el;\n  }\n\n  /** Создать элемент сообщений - CYBERPUNK STYLE */\n  private createMessageElement(): HTMLElement {\n    let el = document.getElementById('game-message');\n    if (!el) {\n      el = document.createElement('div');\n      el.id = 'game-message';\n      el.style.cssText = `\n        position: fixed;\n        top: 45%;\n        left: 50%;\n        transform: translate(-50%, -50%) skewX(-2deg);\n        font-family: 'Orbitron', sans-serif;\n        font-size: 28px;\n        font-weight: 700;\n        color: #ff3366;\n        text-shadow: 0 0 40px rgba(255, 51, 102, 0.9), 0 2px 0 rgba(0,0,0,0.3);\n        opacity: 0;\n        padding: 18px 60px;\n        background: linear-gradient(90deg, \n          transparent 0%, \n          rgba(255, 51, 102, 0.1) 5%, \n          rgba(255, 51, 102, 0.15) 50%, \n          rgba(255, 51, 102, 0.1) 95%, \n          transparent 100%\n        );\n        border-top: 1px solid rgba(255, 51, 102, 0.5);\n        border-bottom: 1px solid rgba(255, 51, 102, 0.5);\n        backdrop-filter: blur(6px);\n        transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);\n        pointer-events: none;\n        text-align: center;\n        z-index: 1000;\n        letter-spacing: 6px;\n        text-transform: uppercase;\n      `;\n      document.body.appendChild(el);\n    }\n    return el;\n  }\n\n  /** Создать оверлей урона */\n  private createDamageOverlay(): HTMLElement {\n    let el = document.getElementById('damage-overlay');\n    if (!el) {\n      el = document.createElement('div');\n      el.id = 'damage-overlay';\n      el.style.cssText = `\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: radial-gradient(circle, \n          rgba(0, 255, 0, 0.3) 0%,\n          rgba(50, 255, 50, 0.4) 30%,\n          rgba(0, 150, 0, 0.5) 70%,\n          rgba(0, 100, 0, 0.6) 100%\n        );\n        opacity: 0;\n        transition: opacity 0.15s;\n        pointer-events: none;\n        z-index: 999;\n      `;\n      document.body.appendChild(el);\n    }\n    return el;\n  }\n\n  /** Создать элемент оружия - CYBERPUNK */\n  private createWeaponElement(): HTMLElement {\n    let el = document.getElementById('weapon-indicator');\n    if (!el) {\n      el = document.createElement('div');\n      el.id = 'weapon-indicator';\n      el.style.cssText = `\n        position: fixed;\n        bottom: 20px;\n        right: 120px;\n        font-family: 'Rajdhani', sans-serif;\n        font-size: 10px;\n        font-weight: 500;\n        color: rgba(0, 240, 255, 0.5);\n        letter-spacing: 3px;\n        text-transform: uppercase;\n        z-index: 100;\n      `;\n      el.textContent = '⚔ КАТАНА';\n      document.body.appendChild(el);\n    }\n    return el;\n  }\n\n  /** Обновить индикатор оружия */\n  public updateWeapon(weapon: 'katana' | 'axe', charges?: number): void {\n    if (this.weaponEl) {\n      if (weapon === 'katana') {\n        this.weaponEl.textContent = '⚔️ КАТАНА';\n        this.weaponEl.style.color = '#00ffff';\n        this.weaponEl.style.borderColor = 'rgba(0, 255, 255, 0.5)';\n      } else {\n        this.weaponEl.textContent = `🪓 ТОПОР (${charges})`;\n        this.weaponEl.style.color = '#ff8800';\n        this.weaponEl.style.borderColor = 'rgba(255, 136, 0, 0.5)';\n        \n        // Мигание при малом количестве зарядов\n        if (charges !== undefined && charges <= 2) {\n          this.weaponEl.style.animation = 'pulse 0.5s infinite';\n        } else {\n          this.weaponEl.style.animation = 'none';\n        }\n      }\n    }\n  }\n\n  /** Оверлей замедления */\n  private slowOverlay: HTMLElement | null = null;\n\n  /** Показать урон с определённым цветом */\n  public showDamage(color: 'green' | 'purple' = 'green'): void {\n    if (this.damageOverlay) {\n      if (color === 'purple') {\n        // Фиолетовый для фантома + ЗАМЕДЛЕНИЕ\n        this.damageOverlay.style.background = `radial-gradient(circle, \n          rgba(100, 0, 150, 0.3) 0%,\n          rgba(80, 0, 120, 0.4) 30%,\n          rgba(50, 0, 80, 0.5) 70%,\n          rgba(30, 0, 50, 0.6) 100%\n        )`;\n        // Показываем оверлей замедления\n        this.showSlowdown(2.0);\n      } else {\n        // Зелёный для бейнлинга\n        this.damageOverlay.style.background = `radial-gradient(circle, \n          rgba(0, 255, 0, 0.3) 0%,\n          rgba(50, 255, 50, 0.4) 30%,\n          rgba(0, 150, 0, 0.5) 70%,\n          rgba(0, 100, 0, 0.6) 100%\n        )`;\n      }\n      this.damageOverlay.style.opacity = '1';\n      setTimeout(() => {\n        if (this.damageOverlay) this.damageOverlay.style.opacity = '0';\n      }, 150);\n    }\n  }\n\n  /** Показать эффект замедления */\n  public showSlowdown(duration: number): void {\n    if (!this.slowOverlay) {\n      this.slowOverlay = document.createElement('div');\n      this.slowOverlay.id = 'slow-overlay';\n      this.slowOverlay.style.cssText = `\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: radial-gradient(circle,\n          transparent 0%,\n          rgba(50, 0, 80, 0.2) 50%,\n          rgba(30, 0, 60, 0.4) 100%\n        );\n        pointer-events: none;\n        z-index: 998;\n        opacity: 0;\n        transition: opacity 0.3s;\n      `;\n      document.body.appendChild(this.slowOverlay);\n    }\n\n    this.slowOverlay.style.opacity = '1';\n    \n    // Эффект пульсации\n    this.slowOverlay.animate([\n      { filter: 'hue-rotate(0deg) brightness(1)' },\n      { filter: 'hue-rotate(20deg) brightness(1.1)' },\n      { filter: 'hue-rotate(0deg) brightness(1)' }\n    ], {\n      duration: 500,\n      iterations: Math.ceil(duration * 2)\n    });\n\n    setTimeout(() => {\n      if (this.slowOverlay) {\n        this.slowOverlay.style.opacity = '0';\n      }\n    }, duration * 1000);\n  }\n\n  /** Обновить здоровье */\n  public updateHealth(health: number, maxHealth: number): void {\n    if (this.healthEl) {\n      this.healthEl.textContent = Math.floor(health).toString();\n      \n      const ratio = health / maxHealth;\n      if (ratio > 0.5) {\n        this.healthEl.style.color = '#00ffaa';\n      } else if (ratio > 0.25) {\n        this.healthEl.style.color = '#ffaa00';\n      } else {\n        this.healthEl.style.color = '#ff4444';\n      }\n    }\n  }\n  \n  /** Обновить текущие очки (несёт игрок) */\n  public updateCarryingScore(score: number): void {\n    const valueEl = document.getElementById('score-value');\n    if (valueEl) {\n      valueEl.textContent = score.toString();\n      \n      // Пульсация при изменении\n      if (this.scoreEl) {\n        this.scoreEl.style.transform = 'scale(1.1)';\n        setTimeout(() => {\n          if (this.scoreEl) this.scoreEl.style.transform = 'scale(1)';\n        }, 100);\n      }\n    }\n  }\n  \n  /** Обновить общий счёт алтарей */\n  public updateAltarScore(total: number): void {\n    const valueEl = document.getElementById('altar-value');\n    if (valueEl) {\n      valueEl.textContent = total.toString();\n      \n      // Яркая вспышка при обновлении\n      if (this.altarScoreEl) {\n        this.altarScoreEl.style.boxShadow = '0 0 30px #00ffaa';\n        setTimeout(() => {\n          if (this.altarScoreEl) this.altarScoreEl.style.boxShadow = '';\n        }, 300);\n      }\n    }\n  }\n  \n  /** Обновить количество дротиков */\n  public updateDarts(count: number): void {\n    const valueEl = document.getElementById('darts-value');\n    if (valueEl) {\n      valueEl.textContent = count.toString();\n      \n      // Цвет в зависимости от количества\n      if (this.dartsEl) {\n        if (count === 0) {\n          this.dartsEl.style.opacity = '0.5';\n        } else {\n          this.dartsEl.style.opacity = '1';\n        }\n      }\n    }\n  }\n\n  /** Обновить заряды сплеш-волны */\n  public updateSplashCharges(charges: number): void {\n    if (!this.splashChargesEl) {\n      this.createSplashChargesElement();\n    }\n    \n    if (this.splashChargesEl) {\n      if (charges > 0) {\n        this.splashChargesEl.style.display = 'block';\n        this.splashChargesEl.innerHTML = `⚡ ВОЛНА: ${'●'.repeat(charges)}${'○'.repeat(3 - charges)}`;\n        this.splashChargesEl.style.color = '#00ffff';\n        this.splashChargesEl.style.textShadow = '0 0 10px #00ffff, 0 0 20px #00ffff';\n      } else {\n        this.splashChargesEl.style.display = 'none';\n      }\n    }\n  }\n\n  /** Создать элемент зарядов */\n  private splashChargesEl: HTMLElement | null = null;\n  \n  /** Элемент кулдауна двойного прыжка */\n  private doubleJumpEl: HTMLElement | null = null;\n  \n  private createSplashChargesElement(): void {\n    this.splashChargesEl = document.createElement('div');\n    this.splashChargesEl.style.cssText = `\n      position: fixed;\n      bottom: 80px;\n      right: 20px;\n      font-family: 'Orbitron', 'Audiowide', monospace;\n      font-size: 18px;\n      color: #00ffff;\n      text-shadow: 0 0 10px #00ffff;\n      letter-spacing: 2px;\n      display: none;\n      z-index: 1000;\n    `;\n    document.body.appendChild(this.splashChargesEl);\n  }\n\n  /** Обновить индикатор двойного прыжка - иконка запрета */\n  public updateDoubleJump(_cooldown: number, isReady: boolean): void {\n    if (!this.doubleJumpEl) {\n      this.createDoubleJumpElement();\n    }\n    \n    if (this.doubleJumpEl) {\n      if (isReady) {\n        // Скрываем когда готов\n        this.doubleJumpEl.style.opacity = '0';\n      } else {\n        // Показываем иконку запрета\n        this.doubleJumpEl.style.opacity = '1';\n      }\n    }\n  }\n\n  private createDoubleJumpElement(): void {\n    this.doubleJumpEl = document.createElement('div');\n    this.doubleJumpEl.style.cssText = `\n      position: fixed;\n      bottom: 70px;\n      left: 15px;\n      font-size: 20px;\n      color: rgba(255, 100, 100, 0.7);\n      text-shadow: 0 0 8px rgba(255, 50, 50, 0.5);\n      z-index: 1000;\n      opacity: 0;\n      transition: opacity 0.2s;\n      display: none;\n    `;\n    this.doubleJumpEl.innerHTML = '⊘'; // Иконка запрета\n    document.body.appendChild(this.doubleJumpEl);\n  }\n\n  /** Количество врагов */\n  private enemiesCount = 0;\n  \n  /** Обновить врагов - показываем рядом со счётом */\n  public updateAmmo(_wave: number, enemiesLeft: number): void {\n    this.enemiesCount = enemiesLeft;\n    this.updateFragsDisplay();\n    \n    // Скрываем старую панель ammo\n    if (this.ammoEl) {\n      const ammoPanel = this.ammoEl.parentElement;\n      if (ammoPanel) ammoPanel.style.display = 'none';\n    }\n  }\n\n  /** Обновить счёт */\n  public updateFrags(frags: number): void {\n    if (this.fragsEl) {\n      this.fragsEl.textContent = frags.toString();\n    }\n    this.updateFragsDisplay();\n  }\n  \n  /** Обновить отображение счёта с врагами */\n  private updateFragsDisplay(): void {\n    // Добавляем количество врагов к панели счёта\n    let enemyEl = document.getElementById('enemies-inline');\n    if (!enemyEl) {\n      enemyEl = document.createElement('span');\n      enemyEl.id = 'enemies-inline';\n      enemyEl.style.cssText = `\n        margin-left: 15px;\n        color: rgba(0, 212, 224, 0.8);\n        font-size: 14px;\n      `;\n      const fragsPanel = document.getElementById('frags');\n      if (fragsPanel) fragsPanel.appendChild(enemyEl);\n    }\n    \n    if (this.enemiesCount > 0) {\n      enemyEl.innerHTML = `<span style=\"color:rgba(0,212,224,0.5);\">⚔</span> ${this.enemiesCount}`;\n    } else {\n      enemyEl.innerHTML = `<span style=\"color:#00ff88;\">✓</span>`;\n    }\n  }\n\n  /** Показать волну - CYBERPUNK ANIMATION */\n  public showWave(wave: number): void {\n    if (this.waveEl) {\n      this.waveEl.textContent = `▸ ВОЛНА ${wave} ◂`;\n      this.waveEl.style.color = '#00f0ff';\n      this.waveEl.style.borderColor = 'rgba(0, 240, 255, 0.8)';\n      \n      // Появление с глитч-эффектом\n      this.waveEl.animate([\n        { opacity: 0, transform: 'translateX(-50%) skewX(-3deg) scaleX(1.5)', filter: 'blur(10px)' },\n        { opacity: 0.5, transform: 'translateX(-48%) skewX(-5deg) scaleX(1.1)', filter: 'blur(2px)' },\n        { opacity: 1, transform: 'translateX(-50%) skewX(-3deg) scaleX(1)', filter: 'blur(0px)' }\n      ], { duration: 400, fill: 'forwards', easing: 'cubic-bezier(0.16, 1, 0.3, 1)' });\n      \n      setTimeout(() => {\n        if (this.waveEl) {\n          this.waveEl.animate([\n            { opacity: 1, transform: 'translateX(-50%) skewX(-3deg)' },\n            { opacity: 0, transform: 'translateX(-50%) skewX(-3deg) translateY(-15px)' }\n          ], { duration: 300, fill: 'forwards', easing: 'ease-in' });\n        }\n      }, 1800);\n    }\n  }\n\n  /** Показать завершение волны - CYBERPUNK */\n  public showWaveComplete(wave: number): void {\n    if (this.waveEl) {\n      this.waveEl.textContent = `◈ ВОЛНА ${wave} ПРОЙДЕНА ◈`;\n      this.waveEl.style.color = '#00ff88';\n      this.waveEl.style.borderColor = 'rgba(0, 255, 136, 0.8)';\n      \n      // Появление\n      this.waveEl.animate([\n        { opacity: 0, transform: 'translateX(-50%) skewX(-3deg) scaleY(0.5)' },\n        { opacity: 1, transform: 'translateX(-50%) skewX(-3deg) scaleY(1)' }\n      ], { duration: 300, fill: 'forwards', easing: 'cubic-bezier(0.16, 1, 0.3, 1)' });\n      \n      // Переключение на \"готовься\"\n      setTimeout(() => {\n        if (this.waveEl) {\n          this.waveEl.textContent = `▸ ГОТОВЬСЯ ◂`;\n          this.waveEl.style.color = '#ffaa00';\n          this.waveEl.style.borderColor = 'rgba(255, 170, 0, 0.6)';\n        }\n      }, 1500);\n      \n      // Исчезновение\n      setTimeout(() => {\n        if (this.waveEl) {\n          this.waveEl.animate([\n            { opacity: 1 },\n            { opacity: 0 }\n          ], { duration: 400, fill: 'forwards' });\n        }\n      }, 3200);\n    }\n  }\n\n  /** Показать Game Over - CYBERPUNK */\n  public showGameOver(score: number, wave: number): void {\n    if (this.messageEl) {\n      this.messageEl.innerHTML = `\n        <div style=\"font-size:32px;letter-spacing:8px;\">GAME OVER</div>\n        <div style=\"\n          font-size: 14px; \n          color: rgba(0,240,255,0.8); \n          margin-top: 15px;\n          letter-spacing: 4px;\n          font-weight: 400;\n        \">\n          СЧЁТ <span style=\"color:#ff00ff;font-size:18px;\">${score}</span> · ВОЛНА <span style=\"color:#ff00ff;font-size:18px;\">${wave}</span>\n        </div>\n      `;\n      \n      // Глитч-появление\n      this.messageEl.animate([\n        { opacity: 0, transform: 'translate(-50%, -50%) skewX(-2deg) scaleX(2)', filter: 'blur(20px) hue-rotate(90deg)' },\n        { opacity: 0.8, transform: 'translate(-48%, -50%) skewX(-4deg) scaleX(1.1)', filter: 'blur(5px) hue-rotate(0deg)' },\n        { opacity: 1, transform: 'translate(-50%, -50%) skewX(-2deg) scaleX(1)', filter: 'blur(0px) hue-rotate(0deg)' }\n      ], { duration: 500, fill: 'forwards', easing: 'cubic-bezier(0.16, 1, 0.3, 1)' });\n      \n      setTimeout(() => {\n        if (this.messageEl) {\n          this.messageEl.animate([\n            { opacity: 1 },\n            { opacity: 0, filter: 'blur(10px)' }\n          ], { duration: 500, fill: 'forwards' });\n        }\n      }, 3000);\n    }\n  }\n\n  /** Показать индикатор перезарядки - не используется для катаны */\n  public showReloading(_show: boolean): void {\n    // Катане не нужна перезарядка\n  }\n\n  /** Расширить прицел */\n  public expandCrosshair(): void {\n    if (this.crosshairEl) {\n      this.crosshairEl.classList.add('shooting');\n      setTimeout(() => {\n        this.crosshairEl?.classList.remove('shooting');\n      }, 100);\n    }\n  }\n\n  /** Показать хитмаркер */\n  public showHitmarker(isKill: boolean = false): void {\n    if (this.hitmarkerEl) {\n      this.hitmarkerEl.className = 'hitmarker active';\n      if (isKill) {\n        this.hitmarkerEl.classList.add('kill');\n      }\n      \n      setTimeout(() => {\n        this.hitmarkerEl?.classList.remove('active', 'kill');\n      }, 150);\n    }\n  }\n\n  /** Эффект урона (алиас) */\n  public showDamageEffect(): void {\n    this.showDamage('green');\n  }\n\n  /** Показать сообщение - CYBERPUNK TOAST */\n  public showMessage(text: string, color: string = 'white'): void {\n    const msg = document.createElement('div');\n    msg.style.cssText = `\n      position: fixed;\n      top: 25%;\n      left: 50%;\n      transform: translateX(-50%) skewX(-3deg) translateY(20px);\n      font-family: 'Orbitron', sans-serif;\n      font-size: 18px;\n      font-weight: 600;\n      color: ${color};\n      text-shadow: 0 0 30px ${color};\n      padding: 10px 40px;\n      background: linear-gradient(90deg, transparent 0%, rgba(0,0,0,0.4) 20%, rgba(0,0,0,0.4) 80%, transparent 100%);\n      border-left: 2px solid ${color};\n      border-right: 2px solid ${color};\n      pointer-events: none;\n      z-index: 1100;\n      opacity: 0;\n      letter-spacing: 3px;\n      text-transform: uppercase;\n    `;\n    msg.textContent = text;\n    document.body.appendChild(msg);\n\n    // Анимация появления\n    msg.animate([\n      { opacity: 0, transform: 'translateX(-50%) skewX(-3deg) translateY(30px)' },\n      { opacity: 1, transform: 'translateX(-50%) skewX(-3deg) translateY(0)' }\n    ], { duration: 200, fill: 'forwards', easing: 'cubic-bezier(0.16, 1, 0.3, 1)' });\n\n    // Анимация исчезновения\n    setTimeout(() => {\n      msg.animate([\n        { opacity: 1, transform: 'translateX(-50%) skewX(-3deg) translateY(0)' },\n        { opacity: 0, transform: 'translateX(-50%) skewX(-3deg) translateY(-20px)' }\n      ], { duration: 300, fill: 'forwards', easing: 'ease-in' });\n      setTimeout(() => msg.remove(), 300);\n    }, 800);\n  }\n\n  /** Показать оверлей буйства */\n  private rageOverlay: HTMLElement | null = null;\n\n  /** HP бар босса */\n  private bossHealthBar: HTMLElement | null = null;\n  private bossHealthFill: HTMLElement | null = null;\n  private bossNameEl: HTMLElement | null = null;\n\n  /** Оверлей войда */\n  private voidOverlay: HTMLElement | null = null;\n  private voidTimerEl: HTMLElement | null = null;\n  private voidKillsEl: HTMLElement | null = null;\n\n  public showRageOverlay(duration: number): void {\n    if (!this.rageOverlay) {\n      this.rageOverlay = document.createElement('div');\n      this.rageOverlay.id = 'rage-overlay';\n      this.rageOverlay.style.cssText = `\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: radial-gradient(circle,\n          transparent 0%,\n          rgba(255, 50, 0, 0.15) 50%,\n          rgba(255, 0, 0, 0.3) 100%\n        );\n        pointer-events: none;\n        z-index: 997;\n        opacity: 0;\n        transition: opacity 0.3s;\n      `;\n      document.body.appendChild(this.rageOverlay);\n    }\n\n    this.rageOverlay.style.opacity = '1';\n    \n    this.rageOverlay.animate([\n      { filter: 'hue-rotate(0deg) brightness(1)' },\n      { filter: 'hue-rotate(-20deg) brightness(1.2)' },\n      { filter: 'hue-rotate(0deg) brightness(1)' }\n    ], {\n      duration: 300,\n      iterations: Math.ceil(duration * 3)\n    });\n\n    setTimeout(() => {\n      if (this.rageOverlay) {\n        this.rageOverlay.style.opacity = '0';\n      }\n    }, duration * 1000);\n  }\n\n  /** Показать HP босса */\n  public showBossHealth(hp: number, maxHp: number, bossType: string): void {\n    if (!this.bossHealthBar) {\n      // Создаём контейнер\n      this.bossHealthBar = document.createElement('div');\n      this.bossHealthBar.style.cssText = `\n        position: fixed;\n        top: 50px;\n        left: 50%;\n        transform: translateX(-50%);\n        width: 400px;\n        padding: 10px;\n        background: rgba(0, 0, 0, 0.7);\n        border: 2px solid #ff0000;\n        border-radius: 8px;\n        z-index: 1100;\n        text-align: center;\n        font-family: 'Orbitron', sans-serif;\n        box-shadow: 0 0 20px rgba(255, 0, 0, 0.5);\n      `;\n      \n      // Имя босса\n      this.bossNameEl = document.createElement('div');\n      this.bossNameEl.style.cssText = `\n        color: #ff4444;\n        font-size: 16px;\n        text-shadow: 0 0 10px #ff0000;\n        margin-bottom: 8px;\n        text-transform: uppercase;\n        letter-spacing: 3px;\n      `;\n      this.bossHealthBar.appendChild(this.bossNameEl);\n      \n      // Полоска HP\n      const barContainer = document.createElement('div');\n      barContainer.style.cssText = `\n        width: 100%;\n        height: 20px;\n        background: #333;\n        border-radius: 10px;\n        overflow: hidden;\n        border: 1px solid #666;\n      `;\n      \n      this.bossHealthFill = document.createElement('div');\n      this.bossHealthFill.style.cssText = `\n        height: 100%;\n        transition: width 0.3s ease-out;\n        border-radius: 10px;\n      `;\n      barContainer.appendChild(this.bossHealthFill);\n      this.bossHealthBar.appendChild(barContainer);\n      \n      document.body.appendChild(this.bossHealthBar);\n    }\n\n    // Имя и цвет\n    let bossName = 'БОСС';\n    let barColor = '#ff0000';\n    \n    if (bossType === 'boss_green') {\n      bossName = '☠️ ТОКСИЧНЫЙ ГИГАНТ ☠️';\n      barColor = 'linear-gradient(90deg, #00ff00, #88ff00)';\n      this.bossHealthBar.style.borderColor = '#00ff00';\n      this.bossHealthBar.style.boxShadow = '0 0 20px rgba(0, 255, 0, 0.5)';\n    } else if (bossType === 'boss_black') {\n      bossName = '🌀 ВЛАДЫКА ПУСТОТЫ 🌀';\n      barColor = 'linear-gradient(90deg, #4400aa, #8800ff)';\n      this.bossHealthBar.style.borderColor = '#8800ff';\n      this.bossHealthBar.style.boxShadow = '0 0 20px rgba(136, 0, 255, 0.5)';\n    } else if (bossType === 'boss_blue') {\n      bossName = '⚡ ФАНТОМ ХАОСА ⚡';\n      barColor = 'linear-gradient(90deg, #0088ff, #00ffff)';\n      this.bossHealthBar.style.borderColor = '#00ffff';\n      this.bossHealthBar.style.boxShadow = '0 0 20px rgba(0, 255, 255, 0.5)';\n    }\n    \n    if (this.bossNameEl) {\n      this.bossNameEl.textContent = bossName;\n    }\n    \n    if (this.bossHealthFill) {\n      const percent = (hp / maxHp) * 100;\n      this.bossHealthFill.style.width = percent + '%';\n      this.bossHealthFill.style.background = barColor;\n    }\n    \n    this.bossHealthBar.style.display = 'block';\n  }\n\n  /** Скрыть HP босса */\n  public hideBossHealth(): void {\n    if (this.bossHealthBar) {\n      this.bossHealthBar.style.display = 'none';\n    }\n  }\n\n  /** Эпичная заставка босса */\n  public showBossIntro(bossType: string, onComplete?: () => void): void {\n    // Определяем имя и стиль босса\n    let bossName = 'БОСС';\n    let bossSubtitle = '';\n    let color = '#ff0044';\n    let glowColor = 'rgba(255, 0, 68, 0.5)';\n    let icon = '💀';\n    \n    if (bossType === 'boss_green') {\n      bossName = 'ЯДОВИТЫЕ БЛИЗНЕЦЫ';\n      bossSubtitle = 'Охотник & Загонщик';\n      color = '#00ff44';\n      glowColor = 'rgba(0, 255, 68, 0.5)';\n      icon = '☣️';\n    } else if (bossType === 'boss_black') {\n      bossName = 'ВЛАДЫКА ПУСТОТЫ';\n      bossSubtitle = 'Повелитель Тьмы';\n      color = '#8800ff';\n      glowColor = 'rgba(136, 0, 255, 0.5)';\n      icon = '🌀';\n    } else if (bossType === 'boss_blue') {\n      bossName = 'ФАНТОМ ХАОСА';\n      bossSubtitle = 'Владыка Молний';\n      color = '#00ffff';\n      glowColor = 'rgba(0, 255, 255, 0.5)';\n      icon = '⚡';\n    }\n\n    // Создаём оверлей заставки\n    const overlay = document.createElement('div');\n    overlay.id = 'boss-intro-overlay';\n    overlay.style.cssText = `\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      background: rgba(0, 0, 0, 0);\n      display: flex;\n      flex-direction: column;\n      justify-content: center;\n      align-items: center;\n      z-index: 9999;\n      pointer-events: none;\n    `;\n\n    // Иконка босса\n    const iconEl = document.createElement('div');\n    iconEl.style.cssText = `\n      font-size: 120px;\n      opacity: 0;\n      transform: scale(3);\n      filter: drop-shadow(0 0 30px ${glowColor});\n    `;\n    iconEl.textContent = icon;\n\n    // Имя босса\n    const nameEl = document.createElement('div');\n    nameEl.style.cssText = `\n      font-family: 'Orbitron', sans-serif;\n      font-size: 72px;\n      font-weight: 900;\n      color: ${color};\n      text-shadow: \n        0 0 20px ${color},\n        0 0 40px ${glowColor},\n        0 0 60px ${glowColor};\n      opacity: 0;\n      transform: translateY(50px);\n      letter-spacing: 8px;\n      margin-top: 20px;\n    `;\n    nameEl.textContent = bossName;\n\n    // Подзаголовок\n    const subtitleEl = document.createElement('div');\n    subtitleEl.style.cssText = `\n      font-family: 'Orbitron', sans-serif;\n      font-size: 24px;\n      color: ${color};\n      text-shadow: 0 0 10px ${glowColor};\n      opacity: 0;\n      margin-top: 10px;\n      letter-spacing: 4px;\n    `;\n    subtitleEl.textContent = bossSubtitle;\n\n    // Линии по бокам\n    const lineLeft = document.createElement('div');\n    const lineRight = document.createElement('div');\n    const lineStyle = `\n      position: absolute;\n      top: 50%;\n      width: 0;\n      height: 3px;\n      background: linear-gradient(90deg, transparent, ${color});\n    `;\n    lineLeft.style.cssText = lineStyle + 'left: 0; transform: translateY(-50%);';\n    lineRight.style.cssText = lineStyle + 'right: 0; transform: translateY(-50%) scaleX(-1);';\n\n    overlay.appendChild(lineLeft);\n    overlay.appendChild(lineRight);\n    overlay.appendChild(iconEl);\n    overlay.appendChild(nameEl);\n    overlay.appendChild(subtitleEl);\n    document.body.appendChild(overlay);\n\n    // Анимация появления\n    overlay.animate([\n      { background: 'rgba(0, 0, 0, 0)' },\n      { background: 'rgba(0, 0, 0, 0.8)' }\n    ], { duration: 300, fill: 'forwards' });\n\n    iconEl.animate([\n      { opacity: 0, transform: 'scale(3)' },\n      { opacity: 1, transform: 'scale(1)' }\n    ], { duration: 500, delay: 200, fill: 'forwards', easing: 'ease-out' });\n\n    nameEl.animate([\n      { opacity: 0, transform: 'translateY(50px)' },\n      { opacity: 1, transform: 'translateY(0)' }\n    ], { duration: 500, delay: 400, fill: 'forwards', easing: 'ease-out' });\n\n    subtitleEl.animate([\n      { opacity: 0 },\n      { opacity: 0.8 }\n    ], { duration: 400, delay: 600, fill: 'forwards' });\n\n    lineLeft.animate([\n      { width: '0%' },\n      { width: '35%' }\n    ], { duration: 600, delay: 300, fill: 'forwards', easing: 'ease-out' });\n\n    lineRight.animate([\n      { width: '0%' },\n      { width: '35%' }\n    ], { duration: 600, delay: 300, fill: 'forwards', easing: 'ease-out' });\n\n    // Анимация исчезновения и удаление\n    setTimeout(() => {\n      overlay.animate([\n        { opacity: 1 },\n        { opacity: 0 }\n      ], { duration: 500, fill: 'forwards' });\n      \n      setTimeout(() => {\n        overlay.remove();\n        onComplete?.();\n      }, 500);\n    }, 2500);\n  }\n\n  /** Показать UI войда (расстояние до портала) */\n  public showVoidMode(distance: number, maxDistance: number): void {\n    if (!this.voidOverlay) {\n      this.createVoidOverlay();\n    }\n\n    if (this.voidOverlay) {\n      this.voidOverlay.style.display = 'flex';\n      \n      // Заголовок\n      if (this.voidTimerEl) {\n        this.voidTimerEl.textContent = `НАЙДИ ПОРТАЛ`;\n        this.voidTimerEl.style.color = '#aa55ff';\n        this.voidTimerEl.style.textShadow = '0 0 20px #8800ff, 0 0 40px rgba(136, 0, 255, 0.5)';\n      }\n      \n      // Расстояние до портала\n      if (this.voidKillsEl) {\n        this.voidKillsEl.textContent = `🌀 ${distance}м`;\n        \n        // Цвет по расстоянию\n        if (distance < 15) {\n          this.voidKillsEl.style.color = '#00ff88';\n          this.voidKillsEl.style.textShadow = '0 0 15px #00ff88';\n        } else if (distance < 30) {\n          this.voidKillsEl.style.color = '#cc88ff';\n          this.voidKillsEl.style.textShadow = '0 0 15px #aa55ff';\n        } else {\n          this.voidKillsEl.style.color = '#8855cc';\n          this.voidKillsEl.style.textShadow = '0 0 15px #6633aa';\n        }\n      }\n    }\n  }\n\n  /** Скрыть UI войда */\n  public hideVoidMode(): void {\n    if (this.voidOverlay) {\n      this.voidOverlay.style.display = 'none';\n    }\n  }\n\n  /** Создать оверлей войда - фиолетовая тема */\n  private createVoidOverlay(): void {\n    this.voidOverlay = document.createElement('div');\n    this.voidOverlay.id = 'void-overlay';\n    this.voidOverlay.style.cssText = `\n      position: fixed;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      display: none;\n      flex-direction: column;\n      justify-content: flex-start;\n      align-items: center;\n      padding-top: 80px;\n      pointer-events: none;\n      z-index: 1200;\n      background: radial-gradient(ellipse at center, transparent 0%, rgba(30, 0, 50, 0.3) 100%);\n    `;\n\n    // Заголовок \"ВОЙД\"\n    const titleEl = document.createElement('div');\n    titleEl.style.cssText = `\n      font-family: 'Orbitron', sans-serif;\n      font-size: 48px;\n      font-weight: 900;\n      color: #aa55ff;\n      text-shadow: \n        0 0 30px #8800ff,\n        0 0 60px rgba(136, 0, 255, 0.5),\n        0 0 90px rgba(100, 0, 200, 0.3);\n      letter-spacing: 15px;\n      margin-bottom: 20px;\n      animation: voidPulse 1s ease-in-out infinite;\n    `;\n    titleEl.textContent = 'В О Й Д';\n\n    // Инструкция\n    this.voidTimerEl = document.createElement('div');\n    this.voidTimerEl.style.cssText = `\n      font-family: 'Orbitron', sans-serif;\n      font-size: 32px;\n      font-weight: 700;\n      color: #aa55ff;\n      text-shadow: 0 0 20px #8800ff, 0 0 40px rgba(136, 0, 255, 0.5);\n      letter-spacing: 5px;\n      margin-bottom: 15px;\n    `;\n\n    // Расстояние до портала\n    this.voidKillsEl = document.createElement('div');\n    this.voidKillsEl.style.cssText = `\n      font-family: 'Orbitron', sans-serif;\n      font-size: 28px;\n      color: #cc88ff;\n      text-shadow: 0 0 15px #aa55ff;\n      letter-spacing: 3px;\n    `;\n\n    // Подсказка\n    const hintEl = document.createElement('div');\n    hintEl.style.cssText = `\n      font-family: 'Orbitron', sans-serif;\n      font-size: 16px;\n      color: #7744aa;\n      margin-top: 30px;\n      letter-spacing: 2px;\n      text-shadow: 0 0 10px rgba(136, 0, 255, 0.3);\n    `;\n    hintEl.textContent = 'БЕГИ ПО МОСТУ К ПОРТАЛУ';\n\n    // Добавляем CSS анимацию\n    if (!document.getElementById('void-anim-style')) {\n      const style = document.createElement('style');\n      style.id = 'void-anim-style';\n      style.textContent = `\n        @keyframes voidPulse {\n          0%, 100% { \n            opacity: 1; \n            transform: scale(1);\n            filter: brightness(1);\n          }\n          50% { \n            opacity: 0.8; \n            transform: scale(1.02);\n            filter: brightness(1.3);\n          }\n        }\n      `;\n      document.head.appendChild(style);\n    }\n\n    this.voidOverlay.appendChild(titleEl);\n    this.voidOverlay.appendChild(this.voidTimerEl);\n    this.voidOverlay.appendChild(this.voidKillsEl);\n    this.voidOverlay.appendChild(hintEl);\n    document.body.appendChild(this.voidOverlay);\n  }\n\n  /** Показать сообщение входа в войд */\n  public showVoidEnter(): void {\n    this.showMessage('🌀 ВЛАДЫКА ЗАСОСАЛ ТЕБЯ В ВОЙД! 🌀', '#aa55ff');\n  }\n\n  /** Показать сообщение выхода из войда */\n  public showVoidExit(success: boolean): void {\n    if (success) {\n      this.showMessage('✓ ВЫРВАЛСЯ ИЗ ВОЙДА!', '#00ff88');\n    } else {\n      this.showMessage('☠️ ВОЙД ПОГЛОТИЛ ТЕБЯ...', '#aa00ff');\n    }\n  }\n}\n","import type { Vec3, ICollisionSystem } from '@/types';\n\n/**\n * Система коллизий для круглой арены с бассейнами\n * Круглые платформы по центру для паркура с двойным прыжком\n */\nexport class CollisionSystem implements ICollisionSystem {\n  /** Радиус игрока */\n  private playerRadius = 0.4;\n\n  // Размеры круглой арены\n  private arenaRadius = 38.0;\n  \n  // Центральный бассейн\n  private poolRadius = 8.0;\n  \n  // Боковые платформы (левая и правая)\n  private platformHeight = 2.0;\n  private platformX = 20.0;\n  \n  // Мосты\n  private bridgeWidth = 3.5;\n  \n  // Площадки за порталами\n  private backPlatformRadius = 8.0;\n  private backPlatformX = 30.0;\n  \n  // === КРУГЛЫЕ ПЛАТФОРМЫ ДЛЯ ПАРКУРА (спираль по кругу) ===\n  // 6 платформ по кругу с радиусом 10м, высота растёт по спирали\n  // Базовые высоты (без анимации)\n  private baseHeights = [1.8, 3.0, 4.2, 5.4, 6.6, 7.8];\n  private topBaseHeight = 9.5;\n  \n  private jumpPlatforms = [\n    { x: 10.0, z: 0.0, height: 1.8, radius: 1.5 },   // 1 - старт (0°)\n    { x: 5.0, z: 8.66, height: 3.0, radius: 1.4 },   // 2 - (60°)\n    { x: -5.0, z: 8.66, height: 4.2, radius: 1.4 },  // 3 - (120°)\n    { x: -10.0, z: 0.0, height: 5.4, radius: 1.3 },  // 4 - (180°)\n    { x: -5.0, z: -8.66, height: 6.6, radius: 1.3 }, // 5 - (240°)\n    { x: 5.0, z: -8.66, height: 7.8, radius: 1.2 },  // 6 - (300°)\n  ];\n  // Верхняя платформа с бафом - в центре над фонтаном\n  private topPlatform = { x: 0, z: 0, height: 9.5, radius: 2.5 };\n\n  /** Обновить высоту платформ (анимация парения) */\n  public updatePlatforms(time: number): void {\n    // Каждая платформа парит с разной фазой\n    for (let i = 0; i < this.jumpPlatforms.length; i++) {\n      const phase = i * 0.8; // Разная фаза для каждой платформы\n      const bobAmount = Math.sin(time * 1.5 + phase) * 0.3; // ±0.3м\n      this.jumpPlatforms[i].height = this.baseHeights[i] + bobAmount;\n    }\n    // Верхняя платформа тоже парит, но медленнее\n    this.topPlatform.height = this.topBaseHeight + Math.sin(time * 1.0) * 0.2;\n  }\n\n  /** Получить данные платформ для шейдера */\n  public getPlatformData(): Float32Array {\n    // 7 платформ * 4 компонента (x, z, height, radius)\n    const data = new Float32Array(28);\n    for (let i = 0; i < this.jumpPlatforms.length; i++) {\n      const p = this.jumpPlatforms[i];\n      data[i * 4 + 0] = p.x;\n      data[i * 4 + 1] = p.z;\n      data[i * 4 + 2] = p.height;\n      data[i * 4 + 3] = p.radius;\n    }\n    // Верхняя платформа\n    data[24] = this.topPlatform.x;\n    data[25] = this.topPlatform.z;\n    data[26] = this.topPlatform.height;\n    data[27] = this.topPlatform.radius;\n    return data;\n  }\n\n  /** Проверить коллизию в точке */\n  public checkCollision(pos: Vec3): boolean {\n    const r = this.playerRadius;\n\n    // Стены убраны - теперь за границей арены река войда!\n    // Игрок может свободно падать туда\n    const distFromCenter = Math.sqrt(pos.x * pos.x + pos.z * pos.z);\n    // Нет стен - проверка убрана!\n\n    // Центральная колонна (фонтан) - блокирует только внизу, не на верхней платформе\n    // Фонтан высотой ~8м, верхняя платформа на 9.5м\n    if (distFromCenter < 1.2 + r && pos.y < 10.0) return true;\n\n    // === БОРТИК БАССЕЙНА ФОНТАНА ===\n    // Внутренний край бортика (нельзя войти в воду)\n    const poolRadius = 8.0;\n    if (distFromCenter > poolRadius - 0.5 && distFromCenter < poolRadius + 0.5) {\n      if (pos.y < 0.8) return true; // Бортик высотой ~0.5м\n    }\n\n    // === КОЛОННЫ ПОРТАЛОВ (ТОРИИ) ===\n    // Левый портал - две колонны\n    const leftPortalX = -22.0;\n    const leftCol1 = { x: leftPortalX, z: -2.0 };\n    const leftCol2 = { x: leftPortalX, z: 2.0 };\n    \n    // Правый портал - две колонны\n    const rightPortalX = 22.0;\n    const rightCol1 = { x: rightPortalX, z: -2.0 };\n    const rightCol2 = { x: rightPortalX, z: 2.0 };\n    \n    const portalColumns = [leftCol1, leftCol2, rightCol1, rightCol2];\n    \n    for (const col of portalColumns) {\n      const dx = pos.x - col.x;\n      const dz = pos.z - col.z;\n      // Колонны квадратные ~0.5x0.5, высота до 5м\n      if (Math.abs(dx) < 0.6 + r && Math.abs(dz) < 0.6 + r && pos.y < 5.5) {\n        return true;\n      }\n    }\n\n    // === ПЛАТФОРМЫ ЗА ПОРТАЛАМИ ===\n    // Левая платформа за порталом\n    const leftPlatDist = Math.sqrt(\n      Math.pow(pos.x - (-this.backPlatformX), 2) + \n      Math.pow(pos.z, 2)\n    );\n    // Бортик левой платформы\n    if (leftPlatDist > this.backPlatformRadius - 0.5 && \n        leftPlatDist < this.backPlatformRadius + 0.5 &&\n        pos.y < 1.0) {\n      return true;\n    }\n    // Столбики на левой платформе (8 штук)\n    for (let i = 0; i < 8; i++) {\n      const angle = i * Math.PI / 4; // 45 градусов\n      const pillarX = -this.backPlatformX + Math.cos(angle) * (this.backPlatformRadius - 0.2);\n      const pillarZ = Math.sin(angle) * (this.backPlatformRadius - 0.2);\n      const dx = pos.x - pillarX;\n      const dz = pos.z - pillarZ;\n      if (Math.abs(dx) < 0.3 + r && Math.abs(dz) < 0.3 + r && pos.y < 1.5) {\n        return true;\n      }\n    }\n\n    // Правая платформа за порталом\n    const rightPlatDist = Math.sqrt(\n      Math.pow(pos.x - this.backPlatformX, 2) + \n      Math.pow(pos.z, 2)\n    );\n    // Бортик правой платформы\n    if (rightPlatDist > this.backPlatformRadius - 0.5 && \n        rightPlatDist < this.backPlatformRadius + 0.5 &&\n        pos.y < 1.0) {\n      return true;\n    }\n    // Столбики на правой платформе\n    for (let i = 0; i < 8; i++) {\n      const angle = i * Math.PI / 4;\n      const pillarX = this.backPlatformX + Math.cos(angle) * (this.backPlatformRadius - 0.2);\n      const pillarZ = Math.sin(angle) * (this.backPlatformRadius - 0.2);\n      const dx = pos.x - pillarX;\n      const dz = pos.z - pillarZ;\n      if (Math.abs(dx) < 0.3 + r && Math.abs(dz) < 0.3 + r && pos.y < 1.5) {\n        return true;\n      }\n    }\n\n    // Коллизия с круглыми платформами (сбоку) - только на уровне платформы\n    const allPlatforms = [...this.jumpPlatforms, this.topPlatform];\n    for (const plat of allPlatforms) {\n      const dx = pos.x - plat.x;\n      const dz = pos.z - plat.z;\n      const dist = Math.sqrt(dx * dx + dz * dz);\n      const feetY = pos.y - 1.7;\n      \n      // Блокируем только если ноги близко к уровню платформы (в пределах 1м ниже)\n      // Это позволяет ходить под платформами на земле\n      if (dist < plat.radius + r && feetY < plat.height - 0.1 && feetY > plat.height - 1.5) {\n        return true;\n      }\n    }\n\n    // Края платформ (перила)\n    // Левая платформа\n    if (pos.x < -this.platformX + 3.5 && pos.x > -this.platformX - 3.5 &&\n        Math.abs(pos.z) < 6.5 && pos.y > this.platformHeight - 0.5) {\n      // Перила на краю\n      if (pos.x > -this.platformX + 2.8 && Math.abs(pos.z) < 6.0) {\n        return true;\n      }\n    }\n    \n    // Правая платформа\n    if (pos.x > this.platformX - 3.5 && pos.x < this.platformX + 3.5 &&\n        Math.abs(pos.z) < 6.5 && pos.y > this.platformHeight - 0.5) {\n      if (pos.x < this.platformX - 2.8 && Math.abs(pos.z) < 6.0) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  /** Проверить, находится ли точка над круглой платформой */\n  private isOverCirclePlatform(pos: Vec3, plat: { x: number; z: number; height: number; radius: number }): boolean {\n    const dx = pos.x - plat.x;\n    const dz = pos.z - plat.z;\n    const dist = Math.sqrt(dx * dx + dz * dz);\n    // Игрок должен быть СТРОГО выше платформы (минимум на уровне верха) и в радиусе\n    // pos.y - это позиция глаз, eyeHeight = 1.7, значит ноги на pos.y - 1.7\n    // Ноги должны быть выше или на уровне платформы\n    const feetY = pos.y - 1.7;\n    return dist < plat.radius && feetY >= plat.height - 0.1;\n  }\n\n  /** Получить высоту пола в точке */\n  public getFloorHeight(pos: Vec3): number {\n    const distFromCenter = Math.sqrt(pos.x * pos.x + pos.z * pos.z);\n    \n    // === КРАЙ АРЕНЫ ===\n    const arenaRadius = 33.0; // ARENA_RADIUS - 5.0\n    \n    if (distFromCenter > arenaRadius) {\n      return -50.0; // Бездонная пропасть\n    }\n\n    // === МОСТЫ (приоритет - они над бассейном) ===\n    const onBridgeX = Math.abs(pos.z) < this.bridgeWidth / 2 && \n                      Math.abs(pos.x) < this.poolRadius + 1;\n    const onBridgeZ = Math.abs(pos.x) < this.bridgeWidth / 2 && \n                      Math.abs(pos.z) < this.poolRadius + 1;\n    \n    if ((onBridgeX || onBridgeZ) && distFromCenter > 2.0) {\n      return 0.3; // Высота моста\n    }\n\n    // === ЛЕВАЯ ПЛАТФОРМА И ЛЕСТНИЦА ===\n    const leftStairStartX = -16.0;\n    const leftStairEndX = -17.0;\n    const leftPlatformEnd = -23.0;\n    \n    if (Math.abs(pos.z) < 3.0) {\n      if (pos.x >= leftStairEndX && pos.x <= leftStairStartX) {\n        const progress = (leftStairStartX - pos.x) / (leftStairStartX - leftStairEndX);\n        return progress * this.platformHeight;\n      }\n      if (pos.x < leftStairEndX && pos.x > leftPlatformEnd) {\n        return this.platformHeight;\n      }\n    }\n\n    // === ПРАВАЯ ПЛАТФОРМА И ЛЕСТНИЦА ===\n    const rightStairStartX = 16.0;\n    const rightStairEndX = 17.0;\n    const rightPlatformEnd = 23.0;\n    \n    if (Math.abs(pos.z) < 3.0) {\n      if (pos.x >= rightStairStartX && pos.x <= rightStairEndX) {\n        const progress = (pos.x - rightStairStartX) / (rightStairEndX - rightStairStartX);\n        return progress * this.platformHeight;\n      }\n      if (pos.x > rightStairEndX && pos.x < rightPlatformEnd) {\n        return this.platformHeight;\n      }\n    }\n\n    // === КРУГЛЫЕ ПЛАТФОРМЫ ДЛЯ ПАРКУРА (спираль) ===\n    // Верхняя платформа с бафом\n    if (this.isOverCirclePlatform(pos, this.topPlatform)) {\n      return this.topPlatform.height;\n    }\n    \n    // 6 платформ по кругу (проверяем сверху вниз)\n    for (let i = this.jumpPlatforms.length - 1; i >= 0; i--) {\n      if (this.isOverCirclePlatform(pos, this.jumpPlatforms[i])) {\n        return this.jumpPlatforms[i].height;\n      }\n    }\n\n    // === СТУПЕНИ ПОРТАЛОВ ===\n    // Левый портал (x = -22)\n    if (pos.x < -18.5 && pos.x > -25.5 && Math.abs(pos.z) < 3.5) {\n      return 0.5; // Верхняя ступень портала\n    }\n    // Правый портал (x = 22)\n    if (pos.x > 18.5 && pos.x < 25.5 && Math.abs(pos.z) < 3.5) {\n      return 0.5;\n    }\n\n    // === ПЛАТФОРМЫ ЗА ПОРТАЛАМИ ===\n    // Левая платформа\n    const leftPlatDist = Math.sqrt(\n      Math.pow(pos.x - (-this.backPlatformX), 2) + \n      Math.pow(pos.z, 2)\n    );\n    if (leftPlatDist < this.backPlatformRadius) {\n      return 0.5; // Высота платформы\n    }\n    \n    // Правая платформа\n    const rightPlatDist = Math.sqrt(\n      Math.pow(pos.x - this.backPlatformX, 2) + \n      Math.pow(pos.z, 2)\n    );\n    if (rightPlatDist < this.backPlatformRadius) {\n      return 0.5;\n    }\n\n    // === МОСТЫ К ПЛАТФОРМАМ ЗА ПОРТАЛАМИ ===\n    // Левый мост\n    if (pos.x < -21.5 && pos.x > -this.backPlatformX + this.backPlatformRadius && Math.abs(pos.z) < 2.5) {\n      return 0.3;\n    }\n    // Правый мост\n    if (pos.x > 21.5 && pos.x < this.backPlatformX - this.backPlatformRadius && Math.abs(pos.z) < 2.5) {\n      return 0.3;\n    }\n\n    // Основной пол\n    return 0.0;\n  }\n\n  /** Получить высоту потолка */\n  public getCeilingHeight(pos: Vec3): number {\n    // Проверяем все платформы - потолок только если близко снизу\n    const allPlatforms = [...this.jumpPlatforms, this.topPlatform];\n    \n    for (const plat of allPlatforms) {\n      const dx = pos.x - plat.x;\n      const dz = pos.z - plat.z;\n      const dist = Math.sqrt(dx * dx + dz * dz);\n      \n      // Потолок только если игрок прямо под платформой и близко к ней (в пределах 3м)\n      if (dist < plat.radius - 0.3 && pos.y < plat.height - 0.5 && pos.y > plat.height - 4.0) {\n        return plat.height - 0.3;\n      }\n    }\n    \n    return 18.0;\n  }\n\n  /** Проверить коллизию для врага (упрощённая версия без перил) */\n  public checkEnemyCollision(pos: Vec3, radius: number): boolean {\n    // Стены убраны, но враги не выходят за границу\n    const distFromCenter = Math.sqrt(pos.x * pos.x + pos.z * pos.z);\n    const ARENA_EDGE = 33.0; // Граница до реки войда\n    if (distFromCenter > ARENA_EDGE - radius) return true;\n\n    // Центральная колонна (фонтан)\n    if (distFromCenter < 1.2 + radius) return true;\n\n    // Бортик бассейна\n    const poolRadius = 8.0;\n    if (distFromCenter > poolRadius - 0.5 - radius && \n        distFromCenter < poolRadius + 0.5 + radius &&\n        pos.y < 0.8) {\n      return true;\n    }\n\n    // Колонны порталов (тории)\n    const portalColumns = [\n      { x: -22.0, z: -2.0 }, { x: -22.0, z: 2.0 },\n      { x: 22.0, z: -2.0 }, { x: 22.0, z: 2.0 },\n    ];\n    \n    for (const col of portalColumns) {\n      const dx = pos.x - col.x;\n      const dz = pos.z - col.z;\n      if (Math.abs(dx) < 0.6 + radius && Math.abs(dz) < 0.6 + radius && pos.y < 5.5) {\n        return true;\n      }\n    }\n\n    // Столбики на платформах за порталами\n    for (let side = -1; side <= 1; side += 2) {\n      const platX = side * this.backPlatformX;\n      for (let i = 0; i < 8; i++) {\n        const angle = i * Math.PI / 4;\n        const pillarX = platX + Math.cos(angle) * (this.backPlatformRadius - 0.2);\n        const pillarZ = Math.sin(angle) * (this.backPlatformRadius - 0.2);\n        const dx = pos.x - pillarX;\n        const dz = pos.z - pillarZ;\n        if (Math.abs(dx) < 0.3 + radius && Math.abs(dz) < 0.3 + radius && pos.y < 1.5) {\n          return true;\n        }\n      }\n    }\n\n    // Колонны по периметру (фонари)\n    const columnPositions = [\n      { x: 0, z: 28 },\n      { x: 0, z: -28 },\n      { x: 28, z: 0 },\n      { x: -28, z: 0 },\n    ];\n    \n    for (const col of columnPositions) {\n      const dx = pos.x - col.x;\n      const dz = pos.z - col.z;\n      if (Math.sqrt(dx * dx + dz * dz) < 0.7 + radius) return true;\n    }\n\n    // Все платформы - блокируем только если враг рядом по высоте\n    const allPlatforms = [...this.jumpPlatforms, this.topPlatform];\n    for (const plat of allPlatforms) {\n      const dx = pos.x - plat.x;\n      const dz = pos.z - plat.z;\n      const dist = Math.sqrt(dx * dx + dz * dz);\n      \n      // Блокируем только если враг в пределах 1.5м от уровня платформы\n      // (как для игрока в checkCollision)\n      if (dist < plat.radius + radius && pos.y < plat.height + 1.5 && pos.y > plat.height - 1.5) {\n        return true;\n      }\n    }\n\n    return false;\n  }\n\n  /** Получить высоту препятствия перед врагом (для прыжков) */\n  public getObstacleHeight(pos: Vec3, dirX: number, dirZ: number, checkDist: number = 1.5): number {\n    const checkX = pos.x + dirX * checkDist;\n    const checkZ = pos.z + dirZ * checkDist;\n    \n    const allPlatforms = [...this.jumpPlatforms, this.topPlatform];\n    for (const plat of allPlatforms) {\n      const dx = checkX - plat.x;\n      const dz = checkZ - plat.z;\n      const dist = Math.sqrt(dx * dx + dz * dz);\n      \n      if (dist < plat.radius && pos.y < plat.height) {\n        return plat.height;\n      }\n    }\n    \n    return 0;\n  }\n}\n","import type { GameState, GameConfig, Vec3 } from '@/types';\nimport { GameLoop } from './GameLoop';\nimport { Input } from './Input';\nimport { Player } from '@/player/Player';\nimport { Weapon } from '@/weapon/Weapon';\nimport { WeaponRenderer } from '@/weapon/WeaponRenderer';\nimport { TargetManager, Target, PORTAL_POSITIONS } from '@/enemies/Target';\nimport { PickupManager } from '@/items/Pickup';\nimport { AudioManager } from '@/audio/AudioManager';\nimport { WebGLRenderer } from '@/render/WebGLRenderer';\nimport { HUD } from '@/render/HUD';\nimport { CollisionSystem } from '@/world/Collision';\nimport { vec3 } from '@/utils/math';\n\n/** Конфигурация по умолчанию */\nconst DEFAULT_CONFIG: GameConfig = {\n  width: 1280,\n  height: 720,\n  renderScale: 0.4,\n  movement: {\n    walkSpeed: 9.0,\n    runSpeed: 16.0,\n    jumpForce: 12.0,\n    gravity: 25.0,\n    groundFriction: 12.0,\n    airControl: 0.85,\n    mouseSensitivity: 0.002,\n  },\n  weapon: {\n    name: 'Katana',\n    damage: 100,\n    fireRate: 2.5,\n    magazineSize: 999,\n    reloadTime: 0,\n    spread: 0,\n    automatic: false,\n  },\n};\n\n/**\n * Samurai Pool Arena\n * Руби врагов катаной пока они не долетели до тебя!\n */\nexport class Game {\n  // === СОСТОЯНИЕ ===\n  public state: GameState = {\n    isRunning: false,\n    isPaused: false,\n    frags: 0,\n    gameTime: 0,\n    soundEnabled: true,\n  };\n\n  // === КОНФИГУРАЦИЯ ===\n  public config: GameConfig;\n\n  // === СИСТЕМЫ ===\n  private gameLoop: GameLoop;\n  private input: Input;\n  private player: Player;\n  private weapon: Weapon;\n  private weaponRenderer: WeaponRenderer;\n  private targetManager: TargetManager;\n  private pickupManager: PickupManager;\n  private audio: AudioManager;\n  private renderer: WebGLRenderer;\n  private hud: HUD;\n  private collision: CollisionSystem;\n\n  // === CANVAS ===\n  private weaponCanvas: HTMLCanvasElement;\n\n  // === UI ===\n  private startScreen: HTMLElement | null;\n\n  // === ВРЕМЯ ===\n  private gameTime = 0;\n\n  // === СОСТОЯНИЕ ===\n  private isPaused = false;\n  \n  // === СИСТЕМА ОЧКОВ ===\n  /** Очки, которые игрок несёт (ещё не вброшены) */\n  private carryingScore = 0;\n  \n  /** Алтари на краях карты */\n  private altars = [\n    { position: { x: 0, y: 0, z: 30 }, score: 0 },   // Северный алтарь\n    { position: { x: 0, y: 0, z: -30 }, score: 0 },  // Южный алтарь\n  ];\n  \n  /** Очки за разных врагов */\n  private readonly SCORE_VALUES: Record<string, number> = {\n    baneling: 10,\n    phantom: 15,\n    runner: 20,\n    hopper: 25,\n    spiker: 30,\n    boss_green: 100,\n    boss_black: 150,\n    boss_blue: 200,\n  };\n  \n  // === СИСТЕМА ДРОТИКОВ ===\n  /** Количество дротиков */\n  private darts = 50;\n  \n  /** Кулдаун стрельбы дротиками */\n  private dartCooldown = 0;\n  private readonly DART_FIRE_RATE = 0.08; // 12.5 выстрелов в секунду!\n  private readonly DART_DAMAGE = 15;\n  private readonly DARTS_PER_POINT = 2; // 2 дротика за 1 очко\n  \n  /** Летящие дротики */\n  private flyingDarts: Array<{\n    position: Vec3;\n    velocity: Vec3;\n    active: boolean;\n  }> = [];\n  \n  // === ПОРТАЛ В ВОЙД ===\n  /** Таймер появления портала */\n  private voidPortalTimer = 10;\n  /** Активен ли портал */\n  private voidPortalActive = false;\n  /** Время жизни портала */\n  private voidPortalLifetime = 0;\n  private readonly VOID_PORTAL_DURATION = 10; // Портал открыт 10 секунд\n  private readonly VOID_PORTAL_COOLDOWN = 10; // Появляется каждые 10 секунд\n  \n  // === МОНЕТЫ КРОВИ (валюта войда) ===\n  /** Собранные монеты крови */\n  private bloodCoins = 0;\n  /** Монеты в войде */\n  private voidCoins: Array<{\n    position: Vec3;\n    active: boolean;\n    phase: number;\n  }> = [];\n  \n  // === ГРАНАТЫ (покупаются за монеты крови) ===\n  /** Количество гранат у игрока */\n  private grenadeCount = 5;\n  /** Летящие гранаты */\n  private grenades: Array<{\n    position: Vec3;\n    velocity: Vec3;\n    active: boolean;\n    lifetime: number;\n  }> = [];\n  /** Активные взрывы */\n  private explosions: Array<{\n    position: Vec3;\n    progress: number; // 0-1\n    active: boolean;\n  }> = [];\n  \n  // === ЭФФЕКТЫ СМЕРТИ ВРАГОВ ===\n  /** Активные эффекты смерти (до 8) */\n  private deathEffects: Array<{\n    position: Vec3;\n    progress: number; // 0-1, затем удаляется\n    active: boolean;\n  }> = [];\n  private readonly DEATH_EFFECT_DURATION = 0.5; // 0.5 сек\n  \n  private readonly GRENADE_SPEED = 25;\n  private readonly GRENADE_GRAVITY = 15;\n  private readonly GRENADE_FUSE = 1.5; // 1.5 сек до взрыва\n  private readonly EXPLOSION_RADIUS = 8;\n  private readonly EXPLOSION_DAMAGE = 50;\n  private readonly EXPLOSION_DURATION = 0.5;\n  private readonly GRENADE_COST = 3; // 3 монеты крови за гранату\n  \n  // === ВАРИАНТ ВОЙДА (разные каждый раз) ===\n  private voidVariant = 0; // 0-3 разные цвета/стили\n  \n  private footstepTimer = 0;\n  private wasGrounded = true;\n  private screenShake = 0;\n  private lastSliceTime = 0;\n  private wasJumpPressed = false;\n  \n  /** Флаг: уже проверили попадание в текущем взмахе? */\n  private attackHitChecked = false;\n  private splashHitChecked = false;\n  \n  /** Текущая эпоха (1-3) для атмосферы */\n  private currentEra = 1;\n\n  /** Система комбо-убийств для адреналина */\n  private killTimes: number[] = [];\n  private readonly COMBO_WINDOW = 9.0; // 9 секунд\n  private readonly COMBO_KILLS_NEEDED = 3; // 3 убийства для адреналина\n\n  /** === VOID MODE - ECLIPSE (БЕРСЕРК) === */\n  private isInVoid = false;\n  private voidSpawnTimer = 0; // Таймер до следующего спавна фантома\n  private savedPosition: Vec3 = vec3(0, 0, 0);\n  private savedYaw = 0;\n  private voidEnemyIds: number[] = []; // ID врагов в войде\n  private voidFallOffset = 0; // Смещение для эффекта падения\n  private savedEnemyIds: number[] = []; // ID врагов которые были активны до войда\n  private savedWaveActive = false; // Была ли волна активна до войда\n  private voidPhantomCooldown: Map<number, number> = new Map(); // Кулдаун урона от фантомов\n  private portalPos: Vec3 = vec3(0, 0, 0); // Позиция портала выхода\n  private readonly PORTAL_DISTANCE = 60; // Расстояние до портала\n  private readonly PORTAL_RADIUS = 4; // Радиус для достижения портала\n  private readonly VOID_SPAWN_INTERVAL = 3.0; // Интервал спавна фантомов\n\n  constructor(\n    canvas: HTMLCanvasElement,\n    weaponCanvas: HTMLCanvasElement,\n    config: Partial<GameConfig> = {}\n  ) {\n    this.weaponCanvas = weaponCanvas;\n    this.config = { ...DEFAULT_CONFIG, ...config };\n\n    // Инициализируем системы\n    this.collision = new CollisionSystem();\n    this.input = new Input(canvas);\n    this.audio = new AudioManager();\n    this.hud = new HUD();\n\n    // Игрок на мосту (безопасная позиция)\n    this.player = new Player(\n      vec3(0, 1.7, 12),\n      this.config.movement,\n      this.collision\n    );\n\n    // Катана\n    this.weapon = new Weapon();\n    this.weapon.onSlice = () => this.onKatanaSlice();\n\n    // Рендереры\n    this.renderer = new WebGLRenderer(canvas);\n    this.renderer.renderScale = this.config.renderScale;\n    this.weaponRenderer = new WeaponRenderer(weaponCanvas);\n\n    // Враги (передаём систему коллизий для обхода препятствий)\n    this.targetManager = new TargetManager(this.collision);\n    this.setupTargetCallbacks();\n\n    // Предметы\n    this.pickupManager = new PickupManager();\n\n    // Игровой цикл\n    this.gameLoop = new GameLoop(\n      (dt) => this.update(dt),\n      () => this.render()\n    );\n\n    // UI\n    this.startScreen = document.getElementById('click-to-start');\n\n    // Обработчики\n    this.setupEventHandlers();\n  }\n\n  /** Настройка callbacks для врагов */\n  private setupTargetCallbacks(): void {\n    this.targetManager.onTargetDestroyed = (target) => {\n      this.state.frags++;\n      this.audio.playSFX('kill');\n      this.hud.showHitmarker(true);\n      \n      // Создаём эффект смерти\n      this.spawnDeathEffect(target.position);\n      \n      // === НАЧИСЛЕНИЕ ОЧКОВ ===\n      const scoreValue = this.SCORE_VALUES[target.enemyType] || 10;\n      this.carryingScore += scoreValue;\n      this.hud.showMessage(`+${scoreValue}`, 'purple');\n      \n      // Шанс выпадения предмета (не в войде)\n      if (!this.isInVoid) {\n        this.pickupManager.spawnAfterKill(target.position);\n      }\n      \n      // === СИСТЕМА КОМБО ДЛЯ АДРЕНАЛИНА ===\n      // Добавляем время убийства\n      this.killTimes.push(this.gameTime);\n      \n      // Удаляем старые убийства (старше 9 секунд)\n      this.killTimes = this.killTimes.filter(t => this.gameTime - t < this.COMBO_WINDOW);\n      \n      // Проверяем комбо (3 убийства за 9 секунд)\n      if (this.killTimes.length >= this.COMBO_KILLS_NEEDED && !this.player.rageMode) {\n        this.activateComboAdrenaline();\n      }\n      \n      // Показываем прогресс комбо\n      if (this.killTimes.length > 0 && this.killTimes.length < this.COMBO_KILLS_NEEDED) {\n        this.hud.showMessage(`🔥 КОМБО ${this.killTimes.length}/${this.COMBO_KILLS_NEEDED}`, 'orange');\n      }\n      \n      // Сообщение при убийстве босса\n      if (target.isBoss) {\n        this.hud.showMessage('💀 БОСС ПОВЕРЖЕН! 💀', 'gold');\n        // Босс роняет много аптечек\n        for (let i = 0; i < 3; i++) {\n          this.pickupManager.spawnAfterKill(target.position);\n        }\n        // Респавн заряда катаны после босса\n        this.pickupManager.respawnChargeAfterBoss();\n        \n        // После первого босса (волна 5) - разблокируем тройной прыжок!\n        if (this.targetManager.wave === 5 && this.player.maxAirJumps < 2) {\n          this.player.unlockTripleJump();\n          this.hud.showMessage('🦘 ТРОЙНОЙ ПРЫЖОК РАЗБЛОКИРОВАН! 🦘', 'cyan');\n        }\n      }\n    };\n\n    this.targetManager.onPlayerHit = (target) => {\n      // Урон игроку (зависит от типа врага)\n      this.player.takeDamage(target.damage);\n      \n      // Вскрик героя\n      this.audio.playSFX('player_hurt');\n      \n      // Отталкивание от врага\n      const playerPos = this.player.state.position;\n      const knockbackDir = {\n        x: playerPos.x - target.position.x,\n        y: 0,\n        z: playerPos.z - target.position.z\n      };\n      const knockDist = Math.sqrt(knockbackDir.x ** 2 + knockbackDir.z ** 2);\n      if (knockDist > 0.1) {\n        const knockForce = target.isBoss ? 12 : 6; // Боссы отталкивают сильнее\n        this.player.state.velocity.x += (knockbackDir.x / knockDist) * knockForce;\n        this.player.state.velocity.z += (knockbackDir.z / knockDist) * knockForce;\n      }\n      \n      // Разные эффекты для разных врагов\n      switch (target.enemyType) {\n        case 'phantom':\n          this.audio.playSFX('phantom_pass');\n          this.screenShake = 0.3;\n          this.hud.showDamage('purple');\n          this.slowdownFactor = 0.3;\n          this.slowdownTimer = 2.0;\n          break;\n        case 'runner':\n          this.audio.playSFX('runner_hit');\n          this.screenShake = 0.4;\n          this.hud.showDamage('green');\n          break;\n        case 'hopper':\n          this.audio.playSFX('hopper_hit');\n          this.screenShake = 0.6;\n          this.hud.showDamage('green');\n          break;\n        case 'boss_green':\n          this.audio.playSFX('kill');\n          this.screenShake = 1.0; // Очень сильная тряска\n          this.hud.showDamage('green');\n          this.hud.showMessage('💀 ТОКСИЧНЫЙ УДАР!', 'lime');\n          break;\n        case 'boss_black':\n          // Владыка пустоты засасывает в ВОЙД!\n          if (!this.isInVoid) {\n            this.enterVoidMode();\n            return; // Не наносим урон - вместо этого входим в войд\n          }\n          break;\n        case 'boss_blue':\n          this.audio.playSFX('hopper_hit');\n          this.screenShake = 0.7;\n          this.hud.showDamage('purple');\n          this.hud.showMessage('⚡ ТЕЛЕПОРТ УДАР!', 'cyan');\n          break;\n        default:\n          this.audio.playSFX('hit');\n          this.screenShake = 0.5;\n          this.hud.showDamage('green');\n      }\n    };\n\n    this.targetManager.onWaveStart = (wave) => {\n      this.hud.showWave(wave);\n      \n      // Обновляем эпоху для музыки и атмосферы\n      this.audio.setEra(wave);\n      this.currentEra = wave > 10 ? 3 : wave > 5 ? 2 : 1;\n      \n      // Эпичные заставки боссов!\n      if (wave === 5) {\n        this.isPaused = true; // Пауза на время заставки\n        this.audio.playBossWarning();\n        this.hud.showBossIntro('boss_green', () => {\n          this.isPaused = false;\n          this.audio.setBossMusic('boss_green');\n        });\n      } else if (wave === 10) {\n        this.isPaused = true;\n        this.audio.playBossWarning();\n        this.hud.showBossIntro('boss_black', () => {\n          this.isPaused = false;\n          this.audio.setBossMusic('boss_black');\n        });\n      } else if (wave === 15) {\n        this.isPaused = true;\n        this.audio.playBossWarning();\n        this.hud.showBossIntro('boss_blue', () => {\n          this.isPaused = false;\n          this.audio.setBossMusic('boss_blue');\n        });\n      }\n      \n      // Сообщения о смене эпохи\n      if (wave === 6) {\n        setTimeout(() => this.hud.showMessage('🌀 ЗОНА ЧЁРНОЙ ДЫРЫ 🌀', 'purple'), 1000);\n      } else if (wave === 11) {\n        setTimeout(() => this.hud.showMessage('🚀 КОСМИЧЕСКАЯ ЗОНА 🚀', 'cyan'), 1000);\n      }\n    };\n\n    this.targetManager.onWaveComplete = (wave) => {\n      this.hud.showWaveComplete(wave);\n      \n      // Возврат к обычной музыке после босса\n      if (wave === 5 || wave === 10 || wave === 15) {\n        this.audio.setBossMusic(null);\n        // Обновляем эпоху после босса\n        this.audio.setEra(wave + 1);\n      }\n    };\n\n    // Урон от токсичных луж\n    this.targetManager.onPoolDamage = (damage) => {\n      this.player.takeDamage(damage);\n      this.hud.showDamage('green');\n      this.screenShake = 0.2;\n    };\n\n    // Смена фазы босса\n    this.targetManager.onBossPhaseChange = (bossType, phase) => {\n      if (bossType === 'boss_green' && phase === 2) {\n        // Зелёный босс перешёл во вторую фазу!\n        this.audio.setBossGreenPhase2();\n        this.hud.showMessage('☣️ ФАЗА 2: ЯРОСТЬ! ☣️', 'lime');\n        this.screenShake = 1.5; // Сильная тряска\n      }\n    };\n\n    // Вихрь чёрного босса (без звука вибро)\n    this.targetManager.onBossVortexWarning = () => {\n      this.hud.showMessage('⚠️ ВИХРЬ ПРИБЛИЖАЕТСЯ! ⚠️', 'yellow');\n    };\n\n    this.targetManager.onBossVortexStart = () => {\n      this.hud.showMessage('🌀 ВИХРЬ! БЕГИ! 🌀', 'purple');\n      this.screenShake = 1.0;\n    };\n\n    this.targetManager.onBossVortexEnd = () => {\n      // Вихрь закончился\n    };\n\n    // Звук плевка кислотой\n    this.targetManager.onAcidSpit = () => {\n      this.audio.playSFX('acid_spit');\n    };\n\n    // Кислотный дождь приземлился\n    this.targetManager.onAcidRain = (_pos) => {\n      this.audio.playAcidSplash();\n      this.screenShake = 0.3;\n    };\n\n    // Звук установки метки для кислотного дождя\n    this.targetManager.onAcidRainMarkSound = () => {\n      this.audio.playAcidRainMark();\n      this.hud.showMessage('☢️ КИСЛОТНЫЙ ДОЖДЬ! УКРОЙСЯ! ☢️', 'lime');\n    };\n\n    // Кислотный дождь начался\n    this.targetManager.onAcidRainStart = (_pos) => {\n      this.audio.playAcidRainStart();\n      this.screenShake = 0.5;\n    };\n    \n    // === СПАВН ВРАГОВ ЧЕРЕЗ ПОРТАЛЫ ===\n    this.targetManager.onEnemySpawn = (type, _portalSide) => {\n      // Воспроизводим уникальный звук для каждого типа врага\n      switch (type) {\n        case 'baneling':\n          this.audio.playBanelingSpawn();\n          break;\n        case 'phantom':\n          this.audio.playPhantomSpawn();\n          break;\n        case 'runner':\n          this.audio.playRunnerSpawn();\n          break;\n        case 'hopper':\n          this.audio.playHopperSpawn();\n          break;\n        case 'spiker':\n          this.audio.playSFX('spiker_scream'); // Вскрик при появлении\n          break;\n        case 'boss_green':\n        case 'boss_black':\n        case 'boss_blue':\n          this.audio.playBossSpawn();\n          break;\n      }\n    };\n    \n    // === АТАКА ИГОЛКАМИ СПАЙКЕРОВ ===\n    this.targetManager.onSpikerScream = () => {\n      this.audio.playSFX('spiker_scream');\n    };\n    \n    this.targetManager.onSpikerAttack = () => {\n      this.audio.playSFX('spiker_shoot');\n    };\n    \n    // Попадание иголки в игрока\n    this.targetManager.onSpikeHit = () => {\n      this.player.takeDamage(10); // 10 урона от иголки\n      this.audio.playSFX('player_hurt');\n      this.hud.showDamage(); // Красный эффект по умолчанию\n      this.screenShake = 0.3;\n      this.hud.updateHealth(this.player.state.health, this.player.state.maxHealth);\n      \n      if (this.player.isDead()) {\n        this.gameOver();\n      }\n    };\n  }\n\n  /** Замедление от фантомов */\n  private slowdownFactor = 1.0;\n  private slowdownTimer = 0;\n\n  /** Настройка обработчиков событий */\n  private setupEventHandlers(): void {\n    // Обработчики слайдеров\n    const volumeSlider = document.getElementById('volume-slider') as HTMLInputElement;\n    const volumeValue = document.getElementById('volume-value');\n    const sensSlider = document.getElementById('sens-slider') as HTMLInputElement;\n    const sensValue = document.getElementById('sens-value');\n\n    volumeSlider?.addEventListener('input', (e) => {\n      e.stopPropagation(); // Не запускаем игру при клике на слайдер\n      const value = parseInt(volumeSlider.value);\n      if (volumeValue) volumeValue.textContent = `${value}%`;\n      this.audio.setVolume(value / 100);\n    });\n\n    sensSlider?.addEventListener('input', (e) => {\n      e.stopPropagation();\n      const value = parseInt(sensSlider.value);\n      if (sensValue) sensValue.textContent = `${value}%`;\n      // Чувствительность от 0.001 до 0.01\n      this.input.setSensitivity(0.001 + (value / 100) * 0.009);\n    });\n\n    // Предотвращаем запуск игры при клике на слайдеры и кнопки\n    document.getElementById('settings')?.addEventListener('click', (e) => {\n      e.stopPropagation();\n    });\n    document.getElementById('start-buttons')?.addEventListener('click', (e) => {\n      e.stopPropagation();\n    });\n\n    // Кнопка НАЧАТЬ\n    document.getElementById('btn-start')?.addEventListener('click', () => this.start());\n    \n    // Кнопки боссов\n    document.getElementById('btn-boss5')?.addEventListener('click', () => this.startFromWave(5));\n    document.getElementById('btn-boss10')?.addEventListener('click', () => this.startFromWave(10));\n    document.getElementById('btn-boss15')?.addEventListener('click', () => this.startFromWave(15));\n\n    // Кнопки модалок\n    document.getElementById('btn-settings')?.addEventListener('click', (e) => {\n      e.stopPropagation();\n      document.getElementById('modal-settings')?.classList.add('active');\n    });\n    document.getElementById('btn-help')?.addEventListener('click', (e) => {\n      e.stopPropagation();\n      document.getElementById('modal-help')?.classList.add('active');\n    });\n    \n    // Закрытие модалок\n    document.querySelectorAll('.modal-close').forEach(btn => {\n      btn.addEventListener('click', (e) => {\n        e.stopPropagation();\n        const modalId = (btn as HTMLElement).dataset.modal;\n        if (modalId) {\n          document.getElementById(modalId)?.classList.remove('active');\n        }\n      });\n    });\n    \n    // Закрытие модалки при клике на фон\n    document.querySelectorAll('.modal').forEach(modal => {\n      modal.addEventListener('click', (e) => {\n        if (e.target === modal) {\n          modal.classList.remove('active');\n        }\n      });\n    });\n    \n    // Предотвращаем закрытие при клике на контент модалки\n    document.querySelectorAll('.modal-content').forEach(content => {\n      content.addEventListener('click', (e) => e.stopPropagation());\n    });\n\n    document.addEventListener('keydown', (e) => {\n      if (e.code === 'KeyM') {\n        this.audio.toggleMute();\n      }\n      if (e.code === 'KeyF') {\n        this.toggleFullscreen();\n      }\n    });\n\n    window.addEventListener('resize', () => this.handleResize());\n  }\n\n  /** Запуск игры */\n  public start(): void {\n    this.startFromWave(1);\n  }\n\n  /** Запуск с определённой волны (для боссов) */\n  public startFromWave(wave: number): void {\n    if (this.state.isRunning) return;\n\n    // Читаем настройки\n    const volumeSlider = document.getElementById('volume-slider') as HTMLInputElement;\n    const sensSlider = document.getElementById('sens-slider') as HTMLInputElement;\n    \n    if (volumeSlider) {\n      this.audio.setVolume(parseInt(volumeSlider.value) / 100);\n    }\n    if (sensSlider) {\n      this.input.setSensitivity(0.001 + (parseInt(sensSlider.value) / 100) * 0.009);\n    }\n\n    if (this.startScreen) {\n      this.startScreen.style.display = 'none';\n    }\n\n    // Показываем HUD при старте игры\n    this.hud.showHUD();\n\n    this.input.requestPointerLock();\n    this.audio.start();\n    this.gameLoop.start();\n    this.state.isRunning = true;\n\n    // Начинаем с указанной волны\n    this.targetManager.startGame(wave);\n    \n    // Сообщение о боссе\n    if (wave === 5) {\n      this.hud.showMessage('⚠️ ЗЕЛЁНЫЙ БОСС! ⚠️', 'lime');\n    } else if (wave === 10) {\n      this.hud.showMessage('☠️ ЧЁРНЫЙ БОСС! ☠️', 'purple');\n    } else if (wave === 15) {\n      this.hud.showMessage('⚡ СИНИЙ БОСС! ⚡', 'cyan');\n    }\n\n    this.handleResize();\n  }\n\n  /** Остановка игры */\n  public stop(): void {\n    this.gameLoop.stop();\n    this.state.isRunning = false;\n    this.input.exitPointerLock();\n  }\n\n  /** Обновление игры */\n  private update(dt: number): void {\n    if (this.state.isPaused || this.isPaused) return;\n\n    this.gameTime += dt;\n\n    // Обновляем анимацию платформ (парение) - только если не в войде\n    if (!this.isInVoid) {\n      this.collision.updatePlatforms(this.gameTime);\n    }\n\n    // Обновляем таймер замедления\n    if (this.slowdownTimer > 0) {\n      this.slowdownTimer -= dt;\n      if (this.slowdownTimer <= 0) {\n        this.slowdownFactor = 1.0;\n      }\n    }\n\n    // Обновляем игрока с учётом замедления\n    const effectiveDt = dt * this.slowdownFactor;\n    this.player.update(effectiveDt, this.input.state, {\n      x: this.input.mouseDelta.x * this.slowdownFactor,\n      y: this.input.mouseDelta.y * this.slowdownFactor\n    });\n    this.input.resetMouseDelta();\n\n    // === VOID MODE (после player.update чтобы не ломать управление) ===\n    if (this.isInVoid) {\n      this.updateVoidMode(dt);\n    }\n    \n    // === ПРОВЕРКА ПАДЕНИЯ В ВОЙД ===\n    if (!this.isInVoid) {\n      const playerPos = this.player.state.position;\n      const distFromCenter = Math.sqrt(playerPos.x ** 2 + playerPos.z ** 2);\n      const arenaRadius = 33.0;\n      \n      if (distFromCenter > arenaRadius) {\n        this.hud.showMessage('💀 УПАЛ В БЕЗДНУ!', 'purple');\n        this.audio.playSFX('kill');\n        this.screenShake = 2.0;\n        this.enterVoid();\n      }\n    }\n\n    // Притяжение вихря чёрного босса\n    const vortexPull = this.targetManager.getVortexPull(this.player.state.position);\n    if (vortexPull.x !== 0 || vortexPull.z !== 0) {\n      this.player.state.position.x += vortexPull.x * dt;\n      this.player.state.position.z += vortexPull.z * dt;\n      // Тряска экрана во время вихря\n      this.screenShake = Math.max(this.screenShake, 0.3);\n    }\n\n    // Звуки движения\n    this.updateMovementSounds(dt);\n\n    // Обычная атака катаной (ЛКМ)\n    if (this.input.state.fire) {\n      if (this.weapon.tryAttack()) {\n        this.audio.playSFX('katana_swing');\n        this.attackHitChecked = false; // Сбросить флаг попадания для нового взмаха\n        \n        // Сразу определяем тип удара по позиции врага\n        const [targetAngle, _] = this.getKatanaTargetData();\n        // Враг слева → бьём справа (тип 0), враг справа → бьём слева (тип 1)\n        this.weapon.attackType = targetAngle > 0 ? 1 : 0;\n      }\n    }\n    \n    // Проверка попадания ВО ВРЕМЯ взмаха (когда лезвие проходит через врага)\n    if (this.weapon.isAttacking && !this.weapon.isSplashAttack && !this.attackHitChecked) {\n      // Попадание в фазе удара (0.2 - 0.5)\n      if (this.weapon.attackProgress >= 0.2 && this.weapon.attackProgress <= 0.5) {\n        this.checkNormalAttack();\n        this.attackHitChecked = true;\n      }\n    }\n\n    // Сплеш-атака (ПКМ) - если есть заряды\n    if (this.input.state.altFire) {\n      if (this.weapon.trySplashAttack()) {\n        this.audio.playSFX('splash_wave');\n        this.splashHitChecked = false;\n      }\n    }\n    \n    // Проверка сплеш-попадания во время взмаха\n    if (this.weapon.isAttacking && this.weapon.isSplashAttack && !this.splashHitChecked) {\n      if (this.weapon.attackProgress >= 0.2 && this.weapon.attackProgress <= 0.5) {\n        this.checkSplashAttack();\n        this.splashHitChecked = true;\n      }\n    }\n    \n    // Стрельба дротиками (ПКМ зажата - автоматическая стрельба)\n    this.dartCooldown -= dt;\n    if (this.input.state.altFire && this.darts > 0 && this.dartCooldown <= 0) {\n      this.fireDart();\n      this.dartCooldown = this.DART_FIRE_RATE;\n    }\n    \n    // Обновляем летящие дротики\n    this.updateDarts(dt);\n    \n    // Бросок гранаты (колёсико мыши)\n    if (this.input.state.throwGrenade && this.grenadeCount > 0) {\n      this.throwGrenade();\n      this.input.state.throwGrenade = false; // Сбрасываем сразу\n    } else {\n      this.input.state.throwGrenade = false; // Сбрасываем даже если нет гранат\n    }\n    \n    // Обновляем гранаты и взрывы\n    this.updateGrenades(dt);\n    this.updateExplosions(dt);\n    \n    // Обновляем эффекты смерти\n    this.updateDeathEffects(dt);\n    \n    // === ПОРТАЛ В ВОЙД ===\n    this.updateVoidPortal(dt);\n\n    // Обновляем катану\n    const isMoving = this.input.state.forward || this.input.state.backward ||\n                     this.input.state.left || this.input.state.right;\n    this.weapon.update(dt, isMoving, this.input.state.run);\n\n    // Синхронизируем анимацию с рендерером\n    this.weaponRenderer.isAttacking = this.weapon.isAttacking;\n    this.weaponRenderer.attackProgress = this.weapon.attackProgress;\n    this.weaponRenderer.isSplashAttack = this.weapon.isSplashAttack;\n    this.weaponRenderer.splashCharges = this.weapon.splashCharges;\n\n    // Обновляем врагов\n    const playerPos = this.player.getEyePosition();\n    if (!this.isInVoid) {\n      // Обычный режим - полное обновление\n      this.targetManager.update(dt, playerPos, this.gameTime);\n    } else {\n      // В войде - обновляем врагов войда (движение + столкновения)\n      // Уменьшаем кулдауны\n      for (const [id, cd] of this.voidPhantomCooldown) {\n        if (cd > 0) {\n          this.voidPhantomCooldown.set(id, cd - dt);\n        }\n      }\n      \n      for (const target of this.targetManager.targets) {\n        if (target.active && this.voidEnemyIds.includes(target.id)) {\n          target.update(dt, playerPos, this.gameTime);\n          \n          // Проверяем столкновение фантома с игроком (с кулдауном!)\n          const cooldown = this.voidPhantomCooldown.get(target.id) || 0;\n          if (cooldown <= 0 && target.checkPlayerCollision(playerPos)) {\n            // Фантом пролетел сквозь игрока - наносим урон\n            this.player.takeDamage(8); // Уменьшенный урон\n            this.voidPhantomCooldown.set(target.id, 1.5); // 1.5 сек кулдаун\n            \n            // Отталкивание от фантома\n            const knockbackDir = {\n              x: playerPos.x - target.position.x,\n              y: 0,\n              z: playerPos.z - target.position.z\n            };\n            const knockDist = Math.sqrt(knockbackDir.x ** 2 + knockbackDir.z ** 2);\n            if (knockDist > 0.1) {\n              const knockForce = 8; // Сила отталкивания\n              this.player.state.velocity.x += (knockbackDir.x / knockDist) * knockForce;\n              this.player.state.velocity.z += (knockbackDir.z / knockDist) * knockForce;\n            }\n            \n            this.audio.playSFX('phantom_hit');\n            this.audio.playSFX('player_hurt'); // Вскрик героя\n            this.screenShake = 0.8;\n            this.hud.showDamage('purple');\n            this.hud.showMessage('💀 ФАНТОМ!', 'purple');\n          }\n        }\n      }\n    }\n\n    // Звуки приближения врагов\n    this.updateEnemyProximitySounds(playerPos);\n\n    // Проверяем прицепившихся раннеров\n    this.checkAttachedRunners();\n\n    // Отслеживаем отпускание Space для двойного прыжка\n    if (!this.input.state.jump && this.wasJumpPressed) {\n      this.player.onJumpReleased();\n    }\n    this.wasJumpPressed = this.input.state.jump;\n\n    // Двойной прыжок для скидывания раннера\n    if (this.input.state.jump && !this.player.state.grounded) {\n      if (this.player.tryDoubleJump()) {\n        // Пробуем скинуть раннеров\n        this.detachRunners();\n        this.audio.playSFX('jump');\n      }\n    }\n\n    // Обновляем предметы\n    const pickedUp = this.pickupManager.update(dt, this.gameTime, playerPos);\n    if (pickedUp) {\n      this.onPickup(pickedUp);\n    }\n\n    // Общий proximity звук отключён - у каждого врага свой звук\n    this.audio.updateProximitySound(0);\n\n    // Тряска экрана\n    if (this.screenShake > 0) {\n      this.screenShake -= dt * 2;\n    }\n\n    // Проверка смерти\n    if (this.player.isDead()) {\n      this.gameOver();\n    }\n\n    // Обновляем HUD\n    this.hud.updateHealth(this.player.state.health, this.player.state.maxHealth);\n    this.hud.updateAmmo(this.targetManager.wave, this.targetManager.getActiveCount());\n    this.hud.updateFrags(this.state.frags);\n    this.hud.updateSplashCharges(this.weapon.splashCharges);\n    this.hud.updateDoubleJump(this.player.getDoubleJumpCooldown(), this.player.isDoubleJumpReady());\n    \n    // Обновляем очки\n    this.hud.updateCarryingScore(this.carryingScore);\n    const totalAltarScore = this.altars.reduce((sum, a) => sum + a.score, 0);\n    this.hud.updateAltarScore(totalAltarScore);\n    this.hud.updateDarts(this.darts);\n    \n    // Проверка низкого HP для тревожной музыки (меньше 30%)\n    const hpPercent = this.player.state.health / this.player.state.maxHealth;\n    this.audio.setLowHpMode(hpPercent < 0.3 && hpPercent > 0);\n    \n    // Показываем HP босса если есть\n    const boss = this.targetManager.getActiveBoss();\n    if (boss) {\n      this.hud.showBossHealth(boss.hp, boss.maxHp, boss.enemyType);\n    } else {\n      this.hud.hideBossHealth();\n    }\n  }\n\n  /** Звуки движения */\n  private updateMovementSounds(dt: number): void {\n    const isMoving = this.input.state.forward || this.input.state.backward ||\n                     this.input.state.left || this.input.state.right;\n\n    if (isMoving && this.player.state.grounded) {\n      this.footstepTimer -= dt;\n      if (this.footstepTimer <= 0) {\n        this.audio.playSFX('footstep');\n        this.footstepTimer = this.input.state.run ? 0.25 : 0.4;\n      }\n    }\n\n    if (this.player.state.grounded && !this.wasGrounded) {\n      this.audio.playSFX('land');\n    }\n    this.wasGrounded = this.player.state.grounded;\n  }\n\n  /** Callback при взмахе катаной */\n  private onKatanaSlice(): void {\n    this.audio.playSFX('katana_swing');\n  }\n\n  /** Game Over */\n  private gameOver(): void {\n    this.state.isPaused = true;\n    this.hud.showGameOver(this.state.frags, this.targetManager.wave);\n    \n    // Перезапуск через 3 секунды\n    setTimeout(() => {\n      this.restart();\n    }, 3000);\n  }\n\n  /** Перезапуск - полный сброс игры */\n  private restart(): void {\n    // Сброс игрока\n    this.player.reset(vec3(0, 1.7, 12));\n    this.player.state.health = 100;\n    this.player.state.maxHealth = 100;\n    \n    // Сброс состояния игры\n    this.state.frags = 0;\n    this.state.isPaused = false;\n    \n    // Сброс режимов\n    this.isInVoid = false;\n    this.player.isInVoid = false;\n    \n    // Сброс очков\n    this.carryingScore = 0;\n    this.darts = 0;\n    \n    // Сброс алтарей\n    this.altars.forEach(altar => { altar.score = 0; });\n    \n    // Сброс оружия\n    this.weapon.splashCharges = 0;\n    this.weapon.isAttacking = false;\n    this.weapon.attackProgress = 0;\n    \n    // Сброс эффектов\n    this.screenShake = 0;\n    this.slowdownFactor = 1;\n    this.slowdownTimer = 0;\n    \n    // Сброс врагов и пикапов - начинаем с волны 1!\n    this.targetManager.startGame(1);\n    this.pickupManager.pickups = [];\n    \n    // Обновить HUD\n    this.hud.updateCarryingScore(0);\n    this.hud.updateAltarScore(0);\n    this.hud.updateDarts(0);\n    this.hud.updateSplashCharges(0);\n  }\n\n  /** === VOID MODE === */\n\n  /** Вход в войд - ECLIPSE (Берсерк) */\n  private enterVoidMode(): void {\n    this.isInVoid = true;\n    this.player.isInVoid = true; // Отключаем collision для игрока\n    this.voidEnemyIds = [];\n    this.voidFallOffset = 0;\n    this.voidPhantomCooldown.clear(); // Очищаем кулдауны\n\n    // Включаем глубокий low pass фильтр\n    this.audio.enterVoidAudio();\n\n    // Сохраняем позицию для возврата\n    this.savedPosition = { ...this.player.state.position };\n    this.savedYaw = this.player.state.yaw;\n\n    // Телепортируем игрока в центр войда\n    this.player.state.position = vec3(0, 2, 0);\n    this.player.state.velocity = vec3(0, 0, 0);\n    this.player.state.grounded = true; // Может бежать!\n\n    // Создаём портал выхода в случайном направлении\n    const portalAngle = Math.random() * Math.PI * 2;\n    this.portalPos = vec3(\n      Math.cos(portalAngle) * this.PORTAL_DISTANCE,\n      3, // Немного над землёй\n      Math.sin(portalAngle) * this.PORTAL_DISTANCE\n    );\n\n    // Сохраняем состояние волны\n    this.savedWaveActive = this.targetManager.waveActive;\n    \n    // Сохраняем и \"замораживаем\" всех врагов (не удаляем!)\n    this.savedEnemyIds = [];\n    for (const target of this.targetManager.targets) {\n      if (target.active) {\n        this.savedEnemyIds.push(target.id);\n        target.active = false;\n        // Устанавливаем большой таймер чтобы враги не удалились пока мы в войде\n        target.removeTimer = 9999;\n      }\n    }\n\n    // Эффекты входа\n    this.hud.showVoidEnter();\n    this.screenShake = 1.5;\n    \n    // Спавним первого фантома сразу\n    this.voidSpawnTimer = 1.0;\n    this.voidEnemyIds = [];\n  }\n\n  /** Обновление void mode - ECLIPSE */\n  private updateVoidMode(dt: number): void {\n    if (!this.isInVoid) return;\n\n    // === ЭФФЕКТ ПАДЕНИЯ (визуальный) ===\n    this.voidFallOffset += dt * 5.0;\n    \n    // Лёгкая тряска для атмосферы\n    this.screenShake = Math.max(this.screenShake, 0.03);\n\n    // Игрок может СВОБОДНО двигаться и бежать к порталу!\n    const playerPos = this.player.state.position;\n    \n    // === ПРОВЕРКА ПАДЕНИЯ С ОСТРОВОВ И ОБЛОМКОВ ===\n    // Главный остров (центр, радиус 10 - уменьшен!)\n    const distToMainIsland = Math.sqrt(playerPos.x ** 2 + playerPos.z ** 2);\n    const onMainIsland = distToMainIsland < 10;\n    \n    // Остров у портала (радиус 5 - уменьшен!)\n    const distToPortalIsland = Math.sqrt(\n      (playerPos.x - this.portalPos.x) ** 2 + \n      (playerPos.z - this.portalPos.z) ** 2\n    );\n    const onPortalIsland = distToPortalIsland < 5;\n    \n    // Обломки между островами (нужно прыгать!)\n    const toPortalDir = { x: this.portalPos.x, z: this.portalPos.z };\n    const portalDist = Math.sqrt(toPortalDir.x ** 2 + toPortalDir.z ** 2);\n    if (portalDist > 0) {\n      toPortalDir.x /= portalDist;\n      toPortalDir.z /= portalDist;\n    }\n    \n    // Проверяем все 8 обломков\n    const bridgeLen = portalDist - 5.0 - 10.0; // Синхронизировано с шейдером\n    let onFragment = false;\n    let fragmentFloorY = -100;\n    \n    for (let i = 0; i < 8; i++) {\n      // Позиция обломка (должна совпадать с шейдером!)\n      const fragmentPos = 12.0 + i * (bridgeLen / 7.0);\n      const randX = Math.sin(i * 73.1) * 2.0;\n      const randZ = Math.cos(i * 47.3) * 2.0;\n      const randY = Math.sin(i * 91.7) * 0.8 - 0.3;\n      \n      // Размер (2-4м) - используем такую же псевдослучайность как в шейдере\n      const fract = (x: number) => x - Math.floor(x);\n      const fragmentSize = 2.0 + fract(Math.sin(i * 127.3) * 43758.5) * 2.0;\n      const sizeX = fragmentSize * (0.8 + fract(Math.sin(i * 31.7) * 100.0) * 0.4);\n      const sizeZ = fragmentSize * (0.8 + fract(Math.sin(i * 57.3) * 100.0) * 0.4);\n      \n      // Центр обломка\n      const fragCenterX = toPortalDir.x * fragmentPos + randX;\n      const fragCenterZ = toPortalDir.z * fragmentPos + randZ;\n      const fragY = randY + 0.5; // Высота поверхности\n      \n      // Проверяем XZ\n      const rotAngle = i * 0.7;\n      const localX = (playerPos.x - fragCenterX) * Math.cos(-rotAngle) - (playerPos.z - fragCenterZ) * Math.sin(-rotAngle);\n      const localZ = (playerPos.x - fragCenterX) * Math.sin(-rotAngle) + (playerPos.z - fragCenterZ) * Math.cos(-rotAngle);\n      \n      if (Math.abs(localX) < sizeX && Math.abs(localZ) < sizeZ) {\n        onFragment = true;\n        fragmentFloorY = Math.max(fragmentFloorY, fragY + 1.8); // Высота глаз\n      }\n    }\n    \n    // Определяем высоту пола под игроком\n    let floorY = -100; // Нет пола\n    \n    if (onMainIsland || onPortalIsland) {\n      floorY = 2.0; // Высота островов\n    } else if (onFragment) {\n      floorY = fragmentFloorY;\n    }\n    \n    // Упали в бездну?\n    if (playerPos.y < -5) {\n      this.fallFromVoid();\n      return;\n    }\n    \n    // Физика\n    if (floorY > -50 && playerPos.y <= floorY) {\n      // На твёрдой поверхности\n      this.player.state.position.y = floorY;\n      this.player.state.grounded = true;\n      this.player.state.velocity.y = 0;\n    } else {\n      // В воздухе - гравитация!\n      this.player.state.grounded = false;\n      this.player.state.velocity.y -= 30 * dt; // Гравитация (усилил)\n      this.player.state.position.y += this.player.state.velocity.y * dt;\n    }\n    \n    // === МОНЕТЫ КРОВИ ===\n    this.updateBloodCoins(dt);\n\n    // === ПРОВЕРКА ДОСТИЖЕНИЯ ПОРТАЛА ===\n    const dx = this.player.state.position.x - this.portalPos.x;\n    const dz = this.player.state.position.z - this.portalPos.z;\n    const distToPortal = Math.sqrt(dx * dx + dz * dz);\n\n    if (distToPortal < this.PORTAL_RADIUS) {\n      // Достигли портала - выход!\n      this.exitVoidMode(true);\n      return;\n    }\n\n    // === СПАВН ФАНТОМОВ-ОХОТНИКОВ ===\n    this.voidSpawnTimer -= dt;\n    if (this.voidSpawnTimer <= 0) {\n      this.spawnVoidHunter();\n      this.voidSpawnTimer = this.VOID_SPAWN_INTERVAL;\n    }\n\n    // Обновляем HUD с расстоянием до портала\n    this.hud.showVoidMode(Math.floor(distToPortal), this.PORTAL_DISTANCE);\n\n    // Проверяем смерть\n    if (this.player.isDead()) {\n      this.exitVoidMode(false);\n    }\n  }\n\n  /** Спавн фантома-охотника в войде */\n  private spawnVoidHunter(): void {\n    const playerPos = this.player.state.position;\n    \n    // Спавним позади или сбоку от игрока (не перед ним)\n    const playerYaw = this.player.state.yaw;\n    const offsetAngle = (Math.random() - 0.5) * Math.PI + Math.PI; // Сзади ± 90°\n    const angle = playerYaw + offsetAngle;\n    const dist = 15 + Math.random() * 10; // 15-25 единиц\n\n    const spawnPos = vec3(\n      playerPos.x + Math.cos(angle) * dist,\n      2.0,\n      playerPos.z + Math.sin(angle) * dist\n    );\n\n    // Быстрый агрессивный фантом!\n    const phantomId = Date.now() + Math.floor(Math.random() * 1000);\n    const phantom = new Target(\n      spawnPos,\n      12.0 + Math.random() * 4, // Скорость 12-16\n      phantomId,\n      'phantom',\n      this.collision\n    );\n\n    phantom.active = true;\n    this.targetManager.targets.push(phantom);\n    this.voidEnemyIds.push(phantomId);\n    \n    // Жуткий звук появления\n    this.audio.playSFX('void_whistle');\n  }\n\n  /** Падение из войда в обычный мир */\n  private fallFromVoid(): void {\n    this.isInVoid = false;\n    this.player.isInVoid = false;\n    this.voidCoins = []; // Очищаем монеты\n    \n    // Убираем фильтр\n    this.audio.exitVoidAudio();\n    this.hud.hideVoidMode();\n    \n    // Выходим через случайный портал (как враги)\n    const portal = Math.random() < 0.5 ? PORTAL_POSITIONS.left : PORTAL_POSITIONS.right;\n    // Чуть впереди портала чтобы выйти из него\n    const exitOffset = portal.x > 0 ? -3 : 3;\n    \n    this.player.state.position = { \n      x: portal.x + exitOffset, \n      y: portal.y, \n      z: portal.z \n    };\n    this.player.state.velocity = { x: 0, y: 0, z: 0 };\n    this.player.state.grounded = true;\n    \n    // Эффекты\n    this.screenShake = 1.0;\n    this.audio.playSFX('player_hurt');\n    this.hud.showMessage('💀 ВЫШВЫРНУЛО ИЗ БЕЗДНЫ!', 'purple');\n    \n    // Небольшой урон за падение\n    this.player.state.health -= 15;\n    this.hud.showDamage();\n    this.hud.updateHealth(this.player.state.health, this.player.state.maxHealth);\n    \n    if (this.player.isDead()) {\n      this.gameOver();\n    }\n  }\n  \n  /** Выход из войда */\n  private exitVoidMode(success: boolean): void {\n    this.isInVoid = false;\n    this.player.isInVoid = false; // Включаем collision обратно\n    this.hud.hideVoidMode();\n    \n    // Закрываем портал и сбрасываем таймер чтобы не попасть обратно\n    this.voidPortalActive = false;\n    this.voidPortalTimer = this.VOID_PORTAL_COOLDOWN + 3; // +3 секунды запаса\n    this.voidCoins = []; // Очищаем монеты\n    \n    // Убираем фильтр - возвращаем нормальный звук\n    this.audio.exitVoidAudio();\n\n    // Убираем всех void-врагов (фантомов созданных в войде)\n    for (const target of this.targetManager.targets) {\n      if (this.voidEnemyIds.includes(target.id)) {\n        target.active = false;\n      }\n    }\n    this.voidEnemyIds = [];\n\n    // ВОССТАНАВЛИВАЕМ врагов которые были активны до войда\n    for (const target of this.targetManager.targets) {\n      if (this.savedEnemyIds.includes(target.id)) {\n        target.active = true;\n        target.removeTimer = 0; // Сбрасываем таймер удаления\n      }\n    }\n    this.savedEnemyIds = [];\n    \n    // Восстанавливаем состояние волны\n    this.targetManager.waveActive = this.savedWaveActive;\n\n    // Возвращаем игрока\n    this.player.state.position = { ...this.savedPosition };\n    this.player.state.yaw = this.savedYaw;\n    this.player.state.velocity = vec3(0, 0, 0);\n    this.player.state.grounded = true;\n\n    // Эффекты выхода из войда\n    this.screenShake = 0.5;\n\n    if (success) {\n      this.hud.showVoidExit(true);\n      // Бонус за выживание\n      this.state.frags += 500;\n      this.hud.showMessage(`+500 БОНУС ЗА ВОЙД!`, 'cyan');\n    } else {\n      this.hud.showVoidExit(false);\n      // Урон за провал\n      this.player.takeDamage(50);\n    }\n  }\n\n  /** Проверка прицепившихся раннеров */\n  private checkAttachedRunners(): void {\n    for (const target of this.targetManager.targets) {\n      if (target.enemyType === 'runner' && target.isAttached) {\n        // Раннер прицепился - урон когда время выйдет\n        if (target.attachTimer <= 0 && target.active === false) {\n          this.player.takeDamage(target.damage);\n          this.audio.playSFX('runner_hit');\n          this.screenShake = 0.6;\n          this.hud.showDamage('green');\n          this.hud.showMessage('⚠️ РАННЕР УКУСИЛ!', 'orange');\n        }\n      }\n    }\n  }\n\n  /** Звуки приближения врагов - у каждого свой звук */\n  private updateEnemyProximitySounds(playerPos: Vec3): void {\n    // В войде не играем звуки приближения (кроме свиста при спавне)\n    if (this.isInVoid) return;\n\n    for (const target of this.targetManager.targets) {\n      if (!target.active) continue;\n\n      const dx = target.position.x - playerPos.x;\n      const dy = target.position.y - playerPos.y;\n      const dz = target.position.z - playerPos.z;\n      const dist = Math.sqrt(dx * dx + dy * dy + dz * dz);\n\n      // Каждый тип врага издаёт свой звук при приближении\n      this.audio.playEnemyProximitySound(target.enemyType, dist);\n    }\n  }\n\n  /** Скинуть раннеров двойным прыжком */\n  private detachRunners(): void {\n    let detached = false;\n    for (const target of this.targetManager.targets) {\n      if (target.enemyType === 'runner' && target.isAttached) {\n        target.detachRunner();\n        detached = true;\n      }\n    }\n    if (detached) {\n      this.hud.showMessage('✓ РАННЕР СБРОШЕН!', 'cyan');\n    }\n  }\n\n  /** Подбор предмета */\n  private onPickup(type: string): void {\n    if (type === 'health') {\n      // Маленькая аптечка (в воде) - восстанавливает 20 HP\n      const heal = 20;\n      this.player.state.health = Math.min(\n        this.player.state.maxHealth,\n        this.player.state.health + heal\n      );\n      this.audio.playSFX('jump'); // Временный звук\n      this.hud.showMessage('+' + heal + ' HP', 'lime');\n      this.hud.updateHealth(this.player.state.health, this.player.state.maxHealth);\n    } else if (type === 'health_big') {\n      // БОЛЬШАЯ аптечка (на краях) - восстанавливает 60 HP!\n      const heal = 60;\n      this.player.state.health = Math.min(\n        this.player.state.maxHealth,\n        this.player.state.health + heal\n      );\n      this.audio.playSFX('jump'); // Временный звук\n      this.hud.showMessage('+' + heal + ' HP!', 'lime');\n      this.hud.updateHealth(this.player.state.health, this.player.state.maxHealth);\n      \n    } else if (type === 'stimpack') {\n      // Стимпак - буйство!\n      this.player.activateStimpack();\n      this.audio.playSFX('kill'); // Временный звук\n      this.hud.showMessage('🔥 БУЙСТВО! 🔥', 'red');\n      this.hud.showRageOverlay(8.0);\n      \n    } else if (type === 'charge') {\n      // Заряд катаны - 3 сплеш-удара!\n      this.weapon.chargeKatana();\n      this.audio.playSFX('charge_pickup');\n      this.hud.showMessage('⚡ КАТАНА ЗАРЯЖЕНА! (ПКМ x3) ⚡', 'cyan');\n      this.hud.updateSplashCharges(3);\n      this.screenShake = 0.5;\n    }\n  }\n\n  /** Проверка обычной атаки */\n  private checkNormalAttack(): void {\n    const playerPos = this.player.getEyePosition();\n    \n    // Определяем тип удара по позиции ближайшего врага\n    const [targetAngle, _] = this.getKatanaTargetData();\n    // Если враг слева (угол < 0) → бьём справа (тип 0)\n    // Если враг справа (угол > 0) → бьём слева (тип 1)\n    const smartAttackType = targetAngle > 0 ? 1 : 0;\n    this.weapon.attackType = smartAttackType;\n    \n    const hit = this.targetManager.trySlice(\n      playerPos,\n      this.player.state.yaw,\n      this.weapon.attackRange,\n      this.weapon.attackAngle,\n      this.player.state.grounded, // Передаём состояние - на земле ли игрок\n      smartAttackType // Тип удара зависит от позиции врага\n    );\n    \n    if (hit) {\n      this.lastSliceTime = this.gameTime;\n      this.weaponRenderer.showHitEffect();\n      this.audio.playSFX('kill');\n      // СМАЧНЫЙ удар - тряска экрана!\n      this.screenShake = 0.4;\n    }\n\n    // Проверяем попадание по кристаллам (только на волне 10)\n    if (this.targetManager.wave === 10) {\n      const crystalHit = this.targetManager.trySliceCrystal(\n        playerPos,\n        this.player.state.yaw,\n        this.weapon.attackRange\n      );\n      \n      if (crystalHit) {\n        this.weaponRenderer.showHitEffect();\n        this.audio.playSFX('kill');\n        const remaining = this.targetManager.powerCrystals.filter(c => c.active).length;\n        \n        if (remaining === 0) {\n          this.hud.showMessage('💀 КРИСТАЛЛЫ УНИЧТОЖЕНЫ! БОСС ОСЛАБЛЕН! 💀', 'purple');\n          this.screenShake = 2.0;\n        } else {\n          this.hud.showMessage(`🔮 КРИСТАЛЛ РАЗБИТ! (${remaining}/6)`, 'cyan');\n        }\n      }\n    }\n    \n    // === ПРОВЕРКА ПОПАДАНИЯ ПО АЛТАРЮ ===\n    const altarHit = this.checkAltarHit(playerPos);\n    if (altarHit !== null) {\n      // Приоритет 1: Монеты крови → Гранаты\n      if (this.bloodCoins >= this.GRENADE_COST) {\n        this.bloodCoins -= this.GRENADE_COST;\n        this.grenadeCount += 1;\n        this.altars[altarHit].score += this.GRENADE_COST;\n        this.audio.playSFX('kill');\n        this.hud.showMessage(`💣 +1 ГРАНАТА! (🩸${this.bloodCoins})`, 'purple');\n        this.screenShake = 0.3;\n      }\n      // Приоритет 2: Очки → Дротики\n      else if (this.carryingScore > 0) {\n        const dartsEarned = this.carryingScore * this.DARTS_PER_POINT;\n        this.darts += dartsEarned;\n        this.altars[altarHit].score += this.carryingScore;\n        this.audio.playSFX('kill');\n        this.hud.showMessage(`🎯 +${dartsEarned} ДРОТИКОВ!`, 'cyan');\n        this.carryingScore = 0;\n        this.screenShake = 0.3;\n      } else {\n        // Нет ни монет ни очков\n        this.hud.showMessage(`НУЖНЫ ОЧКИ ИЛИ 🩸${this.GRENADE_COST} МОНЕТ!`, 'purple');\n      }\n    }\n  }\n  \n  /** Спавн монет крови в войде */\n  private spawnBloodCoins(): void {\n    this.voidCoins = [];\n    \n    // Направление к порталу\n    const toPortalDir = { x: this.portalPos.x, z: this.portalPos.z };\n    const portalDist = Math.sqrt(toPortalDir.x ** 2 + toPortalDir.z ** 2);\n    if (portalDist > 0) {\n      toPortalDir.x /= portalDist;\n      toPortalDir.z /= portalDist;\n    }\n    const bridgeLen = portalDist - 6.0 - 12.0;\n    \n    // Монеты на обломках (одна на каждом)\n    const fract = (x: number) => x - Math.floor(x);\n    for (let i = 0; i < 8; i++) {\n      const fragmentPos = 14.0 + i * (bridgeLen / 7.0);\n      const randX = Math.sin(i * 73.1) * 2.0;\n      const randZ = Math.cos(i * 47.3) * 2.0;\n      const randY = Math.sin(i * 91.7) * 0.8 - 0.3 + 2.0; // На поверхности обломка\n      \n      const coinX = toPortalDir.x * fragmentPos + randX;\n      const coinZ = toPortalDir.z * fragmentPos + randZ;\n      \n      this.voidCoins.push({\n        position: { x: coinX, y: randY, z: coinZ },\n        active: true,\n        phase: Math.random() * Math.PI * 2,\n      });\n    }\n    \n    // Дополнительные монеты на островах\n    const islandCoins = [\n      { x: 8, z: 8 },\n      { x: -8, z: 8 },\n      { x: 8, z: -8 },\n      { x: -8, z: -8 },\n    ];\n    \n    for (const pos of islandCoins) {\n      this.voidCoins.push({\n        position: { x: pos.x, y: 2.0, z: pos.z },\n        active: true,\n        phase: Math.random() * Math.PI * 2,\n      });\n    }\n  }\n  \n  /** Обновление монет крови */\n  private updateBloodCoins(dt: number): void {\n    if (!this.isInVoid) return;\n    \n    const playerPos = this.player.state.position;\n    \n    for (const coin of this.voidCoins) {\n      if (!coin.active) continue;\n      \n      // Анимация парения\n      coin.position.y = 1.5 + Math.sin(this.gameTime * 3 + coin.phase) * 0.3;\n      \n      // Проверка подбора\n      const dx = coin.position.x - playerPos.x;\n      const dy = coin.position.y - playerPos.y;\n      const dz = coin.position.z - playerPos.z;\n      const dist = Math.sqrt(dx * dx + dy * dy + dz * dz);\n      \n      if (dist < 2.0) {\n        coin.active = false;\n        this.bloodCoins++;\n        this.audio.playSFX('kill');\n        this.hud.showMessage(`🩸 +1 МОНЕТА КРОВИ (${this.bloodCoins})`, 'purple');\n      }\n    }\n  }\n  \n  /** Обновление портала в войд */\n  private updateVoidPortal(dt: number): void {\n    // Не в войде и не на паузе\n    if (this.isInVoid || this.isPaused) return;\n    \n    if (this.voidPortalActive) {\n      // Портал открыт - уменьшаем время жизни\n      this.voidPortalLifetime -= dt;\n      \n      // Проверяем вход игрока в портал\n      const playerPos = this.player.state.position;\n      const distToPortal = Math.sqrt(playerPos.x ** 2 + playerPos.z ** 2);\n      \n      if (distToPortal < 2.5) {\n        // Игрок вошёл в портал!\n        this.enterVoid();\n        return;\n      }\n      \n      if (this.voidPortalLifetime <= 0) {\n        // Портал закрывается\n        this.voidPortalActive = false;\n        this.voidPortalTimer = this.VOID_PORTAL_COOLDOWN;\n        this.hud.showMessage('⚫ ПОРТАЛ ЗАКРЫЛСЯ', 'purple');\n      }\n    } else {\n      // Ждём появления портала\n      this.voidPortalTimer -= dt;\n      \n      if (this.voidPortalTimer <= 0) {\n        // Открываем портал!\n        this.voidPortalActive = true;\n        this.voidPortalLifetime = this.VOID_PORTAL_DURATION;\n        this.audio.playSFX('kill'); // Звук открытия\n        this.hud.showMessage('🌀 ПОРТАЛ В ВОЙД ОТКРЫЛСЯ!', 'purple');\n        this.screenShake = 0.5;\n      } else if (this.voidPortalTimer <= 5) {\n        // Предупреждение за 5 секунд\n        if (Math.floor(this.voidPortalTimer) !== Math.floor(this.voidPortalTimer + dt)) {\n          this.hud.showMessage(`⚫ ПОРТАЛ ЧЕРЕЗ ${Math.ceil(this.voidPortalTimer)}...`, 'purple');\n        }\n      }\n    }\n  }\n  \n  /** Вход в войд через портал */\n  private enterVoid(): void {\n    this.isInVoid = true;\n    this.player.isInVoid = true; // Включаем режим войда для игрока!\n    this.voidPortalActive = false;\n    this.voidEnemyIds = [];\n    this.voidFallOffset = 0;\n    \n    // Случайный вариант войда (разные цвета/атмосфера)\n    this.voidVariant = Math.floor(Math.random() * 4); // 0-3\n    \n    // Сохраняем позицию для возврата\n    this.savedPosition = { ...this.player.state.position };\n    this.savedYaw = this.player.state.yaw;\n    \n    const voidNames = ['БАГРОВЫЙ', 'ИЗУМРУДНЫЙ', 'ЗОЛОТОЙ', 'ЛЕДЯНОЙ'];\n    this.hud.showMessage(`🌀 ${voidNames[this.voidVariant]} ВОЙД!`, 'purple');\n    this.audio.playSFX('kill');\n    this.screenShake = 1.0;\n    \n    // Включаем глубокий low pass фильтр\n    this.audio.enterVoidAudio();\n    \n    // Телепортируем игрока на остров в войде\n    this.player.state.position = { x: 0, y: 2, z: 0 };\n    this.player.state.velocity = { x: 0, y: 0, z: 0 };\n    this.player.state.grounded = true;\n    \n    // Устанавливаем позицию портала выхода (случайное направление, дальше!)\n    const portalAngle = Math.random() * Math.PI * 2;\n    this.portalPos = { \n      x: Math.cos(portalAngle) * 40, // Далеко - нужно прыгать по обломкам!\n      y: 2, \n      z: Math.sin(portalAngle) * 40 \n    };\n    \n    // Спавним монеты крови в войде!\n    this.spawnBloodCoins();\n    \n    // Спавним фантомов\n    this.voidSpawnTimer = 2.0;\n  }\n  \n  /** Выстрел дротиком */\n  private fireDart(): void {\n    if (this.darts <= 0) return;\n    \n    this.darts--;\n    this.audio.playSFX('jump'); // Звук выстрела (временный)\n    \n    const playerPos = this.player.getEyePosition();\n    const yaw = this.player.state.yaw;\n    const pitch = this.player.state.pitch;\n    \n    // Направление взгляда\n    const dirX = Math.sin(yaw) * Math.cos(pitch);\n    const dirY = Math.sin(pitch);\n    const dirZ = -Math.cos(yaw) * Math.cos(pitch);\n    \n    // Небольшой разброс для реализма\n    const spread = 0.03;\n    const spreadX = (Math.random() - 0.5) * spread;\n    const spreadY = (Math.random() - 0.5) * spread;\n    const spreadZ = (Math.random() - 0.5) * spread;\n    \n    const speed = 60; // Очень быстрые дротики\n    \n    this.flyingDarts.push({\n      position: { \n        x: playerPos.x + dirX * 0.5, // Смещение от камеры\n        y: playerPos.y - 0.2,        // Немного ниже глаз\n        z: playerPos.z + dirZ * 0.5 \n      },\n      velocity: {\n        x: (dirX + spreadX) * speed,\n        y: (dirY + spreadY) * speed,\n        z: (dirZ + spreadZ) * speed,\n      },\n      active: true,\n    });\n  }\n  \n  /** Обновление летящих дротиков */\n  private updateDarts(dt: number): void {\n    for (const dart of this.flyingDarts) {\n      if (!dart.active) continue;\n      \n      // Движение\n      dart.position.x += dart.velocity.x * dt;\n      dart.position.y += dart.velocity.y * dt;\n      dart.position.z += dart.velocity.z * dt;\n      \n      // Гравитация (небольшая)\n      dart.velocity.y -= 15 * dt;\n      \n      // Проверяем попадание по врагам\n      for (const target of this.targetManager.targets) {\n        if (!target.active) continue;\n        \n        const dx = dart.position.x - target.position.x;\n        const dy = dart.position.y - target.position.y;\n        const dz = dart.position.z - target.position.z;\n        const dist = Math.sqrt(dx * dx + dy * dy + dz * dz);\n        \n        if (dist < target.radius + 0.5) {\n          // Попадание!\n          dart.active = false;\n          const killed = target.takeDamage(this.DART_DAMAGE);\n          this.audio.playSFX('kill');\n          this.hud.showHitmarker(false);\n          \n          // Убиваем если HP <= 0\n          if (killed || target.hp <= 0) {\n            const sliceDir = { x: dx / (dist || 1), y: 0, z: dz / (dist || 1) };\n            target.slice(sliceDir);\n            this.targetManager.onTargetDestroyed?.(target);\n          }\n          break;\n        }\n      }\n      \n      // Дезактивируем если улетел далеко или упал\n      if (dart.position.y < -5 || \n          Math.abs(dart.position.x) > 50 || \n          Math.abs(dart.position.z) > 50) {\n        dart.active = false;\n      }\n    }\n    \n    // Удаляем неактивные\n    this.flyingDarts = this.flyingDarts.filter(d => d.active);\n  }\n  \n  /** Бросок гранаты */\n  private throwGrenade(): void {\n    if (this.grenadeCount <= 0) return;\n    \n    this.grenadeCount--;\n    this.audio.playSFX('jump'); // Звук броска\n    \n    const playerPos = this.player.getEyePosition();\n    const yaw = this.player.state.yaw;\n    const pitch = this.player.state.pitch;\n    \n    // Направление броска (по взгляду)\n    const dirX = Math.sin(yaw) * Math.cos(pitch);\n    const dirY = Math.sin(pitch);\n    const dirZ = -Math.cos(yaw) * Math.cos(pitch);\n    \n    this.grenades.push({\n      position: { \n        x: playerPos.x + dirX * 1.0,\n        y: playerPos.y,\n        z: playerPos.z + dirZ * 1.0\n      },\n      velocity: {\n        x: dirX * this.GRENADE_SPEED,\n        y: dirY * this.GRENADE_SPEED + 5, // Немного вверх\n        z: dirZ * this.GRENADE_SPEED\n      },\n      active: true,\n      lifetime: this.GRENADE_FUSE\n    });\n    \n    this.hud.showMessage(`💣 ГРАНАТА! (осталось: ${this.grenadeCount})`, 'purple');\n  }\n  \n  /** Обновление гранат */\n  private updateGrenades(dt: number): void {\n    for (const grenade of this.grenades) {\n      if (!grenade.active) continue;\n      \n      // Движение\n      grenade.position.x += grenade.velocity.x * dt;\n      grenade.position.y += grenade.velocity.y * dt;\n      grenade.position.z += grenade.velocity.z * dt;\n      \n      // Гравитация\n      grenade.velocity.y -= this.GRENADE_GRAVITY * dt;\n      \n      // Отскок от земли\n      if (grenade.position.y < 0.5) {\n        grenade.position.y = 0.5;\n        grenade.velocity.y = -grenade.velocity.y * 0.5; // Потеря энергии\n        grenade.velocity.x *= 0.8;\n        grenade.velocity.z *= 0.8;\n      }\n      \n      // Таймер взрыва\n      grenade.lifetime -= dt;\n      if (grenade.lifetime <= 0) {\n        this.explodeGrenade(grenade.position);\n        grenade.active = false;\n      }\n    }\n    \n    // Удаляем неактивные\n    this.grenades = this.grenades.filter(g => g.active);\n  }\n  \n  /** Взрыв гранаты */\n  private explodeGrenade(position: Vec3): void {\n    // Создаём визуальный взрыв\n    this.explosions.push({\n      position: { ...position },\n      progress: 0,\n      active: true\n    });\n    \n    // Звук взрыва (глитч-эффект)\n    this.audio.playSFX('explosion');\n    this.screenShake = 3.0;\n    \n    // Наносим урон врагам в радиусе\n    for (const target of this.targetManager.targets) {\n      if (!target.active) continue;\n      \n      const dx = position.x - target.position.x;\n      const dy = position.y - target.position.y;\n      const dz = position.z - target.position.z;\n      const dist = Math.sqrt(dx * dx + dy * dy + dz * dz);\n      \n      if (dist < this.EXPLOSION_RADIUS) {\n        // Урон падает с расстоянием\n        const damageMultiplier = 1 - (dist / this.EXPLOSION_RADIUS);\n        const damage = this.EXPLOSION_DAMAGE * damageMultiplier;\n        const killed = target.takeDamage(damage);\n        this.hud.showHitmarker(false);\n        \n        // Убиваем если HP <= 0\n        if (killed || target.hp <= 0) {\n          const sliceDir = { x: dx / (dist || 1), y: 0, z: dz / (dist || 1) };\n          target.slice(sliceDir);\n          this.targetManager.onTargetDestroyed?.(target);\n        }\n      }\n    }\n    \n    // Глитч-эффект: телепортация в радиусе взрыва\n    const playerPos = this.player.state.position;\n    const playerDist = Math.sqrt(\n      (position.x - playerPos.x) ** 2 +\n      (position.y - playerPos.y) ** 2 +\n      (position.z - playerPos.z) ** 2\n    );\n    if (playerDist < this.EXPLOSION_RADIUS) {\n      // Телепортируем игрока в случайное место в радиусе взрыва!\n      const teleportAngle = Math.random() * Math.PI * 2;\n      const teleportDist = Math.random() * this.EXPLOSION_RADIUS;\n      const newX = position.x + Math.cos(teleportAngle) * teleportDist;\n      const newZ = position.z + Math.sin(teleportAngle) * teleportDist;\n      \n      this.player.state.position.x = newX;\n      this.player.state.position.z = newZ;\n      \n      // Небольшой урон за глитч\n      const selfDamage = 10;\n      this.player.state.health -= selfDamage;\n      this.hud.showDamage();\n      this.hud.updateHealth(this.player.state.health, this.player.state.maxHealth);\n      this.hud.showMessage('⚡ GLITCH TELEPORT!', 'cyan');\n      \n      // Дополнительная тряска\n      this.screenShake = 1.5;\n      \n      if (this.player.isDead()) {\n        this.gameOver();\n      }\n    }\n  }\n  \n  /** Обновление взрывов */\n  private updateExplosions(dt: number): void {\n    for (const exp of this.explosions) {\n      if (!exp.active) continue;\n      \n      exp.progress += dt / this.EXPLOSION_DURATION;\n      if (exp.progress >= 1) {\n        exp.active = false;\n      }\n    }\n    \n    this.explosions = this.explosions.filter(e => e.active);\n  }\n  \n  /** Проверка попадания по алтарю */\n  private checkAltarHit(playerPos: Vec3): number | null {\n    const range = this.weapon.attackRange + 1.5; // Немного больше радиус\n    \n    for (let i = 0; i < this.altars.length; i++) {\n      const altar = this.altars[i];\n      const dx = playerPos.x - altar.position.x;\n      const dz = playerPos.z - altar.position.z;\n      const dist = Math.sqrt(dx * dx + dz * dz);\n      \n      if (dist < range) {\n        // Проверяем направление взгляда\n        const toAltarX = altar.position.x - playerPos.x;\n        const toAltarZ = altar.position.z - playerPos.z;\n        const toAltarLen = Math.sqrt(toAltarX * toAltarX + toAltarZ * toAltarZ);\n        \n        if (toAltarLen > 0.1) {\n          const lookX = Math.sin(this.player.state.yaw);\n          const lookZ = -Math.cos(this.player.state.yaw);\n          const dot = (toAltarX / toAltarLen) * lookX + (toAltarZ / toAltarLen) * lookZ;\n          \n          // Если смотрим в сторону алтаря (угол < 60°)\n          if (dot > 0.5) {\n            return i;\n          }\n        }\n      }\n    }\n    return null;\n  }\n\n  /** Проверка сплеш-атаки - горизонтальная волна */\n  private checkSplashAttack(): void {\n    const playerPos = this.player.getEyePosition();\n    \n    // Сплеш бьёт всех врагов в радиусе\n    const hits = this.targetManager.trySplashWave(\n      playerPos,\n      this.player.state.yaw,\n      this.weapon.splashRadius\n    );\n    \n    if (hits > 0) {\n      this.lastSliceTime = this.gameTime;\n      this.weaponRenderer.showSplashWave(this.player.state.yaw);\n      this.screenShake = 0.4;\n      this.audio.playSFX('kill');\n      \n      // Показываем сколько убито\n      this.hud.showMessage(`🌊 ВОЛНА x${hits}! 🌊`, 'cyan');\n    }\n    \n    // Обновляем HUD с зарядами\n    this.hud.updateSplashCharges(this.weapon.splashCharges);\n  }\n\n  /** Создать эффект смерти врага */\n  private spawnDeathEffect(position: Vec3): void {\n    // Ищем неактивный слот или создаём новый\n    let effect = this.deathEffects.find(e => !e.active);\n    if (!effect && this.deathEffects.length < 8) {\n      effect = { position: { x: 0, y: 0, z: 0 }, progress: 0, active: false };\n      this.deathEffects.push(effect);\n    }\n    \n    if (effect) {\n      effect.position = { ...position };\n      effect.progress = 0.01; // Начинаем с малого значения\n      effect.active = true;\n    }\n  }\n  \n  /** Обновить эффекты смерти */\n  private updateDeathEffects(dt: number): void {\n    for (const effect of this.deathEffects) {\n      if (effect.active) {\n        effect.progress += dt / this.DEATH_EFFECT_DURATION;\n        if (effect.progress >= 1.0) {\n          effect.active = false;\n        }\n      }\n    }\n  }\n  \n  /** Угол и расстояние до ближайшего врага для автонаведения катаны */\n  private getKatanaTargetData(): [number, number] {\n    const playerPos = this.player.getEyePosition();\n    const playerYaw = this.player.state.yaw;\n    \n    let nearestAngle = -1; // -1 = нет врага поблизости\n    let nearestDist = 100;\n    \n    const maxRange = 5.0; // Максимальная дистанция для автонаведения\n    const maxAngle = Math.PI / 2; // 90 градусов в каждую сторону\n    \n    for (const target of this.targetManager.targets) {\n      if (!target.active) continue;\n      \n      const dx = target.position.x - playerPos.x;\n      const dz = target.position.z - playerPos.z;\n      const dist = Math.sqrt(dx * dx + dz * dz);\n      \n      if (dist > maxRange) continue;\n      \n      // Угол к врагу относительно направления взгляда\n      const angleToTarget = Math.atan2(dx, -dz);\n      let angleDiff = angleToTarget - playerYaw;\n      \n      // Нормализуем угол\n      while (angleDiff > Math.PI) angleDiff -= Math.PI * 2;\n      while (angleDiff < -Math.PI) angleDiff += Math.PI * 2;\n      \n      // Враг в поле зрения?\n      if (Math.abs(angleDiff) > maxAngle) continue;\n      \n      // Ближе чем текущий?\n      if (dist < nearestDist) {\n        nearestDist = dist;\n        nearestAngle = angleDiff;\n      }\n    }\n    \n    return [nearestAngle, nearestDist];\n  }\n  \n  /** Количество фрагментов для шейдера */\n  private getFragmentCount(): number {\n    let count = 0;\n    for (const target of this.targetManager.targets) {\n      count += target.fragments.length;\n    }\n    return count;\n  }\n  \n  /** Данные эффектов смерти для шейдера */\n  private getDeathEffectsData(): Float32Array {\n    const data = new Float32Array(32); // 8 эффектов * 4 компонента\n    for (let i = 0; i < Math.min(this.deathEffects.length, 8); i++) {\n      const effect = this.deathEffects[i];\n      if (effect.active) {\n        data[i * 4 + 0] = effect.position.x;\n        data[i * 4 + 1] = effect.position.y;\n        data[i * 4 + 2] = effect.position.z;\n        data[i * 4 + 3] = effect.progress;\n      }\n    }\n    return data;\n  }\n\n  /** Активация адреналина за комбо-убийства */\n  private activateComboAdrenaline(): void {\n    // Сбрасываем счётчик комбо\n    this.killTimes = [];\n    \n    // Активируем буйство\n    this.player.activateStimpack();\n    this.audio.playSFX('kill');\n    this.hud.showMessage('🔥🔥🔥 КОМБО АДРЕНАЛИН! 🔥🔥🔥', 'red');\n    this.hud.showRageOverlay(8.0);\n    this.screenShake = 0.5;\n  }\n\n  /** Рендеринг */\n  private render(): void {\n    // Данные врагов для шейдера\n    const targetsData = this.targetManager.getShaderData();\n    const targetCount = this.targetManager.targets.length;\n\n    // Данные луж для шейдера\n    const poolsData = this.targetManager.getPoolsShaderData();\n    const poolCount = this.targetManager.toxicPools.length;\n\n    // Данные пикапов для шейдера\n    const pickupsData = this.pickupManager.getShaderData();\n    const pickupCount = this.pickupManager.pickups.length;\n\n    // Тряска камеры\n    let yaw = this.player.state.yaw;\n    let pitch = this.player.state.pitch;\n    \n    if (this.screenShake > 0) {\n      yaw += (Math.random() - 0.5) * this.screenShake * 0.1;\n      pitch += (Math.random() - 0.5) * this.screenShake * 0.1;\n    }\n\n    // Вспышка при ударе\n    const sliceFlash = Math.max(0, 0.3 - (this.gameTime - this.lastSliceTime)) * 3;\n\n    // Данные кристаллов (для волны 10)\n    const crystalsData = this.targetManager.getCrystalsData();\n\n    // Данные летящих снарядов кислоты\n    const acidProjectilesData = this.targetManager.getAcidProjectilesData();\n    const acidProjectileCount = this.targetManager.acidProjectiles.length;\n\n    // Данные лазеров спайкеров\n    const spikesData = this.targetManager.getSpikesData();\n    const spikeTargetsData = this.targetManager.getSpikeTargetsData();\n    const spikeCount = Math.min(this.targetManager.spikes.length, 8);\n\n    // Данные зон кислотного дождя\n    const acidRainZonesData = this.targetManager.getAcidRainZonesData();\n    const acidRainZoneCount = this.targetManager.acidRainZones.length;\n    \n    // Данные алтарей [x, y, z, score]\n    const altarsData = new Float32Array(8);\n    for (let i = 0; i < this.altars.length; i++) {\n      altarsData[i * 4 + 0] = this.altars[i].position.x;\n      altarsData[i * 4 + 1] = this.altars[i].position.y;\n      altarsData[i * 4 + 2] = this.altars[i].position.z;\n      altarsData[i * 4 + 3] = this.altars[i].score;\n    }\n    \n    // Данные лучей [x, y, z, active] и направления [dx, dy, dz, speed]\n    const dartsData = new Float32Array(64); // 16 лучей * 4\n    const dartDirsData = new Float32Array(64); // 16 направлений * 4\n    const dartCount = Math.min(this.flyingDarts.length, 16);\n    for (let i = 0; i < dartCount; i++) {\n      const dart = this.flyingDarts[i];\n      dartsData[i * 4 + 0] = dart.position.x;\n      dartsData[i * 4 + 1] = dart.position.y;\n      dartsData[i * 4 + 2] = dart.position.z;\n      dartsData[i * 4 + 3] = dart.active ? 1.0 : 0.0;\n      \n      // Нормализованное направление\n      const speed = Math.sqrt(dart.velocity.x ** 2 + dart.velocity.y ** 2 + dart.velocity.z ** 2);\n      dartDirsData[i * 4 + 0] = dart.velocity.x / (speed || 1);\n      dartDirsData[i * 4 + 1] = dart.velocity.y / (speed || 1);\n      dartDirsData[i * 4 + 2] = dart.velocity.z / (speed || 1);\n      dartDirsData[i * 4 + 3] = speed;\n    }\n\n    // Рендерим сцену\n    // Данные гранат для шейдера\n    const grenadesData = this.getGrenadesData();\n    const grenadeCount = this.grenades.filter(g => g.active).length;\n    \n    // Данные взрывов для шейдера\n    const explosionsData = this.getExplosionsData();\n    const explosionCount = this.explosions.filter(e => e.active).length;\n    \n    this.renderer.render(\n      this.gameTime,\n      this.player.getEyePosition(),\n      yaw,\n      pitch,\n      targetsData,\n      targetCount,\n      sliceFlash,\n      poolsData,\n      poolCount,\n      this.currentEra,\n      this.targetManager.wave,\n      pickupsData,\n      pickupCount,\n      crystalsData,\n      acidProjectilesData,\n      acidProjectileCount,\n      spikesData,\n      spikeTargetsData,\n      spikeCount,\n      acidRainZonesData,\n      acidRainZoneCount,\n      this.targetManager.greenBossPhase2,\n      this.isInVoid,\n      0, // voidProgress (не используется в Eclipse режиме)\n      this.voidFallOffset,\n      this.isInVoid ? this.portalPos : undefined, // Позиция портала\n      altarsData,\n      dartsData,\n      dartDirsData,\n      dartCount,\n      this.voidPortalActive ? this.voidPortalLifetime : 0,\n      this.getBloodCoinsData(),\n      this.voidCoins.filter(c => c.active).length,\n      grenadesData,\n      grenadeCount,\n      explosionsData,\n      explosionCount,\n      this.voidVariant,\n      // Катана 3D\n      this.weaponRenderer.attackProgress,\n      this.weapon.state.bobPhase,\n      this.weaponRenderer.splashCharges,\n      ...this.getKatanaTargetData(), // targetAngle, targetDist\n      this.weapon.attackType, // Тип удара (0=справа, 1=слева, 2=сплеш)\n      // Эффекты смерти врагов\n      this.getDeathEffectsData(),\n      // Фрагменты врагов (разрубленные куски)\n      this.targetManager.getAllFragmentsData(),\n      Math.min(this.getFragmentCount(), 32)\n    );\n\n    // 2D эффекты оружия (частицы, вспышки) - катана теперь в 3D\n    this.weaponRenderer.setSceneLighting(this.currentEra);\n    this.weaponRenderer.render(this.weapon.state, this.gameTime);\n  }\n  \n  /** Данные монет крови для шейдера */\n  private getBloodCoinsData(): Float32Array {\n    const data = new Float32Array(48); // 12 монет * 4\n    const activeCoins = this.voidCoins.filter(c => c.active);\n    for (let i = 0; i < Math.min(activeCoins.length, 12); i++) {\n      const coin = activeCoins[i];\n      data[i * 4 + 0] = coin.position.x;\n      data[i * 4 + 1] = coin.position.y;\n      data[i * 4 + 2] = coin.position.z;\n      data[i * 4 + 3] = 1.0; // active\n    }\n    return data;\n  }\n  \n  /** Данные гранат для шейдера */\n  private getGrenadesData(): Float32Array {\n    const data = new Float32Array(32); // 8 гранат * 4\n    const activeGrenades = this.grenades.filter(g => g.active);\n    for (let i = 0; i < Math.min(activeGrenades.length, 8); i++) {\n      const g = activeGrenades[i];\n      data[i * 4 + 0] = g.position.x;\n      data[i * 4 + 1] = g.position.y;\n      data[i * 4 + 2] = g.position.z;\n      data[i * 4 + 3] = g.lifetime;\n    }\n    return data;\n  }\n  \n  /** Данные взрывов для шейдера */\n  private getExplosionsData(): Float32Array {\n    const data = new Float32Array(32); // 8 взрывов * 4\n    const activeExplosions = this.explosions.filter(e => e.active);\n    for (let i = 0; i < Math.min(activeExplosions.length, 8); i++) {\n      const e = activeExplosions[i];\n      data[i * 4 + 0] = e.position.x;\n      data[i * 4 + 1] = e.position.y;\n      data[i * 4 + 2] = e.position.z;\n      data[i * 4 + 3] = e.progress;\n    }\n    return data;\n  }\n\n  /** Обработка resize */\n  private handleResize(): void {\n    const dpr = window.devicePixelRatio || 1;\n\n    this.weaponCanvas.width = window.innerWidth * dpr;\n    this.weaponCanvas.height = window.innerHeight * dpr;\n    this.weaponCanvas.style.width = window.innerWidth + 'px';\n    this.weaponCanvas.style.height = window.innerHeight + 'px';\n\n    this.weaponRenderer.resize(this.weaponCanvas.width, this.weaponCanvas.height);\n  }\n\n  /** Полноэкранный режим */\n  private toggleFullscreen(): void {\n    if (!document.fullscreenElement) {\n      document.documentElement.requestFullscreen();\n    } else {\n      document.exitFullscreen();\n    }\n  }\n\n  /** Уничтожить игру */\n  public destroy(): void {\n    this.stop();\n    this.input.destroy();\n    this.audio.stop();\n    this.renderer.destroy();\n  }\n}\n","import { Game } from '@/core/Game';\nimport './styles.css';\n\n/**\n * Точка входа приложения\n * Dungeon Synth Shooter\n */\nfunction main(): void {\n  // Получаем canvas элементы\n  const canvas = document.getElementById('game-canvas') as HTMLCanvasElement;\n  const weaponCanvas = document.getElementById('weapon-canvas') as HTMLCanvasElement;\n\n  if (!canvas || !weaponCanvas) {\n    console.error('Canvas элементы не найдены!');\n    return;\n  }\n\n  // Создаём игру\n  const game = new Game(canvas, weaponCanvas);\n\n  // Делаем доступной глобально для отладки\n  (window as any).game = game;\n\n  console.log('🎮 Dungeon Synth Shooter загружен');\n  console.log('📖 Управление: WASD, SHIFT (бег), SPACE (прыжок), LMB (стрельба), R (перезарядка)');\n  console.log('🔊 M - mute, F - fullscreen');\n}\n\n// Запускаем после загрузки DOM\nif (document.readyState === 'loading') {\n  document.addEventListener('DOMContentLoaded', main);\n} else {\n  main();\n}\n\n\n\n\n\n\n\n\n\n"],"names":["GameLoop","updateFn","renderFn","currentTime","deltaTime","interpolation","Input","value","canvas","e","onLockChange","code","pressed","dx","dy","vec3","x","y","z","subVec3","a","b","lengthVec3","v","distanceVec3","clamp","min","max","DEFAULT_CONFIG","Player","startPosition","config","collision","dt","input","mouseDelta","state","moveX","moveZ","moveLen","sin","cos","worldMoveX","worldMoveZ","distFromCenter","onBridge","baseSpeed","waterFactor","speed","targetVx","targetVz","targetY","friction","heightDiff","airFriction","newPosX","newPosY","newPosZ","testPosX","testPosZ","minY","testPosY","ceilingHeight","yaw","pitch","amount","position","Weapon","isMoving","isRunning","bobSpeed","isSplash","playerPos","playerYaw","targetPos","dz","dist","angleDiff","bobX","bobY","attackOffsetX","attackOffsetY","t","_playerPos","_playerDir","WeaponRenderer","width","height","era","color","intensity","match","r","g","ar","ag","ab","brightness","centerX","centerY","colors","i","angle","heightLimit","writeIndex","p","ctx","alpha","time","scale","baseX","baseY","rotation","easeOut","moveMultiplier","darkFactor","tintR","tintG","tintB","pulse","maxRadius","currentRadius","sparkCount","sparkR","size","progress","cyanGrad","offset","_state","tsukaGrad","glow","bladeGrad","wave","sparkColor","charges","weaponType","gradient","Target","id","type","dirX","dirZ","aggression","currentSpeed","offsetX","offsetZ","perpX","perpZ","newX","newZ","wobble","orbitRadius","orbitHeight","obstacleHeight","testPos","dodgedDirX","dodgedDirZ","zigzag","force","len","baseRadius","spitCooldownActual","rainTarget","spitTarget","spitStart","extra","dirY","speedMult","spawnAngle","spawnDist","spawnPos","orbitSpeed","targetX","targetZ","toOrbitX","toOrbitZ","pullStrength","_time","distXZ","gravity","jumpForce","jumpSpeed","wingCycle","bobAmount","maneuverType","sideAngle","maneuverFade","newAngle","radialSpeed","targetHeight","arenaRadius","f","sliceDirection","sliceLen","numSplash","w","data","PORTAL_POSITIONS","TargetManager","startWave","bossConfigs","boss","pos","startPos","phase","platformPositions","banelingCount","phantomCount","runnerCount","hopperCount","spikerCount","useLeftPortal","j","item","portal","enemy","leftIdx","rightIdx","cd","target","proj","laser","laserDir","laserLen","toPlayer","clampedProj","closest","s","pool","zone","poolRadius","range","playerGrounded","attackType","forwardX","forwardZ","rightX","rightZ","swingDirX","swingDirZ","dist3D","effectiveRange","sliceDir","killed","spawnCount","knockbackForce","radius","killCount","waveForwardX","waveForwardZ","effectiveRadius","toTargetLen","typeIntensity","allFragments","bossPos","baneling","phantom","crystal","remaining","c","minDist","_count","_position","_damage","Pickup","PickupManager","pickup","spot","AudioManager","distortion","samples","curve","deg","duration","convolver","rate","length","impulse","channel","decay","mod","now","proximity","freq","volume","filterFreq","vibrato","enemyType","distance","lastPlayed","cooldown","ctxNow","vol","osc","gain","filter","osc1","osc2","bufferSize","buffer","syllable","envelope","noise","hipass","tone","tone2","toneGain","toneFilter","sigh","sighGain","warp","warpGain","zap","zapGain","boom","boomGain","acidNoise","acidGain","acidFilter","acidFilter2","delay","bubble","bubbleGain","hiss","hissGain","hissFilter","whistle","whistleGain","whistleFilter","hum","humGain","impact","impactGain","impactFilter","noiseBuffer","noiseData","noiseGain","noiseFilter","voice","voiceGain","voiceFilter","voice2","voice2Gain","breathNoise","breathGain","breathFilter","bubbleFilter","baseFreq","noiseLen","scrape","scrapeGain","scrapeFilter","boing","boingGain","zapFilter","roar","roarGain","roarFilter","roar2","roar2Gain","env","lfo","lfoGain","scream","screamGain","screamFilter","vibratoGain","click","clickGain","glitch","glitchGain","swoosh","swooshGain","swooshFilter","dark","darkGain","whisper","whisperGain","whisperFilter","crackle","crackleGain","thud","thudGain","sparks","sparksGain","sparksFilter","kick","kickGain","isInhale","splat","splatGain","splatFilter","source","whooshNoise","whooshGain","whooshFilter","whooshFilter2","metal","metalGain","lowWhoosh","lowGain","lowFilter","waveGain","waveFilter","noiseSource","resonance","resonanceGain","subBass","subGain","charge","charge2","chargeGain","chargeFilter","shimmer","shimmerGain","noiseSource2","noiseGain2","noiseFilter2","spit","spitGain","splash","splashGain","splashFilter","warn","warnGain","warnFilter","beep","beepGain","rain","rainGain","rainFilter","rumble","rumbleGain","gong","gongGain","gong2","gong2Gain","newEra","interval","sampleRate","sample","lowpass","highpass","playThunder","thunderGain","crackOsc","crackGain","crackFilter","playDrone","padNotes","padIndex","playPad","notes","playShimmer","freqs","shimmerLoop","nextDelay","beat","playBeat","playEerie","playGravity","bassNotes","noteIndex","playBass","arpNotes","arpIndex","playArp","delayGain","playKick","chord","playZap","enabled","playHeartbeat","playSpark","playWarning","note","playStatic","bossType","playHeavyKick","playEvilSynth","playAlarm","start","oscGain","playRiser","playSubDrop","playNoiseSweep","playFastHihat","acidPattern","slidePattern","step","playAcidBass","isSlide","filterStart","filterPeak","accent","hihatStep","playHihat","isOffbeat","playAcidScream","bassIndex","playDubBass","echo","echoOsc","echoFilter","echoGain","echoTime","echoVol","breakPattern","breakIndex","playBreakHit","hit","playDubChord","playSubDrone","playFx","oscFilter","playRiserHit","hitOsc","hitGain","playBassNote","playArpNote","padChords","chordIndex","playPadChord","snare","snareGain","snareFilter","snareTone","snareToneGain","hihat","hihatGain","hihatFilter","VERTEX_SHADER","FRAGMENT_SHADER","WebGLRenderer","gl","vertShader","fragShader","shader","vertices","vbo","posLoc","dpr","cameraPos","cameraYaw","cameraPitch","targetsData","targetCount","muzzleFlash","poolsData","poolCount","pickupsData","pickupCount","crystalsData","acidProjectilesData","acidProjectileCount","spikesData","spikeTargetsData","spikeCount","acidRainZonesData","acidRainZoneCount","greenBossPhase2","voidMode","voidProgress","voidFallOffset","portalPos","altarsData","dartsData","dartDirsData","dartCount","voidPortalActive","bloodCoinsData","bloodCoinCount","grenadesData","grenadeCount","explosionsData","explosionCount","voidVariant","katanaAttack","katanaBob","katanaCharges","katanaTargetAngle","katanaTargetDist","katanaAttackType","deathEffectsData","fragmentsData","fragmentCount","paddedData","HUD","hudEl","el","weapon","health","maxHealth","ratio","score","valueEl","total","count","_cooldown","isReady","_wave","enemiesLeft","ammoPanel","frags","enemyEl","fragsPanel","_show","isKill","text","msg","hp","maxHp","barContainer","bossName","barColor","percent","onComplete","bossSubtitle","glowColor","icon","overlay","iconEl","nameEl","subtitleEl","lineLeft","lineRight","lineStyle","maxDistance","titleEl","hintEl","style","success","CollisionSystem","leftPortalX","leftCol1","leftCol2","rightPortalX","portalColumns","col","leftPlatDist","pillarX","pillarZ","rightPlatDist","allPlatforms","plat","feetY","onBridgeX","onBridgeZ","leftStairStartX","leftStairEndX","leftPlatformEnd","rightStairStartX","rightStairEndX","rightPlatformEnd","side","platX","columnPositions","checkDist","checkX","checkZ","Game","weaponCanvas","scoreValue","knockbackDir","knockDist","knockForce","damage","_pos","_portalSide","volumeSlider","volumeValue","sensSlider","sensValue","btn","modalId","modal","content","effectiveDt","vortexPull","targetAngle","_","pickedUp","totalAltarScore","sum","hpPercent","altar","portalAngle","onMainIsland","onPortalIsland","toPortalDir","portalDist","bridgeLen","onFragment","fragmentFloorY","fragmentPos","randX","randZ","randY","fract","fragmentSize","sizeX","sizeZ","fragCenterX","fragCenterZ","fragY","rotAngle","localX","localZ","floorY","distToPortal","offsetAngle","phantomId","exitOffset","detached","smartAttackType","altarHit","dartsEarned","coinX","coinZ","islandCoins","coin","voidNames","spread","spreadX","spreadY","spreadZ","dart","d","grenade","damageMultiplier","teleportAngle","teleportDist","selfDamage","exp","toAltarX","toAltarZ","toAltarLen","lookX","lookZ","hits","effect","nearestAngle","nearestDist","maxRange","maxAngle","sliceFlash","activeCoins","activeGrenades","activeExplosions","main","game"],"mappings":"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AAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;A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"}